(function(){var x=0,t={},k=window.MetaphorJs,p=k.getValue,h=k.extend,g=k.isArray,e=k.trim,l=k.bind,u=k.addListener,G=k.removeListener,r=k.addClass,q=k.removeClass,H=k.lib.Input,y=k.select,v=k.normalizeEvent,z=function(a,b,c){var d,f=a.childNodes;if(!1!==b.call(c,a))for(a=-1,d=f.length>>>0;++a!==d;z(f[a],b,c));},A=MetaphorJs.lib.Observable,w=function(a,b){var c=0;switch(b.nodeName.toLowerCase()){case "select":return z(b,function(a){a.selected&&c++}),c;case "input":if(/radio|checkbox/i.test(b.type))return z(b.form,
function(a){a.type==b.type&&a.name==b.name&&a.checked&&c++}),c}return a.length},m=function(a,b){if(!b)return void 0===a||""===a||null===a;switch(b.nodeName.toLowerCase()){case "select":var c=p(b);return!c||0==c.length;case "input":if(/radio|checkbox/i.test(b.type))return 0==w(a,b)}return 0==e(a).length},B=function(a,b){if("function"==typeof b)return a;g(b)||(b=[b]);var c,d=b.length;for(c=-1;++c<d;a=a.replace(new RegExp("\\{"+c+"\\}","g"),b[c]));return a},s={};h(s,{required:function(a,b,c){return!1===
c?!0:!m(a,b)},regexp:function(a,b,c){c=c instanceof RegExp?c:new RegExp(c);return m(a,b)||c.test(a)},notregexp:function(a,b,c){c=c instanceof RegExp?c:new RegExp(c);return m(a,b)||!c.test(a)},minlength:function(a,b,c){return m(a,b)||(b?w(e(a),b)>=c:a.toString().length>=c)},maxlength:function(a,b,c){return m(a,b)||(b?w(e(a),b)<=c:a.toString().length<=c)},rangelength:function(a,b,c){var d=b?w(e(a),b):a.toString().length;return m(a,b)||d>=c[0]&&d<=c[1]},min:function(a,b,c){return m(a,b)||parseInt(a,
10)>=c},max:function(a,b,c){return m(a,b)||parseInt(a,10)<=c},range:function(a,b,c){a=parseInt(a,10);return m(a,b)||a>=c[0]&&a<=c[1]},email:function(a,b){return m(a,b)||/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i.test(a)},
url:function(a,b){return m(a,b)||/^((https?|ftp):\/\/|)(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(a)},
date:function(a,b){return m(a,b)||!/Invalid|NaN/.test(new Date(a))},dateiso:function(a,b){return m(a,b)||/^\d{4}[\/-]\d{1,2}[\/-]\d{1,2}$/.test(a)},number:function(a,b){return m(a,b)||/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/.test(a)},digits:function(a,b){return m(a,b)||/^\d+$/.test(a)},creditcard:function(a,b){if(m(a,b))return!0;if(/[^0-9-]+/.test(a))return!1;var c=0,d=!1,f;a=a.replace(/\D/g,"");for(var e=a.length-1;0<=e;e--)f=a.charAt(e),f=parseInt(f,10),d&&9<(f*=2)&&(f-=9),c+=f,d=!d;return 0==
c%10},accept:function(a,b,c){c="string"==typeof c?c.replace(/,/g,"|"):"png|jpe?g|gif";return m(a,b)||a.match(new RegExp(".("+c+")$","i"))},equalto:function(a,b,c,d){c=(b=d.getValidator().getField(c))?b.getElem():c;return a==p(c)},notequalto:function(a,b,c,d){c=(b=d.getValidator().getField(c))?b.getElem():c;return a!=p(c)},zxcvbn:function(a,b,c){return zxcvbn(a).score>=parseInt(c)}});var C={required:"This field is required.",remote:"Please fix this field.",email:"Please enter a valid email address.",
url:"Please enter a valid URL.",date:"Please enter a valid date.",dateISO:"Please enter a valid date (ISO).",number:"Please enter a valid number.",digits:"Please enter only digits.",creditcard:"Please enter a valid credit card number.",equalTo:"Please enter the same value again.",accept:"Please enter a value with a valid extension.",maxlength:"Please enter no more than {0} characters.",minlength:"Please enter at least {0} characters.",rangelength:"Please enter a value between {0} and {1} characters long.",
range:"Please enter a value between {0} and {1}.",max:"Please enter a value less than or equal to {0}.",min:"Please enter a value greater than or equal to {0}."},I={allowSubmit:!0,alwaysCheck:!1,alwaysDisplayState:!1,data:null,ignore:null,disabled:!1,cls:{valid:"",error:"",ajax:""},errorBox:{cls:"",fn:null,tag:"",position:"after",elem:null,enabled:!0},callback:{scope:null,destroy:null,statechange:null,errorchange:null,submit:null,check:null,beforeAjax:null,afterAjax:null,displaystate:null},rules:{},
messages:{}},D=function(a){if(!a)return{};var b=function(b,d,f){var e=a[b],g=!1;if(void 0!==e){switch(f){case "string":g="string"==typeof e;break;case "function":g="function"==typeof e;break;case "boolean":if(!0===e||!1===e)g=!0}g&&(a[b]={},a[b][d]=e)}};b("errorBox","enabled","boolean");b("errorBox","tag","string");b("errorBox","fn","function");return a},E=function(a,b,c){b=b||{};var d,f;this._observable=new A;h(this,this._observable.getApi());this.cfg=d=h({},I,D(n.fieldDefaults),D(b),!0);this.input=
new H(a,this.onInputChange,this,this.onInputSubmit);this.elem=a;this.vldr=c;this.callbackScope=f=d.callback.scope;this.enabled=!a.disabled;this.id=a.getAttribute("name")||a.getAttribute.attr("id");this.data=b.data;this.rules={};d.messages=h({},C,n.messages,d.messages,!0);a.setAttribute("data-validator",c.getVldId());this.input.radio&&this.initRadio();for(var e in d.callback)if(d.callback[e])this.on(e,d.callback[e],f);d.rules&&this.setRules(d.rules,!1);this.readRules();this.prev=this.input.getValue();
d.disabled&&this.disable()};h(E.prototype,{vldr:null,elem:null,rules:null,cfg:null,callbackScope:null,input:null,enabled:!0,valid:null,dirty:!1,id:null,prev:"",error:null,errorRule:null,pending:null,rulesNum:0,displayState:!1,data:null,checking:!1,checkTmt:null,errorBox:null,customError:!1,getValidator:function(){return this.vldr},initRadio:function(){var a=this.input.radio,b=this.vldr.getVldId(),c,d;c=0;for(d=a.length;c<d;c++)a[c].setAttribute("data-validator",b)},setRules:function(a,b){b=void 0==
b?!0:b;for(var c in a)this.setRule(c,a[c],!1);b?this.check(!1):this.setValidState(null);return this},setRule:function(a,b,c){var d=this.rules;c=void 0==c?!0:c;null===b?(d[a]&&this.rulesNum--,delete d[a]):(d[a]||this.rulesNum++,d[a]=b,null!==this.valid&&this.setValidState(!1));c?this.check(!1):this.setValidState(null);return this},setMessage:function(a,b){this.cfg.messages[a]=b;return this},setMessages:function(a){for(var b in a)this.setMessage(b,a[b]);return this},getMessages:function(){return h({},
this.cfg.messages)},readRules:function(){var a=this.elem,b=a.className,c={},d,f;for(f in s)s.hasOwnProperty(f)&&(d=a.getAttribute(f)||a.getAttribute("data-validate-"+f),null!==d&&void 0!=d&&!1!==d&&("minlength"!=f&&"maxlength"!=f||-1!=parseInt(d,10))&&(c[f]=d,(d=a.getAttribute("data-message-"+f))&&this.setMessage(f,d)));if(d=a.getAttribute("remote"))c.remote=d;if(b)for(b=b.split(" "),f=0,d=b.length;f<d;f++)if(a=e(b[f]),s[a]||"remote"==a)c[a]=!0;for(f in c)this.setRule(f,c[f],!1)},getRules:function(){return this.rules},
hasRule:function(a){return this.rules[a]?!0:!1},getValue:function(){return this.input.getValue()},getUserData:function(){return this.data},setUserData:function(a){var b=this.data;this.data=a;return b},isEmpty:function(){return m(this.getValue(),this.elem)},enable:function(){this.enabled=!0;this.vldr.reset();return this},disable:function(){this.enabled=!1;!1===this.valid&&(this.setValidState(!0),this.doDisplayState());return this},enableDisplayState:function(){this.displayState=!0},disableDisplayState:function(){this.displayState=
!1},isDisplayStateEnabled:function(){return this.displayState},toggleErrorBox:function(a){var b=this.cfg,c=b.errorBox.enabled;b.errorBox.enabled=a;!c&&a&&a.displayState&&!1===this.valid()&&this.doDisplayState()},isEnabled:function(){return this.enabled},getElem:function(){return this.elem},getName:function(){return this.id},getError:function(){return this.error},getErrorRule:function(){return this.errorRule},isValid:function(){return this.isEnabled()?this.customError?!1:!0===this.valid&&!this.pending||
0===this.rulesNum:!0},getExactValidState:function(){return this.valid},setCustomError:function(a,b){this.customError=a?!0:!1;this.setValidState(a?!1:!0);this.setError(!0===a?null:a,b);this.doDisplayState()},reset:function(){this.abort();this.dirty=!1;this.prev="";this.setValidState(null);this.setError(null);this.doDisplayState();return this},abort:function(){this.pending&&(this.pending.abort(),this.pending=null);return this},check:function(a){var b=this.rules,c=this.cfg,d=this.elem;if(!this.isEnabled())return!0;
if(this.customError)return!1;if(0==this.rulesNum&&!1!==this.valid)return!0;if(this.checking)return this.checkTmt||(this.checkTmt=setTimeout(l(this.checkTimeout,this),100)),!0===this.valid;this.checking=!0;if(!(!0===a||b.equalTo||b.notEqualTo||this.dirty||null===this.valid||c.alwaysCheck))return this.pending||this.doDisplayState(),this.checking=!1,!0===this.valid;var f=!0,e=!1,g=this.getValue(),u,h;for(h in b)if("remote"==h){if(this.dirty||c.alwaysCheck||null===this.valid||!0===a)if(g||b[h].checkEmpty)e=
!0}else if(!0!==(u=("function"==typeof b[h]?b[h]:s[h]).call(this.callbackScope,g,d,b[h],this))){f=!1;this.setError(B(u||c.messages[h]||"",b[h]),h);break}e=e&&f;f&&this.setError(null);e?this.ajaxCheck():(this.setValidState(f),this.doDisplayState());this.checking=this.dirty=!1;this.trigger("check",this,this.valid);return!0===this.valid&&!e},doDisplayState:function(){var a=this.cfg,b=this.isValid(),c=a.cls.error,d=a.cls.valid,f=this.elem;this.displayState||a.alwaysDisplayState||(b=null);null===this.valid&&
(b=null);c&&(!1===b?r(f,c):q(f,c));d&&(!0===b?r(f,d):q(f,d));c=this.getErrorBox();d=this.error;c&&(!1===b&&d&&(c.innerHTML=state.error),c.style.display=!1===b&&d&&a.errorBox.enabled?"block":"none");this.trigger("displaystate",this,b,this.error)},getErrorBox:function(){var a=this.cfg.errorBox;return a.tag||a.fn||a.selector?(!this.errorBox&&a.enabled&&this.createErrorBox(),this.errorBox):null},destroy:function(){this.trigger("destroy",this);this.elem.removeAttribute("data-validator");this.errorBox&&
this.errorBox.parentNode.removeChild(this.errorBox);this.input.destroy();delete this.input;this._observable.destroy();delete this._observable;delete this.vldr;delete this.cfg;delete this.errorBox;delete this.rules;delete this.elem},isPending:function(){return null!==this.pending},setValidState:function(a){this.valid!==a&&(this.valid=a,this.trigger("statechange",this,a))},setError:function(a,b){if(this.error!=a||this.errorRule!=b)this.error=a,this.errorRule=b,this.trigger("errorchange",this,a,b)},
checkTimeout:function(){this.checkTmt=null;this.checking||this.check(!1)},onInputChange:function(a){this.prev!==a&&(this.dirty=!0,this.customError=!1,this.abort(),this.pending||this.check(!1),this.prev=this.input.getValue())},onInputSubmit:function(a){a=v(a);if(!(a.isDefaultPrevented&&a.isDefaultPrevented()||!1!==this.trigger("submit",this,a)))return a.preventDefault(),!1},createErrorBox:function(){var a=this.cfg.errorBox,b=a.tag,c=a.cls,d=a.fn,f=a.position,a=a.elem;d?this.errorBox=d.call(this.callbackScope,
this):a?this.errorBox=a:(this.errorBox=document.createElement(b),this.errorBox.className=c,b=(b=this.input.radio)?b[b-1]:this.elem,"appendParent"==f?b.parentNode.appendChild(this.errorBox):"before"==f?b.parentNode.insertBefore(this.errorBox,b):b.parentNode.insertBefore(this.errorBox,b.nextSibling))},ajaxCheck:function(){var a=this.elem,b=this.rules.remote,c=this.getValue(),d=this.cfg,b=h({},"string"==typeof b?{url:b}:b,!0);b.data=b.data||{};b.data[b.paramName||a.getAttribute("name")||a.getAttribute("id")]=
c;b.handler||(b.dataType="text");b.cache=!1;d.cls.ajax&&r(a,d.cls.ajax);this.trigger("beforeAjax",this,b);this.pending=(window.MetaphorJs?MetaphorJs.ajax:jQuery.ajax)(b);this.pending.done(l(this.onAjaxSuccess,this));this.pending.fail(l(this.onAjaxError,this))},onAjaxSuccess:function(a){var b=this.rules,c=this.cfg;this.pending=null;var d=!0;b.remote.handler?(a=b.remote.handler.call(this.callbackScope,this,a),!0!==a&&(this.setError(B(a||c.messages.remote||"",b.remote),"remote"),d=!1)):a?(this.setError(a,
"remote"),d=!1):this.setError(null);c.cls.ajax&&q(this.elem,c.cls.ajax);this.setValidState(d);this.doDisplayState();this.trigger("afterAjax",this)},onAjaxError:function(a,b){var c=this.cfg;c.cls.ajax&&q(this.elem,c.cls.ajax);this.pending=null;"abort"!=b&&"abort"!=a&&(this.setValidState(!1),this.doDisplayState(),this.trigger("afterAjax",this))}});var J={alwaysCheck:!1,alwaysDisplayState:!1,disabled:!1,value:null,elem:null,errorBox:null,errorField:null,data:null,cls:{valid:"",error:""},fields:[],rules:{},
messages:{},callback:{scope:null,destroy:null,statechange:null,errorchange:null,displaystate:null}},F=function(a,b){a=a||{};var c,d;this._observable=new A;this._vldr=b;h(this,this._observable.getApi());this.cfg=c=h({},J,n.groupDefaults,a,!0);this.callbackScope=d=c.callback.scope;this.data=a.data;this.el=a.elem;this.fields={};this.rules={};c.messages=h({},C,n.messages,c.messages,!0);var f;if(c.callback)for(f in c.callback)if(c.callback[f])this.on(f,c.callback[f],d);c.rules&&this.setRules(c.rules,!1);
if(c.fields)for(f=0,d=a.fields.length;f<d;f++)this.add(b.getField(c.fields[f]));this.enabled=!c.disabled};h(F.prototype,{fields:null,rules:null,cfg:null,callbackScope:null,vldr:null,enabled:!1,invalid:null,valid:null,displayState:!1,rulesNum:0,error:null,data:null,errorBox:null,el:null,enable:function(){this.enabled=!0;return this},disable:function(){this.enabled=!1;return this},isEnabled:function(){return this.enabled},isValid:function(){return!this.enabled||0===this.invalid&&!0===this.valid},getExactValidState:function(){return this.valid},
reset:function(){this.invalid=0;this.setValidState(null);this.setError(null);this.doDisplayState();return this},getUserData:function(){return this.data},getName:function(){return this.cfg.name},setRules:function(a,b){b=void 0==b?!0:b;for(var c in a)this.setRule(c,a[c],!1);b?this.check():this.setValidState(null);return this},setRule:function(a,b,c){var d=this.rules;c=void 0==c?!0:c;null===b?(d[a]&&this.rulesNum--,delete d[a]):(d[a]||this.rulesNum++,d[a]=b,null!==this.valid&&this.setValidState(!1));
c?this.check():this.setValidState(null);return this},getRules:function(){return h({},this.rules)},hasRule:function(a){return this.rules[a]?!0:!1},setError:function(a){var b=this.cfg;this.error!=a&&(b.errorField?(this.vldr.getField(b.errorField).setError(a),this.error=null):(this.error=a,this.trigger("errorchange",this,a)))},getError:function(){return this.error},getFields:function(){return this.fields},enableDisplayState:function(){this.displayState=!0;return this},disableDisplayState:function(){this.displayState=
!1;return this},check:function(){var a=this.cfg,b=this.fields,c=this.rules;if(!this.enabled||0==this.rulesNum)return this.setValidState(null),this.doDisplayState(),!0;this.countInvalid();if(0<this.invalid)return this.setValidState(null),this.doDisplayState(),!0;var d={},f=!0,e=null,g;if(a.value){for(g in b)d[g]=b[g].getValue();e=a.value.call(this.callbackScope,d,this)}for(g in c)if(!0!==(b=("function"==typeof c[g]?c[g]:s[g]).call(this.callbackScope,e,null,c[g],this,d))){f=!1;b||a.messages[g]?this.setError(B(b||
a.messages[g]||"",c[g])):this.setError(null);break}f&&this.setError(null);this.setValidState(f);this.doDisplayState();return!0===this.valid},doDisplayState:function(){var a=this.valid,b=this.cfg;this.displayState||b.alwaysDisplayState||(a=null);if(b.errorBox){var c=this.getErrorBox();null!==a?c&&(c.innerHTML=this.error||"",c.style.display=!1===this.valid?"block":"none"):c&&(c.style.display="none")}c=b.cls.error;b=b.cls.valid;a=this.valid;c&&(!1===a?r(this.el,c):q(this.el,c));b&&(!0===a?r(this.el,
b):q(this.el,b));this.trigger("displaystate",this,this.valid)},getErrorBox:function(){var a=this.cfg,b=this.fields,c=a.errorBox;if(b[c])return b[c].getErrorBox();this.errorBox||(this.errorBox="function"==typeof a.errorBox?a.errorBox.call(this.callbackScope,this):a.errorBox);return this.errorBox},destroy:function(){var a=this.fields,b;for(b in a)a[b]&&(this.setFieldEvents(a[b],"un"),delete a[b]);this.errorBox&&this.errorBox.parentNode.removeChild(this.errorBox);this._observable.destroy();delete this._observable;
delete this.vldr;delete this.rules;delete this.fields;delete this.cfg},add:function(a){var b=this.fields,c=a.getName();b[c]||(b[c]=a,this.setFieldEvents(a,"on"))},setFieldEvents:function(a,b){a[b]("statechange",this.onFieldStateChange,this)},remove:function(a){var b=this.fields,c=a.getName();b[c]&&(delete b[c],this.setFieldEvents(a,"un"));return this},setValidState:function(a){this.valid!==a&&(this.valid=a,this.trigger("statechange",this,a))},countInvalid:function(){var a=this.fields;this.invalid=
0;for(var b in a)this.invalid+=a[b].isValid()?0:1},onFieldStateChange:function(a,b){this.trigger("fieldstatechange",this,a,b);this.check()}});var K={form:null,all:{},fields:{},rules:{},cls:{valid:"",error:"",checking:""},groups:{},callback:{scope:null,destroy:null,reset:null,beforesubmit:null,submit:null,statechange:null,check:null,displaystate:null,displaystatechange:null}},n=function(a,b,c){var d=a.nodeName.toLowerCase();this.vldId=++x;t[this.vldId]=this;a.setAttribute("data-validator",this.vldId);
this.el=a;b&&"string"!=typeof b&&(c=b,b=null);this._observable=new A;this.cfg=a=h({},K,n.defaults,n[b],c,!0);this.callbackScope=b=a.callback.scope;this.isForm="form"==d;this.isField=/input|select|textarea/.test(d);this.fields={};this.groups={};h(this,this._observable.getApi());this.onRealSubmitClickDelegate=l(this.onRealSubmitClick,this);this.resetDelegate=l(this.reset,this);this.onSubmitClickDelegate=l(this.onSubmitClick,this);this.onFormSubmitDelegate=l(this.onFormSubmit,this);delete a.callback.scope;
var f,e;for(e in a.callback)this.on(e,a.callback[e],b);this.initFields();d=this.fields;for(f in a.rules)d[f]&&d[f].setRules(a.rules[f],!1);a.rules=null;for(f in a.groups)this.addGroup(f,a.groups[f]);this.initForm("bind");delete a.rules;delete a.fields;delete a.groups;this.enabled=!0};h(n.prototype,{vldId:null,el:null,cfg:null,enabled:!1,invalid:null,pending:0,grps:0,outside:!0,submitted:!1,displayState:!1,isForm:!1,isField:!1,submitButton:null,hidden:null,callbackScope:null,_observable:null,fields:null,
groups:null,getVldId:function(){return this.vldId},getElem:function(){return this.el},getGroup:function(a){return this.groups[a]||null},getField:function(a){return this.fields[a]||null},enable:function(){this.enabled=!0;return this},disable:function(){this.enabled=!1;return this},isEnabled:function(){return this.enabled},enableDisplayState:function(){var a=this.fields,b=this.groups,c;if(!0!==this.displayState){this.displayState=!0;for(c in a)a[c].enableDisplayState();for(c in b)b[c].enableDisplayState();
this.trigger("displaystatechange",this,!0)}return this},disableDisplayState:function(){var a=this.groups,b=this.fields,c;if(!1!==this.displayState){this.displayState=!1;for(c in b)b[c].disableDisplayState();for(c in a)a[c].disableDisplayState();this.trigger("displaystatechange",this,!1)}return this},isDisplayStateEnabled:function(){return this.displayState},isValid:function(){return!1===this.enabled?!0:0===this.invalid&&0===this.pending&&0===this.grps&&!0===this.outside},getErrors:function(a){var b=
!0==a?[]:{},c,d,f,e=[this.fields,this.groups],g;if(!this.isEnabled())return b;for(f=0;2>f;f++)for(d in g=e[f],g)null===g[d].getExactValidState()&&g[d].check(),g[d].isValid()||(c=g[d].getError())&&(a?b.push(c):b[d]=c);return b},check:function(){var a=this.fields,b=this.groups;if(!this.isEnabled())return!0;var c=this.isValid(),d;for(d in a)a[d].check();for(d in b)b[d].check();this.outside=!1!==this.trigger("check",this);a=this.isValid();c!=a&&(this.doDisplayState(),this.trigger("statechange",this,!1));
return a},add:function(a,b){var c=a.nodeName.toLowerCase(),d=a.type;if("input"!=c&&"textarea"!=c&&"select"!=c||"submit"==d||"reset"==d||null!==a.getAttribute("data-no-validate")||null!==a.getAttribute("data-validator"))return this;var d=a.getAttribute("name")||a.getAttribute("id"),f=this.cfg,c=this.fields;if(!d)return this;d=f.fields&&f.fields[d]?f.fields[d]:b||{};"string"==typeof d&&(d={rules:[d]});d=h({},f.all||{},d,!0);if(d.ignore)return this;d.callback||(d.callback={scope:this.callbackScope});
f=new E(a,d,this);d=f.getName();if(c[d])return this;c[d]=f;this.setFieldEvents(f,"on");this.displayState&&f.enableDisplayState();this.isEnabled()&&null!==this.invalid&&f.check();return this},addGroup:function(a,b){var c=this.groups;c[a]||(b.name=a,c[a]=new F(b,this),this.setGroupEvents(c[a],"on"),this.isEnabled()&&null!==this.invalid&&c[a].check())},focusInvalid:function(){var a=this.fields,b;for(b in a)if(!a[b].isValid()){a[b].getElem().focus();break}},reset:function(){var a=this.fields,b=this.groups,
c;this.submitted=!1;this.disableDisplayState();for(c in b)b[c].reset();for(c in a)a[c].reset();this.pending=0;this.invalid=null;this.grps=0;this.outside=!1;this.doDisplayState();this.trigger("reset",this);return this},submit:function(){var a=this.el;if(this.isForm)if("function"==typeof a.submit)!1!==this.trigger("beforesubmit",this)&&!1!==this.trigger("submit",this)&&a.submit();else this.onSubmit();else this.onSubmit()},setFieldEvents:function(a,b){a[b]("statechange",this.onFieldStateChange,this);
a[b]("beforeAjax",this.onBeforeAjax,this);a[b]("afterAjax",this.onAfterAjax,this);a[b]("submit",this.onFieldSubmit,this);a[b]("destroy",this.onFieldDestroy,this)},setGroupEvents:function(a,b){a[b]("statechange",this.onGroupStateChange,this)},initFields:function(){var a=this.el,b,c;if(this.isField)return this.add(a),this;a=y("input, textarea, select",a);b=-1;for(c=a.length;++b<c;this.add(a[b]));return this},initForm:function(a){var b=this.el,c=b.getElementsByTagName("input"),d=y(".submit",b),f=y(".reset",
b);a="bind"==a?u:G;var e,g,l,h;e=0;for(g=c.length;e<g;e++)h=c[e],l=h.type,"submit"==l?a(h,"click",this.onRealSubmitClickDelegate):"reset"==l&&a(h,"click",this.resetDelegate);e=-1;for(g=d.length;++e<g;"submit"!=d[e].type&&a(d[e],"click",this.onSubmitClickDelegate));e=-1;for(g=f.length;++e<g;"reset"!=f[e].type&&a(f[e],"click",this.resetDelegate));this.isForm&&a(b,"submit",this.onFormSubmitDelegate)},onRealSubmitClick:function(a){a=v(a||window.event);this.submitButton=a.target||a.srcElement;return this.onSubmit(a)},
onSubmitClick:function(a){return this.onSubmit(v(a||window.event))},onFormSubmit:function(a){a=v(a);if(!this.isValid())return a.preventDefault(),!1},onFieldSubmit:function(a,b){this.enableDisplayState();this.submitted=!0;return this.onSubmit(b)},onSubmit:function(a){this.enableDisplayState();if(this.pending)return a&&a.preventDefault(),!1;var b=this.submitButton?!0:!1;this.isForm&&(this.hidden&&(this.el.removeChild(this.hidden),this.hidden=null),this.submitButton&&/input|button/.test(this.submitButton.nodeName)&&
(this.hidden=document.createElement("input"),this.hidden.type="hidden",this.hidden.setAttribute("name",this.submitButton.name),this.hidden.value=this.submitButton.value,this.el.appendChild(this.hidden)));this.submitButton=null;if(!this.isValid()&&(this.check(),this.onFieldStateChange(),this.pending))return a&&a.preventDefault(),!1;if(!1===this.trigger("beforesubmit",this)||!this.isValid())return a&&(a.preventDefault(),a.stopPropagation()),this.pending||(this.focusInvalid(),this.submitted=!1),this.trigger("failedsubmit",
this,b),!1;this.pending||(this.submitted=!1);return!1!==this.trigger("submit",this)},onFieldDestroy:function(a){a=a.getElem();a=a.getAttribute("name")||a.getAttribute("id");delete this.fields[a]},onFieldStateChange:function(a,b){var c=this.invalid,d=this.fields;this.invalid=0;for(var e in d)this.invalid+=d[e].isValid()?0:1;a&&this.trigger("fieldstatechange",this,a,b);if(null===c||null!==c&&this.invalid!==c)this.doDisplayState(),this.trigger("statechange",this,this.isValid())},onGroupStateChange:function(){var a=
this.groups,b=this.grps;this.grps=0;for(var c in a)this.grps+=a[c].isValid()?0:1;if(null===b||null!==b&&this.grps!==b)this.doDisplayState(),this.trigger("statechange",this,this.isValid())},doDisplayState:function(){var a=this.cfg,b=this.isValid(),c=a.cls.error,a=a.cls.valid,d=this.el;if(this.isField||!this.displayState)b=null;null===this.invalid&&(b=null);c&&(!1===b?r(d,c):q(d,c));a&&(!0===b?r(d,a):q(d,a));this.trigger("displaystate",this,b)},onBeforeAjax:function(){this.pending++;this.cfg.cls.ajax&&
r(this.el,this.cfg.cls.ajax)},onAfterAjax:function(){var a=this.fields,b=this.cfg;this.pending=0;for(var c in a)this.pending+=a[c].isPending()?1:0;this.doDisplayState();b.cls.ajax&&q(this.el,b.cls.ajax);this.submitted&&0==this.pending&&(this.submitted=!1,this.isValid()?this.submit():this.focusInvalid())},destroy:function(){var a=this.groups,b=this.fields,c;this.reset();this.trigger("destroy",this);delete t[this.vldId];for(c in a)a.hasOwnProperty(c)&&a[c]&&(this.setGroupEvents(a[c],"un"),a[c].destroy(),
delete a[c]);for(c in b)b.hasOwnProperty(c)&&b[c]&&(this.setFieldEvents(b[c],"un"),b[c].destroy(),delete b[c]);this._observable.destroy();delete this._observable;this.initForm("unbind");delete this.fields;delete this.groups;delete this.el;delete this.cfg}});n.defaults={};n.messages={};n.fieldDefaults={};n.groupDefaults={};n.addMethod=function(a,b,c){s[a]||(s[a]=b,c&&(n.messages[a]=c))};n.getValidator=function(a){a=a.getAttribute("data-validator");return t[a]||null};window.MetaphorJs&&MetaphorJs.ns?
MetaphorJs.ns.register("MetaphorJs.lib.Validator",n):(window.MetaphorJs=window.MetaphorJs||{},MetaphorJs.lib=MetaphorJs.lib||{},MetaphorJs.lib.Validator=n)})();
(function(){var x=MetaphorJs.lib.Validator,t=MetaphorJs.bind,k=MetaphorJs.lib.Watchable.createFunc,p=function(g,e,l){var h,k=g.childNodes;if(!1!==e.call(l,g))for(g=-1,h=k.length>>>0;++g!==h;p(k[g],e,l));};MetaphorJs.define("MetaphorJs.view.Validator",{node:null,scope:null,validator:null,scopeState:null,initialize:function(g,e){this.node=g;this.scope=e;this.scopeState={};this.validator=this.createValidator();this.initScope();this.initScopeState();this.initValidatorEvents()},createValidator:function(){var g=
this.node,e={},l;if(l=g.getAttribute("mjs-validator-submit"))e.callback={},e.callback.submit=function(e,g){return function(){try{e(g)}catch(l){MetaphorJs.error(l)}}}(k(l),this.scope);return new x(g,e)},initValidatorEvents:function(){var g=this.validator;g.on("fieldstatechange",this.onFieldStateChange,this);g.on("statechange",this.onFormStateChange,this);g.on("displaystatechange",this.onDisplayStateChange,this);g.on("reset",this.onFormReset,this)},initScope:function(){var g=this.scope,e=this.node,
e=e.getAttribute("name")||e.getAttribute("id")||"$form";g[e]=this.scopeState},initScopeState:function(){var g=this.node,e=this.scopeState,l,h,k;g.elements?l=g.elements:(l=[],p(g,function(e){var g=e.nodeName.toLowerCase(),h=e.type;"input"!=g&&"textarea"!=g&&"select"!=g||"submit"==h||"reset"==h||l.push(e)}));g=-1;for(k=l.length;++g<k;)h=l[g],(h=h.getAttribute("name")||h.getAttribute("id"))&&!e[h]&&(e[h]={$error:null,$invalid:null,$pristine:!0,$errorMessage:null});e.$invalid=!1;e.$pristine=!0;e.$submit=
t(this.validator.onFormSubmit,this.validator)},onDisplayStateChange:function(g,e){if(e){e=this.scopeState;var h,k;for(h in e)k=e[h],k.$real&&(e[h]=k.$real);e.$invalid=!g.isValid();e.$pristine=!1;this.scope.$check()}else this.onFormReset(g)},onFormReset:function(g){g=this.scopeState;var e,h;for(e in g)h=g[e],h.$error=null,h.$errorMessage=null,h.$invalid=null,h.$pristine=!0;g.$invalid=!1;g.$pristine=!0;this.scope.$check()},onFormStateChange:function(g,e){var h=this.scopeState;h.$invalid=!1===e&&g.isDisplayStateEnabled();
h.$pristine=!1;this.scope.$check()},onFieldStateChange:function(g,e,h){var k=this.scopeState,p=e.getName();g=g.isDisplayStateEnabled();e={$error:e.getErrorRule(),$errorMessage:e.getError(),$invalid:!1===h,$pristine:null===e.getExactValidState()};g?k[p]=e:k[p].$real=e;this.scope.$check()}});var h=MetaphorJs.ns.get;MetaphorJs.registerAttributeHandler("mjs-validate",250,function(g,e,l){l=l||"MetaphorJs.view.Validator";var k=h(l);k?new k(e,g):MetaphorJs.error(Error("Class '"+l+"' not found"))})})();
