(function(){'use strict';(function(){var b={}.undefined,d=function(a,c,g){if(c&&a)for(var f in c)if(c.hasOwnProperty(f))if(a[f]&&"object"==typeof a[f]&&"object"==typeof c[f])d(a[f],c[f]);else if(!1!==g||a[f]===b||null===a[f])a[f]=c[f]},a={apply:d,emptyFn:function(){},cookie:{set:function(a,c,g){g&&"number"==typeof g&&(g=new Date((new Date).getTime()+1E3*g));c=encodeURIComponent(c)+(g?"; expires="+g.toUTCString():"")+"; path=/";document.cookie=encodeURIComponent(a)+"="+c},get:function(a){for(var c,g,f=document.cookie.split(";"),
b=0,d=f.length;b<d;b++)if(c=f[b].substr(0,f[b].indexOf("=")),g=f[b].substr(f[b].indexOf("=")+1),c=c.replace(/^\s+|\s+$/g,""),c==a)return decodeURIComponent(g);return null}},fn:{delegate:function(a,c){return function(){return a.apply(c,arguments)}},defer:function(a,c,g){c=this.delegate(c,g);return setTimeout(c,a)},countdown:function(a,c,g){a=parseInt(a,10);return function(){a--;0==a&&c.apply(g,arguments)}}}};window.MetaphorJs?d(window.MetaphorJs,a,!0):window.MetaphorJs=a})();(function(){var b=window,d={},a=function(a,c){var g;g=a.split(".");var f,h=g.pop();f=g.join(".");var k=g.length,l,m=b;if(d[f])g=[d[f],h];else{for(f=0;f<k;f++)l=g[f],m[l]||(m[l]={}),m=m[l];g=[m,h]}g[0][g[1]]=c;d[a]=c};a("MetaphorJs.ns",{register:a,exists:function(a){return d[a]?!0:!1},get:function(a){if(d[a])return d[a];a=a.split(".");var c,g=a.length,f,h=b;for(c=0;c<g;c++){f=a[c];if(!h[f])return null;h=h[f]}return h}})})();(function(){var b={}.undefined,d=function(a){return c(function(){},a)},a=function(a,c,e){return function(){var d=b;this.supr=a.prototype[c]||function(){};d=e.apply(this,arguments);this.supr=null;return d}},e=function(c,e,b){for(var d in e)e.hasOwnProperty(d)&&(c[d]="function"===typeof e[d]&&b.prototype&&"function"===typeof b.prototype[d]?a(b,d,e[d]):e[d])},c=function(a,c){var b=function(){};b.prototype=a.prototype;var b=new b,d=function(){this.initialize&&this.initialize.apply(this,arguments)};e(b,
c,a);d.prototype=b;d.prototype.constructor=d;d.prototype.getClass=function(){return this.__proto__.constructor.__class};d.prototype.getParentClass=function(){return this.__proto__.constructor.__parentClass};d.__instantiate=function(a){return function(){var c=function(){},e;c.prototype=a.prototype;c=new c;e=a.prototype.constructor.apply(c,arguments);return"object"==typeof e?e:c}}(d);return d};MetaphorJs.define=function(a,e,b,k){"string"!=typeof e&&(k=b,b=e,e=null);var l=e&&"string"==typeof e?MetaphorJs.ns.get(e):
e;if(e&&!l)throw Error(e+" not found");e=l?c(l,b):d(b);e.__parent=l;e.__parentClass=l?l.__class:null;e.__class=a;if(k)for(var m in k)k.hasOwnProperty(m)&&(e[m]=k[m]);MetaphorJs.ns.register(a,e);return e};MetaphorJs.create=function(a){var c=MetaphorJs.ns.get(a),e=Array.prototype.slice.call(arguments,1);if(!c)throw Error(a+" not found");return c.__instantiate.apply(this,e)};MetaphorJs.is=function(a,c){var e="string"==typeof c?MetaphorJs.ns.get(c):c;return e?a instanceof e:!1};MetaphorJs.isSubclass=
function(a,c){var e=a;for("string"!=typeof c&&(c=c.getClass());e;){if(e==c)return!0;(e=MetaphorJs.ns.get(e))&&(e=e.getParentClass())}return!1}})();MetaphorJs.define("MetaphorJs.cmp.Base",{initialize:function(b){b=b||{};MetaphorJs.apply(this,b)},destroy:MetaphorJs.emptyFn});(function(){var b=function(a){var c,g,b,d;g=1;for(b=arguments.length;g<b;g++)for(c in d=arguments[g],d)a[c]=d[c]},d=function(a,c){var g=[],f={},d=Array(11).join((Math.random().toString(36)+"00000000000000000").slice(2,18)).slice(0,10),k=!1,l=0,m=this;c=c||!1;b(m,{destroy:function(){a=m=l=k=d=f=g=null},on:function(c,b,n){if(c){b=b||c;n=n||{};var k=a+"_"+d;if(!b[k]){var m=++l,p=n.first||!1;b[k]=m;c={fn:c,scope:b,id:m,called:0,limit:n.limit?n.limit:n.once?1:0,start:n.start||1,count:0};p?g.unshift(c):
g.push(c);f[m]=c;return m}}},un:function(c,b){var n=-1,k=a+"_"+d,l;l=c==parseInt(c)?c:(b||c)[k];if(!l)return!1;for(var m=0,q=g.length;m<q;m++)if(g[m].id==l){n=m;delete g[m].scope[k];break}if(-1==n)return!1;g.splice(n,1);delete f[l];return!0},hasListener:function(c,b){if(c){b=b||c;var f;f=a+"_"+d;f=c==parseInt(c)?c:b[f];if(!f)return!1;for(var k=0,l=g.length;k<l;k++)if(g[k].id==f)return!0;return!1}return 0<g.length?g.length:!1},removeAllListeners:function(){for(var c=a+"_"+d,b=0,k=g.length;b<k;b++)delete g[b].scope[c];
g=[];f={}},suspend:function(){k=!0},resume:function(){k=!1},trigger:function(){if(!k&&0!=g.length){var a="all"==c?[]:null,e=[],b,d;b=0;for(d=g.length;b<d;b++)e.push(g[b]);for(;b=e.shift();)if(b&&f[b.id]&&(b.count++,!(b.count<b.start))){d=b.fn.apply(b.scope,arguments);b.called++;b.called==b.limit&&this.un(b.id);"all"==c&&a.push(d);if("first"==c&&d)return d;"last"==c&&d&&(a=d);if(!1==c&&!1===d)break}if(c)return a}}})},a=function(){var a=this,c={},g={};b(g,{createEvent:function(a,e){a=a.toLowerCase();
c[a]||(c[a]=new d(a,e));return c[a]},getEvent:function(a){a=a.toLowerCase();return c[a]},on:function(a,e,b,g){a=a.toLowerCase();c[a]||(c[a]=new d(a));return c[a].on(e,b,g)},once:function(c,b,g,d){d=d||{};d.limit=1;return a.on(c,b,g,d)},un:function(a,e,b){a=a.toLowerCase();c[a]&&c[a].un(e,b)},hasListener:function(a,e,b){a=a.toLowerCase();return c[a]?c[a].hasListener(e,b):!1},removeAllListeners:function(a){c[a]&&c[a].removeAllListeners()},trigger:function(){var a=[],e=arguments[0],e=e.toLowerCase();
if(c[e]){for(var b=1,g=arguments.length;b<g;b++)a.push(arguments[b]);e=c[e];return e.trigger.apply(e,a)}},suspendEvent:function(a){a=a.toLowerCase();c[a]&&c[a].suspend()},suspendAllEvents:function(){for(var a in c)c[a].suspend()},resumeEvent:function(a){a=a.toLowerCase();c[a]&&c[a].resume()},resumeAllEvents:function(){for(var a in c)c[a].resume()}});b(a,g,{destroy:function(b){if(b)b=b.toLowerCase(),c[b]&&(c[b].destroy(),delete c[b]);else{for(var g in c)c[g].destroy();a=c=null}},getApi:function(){return g}});
return a};window.MetaphorJs&&MetaphorJs.ns?MetaphorJs.ns.register("MetaphorJs.lib.Observable",a):(window.MetaphorJs=window.MetaphorJs||{},MetaphorJs.lib=MetaphorJs.lib||{},MetaphorJs.lib.Observable=a)})();MetaphorJs.define("MetaphorJs.cmp.Observable","MetaphorJs.cmp.Base",{_observable:null,listeners:null,initialize:function(b){this._observable=new MetaphorJs.lib.Observable;MetaphorJs.apply(this,this._observable.getApi());b=b||{};if(b.callback){var d=b.callback,a=d.scope||this;delete d.scope;for(var e in d)if(d.hasOwnProperty(e))this.on(e,d[e],a);delete b.callback}this.supr(b)},destroy:function(){this._observable.destroy();delete this._observable;this.supr()}});(function(){var b={},d=-1,a=function(a){return b[a]||null};MetaphorJs.define("MetaphorJs.cmp.Component","MetaphorJs.cmp.Observable",{id:null,tag:"div",el:null,dom:null,cls:null,style:null,renderTo:null,html:null,rendered:!1,hidden:!1,destroyed:!1,destroyEl:!0,initialize:function(a){this.supr(a);this.dom&&!this.el&&(this.el=$(this.dom));this.el&&(this.id=this.el.attr("id"),this.dom||(this.dom=this.el.get(0)));d++;this.id=this.id||"cmp-"+d;b[this.id]=this;this.initComponent();!this.dom&&this.renderTo?
this.render():this.dom&&(this.hidden=this.el.is(":hidden"),this.rendered=!0,this.html&&(this.el.html(this.html),this.html=null),this.onRender())},render:function(a){if(!this.rendered){var c=this.tag,c=$("<"+c+"></"+c+">");a=a||this.renderTo;this.cls&&c.addClass(this.cls);this.style&&c.css(this.style);c.attr("id",this.id);this.html&&(c.html(this.html),this.html=null);this.hidden&&c.hide();c.appendTo(a||"body");this.el=c;this.dom=c.get(0);this.rendered=!0;this.onRender();this.renderTo=null}},setContent:function(a){this.rendered?
this.el.html(a):this.html=a},onRender:function(){this.el.attr("cmp-id",this.id);this.trigger("render",this);this.afterRender();this.trigger("afterrender",this)},show:function(){if(this.hidden){if(!1===this.trigger("beforeshow",this))return!1;this.el.show();this.hidden=!1;this.onShow();this.trigger("show",this)}},hide:function(){if(!this.hidden){if(!1===this.trigger("beforehide",this))return!1;this.el.hide();this.hidden=!0;this.onHide();this.trigger("hide",this)}},isHidden:function(){return this.hidden},
isRendered:function(){return this.rendered},isDestroyed:function(){return this.destroyed},getEl:function(){return this.el},getDom:function(){return this.dom},destroy:function(){if(!this.destroyed){if(!1===this.trigger("beforedestroy",this))return!1;this.onDestroy();this.destroyed=!0;this.trigger("destroy",this);this.destroyEl&&(this.el.remove(),this.dom=this.el=null);this.supr();delete b[this.id]}},initComponent:MetaphorJs.emptyFn,afterRender:MetaphorJs.emptyFn,onShow:MetaphorJs.emptyFn,onHide:MetaphorJs.emptyFn,
onDestroy:MetaphorJs.emptyFn});MetaphorJs.getCmp=a;$.fn.createCmp=function(e,c){var b=null;e&&"string"!=typeof e&&(c=e,e=null);e=e||"MetaphorJs.cmp.Component";c=c||{};this.each(function(){var d=$(this),h=d.attr("cmp-id");if(h)return b=a(h),!1;c.el=d;c.dom=this;b=MetaphorJs.create(e,c);return!1});return b};$.fn.getCmp=function(){return a(this.attr("cmp-id"))};$.fn.getParentCmp=function(){if(this.attr("cmp-id"))return MetaphorJs.getCmp(el.attr("cmp-id"));var a=this.parents("[cmp-id]").eq(0);return a.length?
MetaphorJs.getCmp(a.attr("cmp-id")):null}})();(function(){var b={},d={};MetaphorJs.define("MetaphorJs.data.Model",{type:null,fields:null,record:null,store:null,plain:!1,initialize:function(a){this.fields={};MetaphorJs.apply(this,a);this.record=this.record||{};this.store=this.store||{};this.plain=this.type?!1:!0;MetaphorJs.apply(this.record,{load:null,save:null,delete:null,id:null,data:null,extra:{},extend:{}},!1);MetaphorJs.apply(this.store,{load:null,save:null,delete:null,id:null,data:null,total:null,start:null,limit:null,extra:{},extend:{}},
!1)},isPlain:function(){return this.plain},getRecordProp:function(a,e){return this.getProp("record",a,e)},getStoreProp:function(a,e){return this.getProp("store",a,e)},getProp:function(a,e,c){a=this[a];return a[e]&&a[e][c]||a[c]||this[c]||null},_createAjaxCfg:function(a,e,c,b){var d=this[a],h="string"==typeof d[e]?{url:d[e]}:d[e],k=this.getProp(a,e,"id"),l=this.getProp(a,e,"data");if(!h)throw Error(a+"."+e+" not defined");h.data=$.extend(!0,{},h.data,this.extra,d.extra,d[e].extra);h.type||(h.type=
"load"==e?"GET":"POST");c&&(h.data[k]=c);b&&(l?h.data[l]=b:h.data=b);return h},_processRecordResponse:function(a,e,c){var b=this.getRecordProp(a,"id");a=(a=this.getRecordProp(a,"data"))?e[a]:e;c(a&&(a[b]||e[b]),a)},_processStoreResponse:function(a,e,c){var b=this.getStoreProp(a,"data");a=this.getStoreProp(a,"total");c(b?e[b]:e,a?e[a]:null)},getFields:function(){return this.fields},restoreField:function(a,e,c){var b=this.fields[e];if(b){switch("string"==typeof b?b:b.type){case "int":c=parseInt(c);
break;case "bool":case "boolean":"string"==typeof c?(c=c.toLowerCase(),c="off"===c||"no"===c||"0"===c||"false"==c||"null"==c?!1:!0):c=c?!0:!1;break;case "double":case "float":c=parseFloat(c);break;case "date":b.parseFn?c=b.parseFn(c,b.format):Date.parse?c=Date.parse(c,b.format):("timestamp"==b.format&&(c=1E3*parseInt(c)),c=new Date(c))}b.restore&&(c=b.restore.call(a,c,e))}return this.onRestoreField(a,e,c)},onRestoreField:function(a,e,c){return c},storeField:function(a,e,c){var b=this.fields[e];if(b){switch("string"==
typeof b?b:b.type){case "bool":case "boolean":c=c?"1":"0";break;case "date":c=b.formatFn?b.formatFn(c,b.format):Date.format?Date.format(c,b.format):"timestamp"==b.format?c.getTime()/1E3:c.format?c.format(b.format):c.toString();break;default:c=c.toString()}b.store&&(c=b.store.call(a,c,e))}return this.onStoreField(a,e,c)},onStoreField:function(a,e,c){return c},loadRecord:function(a,e){var c=this,b=c._createAjaxCfg("record","load",a);if(b)return b.success=function(a){c._processRecordResponse("load",
a,e)},$.ajax(b)},saveRecord:function(a,e){var c=this,b=c._createAjaxCfg("record","save",a.getId(),a.storeData(a.getData()));if(b)return b.success=function(a){c._processRecordResponse("save",a,e)},$.ajax(b)},deleteRecord:function(a,e){var c=this._createAjaxCfg("record","delete",a.getId());c.success=function(){e()};return $.ajax(c)},loadStore:function(a,e,c){var b=this;a=b._createAjaxCfg("store","load");a.data=$.extend(!0,a.data,e);a.success=function(a){b._processStoreResponse("load",a,c)};return $.ajax(a)},
saveStore:function(a,e,c){var b=this;a=b._createAjaxCfg("store","save",null,e);a.success=function(a){b._processStoreResponse("save",a,c)};return $.ajax(a)},deleteRecords:function(a,e,c){a=this._createAjaxCfg("store","delete",e);a.success=c;return $.ajax(a)}},{create:function(a,e){return"MetaphorJs.data.Model"==a?MetaphorJs.create(a,e):e?MetaphorJs.create(a,e):b[a]?b[a]:b[a]=MetaphorJs.create(a)},addToCache:function(a){var e=a.getClass(),c=a.getId();"MetaphorJs.data.Record"!=e&&(d[e]||(d[e]={}),d[e][c]=
a)},getFromCache:function(a,e){return d[a]&&d[a][e]?d[a][e]:null},removeFromCache:function(a,e){d[a]&&d[a][e]&&delete d[a][e]}})})();(function(){var b=0,d={};MetaphorJs.define("MetaphorJs.data.Store","MetaphorJs.cmp.Observable",{id:null,autoLoad:!1,clearOnLoad:!0,model:null,loaded:!1,loading:!1,local:!1,items:null,map:null,keys:null,length:0,totalLength:0,start:0,pages:null,filtered:!1,filterBackup:null,filterFn:null,filterScope:null,filterParams:null,initialize:function(a,e,c){this.items=[];this.map={};this.keys=[];this.loaded=!1;a&&"string"!=typeof a&&(c=e,e=a,a=null);e=e||{};this.supr(e);this.id=this.id||++b;d[this.id]=this;
"string"==typeof this.model?this.model=MetaphorJs.create(this.model):MetaphorJs.is(this.model,"MetaphorJs.data.Model")||(this.model=MetaphorJs.create("MetaphorJs.data.Model",this.model));if(a||e.url)this.model.store.load=a||e.url;!this.local&&this.autoLoad?this.load():c&&($.isArray(c)?this.loadArray(c):this.loadAjaxData(c));this.local&&(this.loaded=!0)},getId:function(){return this.id},isLoaded:function(){return this.loaded},isLocal:function(){return this.local},setLocal:function(a){this.local=a?
!0:!1},isLoading:function(){return this.loading},isFiltered:function(){return this.filtered},getLength:function(){return this.length},getTotalLength:function(){return this.filtered?this.length:this.totalLength||this.length},getPagesCount:function(){return null!==this.pageSize?parseInt(this.totalLength/this.pageSize):1},setParam:function(a,e){this.model.store.extra[a]=e},getParam:function(a){return this.model.store.extra[a]},getAjaxData:function(){return this.ajaxData},hasDirty:function(){if(this.model.isPlain())return!1;
var a=!1;this.each(function(e){if(e.isDirty())return a=!0,!1});return a},getDirty:function(){var a=[];if(this.model.isPlain())return a;this.each(function(e){e.isDirty()&&a.push(e)});return a},import:function(a){this.suspendAllEvents();for(var e=0;e<a.length;e++)this.add(a[e]);this.resumeAllEvents();this.loaded=!0;this.loading=!1;this.trigger("load",this)},load:function(a){var e=this,c=e.model.store,b=c.start,c=c.limit;a=a||{};null===e.pageSize||a[b]||a[c]||(a[b]=e.start,a[c]=e.pageSize);return e.model.loadStore(e,
a,function(a,c){e.import(a);e.totalLength=parseInt(c)})},save:function(){var a=this,e={},c=0;if(!a.model.isPlain()&&(a.each(function(a){a.isDirty()&&(e[a.getId()]=a.storeData(a.getData()),c++)}),c))return a.model.saveStore(a,e,function(c){var e,b,d;if(c&&c.length)for(e=0,b=c.length;e<b;e++)d=a.getRecordId(c[e]),(d=a.getById(d))&&d.import(c[e]);a.trigger("save",a)})},deleteById:function(a){var e=this,c,b,d;if(a){$.isArray(a)||(a=[a]);c=0;for(b=a.length;c<b;c++)d=e.getById(a[c]),d instanceof MetaphorJs.data.Record?
d.destroy():e.removeId(a[c]);return e.model.deleteRecords(e,a,function(){e.trigger("delete",e,a)})}},deleteAt:function(a){if(a=this.getAt(a))return this.deleteRecord(a)},delete:function(a){if(a)return this.deleteById(this.getRecordId(a))},deleteRecords:function(a){var e=[],c,b;c=0;for(b=a.length;c<b;c++)e.push(this.getRecordId(a[c]));if(e.length)return this.deleteById(e)},loadAjaxData:function(a){var e=this;e.model._processStoreResponse("load",a,function(a,b){e.import(a);e.totalLength=parseInt(b)})},
loadArray:function(a,e){!1!==this.trigger("beforeload",this)&&(!e&&this.clearOnLoad&&0<this.length&&this.clear(),$.isArray(a)&&(this.import(a),this.totalLength=this.length))},loadOr:function(a,e){this.local||this.isLoading()||(this.isLoaded()?a&&a.call(e||this):this.load())},addNextPage:function(){!this.local&&this.length<this.totalLength&&this.load({start:this.length,limit:this.pageSize},!0)},loadNextPage:function(){this.local||(this.start+=this.pageSize,this.load())},loadPrevPage:function(){this.local||
(this.start-=this.pageSize,this.load())},getRecordId:function(a){return a instanceof MetaphorJs.data.Record?a.getId():a[this.model.getStoreProp("load","id")]||null},processRawDataItem:function(a){if(a instanceof MetaphorJs.data.Record||this.model.isPlain())return a;var e=this.model.type,c=this.getRecordId(a),b;c&&(b=MetaphorJs.data.Model.getFromCache(e,c));b||(b=MetaphorJs.create(e,c,a,{model:this.model,standalone:!1}));return b},bindRecord:function(a,b){b[a]("change",this.onRecordChange,this);b[a]("destroy",
this.onRecordDestroy,this);b[a]("dirtychange",this.onRecordDirtyChange,this);return b},onRecordDirtyChange:function(a){this.trigger("update",this,a)},onRecordChange:function(a,b,c,d){this.trigger("update",this,a)},onRecordDestroy:function(a){this.remove(a)},add:function(a,b,c){if(this.filtered)throw Error("Cannot add to filtered store");if("string"!=typeof a&&"number"!=typeof a){b=a;if($.isArray(b)){if(!b.length)return;a=this.length;for(var d=0,f=b.length;d<f;d++)b[d]=this.processRawDataItem(b[d]),
this.add(this.getRecordId(b[d]),b[d],!0);c||this.trigger("add",a,b);return}b=this.processRawDataItem(b);a=this.getRecordId(b)}if("undefined"!=typeof a&&null!==a){if("undefined"!=typeof this.map[a]){this.replace(a,b);return}this.map[a]=b}this.length++;this.items.push(b);this.keys.push(a);b instanceof MetaphorJs.data.Record&&(b.attachStore(this),this.bindRecord("on",b));c||this.trigger("add",this.length-1,[b])},removeAt:function(a){if(a<this.length&&0<=a){this.length--;var b=this.items[a];this.items.splice(a,
1);var c=this.keys[a];"undefined"!=typeof c&&delete this.map[c];this.keys.splice(a,1);this.trigger("remove",b,c);return b instanceof MetaphorJs.data.Record?(this.bindRecord("un",b),b.detachStore(this),null):b}return!1},insert:function(a,b,c,d){if(this.filtered)throw Error("Cannot insert into filtered store");2==arguments.length&&(c=arguments[1],b=this.getRecordId(c));c=this.processRawDataItem(c);this.containsId(b)&&(this.suspendAllEvents(),this.removeId(b),this.resumeAllEvents());if(a>=this.length)return this.add(b,
c,d);this.length++;this.items.splice(a,0,c);"undefined"!=typeof b&&null!==b&&(this.map[b]=c);this.keys.splice(a,0,b);c instanceof MetaphorJs.data.Record&&(c.attachStore(this),this.bindRecord("on",c));d||this.trigger("add",a,[c]);return c},replace:function(a,b){var c,d;1==arguments.length&&(b=arguments[0],a=this.getRecordId(b));b=this.processRawDataItem(b);c=this.map[a];if("undefined"==typeof a||null===a||"undefined"==typeof c)return this.add(a,b);c instanceof MetaphorJs.data.Record&&(this.bindRecord("un",
c),c.detachStore(this));d=this.indexOfId(a);this.items[d]=b;this.map[a]=b;this.trigger("replace",a,c,b);return b},remove:function(a){return this.removeAt(this.indexOf(a))},removeId:function(a){return this.removeAt(this.indexOfId(a))},contains:function(a){return-1!=this.indexOf(a)},containsId:function(a){return"undefined"!=typeof this.map[a]},clear:function(){var a=this.getRange();this.clearFilter(!0);this._reset();this.trigger("clear",a)},reset:function(){this._reset()},_reset:function(a){var b,c;
if(!a)for(a=0,b=this.items.length;a<b;a++)c=this.items[a],c instanceof MetaphorJs.data.Record&&(this.bindRecord("un",c),c.detachStore(this));this.totalLength=this.length=this.start=0;this.items=[];this.keys=[];this.map={};this.loaded=this.local},filter:function(a,b,c){this.filtered&&this.clearFilter(!0);this.filtered=!0;this.filterFn=a;this.filterScope=b;this.filterParams=c;this.trigger("beforefilter",this);this.suspendAllEvents();this.filterBackup={length:this.length,items:this.items,keys:this.keys,
map:this.map};this._reset(!0);a=this.filterBackup.keys;b=this.filterBackup.items;c=0;for(var d=b.length;c<d;c++)this._filterRecord(b[c],a[c])&&(this.items.push(b[c]),this.keys.push(a[c]),this.length++,this.map[a[c]]=b[c]);this.resumeAllEvents();this.trigger("filter",this)},_filterRecord:function(a,b){return this.filtered&&this.filterFn.call(this.filterScope,a,b,this.filterParams)},clearFilter:function(a){this.filtered&&(a||this.trigger("beforeclearfilter",this),this.suspendAllEvents(),this.filtered=
!1,this._reset(!0),this.length=this.filterBackup.length,this.items=this.filterBackup.items,this.keys=this.filterBackup.keys,this.map=this.filterBackup.map,this.filterBackup=null,this.resumeAllEvents(),a||this.trigger("clearfilter",this))},getAt:function(a){return this.items[a]||null},getById:function(a){return this.map[a]||null},indexOf:function(a){return this.items.indexOf(a)},indexOfId:function(a){return this.keys.indexOf(a)},each:function(a,b){var c=[].concat(this.items);b=b||window;for(var d=
0,f=c.length;d<f&&!1!==a.call(b,c[d],d,f);d++);},eachId:function(a,b){b=b||window;for(var c=0,d=this.keys.length;c<d;c++)a.call(b,this.keys[c],this.items[c],c,d)},collect:function(a){var b=[],c=!this.model.isPlain();this.each(function(d){(d=c?d.get(a):d[a])&&b.push(d)});return b},first:function(){return this.items[0]},last:function(){return this.items[this.length-1]},getRange:function(a,b){var c=this.items;if(1>c.length)return[];a=a||0;b=Math.min("undefined"==typeof b||null===b?this.length-1:b,this.length-
1);var d,f=[];if(a<=b)for(d=a;d<=b;d++)f[f.length]=c[d];else for(d=a;d>=b;d--)f[f.length]=c[d];return f},findBy:function(a,b,c){a=this.findIndexBy(a,b,c);return-1==a?null:this.getAt(a)},findIndexBy:function(a,b,c){b=b||this;var d=this.keys,f=this.items;c=c||0;for(var h=f.length;c<h;c++)if(a.call(b,f[c],d[c]))return c;return-1},find:function(a,b,c){var d=!this.model.isPlain(),f;return this.findIndexBy(function(h){f=d?h.get(a):h[a];return c?f===b:f==b},this)},findExact:function(a,b){return this.find(a,
b,!0)},findBySet:function(a){var b=null,c,d;this.each(function(f){c=!0;for(d in a)if(a[d]!=f[d]){c=!1;break}if(c)return b=f,!1});return b},destroy:function(){delete d[this.id];this.trigger("destroy",this);this.removeAllListeners("clear");this.clear();this.supr()}},{createFromSelect:function(a){var b=[];a=a.options;for(var c=0,d=a.length;c<d;c++){var f=a[c],h=(f.hasAttribute?f.hasAttribute("value"):f.getAttributeNode("value").specified)?f.value:f.text;b.push([h,f.text])}a=MetaphorJs.create("MetaphorJs.data.Store",
{server:{load:{id:0}}});a.loadArray(b);return a},lookupStore:function(a){return d[a]||null}})})();MetaphorJs.define("MetaphorJs.data.Record","MetaphorJs.cmp.Observable",{id:null,data:null,orig:null,modified:null,loaded:!1,dirty:!1,destroyed:!1,model:null,standalone:!0,stores:null,initialize:function(b,d,a){var e=arguments.length;1==e?(a=b,d=b=null):2==e&&(a=d,d=null);this.orig={};this.stores=[];this.modified={};this.supr(a);"string"==typeof this.model?this.model=MetaphorJs.create(this.model):MetaphorJs.is(this.model,"MetaphorJs.data.Model")||(this.model=MetaphorJs.create("MetaphorJs.data.Model",
this.model));this.id=b;d?this.import(d):this.load();"MetaphorJs.data.Record"!=this.getClass()&&MetaphorJs.data.Model.addToCache(this)},isLoaded:function(){return this.loaded},isStandalone:function(){return this.standalone},isDirty:function(){return this.dirty},attachStore:function(b){b=b.getId();-1==this.stores.indexOf(b)&&this.stores.push(b)},detachStore:function(b){b=b.getId();var d;this.destroyed||-1==(d=this.stores.indexOf(b))||(this.stores.splice(d,1),0!=this.stores.length||this.standalone||
this.destroy())},setDirty:function(b){this.dirty!=b&&(this.dirty=b?!0:!1,this.trigger("dirtychange",this,b))},import:function(b){var d={},a;if(b){for(a in b)d[a]=this.model.restoreField(this,a,b[a]);this.data=d}this.orig=$.extend({},this.data);this.modified={};this.loaded=!0;this.setDirty(!1)},storeData:function(b){var d={},a;for(a in b)d[a]=this.model.storeField(this,a,b[a]);return d},getId:function(){return this.id},getData:function(){return $.extend({},this.data)},getChanged:function(){return $.extend({},
this.modified)},isChanged:function(b){return this.modified[b]||!1},get:function(b){return this.data[b]},setId:function(b){!this.id&&b&&(this.id=b)},set:function(b,d){var a=this.data[b];d=this.model.restoreField(this,b,d);this.data[b]=d;a!=d&&(this.modified[b]=!0,this.setDirty(!0),this.trigger("change",this,b,d,a),this.trigger("change-"+b,this,b,d,a))},revert:function(){this.dirty&&(this.data=$.extend({},this.orig),this.modified={},this.setDirty(!1))},load:function(){var b=this;b.trigger("beforeload",
b);return b.model.loadRecord(b.id,function(d,a){b.setId(d);b.import(a);b.trigger("load",b)})},save:function(){var b=this;b.trigger("beforesave",b);return b.model.saveRecord(b,function(d,a){b.setId(d);b.import(a);b.trigger("save",b)})},delete:function(){var b=this;b.trigger("beforedelete",b);return b.model.deleteRecord(b,function(){b.trigger("delete",b);b.destroy()})},destroy:function(){this.destroyed||(this.destroyed=!0,this.trigger("destroy",this),this.stores=this.model=this.modified=this.orig=this.data=
null,MetaphorJs.data.Model.removeFromCache(this.getClass(),this.id),this.supr())}});MetaphorJs.define("MetaphorJs.cmp.DataList","MetaphorJs.cmp.Component",{store:null,destroyStore:!0,elList:null,listSelector:null,itemSelector:null,itemTpl:null,addClearfix:!1,emptyText:"",emptyCls:null,continuousScroll:!1,continuousOffset:50,continuousTmt:null,continuousTime:300,continuousSelector:null,elContinuous:null,initComponent:function(){this.checkWindowScrollDelegate=MetaphorJs.fn.delegate(this.checkWindowScroll,this);this.onWindowScrollDelegate=MetaphorJs.fn.delegate(this.onWindowScroll,
this);this.initStore();this.supr()},initStore:function(){this.setStoreEvents("on")},setStoreEvents:function(b){var d=this.store;d&&(d[b]("beforeload",this.onBeforeStoreLoad,this),d[b]("load",this.onStoreLoad,this),d[b]("filter",this.onStoreFilter,this),d[b]("clearfilter",this.onStoreClearFilter,this),d[b]("add",this.onStoreAdd,this),d[b]("replace",this.onStoreReplace,this),d[b]("remove",this.onStoreRemove,this),d[b]("clear",this.onStoreClear,this))},getStore:function(){return this.store},afterRender:function(){var b=
this.id;this.elList||(this.elList=null===this.listSelector?this.el:this.listSelector?$(this.listSelector,this.dom):$("#"+b+"-list"));this.supr();if(this.store.isLoaded())this.onStoreLoad();this.itemSelector&&this.elList.delegate(this.itemSelector,"click",MetaphorJs.fn.delegate(this.onRowClick,this));this.continuousScroll&&$(window).bind("scroll",this.onWindowScrollDelegate);this.continuousSelector&&(this.elContinuous=$(this.continuousSelector,this.dom))},onRowClick:function(b){var d=this.getItemByEvent(b),
a=this.getRecordByEl(d);a&&(this.onItemClick(b,a,d),this.trigger("itemclick",a,d))},onItemClick:MetaphorJs.emptyFn,getItemByEvent:function(b){b=$(b.target);b.is(this.itemSelector)||(b=b.parents(this.itemSelector).eq(0));return b},getElById:function(b){b=$("[data-id="+b+"]",this.dom);return b.length?b:null},getRecordByEl:function(b){b=b.attr("data-id");return this.store.getById(b)},getRecordByEvent:function(b){if((b=this.getItemByEvent(b))&&b.length)return this.getRecordByEl(b)},toggleEmpty:function(){var b=
this.store,d=0==b.getLength();this.el[d?"addClass":"removeClass"](this.emptyCls);d&&this.emptyText&&this.elList.html(this.emptyText);if(this.elContinuous)this.elContinuous[b.getLength()>=b.getTotalLength()?"hide":"show"]()},onBeforeStoreLoad:MetaphorJs.emptyFn,onStoreLoad:function(){this.rendered&&(this.renderAll(),this.toggleEmpty())},onStoreFilter:function(){this.renderAll();this.toggleEmpty()},onStoreClearFilter:function(){this.renderAll();this.toggleEmpty()},onStoreAdd:function(b,d){var a=this.renderRows(b,
d),e;0==b?(this.elList.html(a),this.addClearfix&&this.elList.append(this.addClearfix)):(e=$(this.itemSelector+":eq("+(b-1)+")",this.elList.get(0)),e.after(a));this.toggleEmpty()},onStoreReplace:function(b,d,a){d=this.getElById(b);b=this.store.indexOf(b);a=this.renderRows(b,[a]);d.replaceWith(a)},onStoreRemove:function(b,d){var a=this.getElById(d);a&&a.remove();this.toggleEmpty()},onStoreClear:function(){this.elList.html("");this.toggleEmpty()},renderAll:function(){var b=this.store;0<b.getLength()?
this.elList.html(this.renderRows(0,b.getRange())):this.toggleEmpty()},renderRows:function(b,d){var a="",e,c;e=0;for(c=d.length;e<c;e++)a+=this.renderOneRow(b+e,d[e]);return a},renderOneRow:function(b,d){var a=this.itemTpl,e=d instanceof MetaphorJs.data.Record?d.getData():d,c;if(a)for(c in e)for(;-1!=a.indexOf("{"+c+"}");)a=a.replace("{"+c+"}",e[c]);return a},onWindowScroll:function(){this.continuousTmt||(this.continuousTmt=window.setTimeout(this.checkWindowScrollDelegate,this.continuousTime))},checkWindowScroll:function(){var b=
this,d=b.store;if(!d||d.isLocal()||d.getLength()>=d.getTotalLength())b.continuousTmt=null;else{var a=$(window),d=a.height(),a=a.scrollTop();Math.max(document.documentElement.scrollHeight,document.body.scrollHeight)-(d+a)<=b.continuousOffset?b.store.addNextPage(function(){b.continuousTmt=null}):b.continuousTmt=null}},onDestroy:function(){this.store&&(this.destroyStore?this.store.destroy():this.setStoreEvents("un"),this.store=null);$(window).unbind("scroll",this.onWindowScrollDelegate);this.supr()}});
}());