(function(){'use strict';(function(){var a={}.undefined,b=function(b,d,c){if(d&&b)for(var h in d)!d.hasOwnProperty(h)||!1===c&&b[h]!=a||(b[h]=d[h])},c={apply:b,emptyFn:function(){}};window.MetaphorJs?b(window.MetaphorJs,c,!0):window.MetaphorJs=c})();(function(){var a=window,b={},c=function(c,d){var f;f=c.split(".");var h,g=f.pop();h=f.join(".");var k=f.length,l,m=a;if(b[h])f=[b[h],g];else{for(h=0;h<k;h++)l=f[h],m[l]||(m[l]={}),m=m[l];f=[m,g]}f[0][f[1]]=d;b[c]=d};c("MetaphorJs.ns",{register:c,exists:function(a){return b[a]?!0:!1},getNs:function(c){if(b[c])return b[c];c=c.split(".");var d,f=c.length,h,g=a;for(d=0;d<f-1;d++){h=c[d];if(!g[h])return null;g=g[h]}return g}})})();(function(){var a={}.undefined,b=function(a){return d(function(){},a)},c=function(b,d,c){return function(){var e=a;this.supr=b.prototype[d]||function(){};e=c.apply(this,arguments);this.supr=null;return e}},e=function(a,b,d){for(var e in b)b.hasOwnProperty(e)&&(a[e]="function"===typeof b[e]&&"function"===typeof d.prototype[e]?c(d,e,b[e]):b[e])},d=function(a,b){var d=function(){};d.prototype=a.prototype;var d=new d,c=function(){this.initialize&&this.initialize.apply(this,arguments)};e(d,b,a);c.prototype=
d;return c.prototype.constructor=c};MetaphorJs.define=function(a,c,e,k){e||(e=c,c=null);var l=c&&"string"==typeof c?MetaphorJs.ns.getNs(c):c;if(c&&!l)throw Error(c+" not found");c=l?d(l,e):b(e);c.__parent=l;c.__parentClass=l?l.__class:null;c.__class=a;if(k)for(var m in k)k.hasOwnProperty(m)&&(c[m]=k[m]);MetaphorJs.ns.register(a,c);return c};MetaphorJs.create=function(a,b,d,c,e,m,q,r,s,p){a=MetaphorJs.ns.getNs(a);if(!a)throw Error(a+" not found");b=new a(b,d,c,e,m,q,r,s,p);b.__parent=a.__parent;b.__parentClass=
a.__parentClass;b.__class=a.__class;return b};MetaphorJs.is=function(a,b){var d="string"==typeof b?MetaphorJs.ns.getNs(b):b;return a instanceof d};MetaphorJs.isSubclass=function(a,b){var d=a;"string"!=typeof b&&(b=b.__class);for(;d;){if(d==b)return!0;if(d=MetaphorJs.ns.getNs(d))d=d.__parentClass}return!1}})();MetaphorJs.define("MetaphorJs.cmp.Base",{initialize:function(a){a=a||{};MetaphorJs.apply(this,a)},destroy:MetaphorJs.emptyFn});(function(){var a=function(a){var b,c,h,g;c=1;for(h=arguments.length;c<h;c++)for(b in g=arguments[c],g)a[b]=g[b]},b=function(b,d){var c=[],h=Array(11).join((Math.random().toString(36)+"00000000000000000").slice(2,18)).slice(0,10),g=!1,k=0,l=this;d=d||!1;a(l,{destroy:function(){b=l=k=g=h=c=null},on:function(a,d,g){if(a){d=d||a;g=g||{};var l=b+"_"+h;if(!d[l]){var p=++k,n=g.first||!1;d[l]=p;a={fn:a,scope:d,id:p,called:0,limit:g.limit?g.limit:g.once?1:0,start:g.start||1,count:0};n?c.unshift(a):c.push(a);
return p}}},un:function(a,d){var g=-1,l=b+"_"+h,k;k=a==parseInt(a)?a:(d||a)[l];if(!k)return!1;for(var n=0,t=c.length;n<t;n++)if(c[n].id==k){g=n;delete c[n].scope[l];break}if(-1==g)return!1;c.splice(g,1);return!0},hasListener:function(a,d){if(a){d=d||a;var g;g=b+"_"+h;g=a==parseInt(a)?a:d[g];if(!g)return!1;for(var l=0,k=c.length;l<k;l++)if(c[l].id==g)return!0;return!1}return 0<c.length?c.length:!1},removeAllListeners:function(){for(var a=b+"_"+h,d=0,g=c.length;d<g;d++)delete c[d].scope[a];c=[]},suspend:function(){g=
!0},resume:function(){g=!1},trigger:function(){if(!g&&0!=c.length){for(var a="all"==d?[]:null,b,e=0,h=c.length;e<h;e++){var k=c[e];k.count++;if(!(k.count<k.start)){b=k.fn.apply(k.scope,arguments);k.called++;k.called==k.limit&&l.removeListener(k.id);"all"==d&&a.push(b);if("first"==d&&b)return b;"last"==d&&b&&(a=b);if(!1==d&&!1===b)break}}if(d)return a}}})},c=function(){var c=this,d={},f={};a(f,{createEvent:function(a,c){a=a.toLowerCase();d[a]||(d[a]=new b(a,c));return d[a]},getEvent:function(a){a=
a.toLowerCase();return d[a]},on:function(a,c,e,f){a=a.toLowerCase();d[a]||(d[a]=new b(a));return d[a].on(c,e,f)},once:function(a,b,d,f){f=f||{};f.limit=1;return c.on(a,b,d,f)},un:function(a,b,c){a=a.toLowerCase();d[a]&&d[a].un(b,c)},hasListener:function(a,b,c){a=a.toLowerCase();return d[a]?d[a].hasListener(b,c):!1},removeAllListeners:function(a){d[a]&&d[a].removeAllListeners()},trigger:function(){var a=[],b=arguments[0],b=b.toLowerCase();if(d[b]){for(var c=1,e=arguments.length;c<e;c++)a.push(arguments[c]);
b=d[b];return b.trigger.apply(b,a)}},suspendEvent:function(a){a=a.toLowerCase();d[a]&&d[a].suspend()},suspendAllEvents:function(){for(var a in d)d[a].suspend()},resumeEvent:function(a){a=a.toLowerCase();d[a]&&d[a].resume()},resumeAllEvents:function(){for(var a in d)d[a].resume()}});a(c,f,{destroy:function(a){if(a)a=a.toLowerCase(),d[a]&&(d[a].destroy(),delete d[a]);else{for(var b in d)d[b].destroy();c=d=null}},getApi:function(){return f}});return c};window.MetaphorJs&&MetaphorJs.ns?MetaphorJs.ns.register("MetaphorJs.lib.Observable",
c):(window.MetaphorJs=window.MetaphorJs||{},MetaphorJs.lib=MetaphorJs.lib||{},MetaphorJs.lib.Observable=c)})();MetaphorJs.define("MetaphorJs.cmp.Observable","MetaphorJs.cmp.Base",{_observable:null,listeners:null,initialize:function(a){this._observable=new MetaphorJs.lib.Observable;MetaphorJs.apply(this,this._observable.getApi());a=a||{};if(a.callback){var b=a.callback,c=b.scope||this;delete b.scope;for(var e in b)if(b.hasOwnProperty(e))this.on(e,b[e],c);delete a.callback}this.supr(a)},destroy:function(){this._observable.destroy();delete this._observable;this.supr()}});(function(){var a={},b=-1,c=function(b){return a[b]||null};MetaphorJs.define("MetaphorJs.cmp.Component","MetaphorJs.cmp.Observable",{id:null,tag:"div",el:null,dom:null,cls:null,style:null,renderTo:null,html:null,rendered:!1,hidden:!1,destroyed:!1,destroyEl:!0,initialize:function(c){this.supr(c);this.dom&&!this.el&&(this.el=$(this.dom));this.el&&(this.id=this.el.attr("id"),this.dom||(this.dom=this.el.get(0)));b++;this.id=this.id||"cmp-"+b;a[this.id]=this;this.initComponent();!this.dom&&this.renderTo?
this.render():this.dom&&(this.hidden=this.el.is(":hidden"),this.rendered=!0,this.html&&(this.el.html(this.html),this.html=null),this.onRender())},render:function(a){if(!this.rendered){var b=this.tag,b=$("<"+b+"></"+b+">");a=a||this.renderTo;this.cls&&b.addClass(this.cls);this.style&&b.css(this.style);b.attr("id",this.id);this.html&&(b.html(this.html),this.html=null);this.hidden&&b.hide();b.appendTo(a||"body");this.el=b;this.dom=b.get(0);this.rendered=!0;this.onRender();this.renderTo=null}},setContent:function(a){this.rendered?
this.el.html(a):this.html=a},onRender:function(){this.el.attr("cmp-id",this.id);this.trigger("render",this);this.afterRender();this.trigger("afterrender",this)},show:function(){if(this.hidden){if(!1===this.trigger("beforeshow",this))return!1;this.el.show();this.hidden=!1;this.onShow();this.trigger("show",this)}},hide:function(){if(!this.hidden){if(!1===this.trigger("beforehide",this))return!1;this.el.hide();this.hidden=!0;this.onHide();this.trigger("hide",this)}},isHidden:function(){return this.hidden},
isRendered:function(){return this.rendered},isDestroyed:function(){return this.destroyed},getEl:function(){return this.el},getDom:function(){return this.dom},destroy:function(){if(!this.destroyed){if(!1===this.trigger("beforedestroy",this))return!1;this.onDestroy();this.destroyed=!0;this.trigger("destroy",this);this.destroyEl&&(this.el.remove(),this.dom=this.el=null);this.supr();delete a[this.id]}},initComponent:MetaphorJs.emptyFn,afterRender:MetaphorJs.emptyFn,onShow:MetaphorJs.emptyFn,onHide:MetaphorJs.emptyFn,
onDestroy:MetaphorJs.emptyFn});MetaphorJs.getCmp=c;$.fn.createCmp=function(a,b){var f=null;a&&"string"!=typeof a&&(b=a,a=null);a=a||"MetaphorJs.cmp.Component";b=b||{};this.each(function(){var h=$(this),g=h.attr("cmp-id");if(g)return f=c(g),!1;b.el=h;b.dom=this;f=MetaphorJs.create(a,b);return!1});return f};$.fn.getCmp=function(){return c(this.attr("cmp-id"))}})();MetaphorJs.define("MetaphorJs.data.Store","MetaphorJs.cmp.Observable",{autoLoad:!1,idProperty:"id",totalProperty:"total",root:"record",startParam:"start",limitParam:"limit",pageSize:null,clearOnLoad:!0,fields:null,recordType:null,destroyRecords:!0,ajaxOpt:{type:"GET"},ajaxData:null,extraParams:{},loaded:!1,loading:!1,local:!1,items:null,map:null,keys:null,length:0,totalLength:0,start:0,pages:null,loadXHR:null,filtered:!1,filterBackup:null,initialize:function(a,b,c,e){this.items=[];this.map={};this.keys=
[];this.loaded=!1;b&&"string"==typeof b&&(b={root:b});b=b||{};a&&$.isPlainObject(a)&&(b=a,a=null);c&&(b.extraParams=c);b.ajaxOpt=b.ajaxOpt||{};b.url&&(b.ajaxOpt.url=b.url);a&&(b.ajaxOpt.url=a);this.supr(b);!this.local&&this.autoLoad?this.load():e&&($.isArray(e)?this.loadArray(e):this.loadAjaxData(e));this.local&&(this.loaded=!0)},load:function(a,b,c,e){var d=this;d.loadXHR&&d.loadXHR.abort();a=a||{};if(!1!==d.trigger("beforeload",d)){d.loading=!0;if(c)d.once("load",c,e||window);!b&&d.clearOnLoad&&
0<d.length&&d.clear();b=$.extend({},d.ajaxOpt);b.data=$.extend({},d.extraParams,a);b.context=d;b.success=d.loadAjaxData;null===d.pageSize||a[d.startParam]||a[d.limitParam]||(b.data[d.startParam]=d.start,b.data[d.limitParam]=d.pageSize);d.loadXHR=$.ajax(b);d.loadXHR.always(function(){d.loadXHR=null})}},loadAjaxData:function(a){this.ajaxData=$.extend({},a);if(a[this.root]){var b=a[this.root];a=parseInt(a[this.totalProperty]);$.isArray(b)&&(this.loadData(b),this.totalLength=a||this.length)}},getAjaxData:function(){return this.ajaxData},
loadArray:function(a,b){!1!==this.trigger("beforeload",this)&&(!b&&this.clearOnLoad&&0<this.length&&this.clear(),$.isArray(a)&&(this.loadData(a),this.totalLength=this.length))},loadData:function(a){this.clearFilter(!0);this.suspendAllEvents();for(var b=0;b<a.length;b++)this.add(a[b]);this.resumeAllEvents();this.loaded=!0;this.loading=!1;this.trigger("load",this)},isLoaded:function(){return this.loaded},isLocal:function(){return this.local},setLocal:function(a){this.local=a?!0:!1},isLoading:function(){return this.loading},
isFiltered:function(){return this.filtered},loadOr:function(a,b){this.local||this.isLoading()||(this.isLoaded()?a&&a.call(b||window):this.load())},reload:function(a,b){if(!this.local){if(a)this.once("load",a,b||window);this.load()}},addNextPage:function(a,b){if(!(this.local||this.length>=this.totalLength)){if(a)this.once("load",a,b||window);this.load({start:this.length,limit:this.pageSize},!0)}},loadNextPage:function(a,b){if(!this.local){if(a)this.once("load",a,b||window);this.start+=this.pageSize;
this.load()}},loadPrevPage:function(a,b){if(!this.local){if(a)this.once("load",a,b||window);this.start-=this.pageSize;this.load()}},setParam:function(a,b){this.extraParams[a]=b},getParam:function(a){return this.extraParams[a]},getRecordId:function(a){return this.recordType?a.getId():a[this.idProperty]||null},processDataItem:function(a){return this.recordType?MetaphorJs.is(a,this.recordType)?a:MetaphorJs.create(this.recordType,a,this.fields,{idProperty:this.idProperty,listeners:{scope:this,change:this.onRecordChange,
destroy:this.onRecordDestroy}}):a},onRecordChange:function(a,b,c,e){this.trigger("update",this,e)},onRecordDestroy:function(a){this.remove(a)},getAt:function(a){return this.items[a]||null},getById:function(a){return this.map[a]||null},add:function(a,b,c){if("string"!=typeof a&&"number"!=typeof a){b=a;if($.isArray(b)){if(!b.length)return;a=this.length;for(var e=0,d=b.length;e<d;e++)b[e]=this.processDataItem(b[e]),this.add(this.getRecordId(b[e]),b[e],!0);c||this.trigger("add",a,b);return}b=this.processDataItem(b);
a=this.getRecordId(b)}if("undefined"!=typeof a&&null!==a){if("undefined"!=typeof this.map[a]){this.replace(a,b);return}this.map[a]=b}this.length++;this.items.push(b);this.keys.push(a);c||this.trigger("add",this.length-1,[b])},detachRecord:function(a){a.un("change",self.onRecordChange,self);a.un("destroy",self.onRecordDestroy,self)},removeAt:function(a){if(a<this.length&&0<=a){this.length--;var b=this.items[a];this.items.splice(a,1);var c=this.keys[a];"undefined"!=typeof c&&delete this.map[c];this.keys.splice(a,
1);this.trigger("remove",b,c);this.recordType&&this.detachRecord(b);return this.recordType&&this.destroyRecords?(b.destroy(),null):b}return!1},remove:function(a){return this.removeAt(this.indexOf(a))},removeId:function(a){return this.removeAt(this.indexOfId(a))},contains:function(a){return-1!=this.indexOf(a)},containsId:function(a){return"undefined"!=typeof this.map[a]},clear:function(){var a=this.getRange();this.clearFilter(!0);this.reset();this.trigger("clear",a)},reset:function(){this._reset()},
_reset:function(a){var b=this.destroyRecords,c;if(!a&&this.recordType)for(a=0,c=this.items.length;a<c;a++)this.detachRecord(this.items[a]),b&&this.items[a].destroy();this.totalLength=this.length=this.start=0;this.items=[];this.keys=[];this.map={};this.loaded=this.local},destroy:function(){this.trigger("destroy",this);this.removeAllListeners("clear");this.clear();this.supr()},insert:function(a,b,c){2==arguments.length&&(c=arguments[1],b=this.getRecordId(c));c=this.processDataItem(c);this.containsId(b)&&
(this.suspendAllEvents(),this.removeId(b),this.resumeAllEvents());if(a>=this.length)return this.add(b,c);this.length++;this.items.splice(a,0,c);"undefined"!=typeof b&&null!==b&&(this.map[b]=c);this.keys.splice(a,0,b);this.trigger("add",a,[c]);return c},indexOf:function(a){return this.items.indexOf(a)},indexOfId:function(a){return this.keys.indexOf(a)},getCount:function(){return this.length},getTotalCount:function(){return this.totalLength},getPagesCount:function(){return null!==this.pageSize?parseInt(this.totalLength/
this.pageSize):1},each:function(a,b){var c=[].concat(this.items);b=b||window;for(var e=0,d=c.length;e<d&&!1!==a.call(b,c[e],e,d);e++);},eachId:function(a,b){b=b||window;for(var c=0,e=this.keys.length;c<e;c++)a.call(b,this.keys[c],this.items[c],c,e)},replace:function(a,b){1==arguments.length&&(b=arguments[0],a=this.getRecordId(b));b=this.processDataItem(b);var c=this.map[a];if("undefined"==typeof a||null===a||"undefined"==typeof c)return this.add(a,b);this.recordType&&(this.detachRecord(c),this.destroyRecords&&
(c.destroy(),c=null));var e=this.indexOfId(a);this.items[e]=b;this.map[a]=b;this.trigger("replace",a,c,b);return b},first:function(){return this.items[0]},last:function(){return this.items[this.length-1]},getRange:function(a,b){var c=this.items;if(1>c.length)return[];a=a||0;b=Math.min("undefined"==typeof b||null===b?this.length-1:b,this.length-1);var e,d=[];if(a<=b)for(e=a;e<=b;e++)d[d.length]=c[e];else for(e=a;e>=b;e--)d[d.length]=c[e];return d},findBy:function(a,b,c){a=this.findIndexBy(a,b,c);return-1==
a?null:this.getAt(a)},findIndexBy:function(a,b,c){b=b||this;var e=this.keys,d=this.items;c=c||0;for(var f=d.length;c<f;c++)if(a.call(b,d[c],e[c]))return c;return-1},find:function(a,b,c){var e=this.recordType?!0:!1,d;return this.findIndexBy(function(f){d=e?f.get(a):f[a];return c?d===b:d==b},this)},findExact:function(a,b){return this.find(a,b,!0)},findBySet:function(a){var b=null,c,e;this.each(function(d){c=!0;for(e in a)if(a[e]!=d[e]){c=!1;break}if(c)return b=d,!1});return b},filter:function(a,b,c){this.trigger("beforefilter",
this);this.suspendAllEvents();this.filterBackup||(this.filterBackup={length:this.length,totalLength:this.totalLength,items:this.items,keys:this.keys,map:this.map});this._reset(!0);this.filtered=!0;for(var e=this.filterBackup.keys,d=this.filterBackup.items,f=0,h=d.length;f<h;f++)a.call(b,d[f],e[f],c)&&(this.items.push(d[f]),this.keys.push(e[f]),this.length++,this.map[e[f]]=d[f]);this.totalLength=this.length;this.resumeAllEvents();this.trigger("filter",this)},clearFilter:function(a){this.filtered&&
(a||this.trigger("beforeclearfilter",this),this.suspendAllEvents(),this.filtered=!1,this._reset(!0),this.length=this.filterBackup.length,this.totalLength=this.filterBackup.totalLength,this.items=this.filterBackup.items,this.keys=this.filterBackup.keys,this.map=this.filterBackup.map,this.filterBackup=null,this.resumeAllEvents(),a||this.trigger("clearfilter",this))},collect:function(a){var b=[],c=this.recordType;this.each(function(e){(e=c?e.get(a):e[a])&&b.push(e)});return b}},{createFromSelect:function(a){var b=
[];a=a.options;for(var c=0,e=a.length;c<e;c++){var d=a[c],f=(d.hasAttribute?d.hasAttribute("value"):d.getAttributeNode("value").specified)?d.value:d.text;b.push([f,d.text])}a=MetaphorJs.create("MetaphorJs.data.Store",{idProperty:0});a.loadArray(b);return a}});MetaphorJs.define("MetaphorJs.data.Record","MetaphorJs.cmp.Observable",{data:{},fields:{},idProperty:null,id:null,initialize:function(a,b,c){this.supr(c);this.fields=b||{};this.data=this.processRawData(a);this.idProperty&&(this.id=this.data[this.idProperty])},processRawData:function(a){var b={},c;for(c in a)b[c]=this.restoreField(c,a[c]);return b},restoreField:function(a,b){var c=this.fields[a];if(c){switch("string"==typeof c?c:c.type){case "int":b=parseInt(b);break;case "bool":case "boolean":"string"==
typeof b?(b=b.toLowerCase(),b="off"===b||"no"===b||"0"===b?!1:!0):b=b?!0:!1;break;case "double":case "float":b=parseFloat(b)}c.process&&(b=c.process.call(this,b,a))}return this.onRestoreField(a,b)},onRestoreField:function(a,b){return b},getId:function(){return this.id},getData:function(){return $.extend({},this.data)},get:function(a){return this.data[a]},set:function(a,b){var c=this.data[a];this.data[a]=this.restoreField(a,b);this.trigger("change",a,b,c,this)},destroy:function(){this.trigger("destroy",
this);this.data={};this.fields=null;this.supr()}});
}());