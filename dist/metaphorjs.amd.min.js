'use strict';define("metaphorjs","metaphorjs-observable metaphorjs-promise metaphorjs-ajax metaphorjs-animate metaphorjs-input metaphorjs-class metaphorjs-namespace metaphorjs-select metaphorjs-validator metaphorjs-watchable metaphorjs-dialog metaphorjs-history".split(" "),function(la,v,Na,G,ba,hb,ib,B,jb,Ga,Oa,ma){function W(){}function x(g,a){return g.getAttribute?g.getAttribute(a):null}function fa(g){return"object"==typeof g&&3===J(g)&&!g.nodeType&&g.constructor===Object}function na(g){return!0===
g||!1===g}function H(g){return"object"==typeof g&&5===J(g)}function Q(g){if(g&&void 0!=!g.length&&g!==""+g){for(var a=[],b=-1,c=g.length>>>0;++b!==c;a[b]=g[b]);return a}return g?[g]:[]}function E(g){return"function"==typeof g}function oa(g){if(!g)return!1;var a,b;return"object"!=(b=typeof g)&&"function"!=b?!1:E(a=g.then)?a:!1}function A(g){return"string"==typeof g||g===""+g}function Pa(g){var a={},b,c,d=g.attributes;g=0;for(b=d.length;g<b;g++)c=d[g],a[c.name]=c.value;return a}function Qa(g){if(null===
g||"object"!=typeof g)return!1;g=J(g);return 2<g||-1==g}function M(g){var a=window.document.createDocumentFragment(),b,c;A(g)&&(b=window.document.createElement("div"),b.innerHTML=g,g=b.childNodes);if(!g)return a;if(g.nodeType)a.appendChild(g);else if(g.item)for(b=-1,c=g.length>>>0;++b!==c;a.appendChild(g[0]));else for(b=-1,c=g.length;++b!==c;a.appendChild(g[b]));return a}function va(g,a){return a?ta("(?:^|\\s)"+a+"(?!\\S)").test(g.className):!1}function N(g,a){a&&!va(g,a)&&(g.className+=" "+a)}function P(g,
a){a&&(g.className=g.className.replace(ta("(?:^|\\s)"+a+"(?!\\S)"),""))}function Y(g,a,b,c){return setTimeout(function(){g.apply(a,b||[])},c||0)}function Z(g){var a=g.stack||Error().stack;if("undefined"!=typeof console&&console.log)Y(function(){console.log(g);a&&console.log(a)});else throw g;}function Ha(g){g=J(g);return 3>g&&-1<g}function kb(g){return g.replace(lb,function(a){return a.charAt(1).toUpperCase()})}function O(g,a,b){var c=y(g,"config"),d;if(c)return c;c={};if(b||null!==(b=x(g,"mjs-config")))for(d in g.removeAttribute("mjs-config"),
a=b?R(b)(a||{}):{},a)c[d]=a[d];a=mb(g);for(d in a)b=a[d],c[d]=""===b?!0:b;y(g,"config",c);return c}function wa(g,a,b,c,d){var e=!1!==a;a=a||{};d=d||[];b=b||a.scope;c=c||a.node;a.scope=a.scope||b;a.node=a.node||c;var f=A(g)?ga(g):g;if(!f)throw"Component "+g+" not found";b&&f.$isolateScope&&(a.scope=b=b.$newIsolated());var h,k=[];g=f.template||a.template||null;var l=f.templateUrl||a.templateUrl||null,m=b?b.$app:null,r=Ra.global(),n=m?m.inject:r.inject,p=m?m:r,C=c?x(c,"mjs-cloak"):null,q={$node:c||null,
$scope:b||null,$config:a||null,$args:d||null};if(f.resolve)for(h in f.resolve)(function(e){var l=new v,g;k.push(l.done(function(b){q[e]=b;a[e]=b;d.push(b)}));g=f.resolve[h];E(g)?l.resolve(g(b,c)):A(g)?l.resolve(n.resolve(g)):l.resolve(n.call(p,g,null,t({},q,a,!1,!1)));l.fail(Z)})(h);e&&(g||l)&&(a.template=new pa({scope:b,node:c,deferRendering:!0,ownRenderer:!0,shadow:f.$shadow,tpl:g,url:l}),k.push(a.template.initPromise),c&&c.firstChild&&y(c,"mjs-transclude",M(c.childNodes)));e&&d.unshift(a);var u;
k.length?(u=new v,v.all(k).done(function(){u.resolve(n.call(p,f,null,t({},q,a,!1,!1),d))})):u=v.resolve(n.call(p,f,null,t({},q,a,!1,!1),d));c&&u.isPending()&&null!==C&&(C?N(c,C):c.style.visibility="hidden",u.then(function(){C?P(c,C):c.style.visibility=""}));c&&u.then(function(){P(c,"mjs-cloak")});return u}function qa(){return!1}function Sa(g){var a=g.nodeName.toLowerCase();g=g.type;return"input"!=a&&"textarea"!=a&&"select"!=a||"submit"==g||"reset"==g||"button"==g?!1:!0}function xa(){return!0}function S(g){return new ua(g)}
function Ta(g,a){var b;a:{for(var c=g,d;c;){d=y(c,"mjs-transclude");if(void 0!==d){b=d;break a}c=c.parentNode}b=void 0}if(b){g.firstChild&&y(g,"mjs-transclude",M(g.childNodes));c=g.parentNode;d=g.nextSibling;b=Ia(b);var e=Q(b.childNodes);a?(c.removeChild(g),c.insertBefore(b,d)):g.appendChild(b);return e}return null}function nb(g,a,b){b||(b="asc");g=g.slice();g.sort(function(b,d){var e=typeof b,f=b,h=d;if(e!=typeof d)return 0;"object"==e&&(E(a)?(f=a(b),h=a(d)):(f=b[a],h=d[a]));if("number"==typeof f)return f-
h;f=(""+f).toLowerCase();h=(""+h).toLowerCase();return f===h?0:f>h?1:-1});return"desc"==b?g.reverse():g}function Ua(g){return g===window||g&&g.document&&g.location&&g.alert&&g.setInterval}function ca(g){return g.substr(0,1).toUpperCase()+g.substr(1)}function X(g,a,b){if(g){var c=g.style,d;"string"==typeof a?(g={},g[a]=b):g=a;for(d in g)c[d]=g[d]}}function ob(g,a,b,c){var d=a+"-"+b,e=function(b){b=S(b);return ya(b.target,a)?c(b):null};za[d]||(za[d]=[]);za[d].push({el:g,ls:e,fn:c});K(g,b,e)}function pb(g,
a,b,c){var d,e;if(e=za[a+"-"+b])for(a=-1,d=e.length;++a<d;)e[a].el===g&&e[a].fn===c&&T(g,b,e[a].ls)}function ha(g){var a={top:0,left:0},b=window.document.documentElement;if(!Ja(g)||g===window)return a;g.getBoundingClientRect&&(a=g.getBoundingClientRect());return{top:a.top+Aa()-b.clientTop,left:a.left+Ba()-b.clientLeft}}function Va(g,a,b){var c,d=g.childNodes;if(!1!==a.call(b,g))for(g=-1,c=d.length>>>0;++g!==c;Va(d[g],a,b));}var qb=ba.getValue,rb=ba.setValue,ya=B.is,ia={},z=new ib(ia,"MetaphorJs"),
ra=new hb(z),s=ra.define,da=Array.prototype.slice,sb=Object.prototype.toString,J=function(){var g={"[object String]":0,"[object Number]":1,"[object Boolean]":2,"[object Object]":3,"[object Function]":4,"[object Array]":5,"[object RegExp]":9,"[object Date]":10};return function(a){if(!a){if(null===a)return 6;if(void 0===a)return 7}var b=g[sb.call(a)];return void 0===b?-1:1==b&&isNaN(a)?8:b}}(),t=function(){return function a(){var b=!1,c=!1,d=da.call(arguments),e=d.shift(),f,h,k;na(d[d.length-1])&&(b=
d.pop());na(d[d.length-1])&&(c=b,b=d.pop());for(;d.length;)if(f=d.shift())for(h in f)if(f.hasOwnProperty(h)&&void 0!==(k=f[h]))if(c)if(e[h]&&fa(e[h])&&fa(k))a(e[h],k,b,c);else{if(!0===b||void 0==e[h])fa(k)?(e[h]={},a(e[h],k,b,!0)):e[h]=k}else if(!0===b||void 0==e[h])e[h]=k;return e}}(),aa=function(g){this.$$observable=new la;this.$$historyWatchers={};t(this,g,!0,!1);this.$parent?(this.$parent.$on("check",this.$$onParentCheck,this),this.$parent.$on("destroy",this.$$onParentDestroy,this)):(this.$root=
this,this.$isRoot=!0)};t(aa.prototype,{$app:null,$parent:null,$root:null,$isRoot:!1,$level:0,$$observable:null,$$watchers:null,$$historyWatchers:null,$$checking:!1,$$destroyed:!1,$new:function(){return new aa({$parent:this,$root:this.$root,$app:this.$app,$level:this.$level+1})},$newIsolated:function(){return new aa({$app:this.$app,$level:self.$level+1})},$on:function(g,a,b){return this.$$observable.on(g,a,b)},$un:function(g,a,b){return this.$$observable.un(g,a,b)},$watch:function(g,a,b){return Ga.create(this,
g,a,b,null)},$unwatch:function(g,a,b){return Ga.unsubscribeAndDestroy(this,g,a,b)},$watchHistory:function(g,a){this.$$historyWatchers[a]||(this.$$historyWatchers[a]=g,ia.history.on("change-"+a,this.$$onHistoryChange,this))},$unwatchHistory:function(g){this.$$historyWatchers[g]||(delete this.$$historyWatchers[g],ia.history.un("change-"+g,this.$$onHistoryChange,this))},$wrap:function(g,a){var b=this,c;"string"==typeof g&&(c=g,g=a[c]);var d=function(){var c=g.apply(a,arguments);b.$check();return c};
c&&(a[c]=d);return d},$get:function(g){for(var a=this;a;){if(void 0!==a[g])return a[g];a=a.$parent}},$set:function(g,a){if("string"==typeof g)this[g]=a;else for(var b in g)this[b]=g[b];this.$check()},$$onParentDestroy:function(){this.$destroy()},$$onParentCheck:function(){this.$check()},$$onHistoryChange:function(g,a,b){this.$$historyWatchers[b]&&(a=this.$$historyWatchers[b],this[a]=g,this.$check())},$check:function(){var g;this.$$checking||(this.$$checking=!0,this.$$watchers&&(g=this.$$watchers.$checkAll()),
this.$$checking=!1,this.$$destroyed||this.$$observable.trigger("check",g),0<g&&this.$check())},$destroy:function(){var g,a;this.$$observable.trigger("destroy");this.$$observable.destroy();this.$$watchers&&this.$$watchers.$destroyAll();for(g in this.$$historyWatchers)this.$unwatchHistory(g);for(a in this)this.hasOwnProperty(a)&&(this[a]=null);this.$$destroyed=!0}},!0,!1);var U=function(){var g=["0","0","0"];return function(){for(var a=g.length,b;a;){a--;b=g[a].charCodeAt(0);if(57==b)return g[a]="A",
g.join("");if(90==b)g[a]="0";else return g[a]=String.fromCharCode(b+1),g.join("")}g.unshift("0");return g.join("")}}(),ea=function(){return String.prototype.trim?function(g){return A(g)?g.trim():g}:function(g){return A(g)?g.replace(/^\s\s*/,"").replace(/\s\s*$/,""):g}}(),V=Ga.create,w=z.add,ga=z.get,q=function(){var g=[],a=!1,b=function(a,b){return a.priority<b.priority?-1:a.priority>b.priority?1:0};return s({$class:"Directive",watcher:null,scope:null,node:null,expr:null,autoOnChange:!0,$init:function(a,
b,e){var f;e=ea(e);this.node=b;this.expr=e;this.scope=a;this.watcher=V(a,e,this.onChange,this,null,z);if(this.autoOnChange&&void 0!==(f=this.watcher.getLastResult()))this.onChange(f,void 0);a.$on("destroy",this.onScopeDestroy,this)},onScopeDestroy:function(){this.$destroy()},onChange:function(){},destroy:function(){this.watcher&&this.watcher.unsubscribeAndDestroy(this.onChange,this);this.$super()}},{registerAttribute:function(b,d,e){ga("attr."+b,!0)||(g.push({priority:d,name:b,handler:w("attr."+b,
e)}),a=!1)},getAttributes:function(){a||(g.sort(b),a=!0);return g},registerTag:function(a,b){ga("tag."+a,!0)||w("tag."+a,b)}})}(),D=Function.prototype.bind?function(g,a){return g.bind(a)}:function(g,a){return function(){return g.apply(a,arguments)}},Wa=function(){var g=/\\{/g,a=new la,b=function(a,b,f,h,k){return!b||!b.indexOf||-1==b.indexOf("{{")&&-1==b.indexOf("{[")?null:new c(a,b,f,h,k)},c=s({$class:"TextRenderer",id:null,parent:null,isRoot:null,scope:null,origin:"",processed:null,text:null,watchers:null,
children:null,data:null,recursive:!1,dataChangeDelegate:null,changeTmt:null,lang:null,$init:function(a,b,c,h,k){this.id=U();this.origin=b;this.scope=a;this.parent=c;this.isRoot=!c;this.data=h;this.lang=a.$app?a.$app.lang:null;if(!0===k||!1===k)this.recursive=k;this.watchers=[];this.children=[];this.dataChangeDelegate=D(this.doDataChange,this);this.processed=this.processText(b);this.render()},subscribe:function(b,c){return a.on(this.id,b,c)},unsubscribe:function(b,c){return a.un(this.id,b,c)},getString:function(){null===
this.text&&this.render();var a=this.text;return-1!=a.indexOf("\\{")?a.replace(g,"{"):a},render:function(){var a=this.processed,b,f,h;this.children.length||this.createChildren();h=this.children;b=-1;for(f=h.length;++b<f;a=a.replace("---"+b+"---",h[b]instanceof c?h[b].getString():h[b]));return this.text=a},processText:function(a){for(var b=0,c=a.length,h,k,l="";b<c;)if(-1!=(h=a.indexOf("{{",b))&&-1!=(k=a.indexOf("}}",h+2))&&"\\"!=a.substr(h-1,1))l+=a.substring(b,h),k!=h+2&&(l+=this.watcherMatch(a.substring(h+
2,k))),b=k+2;else{b!==c&&(l+=a.substring(b));break}b=0;a=l;c=a.length;for(l="";b<c;)if(-1!=(h=a.indexOf("{[",b))&&-1!=(k=a.indexOf("]}",h+2))&&"\\"!=a.substr(h-1,1))l+=a.substring(b,h),k!=h+2&&(l+=this.watcherMatch(a.substring(h+2,k),!0)),b=k+2;else{b!==c&&(l+=a.substring(b));break}return l},watcherMatch:function(a,b){var c=this.watchers;if(b){a=ea(a);for(var h=a,k=h.length,l=0,g=0,r=!1,n=!1,p=[],C;l<k;l++)C=h.charAt(l),"\\"==C?l++:'"'==C?r=!r:"'"==C?n=!n:r||n||"|"!=C||("|"!=h.substr(l-1,1)&&"|"!=
h.substr(l+1,1)&&(p.push(h.substring(g,l).replace("\\|","|")),g=l+1),l+=0);p.push(h.substring(g).replace("\\|","|"));h=ea(p[0]);"."!=h.substr(0,1)&&(p[0]="'"+h+"'");1==p.length&&p.push("l");a=p.join(" | ")}c.push(V(this.scope,a,this.onDataChange,this,null,z));return"---"+(c.length-1)+"---"},onDataChange:function(){this.changeTmt||(this.changeTmt=setTimeout(this.dataChangeDelegate,0))},doDataChange:function(){this.destroyChildren();this.triggerChange();this.changeTmt=null},triggerChange:function(){this.text=
null;this.isRoot?a.trigger(this.id,this,this.data):this.parent.triggerChange()},createChildren:function(){var a=this.watchers,c=this.children,f=this.scope,h=this.recursive,k,l,g;k=-1;for(l=a.length;++k<l;)g=a[k].getLastResult(),void 0===g&&(g=""),c.push(h&&b(f,g,this,null,!0)||g)},destroyChildren:function(){var a=this.children,b,f;b=-1;for(f=a.length;++b<f;)a[b]instanceof c&&a[b].$destroy();this.children=[]},destroyWatchers:function(){var a=this.watchers,b,c;b=-1;for(c=a.length;++b<c;a[b].unsubscribeAndDestroy(this.onDataChange,
this));this.watchers=[]},destroy:function(){this.destroyChildren();this.destroyWatchers();a.destroyEvent(this.id);this.changeTmt&&clearTimeout(this.changeTmt)}},{create:b});return c}(),Xa=Array.prototype.indexOf;Xa||(Xa=Array.prototype.indexOf=function(g,a){var b;if(null==this)throw new TypeError('"this" is null or not defined');var c=Object(this),d=c.length>>>0;if(0===d)return-1;b=+a||0;Infinity===Math.abs(b)&&(b=0);if(b>=d)return-1;for(b=Math.max(0<=b?b:d-Math.abs(b),0);b<d;){if(b in c&&c[b]===
g)return b;b++}return-1});var Ca=function(){var g=null,a=Wa.create,b=function(a,b,c,d,f,g){var p=[];if(a&&!0!==a){if(a.nodeType){g.countdown+=1;e(a,c,d,f,g);return}p=da.call(a)}p.length||(p=Q(b.childNodes||b));b=p.length;g.countdown+=b;for(a=-1;++a<b;e(p[a],c,d,f,g));},c=function(a,b){if(b)if(b.nodeType)a.push(b);else if(H(b))for(var d=-1,e=b.length;++d<e;c(a,b[d]));},d={script:!0,template:!0,"mjs-template":!0,style:!0},e=function(a,c,e,f,g){if(a){var n;n=a.nodeName;g||(g={countdown:1});if(!n||!d[n.toLowerCase()])if(n=
c.call(e,a),!1!==n){if(oa(n)){n.done(function(d){!1!==d&&b(d,a,c,e,f,g);0==--g.countdown&&f&&f.call(e)});return}b(n,a,c,e,f,g)}0==--g.countdown&&f&&f.call(e)}},f=new la;return s({$class:"Renderer",id:null,el:null,scope:null,texts:null,parent:null,$init:function(a,b,c){this.id=U();this.el=a;this.scope=b;this.texts=[];this.parent=c;b instanceof aa&&b.$on("destroy",this.$destroy,this);if(c)c.on("destroy",this.$destroy,this)},on:function(a,b,c){return f.on(a+"-"+this.id,b,c)},once:function(a,b,c){return f.once(a+
"-"+this.id,b,c)},un:function(a,b,c){return f.un(a+"-"+this.id,b,c)},createChild:function(a){return new Ca(a,this.scope,this)},getEl:function(){return this.el},runHandler:function(a,b,c,d){var e=a.$isolateScope?b.$newIsolated():a.$breakScope?b.$new():b,f=b.$app,g={$scope:e,$node:c,$attrValue:d,$renderer:this};c=[e,c,d,this];g=f?f.inject(a,null,g,c):a.$instantiate?a.$instantiate.apply(a,c):a.apply(null,c);f&&a.$registerBy&&g&&(oa(g)?g.done(function(c){f.registerCmp(c,b,a.$registerBy)}):f.registerCmp(g,
b,a.$registerBy));if("function"==typeof g)this.on("destroy",g);else if(g&&g.$destroy)this.on("destroy",g.$destroy,g);return a.$stopRenderer?!1:g},processNode:function(b){var d=b.nodeType,e=this.texts,f=this.scope,r,n;if(3==d){if(r=null!==x(b.parentNode,"mjs-recursive"),d=a(f,b.textContent||b.nodeValue,null,e.length,r))d.subscribe(this.onTextChange,this),e.push({node:b,tr:d}),this.renderText(e.length-1)}else if(1==d){g||(g=q.getAttributes());var d=[],p=[],C,F,u;n="tag."+b.tagName.toLowerCase();if(n=
ga(n,!0)){F=this.runHandler(n,f,b);if(!1===F)return!1;oa(F)?d.push(F):c(p,F)}C=Pa(b);n=0;for(r=g.length;n<r;n++)if(u=g[n].name,void 0!==(F=C[u])){b.removeAttribute(u);F=this.runHandler(g[n].handler,f,b,F);C[u]=null;if(!1===F)return!1;oa(F)?d.push(F):c(p,F)}if(d.length){var s=new v;v.all(d).done(function(a){c(p,a);s.resolve(p)});return s}r=void 0!==C["mjs-recursive"];delete C["mjs-recursive"];for(n in C)null!==C[n]&&(d=a(f,C[n],null,e.length,r))&&(b.removeAttribute(n),d.subscribe(this.onTextChange,
this),e.push({node:b,attr:n,tr:d}),this.renderText(e.length-1));return p.length?p:!0}return!0},process:function(){this.el.nodeType?e(this.el,this.processNode,this,this.onProcessingFinished,{countdown:1}):b(null,this.el,this.processNode,this,this.onProcessingFinished,{countdown:0})},onProcessingFinished:function(){f.trigger("rendered-"+this.id,this)},onTextChange:function(a,b){this.renderText(b)},renderText:function(a){a=this.texts[a];var b=a.tr.getString(),c=a.attr;c?("value"==c?a.node.value=b:"class"==
c?a.node.className=b:"src"==c&&(a.node.src=b),a.node.setAttribute(c,b)):(a.node.textContent=b,a.node.nodeValue=b)},destroy:function(){var a=this.texts,b,c;b=-1;for(c=a.length;++b<c;a[b].tr.$destroy());this.parent&&this.parent.un("destroy",this.$destroy,this);f.trigger("destroy-"+this.id)}})}(),tb=function(){var g=function(a,b){"pt_BR"==b&&(b="xbr");3<b.length&&(b=b.substr(0,-b.lastIndexOf("_")));switch(b){case "bo":case "dz":case "id":case "ja":case "jv":case "ka":case "km":case "kn":case "ko":case "ms":case "th":case "tr":case "vi":case "zh":return 0;
case "af":case "az":case "bn":case "bg":case "ca":case "da":case "de":case "el":case "en":case "eo":case "es":case "et":case "eu":case "fa":case "fi":case "fo":case "fur":case "fy":case "gl":case "gu":case "ha":case "he":case "hu":case "is":case "it":case "ku":case "lb":case "ml":case "mn":case "mr":case "nah":case "nb":case "ne":case "nl":case "nn":case "no":case "om":case "or":case "pa":case "pap":case "ps":case "pt":case "so":case "sq":case "sv":case "sw":case "ta":case "te":case "tk":case "ur":case "zu":return 1==
a?0:1;case "am":case "bh":case "fil":case "fr":case "gun":case "hi":case "ln":case "mg":case "nso":case "xbr":case "ti":case "wa":return 0==a||1==a?0:1;case "be":case "bs":case "hr":case "ru":case "sr":case "uk":return 1==a%10&&11!=a%100?0:2<=a%10&&4>=a%10&&(10>a%100||20<=a%100)?1:2;case "cs":case "sk":return 1==a?0:2<=a&&4>=a?1:2;case "ga":return 1==a?0:2==a?1:2;case "lt":return 1==a%10&&11!=a%100?0:2<=a%10&&(10>a%100||20<=a%100)?1:2;case "sl":return 1==a%100?0:2==a%100?1:3==a%100||4==a%100?2:3;
case "mk":return 1==a%10?0:1;case "mt":return 1==a?0:0==a||1<a%100&&11>a%100?1:10<a%100&&20>a%100?2:3;case "lv":return 0==a?0:1==a%10&&11!=a%100?1:2;case "pl":return 1==a?0:2<=a%10&&4>=a%10&&(12>a%100||14<a%100)?1:2;case "cy":return 1==a?0:2==a?1:8==a||11==a?2:3;case "ro":return 1==a?0:0==a||0<a%100&&20>a%100?1:2;case "ar":return 0==a?0:1==a?1:2==a?2:3<=a&&10>=a?3:11<=a&&99>=a?4:5;default:return 0}},a=function(a){this.store={};a&&(this.locale=a)};t(a.prototype,{store:null,locale:"en",setLocale:function(a){this.locale=
a},set:function(a,b){var e=this.store;void 0===e[a]&&(e[a]=b)},load:function(a){t(this.store,a,!1,!1)},get:function(a){return this.store[a]||(this===b?"-- "+a+" --":b.get(a))},plural:function(a,b){var e=this.get(a),f=g(b,this.locale);return H(e)?e[f]:fa(e)?e[b]?e[b]:1==b&&void 0!=e.one?e.one:0>b&&void 0!=e.negative?e.negative:e.other:e},destroy:function(){this.store=null}},!0,!1);var b=new a;a.global=function(){return b};return a}(),ub=function(){var g=[],a=function(a){var c,d,e,f;c=0;for(d=g.length;c<
d;c++)e=g[c],e.$destroy?e.$destroy():e.destroy&&e.destroy();g=null;ra&&ra.destroy&&(ra.destroy(),ra=null);z&&z.destroy&&(z.destroy(),z=null);for(f in ia)ia[f]=null;ia=null;if(a)for(f in window)window.hasOwnProperty(f)&&(window[f]=null)};a.collect=function(a){g.push(a)};return a}();z.register("mixin.Observable",{$$observable:null,$$callbackContext:null,$beforeInit:function(g){this.$$observable=new la;if(g&&g.callback){var a=g.callback,b=a.context||a.scope,c;a.context=null;a.scope=null;for(c in a)if(a[c])this.$$observable.on(c,
a[c],b||this);g.callback=null;b&&(this.$$callbackContext=b)}},on:function(){var g=this.$$observable;return g.on.apply(g,arguments)},un:function(){var g=this.$$observable;return g.un.apply(g,arguments)},once:function(){var g=this.$$observable;return g.once.apply(g,arguments)},trigger:function(){var g=this.$$observable;return g.trigger.apply(g,arguments)},$beforeDestroy:function(){this.$$observable.trigger("before-destroy",this)},$afterDestroy:function(){this.$$observable.trigger("destroy",this);this.$$observable.destroy();
this.$$observable=null}});var vb=function(g,a){var b=function(){},c;b.prototype=g.prototype;b=new b;c=g.apply(b,a);return Qa(c)||!1===c?c:b},Ra=function(){var g,a=function(){this.store={}};t(a.prototype,{store:null,instantiate:function(a,c,d,e){return a.$instantiate?a.$instantiate.apply(a,d):e?vb(a,d):a.apply(c,d)},inject:function(a,c,d,e,f){d=d||{};e=e||[];var h=this;if(E(a))if(a.inject)e=da.call(a.inject),e.push(a),a=e;else return h.instantiate(a,c,e,f);a=da.call(a);e=[];var k=a.pop(),g,m;g=-1;
for(m=a.length;++g<m;e.push(h.resolve(a[g],d)));return v.all(e).then(function(a){return h.instantiate(k,c,a,f)})},value:function(a,c){this.store[a]={type:1,value:c}},constant:function(a,c){var d=this.store;d[a]||(d[a]={type:2,value:c})},factory:function(a,c,d,e){na(d)&&(e=d,d=null);this.store[a]={type:3,singleton:e,fn:c,context:d}},service:function(a,c,d){this.store[a]={type:4,singleton:d,fn:c}},provider:function(a,c){this.store[a+"Provider"]={name:a,type:5,fn:c,instance:null}},resolve:function(a,
c,d){var e=this.store,f,h,k;c=c||{};d=d||[];if(void 0!==c[a])return c[a];if(h=e[a]){f=h.type;if(1==f||2==f)return h.value;if(3==f)k=this.inject(h.fn,h.context,c,d);else if(4==f)k=this.inject(h.fn,null,c,d,!0);else if(5==f)return h.instance||(h.instance=v.resolve(this.inject(h.fn,null,c)).done(function(a){h.instance=a;e[h.name]={type:3,fn:a.$get,context:a}})),h.instance;h.singleton&&(h.type=1,h.value=k,3==f&&oa(k)&&k.done(function(a){h.value=a}));return c[a]=k}if(e[a+"Provider"])return this.resolve(a+
"Provider",c),this.resolve(a,c);if(this===g)throw"Could not provide value for "+a;return g.resolve(a)},destroy:function(){this.scope=this.store=null}},!0,!1);a.global=function(){return g};g=new a;return a}();z.register("mixin.Provider",{$$provider:null,$beforeInit:function(){this.$$provider=new Ra},value:function(){var g=this.$$provider;return g.value.apply(g,arguments)},constant:function(){var g=this.$$provider;return g.constant.apply(g,arguments)},factory:function(){var g=this.$$provider;return g.factory.apply(g,
arguments)},service:function(){var g=this.$$provider;return g.service.apply(g,arguments)},provider:function(){var g=this.$$provider;return g.provider.apply(g,arguments)},resolve:function(){var g=this.$$provider;return g.resolve.apply(g,arguments)},inject:function(){var g=this.$$provider;return g.inject.apply(g,arguments)},$afterDestroy:function(){this.$$provider.destroy();this.$$provider=null}});s({$class:"App",$mixins:["mixin.Observable","mixin.Provider"],lang:null,scope:null,renderer:null,cmpListeners:null,
components:null,sourceObs:null,$init:function(g,a){var b=a instanceof aa?a:new aa(a),c;ub.collect(this);g.removeAttribute("mjs-app");b.$app=this;this.$super();this.lang=new tb;this.scope=b;this.cmpListeners={};this.components={};this.factory("$parentCmp",["$node",this.getParentCmp],this);this.value("$app",this);this.value("$rootScope",b.$root);this.value("$lang",this.lang);this.renderer=new Ca(g,b);c=da.call(arguments);c[1]=b;this.initApp.apply(this,c)},initApp:W,run:function(){this.renderer.process()},
createSource:function(g,a){var b="source-"+g;this.$$observable.getEvent(b)||this.$$observable.createEvent(b,a||"nonempty")},registerSource:function(g,a,b){this.on("source-"+g,a,b)},collect:function(g){arguments[0]="source-"+arguments[0];return this.trigger.apply(this,arguments)},getParentCmp:function(g){g=g.parentNode;for(var a;g;){if(a=x(g,"cmp-id"))return this.getCmp(a);g=g.parentNode}return null},onAvailable:function(g,a,b){var c=this.cmpListeners,d=this.components;c[g]||(c[g]=new v);a&&c[g].done(a,
b);d[g]&&c[g].resolve(d[g]);return c[g]},getCmp:function(g){return this.components[g]||null},registerCmp:function(g,a,b){var c=this,d=g[b];b=function(){delete c.cmpListeners[d];delete c.components[d]};c.components[d]=g;c.cmpListeners[d]&&c.cmpListeners[d].resolve(g);if(g.on)g.on("destroy",b);a.$on("$destroy",b)},destroy:function(){this.renderer.$destroy();this.scope.$destroy();this.lang.destroy();this.$super()}});var Ja=function(){return function a(b){if(b===window)return!0;if(3==b.nodeType)return b.parentElement?
a(b.parentElement):!0;var c=window.document.documentElement;return b===c?!0:c.contains(b)}}(),y=function(){var g={};return function(a,b,c){a=a._mjsid||(a._mjsid=U());var d=g[a];return void 0!==c?(d||(d=g[a]={}),d[b]=c):d?d[b]:void 0}}(),Ia=function a(b){var c,d,e;if(H(b)){e=[];c=0;for(d=b.length;c<d;c++)e.push(a(b[c]));return e}if(b)switch(b.nodeType){case 1:return b.cloneNode(!0);case 3:return window.document.createTextNode(b.innerText||b.textContent);case 11:return b.cloneNode(!0)}return null},
wb=function(){var a,b=function(b){var d={},e=[];0==arguments.length&&(b=!0);return{addFinder:function(a,b,c){e[c?"unshift":"push"]({fn:a,context:b})},add:function(a,h,e){if(d[a]&&!1===d[a].rewritable)return d[a];d[a]={rewritable:"undefined"!=typeof e?e:b,value:h};return h},get:function(a){if(d[a])return d[a].value;if(e.length){var b,c,l;b=0;for(c=e.length;b<c;b++)if(l=e[b].fn.call(e[b].context,a,this),void 0!==l)return this.add(a,l,!0)}},remove:function(a){var b=d[a];b&&!0===b.rewritable&&delete d[a];
return b?b.value:void 0},exists:function(a){return!!d[a]},eachEntry:function(a,b){for(var c in d)a.call(b,d[c].value,c)},destroy:function(){this===a&&(a=null);this.remove=this.exists=this.destroy=this.get=this.add=b=d=null}}};b.global=function(){a||(a=new b(!0));return a};return b}(),pa=function(){var a=new la,b=new wb,c=function(a){var c=b.get(a);"string"==typeof c&&(c=M(c),b.add(a,c));return c},d=function(a){return b.exists(a)?b.get(a):b.add(a,Na(a,{dataType:"fragment"}).then(function(c){return b.add(a,
c)}))};b.addFinder(function(a){a=window.document.getElementById(a);var b;if(a)return b=a.tagName.toLowerCase(),"script"==b?(b=window.document.createElement("div"),b.innerHTML=a.innerHTML,a.parentNode.removeChild(a),M(b.childNodes)):"content"in a?a.content:M(a.childNodes)});return s({$class:"Template",_watcher:null,_tpl:null,_renderer:null,_initial:!0,_fragment:null,_id:null,_originalNode:null,_intendedShadow:!1,scope:null,node:null,tpl:null,url:null,ownRenderer:!1,initPromise:null,tplPromise:null,
parentRenderer:null,deferRendering:!1,replace:!1,shadow:!1,animationEnabled:!0,$init:function(b){t(this,b,!0,!1);window.document.documentElement.createShadowRoot||(this._intendedShadow=this.shadow,this.shadow=!1);this.id=U();a.createEvent("rendered-"+this.id,!1,!0);this.tpl&&(this.tpl=ea(this.tpl));this.url&&(this.url=ea(this.url));var c=this.node;b=this.tpl||this.url;c&&c.removeAttribute("mjs-include");this.shadow&&(this._originalNode=c,this.node=c=c.createShadowRoot());c||(this.deferRendering=!0);
if(b){if(c&&c.firstChild&&!this.shadow&&y(c,"mjs-transclude",M(c.childNodes)),"."==b.substr(0,1)?(c=b.substr(1,1),c=!("."==c||"/"==c)):c=!1,c&&(this._watcher=V(this.scope,b,this.onChange,this,null,z)),this._watcher&&!this.replace?this.ownRenderer=!0:this.shadow?this.ownRenderer=!0:this.replace&&(this.ownRenderer=!1),this.resolveTemplate(),this._watcher&&this.replace&&(this._watcher.unsubscribeAndDestroy(this.onChange,this),this._watcher=null),this.deferRendering&&this.ownRenderer||this.tplPromise.done(this.applyTemplate,
this),this.ownRenderer&&this.parentRenderer)this.parentRenderer.on("destroy",this.onParentRendererDestroy,this)}else!this.deferRendering&&this.ownRenderer&&this.doRender();this.scope.$on("destroy",this.onScopeDestroy,this)},setAnimation:function(a){this.animationEnabled=a},doRender:function(){this._renderer||(this._renderer=new Ca(this.node,this.scope),this._renderer.on("rendered",this.onRendered,this),this._renderer.process())},onRendered:function(){a.trigger("rendered-"+this.id,this)},on:function(b,
c,d){return a.on(b+"-"+this.id,c,d)},un:function(b,c,d){return a.un(b+"-"+this.id,c,d)},startRendering:function(){var a=this.tpl||this.url;if(this.deferRendering&&this.node){this.deferRendering=!1;if(this.tplPromise)return this.tplPromise.done(a?this.applyTemplate:this.doRender,this),this.initPromise;a?this.applyTemplate():this.doRender()}return null},resolveTemplate:function(){var a=this,b=a.url,h=a._watcher?a._watcher.getLastResult():a.tpl||b;a._watcher&&!h&&(b=null);a.initPromise=new v;a.tplPromise=
new v;a.ownRenderer&&a.initPromise.resolve(!1);return(new v(function(a,e){h||b?b?a(c(h)||d(b)):a(c(h)||M(h)):e()})).done(function(b){a._fragment=b;a.tplPromise.resolve()}).fail(a.initPromise.reject,a.initPromise).fail(a.tplPromise.reject,a.tplPromise)},onChange:function(){this._renderer&&(this._renderer.$destroy(),this._renderer=null);this.resolveTemplate().done(this.applyTemplate,this)},doApplyTemplate:function(){for(var b=this.node;b.firstChild;)b.removeChild(b.firstChild);this._intendedShadow&&
this.makeTranscludes();if(this.replace){var c=Ia(this._fragment),d=y(b,"mjs-transclude"),k=da.call(c.childNodes);if(d){var l=B("[mjs-transclude], mjs-transclude",c);l.length&&y(l[0],"mjs-transclude",d)}b.parentNode.replaceChild(c,b);this.node=k;this.initPromise.resolve(k)}else b.appendChild(Ia(this._fragment)),this.initPromise.resolve(this.node);a.trigger("before-render-"+this.id,this);this.ownRenderer&&this.doRender()},applyTemplate:function(){var a=this.node,b=new v;!this._initial&&this.animationEnabled?
(G(a,"leave",null,!0).done(this.doApplyTemplate,this).done(b.resolve,b),G(a,"enter",null,!0)):(this.doApplyTemplate(),b.resolve());this._initial=!1;return b},makeTranscludes:function(){var a=this._fragment,b=B("content",a),c,d,l,m,r,n;r=0;for(n=b.length;r<n;r++)l=window.document.createElement("mjs-transclude"),c=b[r],d=c.nextSibling,(m=x(c,"select"))&&l.setAttribute("select",m),a.removeChild(c),a.insertBefore(l,d)},onParentRendererDestroy:function(){this._renderer.$destroy();this.$destroy()},onScopeDestroy:function(){this.$destroy()},
destroy:function(){this.shadow&&this._originalNode.createShadowRoot();this._watcher&&this._watcher.unsubscribeAndDestroy(this.onChange,this)}},{cache:b})}(),ta=function(){var a={};return function(b){return a[b]||(a[b]=new RegExp(b))}}(),xb=s({$class:"Component",$mixins:["mixin.Observable"],id:null,originalId:!1,node:null,cls:null,renderTo:null,autoRender:!0,rendered:!1,hidden:!1,destroyEl:!0,destroyScope:!1,scope:null,template:null,templateUrl:null,tag:null,as:null,$init:function(a){a=a||{};this.$super(a);
t(this,a,!0,!1);this.scope||(this.scope=new aa);this.as&&(this.scope[this.as]=this);if(this.node){var b=x(this.node,"id");b&&(this.originalId=!0,this.id||(this.id=b))}this.id=this.id||"cmp-"+U();this.node||this._createNode();this.cls&&N(this.node,this.cls);this.initComponent.apply(this,arguments);this.scope.$app&&this.scope.$app.registerCmp(this,this.scope,"id");var b=this.template,c=this.templateUrl;b&&b instanceof pa?b instanceof pa&&(this.template.node=this.node):this.template=b=new pa({scope:this.scope,
node:this.node,deferRendering:!b,ownRenderer:!0,tpl:b,url:c,shadow:this.constructor.$shadow,animationEnabled:!this.hidden});this.template.on("rendered",this.onRenderingFinished,this);if(this.parentRenderer)this.parentRenderer.on("destroy",this.onParentRendererDestroy,this);this._initElement();this.autoRender&&(b.initPromise?b.initPromise.done(this.render,this):this.render())},_createNode:function(){this.node=window.document.createElement(this.tag||"div")},_initElement:function(){var a=this.node;this.originalId||
a.setAttribute("id",this.id);a.setAttribute("cmp-id",this.id);this.hidden&&(a.style.display="none")},render:function(){this.rendered||(this.trigger("render",this),this.template.startRendering())},onRenderingFinished:function(){this.renderTo?this.renderTo.appendChild(this.node):Ja(this.node)||window.document.body.appendChild(this.node);this.rendered=!0;this.afterRender();this.trigger("after-render",this)},show:function(){if(this.hidden){if(!1===this.trigger("before-show",this))return!1;this.rendered||
this.render();this.template.setAnimation(!0);this.node.style.display="block";this.hidden=!1;this.onShow();this.trigger("show",this)}},hide:function(){if(!this.hidden){if(!1===this.trigger("before-hide",this))return!1;this.template.setAnimation(!1);this.node.style.display="none";this.hidden=!0;this.onHide();this.trigger("hide",this)}},isHidden:function(){return this.hidden},isRendered:function(){return this.rendered},isDestroyed:function(){return this.destroyed},getEl:function(){return this.node},
initComponent:W,afterRender:W,onShow:W,onHide:W,onParentRendererDestroy:function(){this.$destroy()},destroy:function(){this.template&&this.template.$destroy();this.destroyEl?Ja(this.node)&&this.node.parentNode.removeChild(this.node):(this.node.removeAttribute("cmp-id"),this.originalId||this.node.removeAttribute("id"),this.cls&&P(this.node,this.cls));this.destroyScope&&this.scope&&this.scope.$destroy();this.$super()}}),ja=function(a){var b=y(a,"mjsAnimationQueue"),c,d;if(H(b)&&b.length){if(b=b[0])b.stages&&
(c=b.position,d=b.stages,P(a,d[c]),P(a,d[c]+"-active")),b.deferred&&b.deferred.reject(b.el)}else E(b)?b(a):"stop"==b&&$(a).stop(!0,!0);y(a,"mjsAnimationQueue",null)},I=function(){var a,b;if("undefined"!=typeof window){var c=window;a=c.requestAnimationFrame||c.webkitRequestAnimationFrame||c.mozRequestAnimationFrame;b=c.cancelAnimationFrame||c.webkitCancelAnimationFrame||c.mozCancelAnimationFrame||c.webkitCancelRequestAnimationFrame;if(a)return function(c){var e=a(c);return function(){b(e)}}}return function(a){var b=
setTimeout(a,0);return function(){clearTimeout(b)}}}(),Ya=function(){var a=["Moz","Webkit","ms","O","Khtml"],b="animationDelay",c="animationDuration",d="transitionDelay",e="transitionDuration",f="transform",h=null,k=null,l=!1;return function(){if(!l){var m=window.document.createElement("div"),r=!1,n,p,C;if(void 0!==m.style.animationName)r=!0;else for(p=0,C=a.length;p<C;p++)if(n=a[p],void 0!==m.style[n+"AnimationName"]){r=!0;b=n+"AnimationDelay";c=n+"AnimationDuration";d=n+"TransitionDelay";e=n+"TransitionDuration";
f=n+"Transform";break}r&&("ontransitionend"in window?h="transitionend":"onwebkittransitionend"in window&&(h="webkitTransitionEnd"));k=r?{animationDelay:b,animationDuration:c,transitionDelay:d,transitionDuration:e,transform:f,transitionend:h}:{};l=!0}return k}}(),L=function(a){a=a||{};this._queue=[];this._map={};this.id="$$"+U();for(var b in a)this[b]=a[b]};L.REPLACE=1;L.ONCE=2;L.MULTIPLE=3;L.ONCE_EVER=4;t(L.prototype,{_queue:null,_map:null,_nextRequested:!1,_running:!1,length:0,id:null,async:!0,auto:!0,
thenable:!1,stack:!1,context:null,mode:L.MULTIPLE,add:function(a,b,c,d,e,f){var h=this.id,k=a[h]||U();b={id:k,fn:a,context:b,args:c,async:f};d=d||this.mode;if(d==L.ONCE_EVER&&a[h])return a[h];a[h]=k;if(this._map[k])if(d==L.REPLACE)this.remove(k);else if(d==L.ONCE)return k;this._queue[e?"unshift":"push"](b);this._map[k]=b;this.length=this._queue.length;this.auto&&this.next();return k},append:function(a,b,c,d,e){return this.add(a,b,c,d,!1,e)},prepend:function(a,b,c,d,e){return this.add(a,b,c,d,!0,e)},
remove:function(a){var b=this._queue,c,d;c=0;for(d=b.length;c<d;c++)if(b[c].id==a){b.splice(c,1);break}delete this._map[a]},isEmpty:function(){return 0==this.length},next:function(){var a=this,b;if(a._running)a._nextRequested=!0;else if(a._nextRequested=!1,b=a._queue[a.stack?"pop":"shift"](),a.length=a._queue.length,b)if(a._running=!0,delete a._map[b.id],a.async||b.async){var c=0;1===J(b.async)?c=b.async:1===J(a.async)&&(c=a.async);var d=function(){try{a._processResult(b.fn.apply(b.context||a.context,
b.args||[]))}catch(c){throw Z(c),a._finish(),c;}};"raf"==b.async||!b.async&&"raf"==a.async?I(d):Y(d,null,null,c)}else try{a._processResult(b.fn.apply(b.context||a.context,b.args||[]))}catch(e){throw Z(e),a._finish(),e;}},_processResult:function(a){var b=this;b.thenable&&oa(a)?a.then(function(){b._finish()},function(){b._finish()}):b._finish();return a},_finish:function(){this._running=!1;(this.auto||this._nextRequested)&&this.next()},destroy:function(){this.context=this._map=this._queue=null;this._running=
this._nextRequested=!1;this.next=W}},!0,!1);var Za=function(){var a=/(^|[^a-z0-9_$\]\)'"])(\.)([^0-9])/ig,b=Function,c=function(a,b){return function(b){var c=da.call(arguments);c.push(null);c.push(a);c=a.apply(null,c);return void 0===c||"number"==typeof c&&isNaN(c)?void 0:c}},d={},e=0,f={},h=0,k={},l=0,m=function(){1E3<=e&&(d={});1E3<=h&&(f={});1E3<=l&&(k={})};return{createGetter:function(h){try{return d[h]?d[h]:(e++,d[h]=c(new b("____","$$interceptor","$$itself","".concat("try {","return ",h.replace(a,
"$1____.$3"),";} catch (thrownError) { return undefined; }")),!0))}catch(f){return Z(f),W}},createSetter:function(d){try{if(!f[d]){h++;var e=d.replace(a,"$1____.$3");return f[d]=c(new b("____","$$$$","$$interceptor","$$itself","".concat("try {",e," = $$$$",";} catch (thrownError) { return undefined; }")))}return f[d]}catch(k){return Z(k),W}},createFunc:function(d){try{return k[d]?k[d]:(l++,k[d]=c(new b("____","$$interceptor","$$itself","".concat("try {",d.replace(a,"$1____.$3"),";} catch (thrownError) { return undefined; }"))))}catch(h){return Z(h),
W}},resetCache:m,enableResetCacheInterval:function(){setTimeout(m,1E4)}}}(),R=Za.createGetter,lb=/-./g,mb=function(){return function(a){if(a.dataset)return a.dataset;var b;if(void 0!==(b=y(a,"data")))return b;b=a.attributes;var c={},d,e,f;d=0;for(e=b.length;d<e;d++)f=b[d].name,0===f.indexOf("data-")&&(c[kb(f.substr(5))]=b[d].value);b=c;y(a,"data",b);return b}}(),Ka=s({$class:"ListRenderer",id:null,model:null,itemName:null,tpl:null,renderers:null,parentEl:null,prevEl:null,nextEl:null,trackBy:null,
trackByWatcher:null,animateMove:!1,animate:!1,trackByFn:null,griDelegate:null,tagMode:!1,queue:null,buffered:!1,bufferPlugin:null,$constructor:function(a,b,c){a=O(b,a);this.tagMode="mjs-each"==b.nodeName.toLowerCase();this.animateMove=!this.tagMode&&!a.buffered&&a.animateMove&&G.cssAnimationSupported();this.animate=!this.tagMode&&!a.buffered&&(null!==x(b,"mjs-animate")||a.animate);this.id=a.id||U();b.removeAttribute("mjs-animate");this.animate&&this.animateMove&&this.$plugins.push("plugin.ListAnimatedMove");
a.observable&&this.$plugins.push("plugin.Observable");this.tagMode&&(a.buffered=!1);a.buffered&&(this.buffered=!0,this.$plugins.push("plugin.ListBuffered"))},$init:function(a,b,c){this.tagMode&&(c=x(b,"value"));this.parseExpr(c);this.tpl=this.tagMode?M(b.childNodes):b;this.renderers=[];this.prevEl=b.previousSibling;this.nextEl=b.nextSibling;this.parentEl=b.parentNode;this.node=null;this.scope=a;this.queue=new L({async:!1,auto:!0,thenable:!0,stack:!1,context:this,mode:L.ONCE});this.parentEl.removeChild(b);
this.afterInit(a,b);this.queue.add(this.render,this,[Q(this.watcher.getLastResult())])},afterInit:function(a,b){var c=O(b,a);this.watcher=V(a,this.model,this.onChange,this,null,z);(this.trackBy=c.trackBy)&&"$"!=this.trackBy?this.trackByWatcher=V(a,this.trackBy,this.onChangeTrackBy,this,null,z):"$"==this.trackBy||this.watcher.hasInputPipes()||(this.trackBy="$$"+this.watcher.id);this.griDelegate=D(this.scopeGetRawIndex,this)},trigger:W,render:function(a){var b=this.renderers,c=this.tpl,d=this.parentEl,
e=this.nextEl,f=this.buffered,h=window.document.createDocumentFragment(),k,l,m;l=0;for(m=a.length;l<m;l++)k=c.cloneNode(!0),b.push(this.createItem(k,a,l)),f||(h.appendChild(k),b[l].attached=!0);f?(this.bufferPlugin.getScrollOffset(),this.bufferPlugin.updateScrollBuffer()):(d.insertBefore(h,e),this.doUpdate());this.trigger("render",this)},doUpdate:function(a,b,c,d){var e=this.renderers;a=a||0;var f=e.length;b=b||f-1;var h=this.watcher.getLastResult(),k=this.getTrackByFunction();for(b>f-1&&(b=f-1);a<=
b;a++)c&&e[a].action!=c||this.renderItem(a,e,h,k,d)},renderItem:function(a,b,c,d,e){c=c||this.watcher.getLastResult();b=b||this.renderers;d=d||this.getTrackByFunction();var f=b[a],h=f.scope;b=b.length-1;var k=!(a%2);e&&f.rendered||(h.$index=a,h.$first=0===a,h.$last=a===b,h.$even=k,h.$odd=!k,h.$trackId=d(c[a]),h.$getRawIndex=this.griDelegate,f.renderer?h.$check():(f.renderer=new Ca(f.el,h),f.renderer.process(),f.rendered=!0))},createItem:function(a,b,c){var d=this.itemName,e=this.scope.$new(),f=this.tagMode;
e[d]=this.getListItem(b,c);a=f?Q(a.childNodes):a;return{index:c,action:"enter",el:a,firstEl:f?a[0]:a,lastEl:f?a[a.length-1]:a,scope:e,attached:!1,rendered:!1}},onChange:function(a,b){this.queue.prepend(this.applyChanges,this,[b],L.REPLACE)},applyChanges:function(a){var b=this,c=b.renderers,d=b.tpl,e=0,f=Q(b.watcher.getLastResult()),h=null,k=b.animateMove,l=b.animate,m=[],r=b.itemName,n=c.slice(),p=!1,q,F,u,s,t,x;a=b.watcher.getMovePrescription(a,b.getTrackByFunction(),f);u=0;for(s=a.length;u<s;u++)q=
a[u],1===J(q)?(F=q,q=c[F],F!=e&&null===h&&(h=u),q.action="move",q.scope[r]=b.getListItem(f,u),p=k,m.push(q),c[F]=null,e++):(null===h&&(h=u),t=b.createItem(d.cloneNode(!0),f,u),m.push(t));b.renderers=m;if(l){b.doUpdate(h,null,"enter");p&&(x=b.calculateTranslates(m,n,c));var d=[],A=new v,w=new v,B=new v,y=v.counter(m.length),e=function(){y.countdown();return A};u=0;for(s=c.length;u<s;u++)if(t=c[u])t.scope.$destroy(),ja(t.el),d.push(G(t.el,"leave",null,!1,z).done(function(a){a.style.visibility="hidden"}));
u=0;for(s=m.length;u<s;u++)t=m[u],ja(t.el),"enter"==t.action?d.push(G(t.el,"enter",e,!1,z)):d.push(b.moveAnimation(t.el,p?x[u][0]:null,p?x[u][1]:null,e,w));y.done(function(){I(function(){w.resolve();b.applyDomPositions(c);p||b.doUpdate(h,null,"move");I(function(){A.resolve()});b.trigger("change",b)})});v.all(d).always(function(){I(function(){var a=Ya();b.doUpdate(h||0);b.removeOldElements(c);if(p)for(b.doUpdate(h,null,"move"),u=0,s=m.length;u<s;u++)t=m[u],t.el.style[a.transform]=null,t.el.style[a.transform]=
"";B.resolve()})});return B}b.buffered?(b.bufferPlugin.getScrollOffset(),b.removeOldElements(c),b.queue.append(b.bufferPlugin.updateScrollBuffer,b.bufferPlugin,[!0])):(b.applyDomPositions(),b.doUpdate(h||0),b.removeOldElements(c));b.trigger("change",b)},removeOldElements:function(a){var b,c,d,e,f,h=this.parentEl;b=0;for(c=a.length;b<c;b++){if((d=a[b])&&d.attached)if(d.attached=!1,self.tagMode)for(e=0,f=d.el.length;e<f;e++)h.removeChild(d.el[e]);else h.removeChild(d.el);d&&d.scope&&d.scope.$destroy()}},
applyDomPositions:function(a){var b=this.renderers,c=this.parentEl,d=this.prevEl,e=this.tagMode,d=d?d.nextSibling:c.firstChild,f,h,k,l,m;h=0;for(k=b.length;h<k;h++)m=b[h],l=m.el,f=a&&a[h]?a[h].lastEl.nextSibling:0<h?b[h-1].lastEl.nextSibling||d:d,m.firstEl!==f&&(f&&m.lastEl.nextSibling!==f?c.insertBefore(e?M(l):l,f):f||c.appendChild(e?M(l):l)),m.attached=!0},getListItem:function(a,b){return a[b]},onChangeTrackBy:function(a){this.trackByFn=null;this.trackBy=a},getTrackByFunction:function(){var a;this.trackByFn||
((a=this.trackBy)&&"$"!=a?E(a)?this.trackByFn=a:this.trackByFn=function(b){return b&&!Ha(b)?b[a]:void 0}:this.trackByFn=function(a){return Ha(a)?a:void 0});return this.trackByFn},scopeGetRawIndex:function(a){if(void 0===a)return-1;var b=this.watcher.getUnfilteredValue(),c=this.getTrackByFunction(),d,e;d=0;for(e=b.length;d<e;d++)if(c(b[d])===a)return d;return-1},getNodePositions:function(a,b,c){return{}},calculateTranslates:function(a,b,c){return[]},moveAnimation:function(a,b,c,d,e){return G(a,"move",
d,!1,z)},scrollTo:function(){},parseExpr:function(a){a=a.split(" ");var b,c,d,e,f;b=0;for(c=a.length;b<c;b++)if(f=a[b],""!=f&&"in"!=f)if(e){d=a.slice(b).join(" ");break}else e=f;this.model=d;this.itemName=e||"item"},destroy:function(){var a=this.renderers,b,c;b=0;for(c=a.length;b<c;b++)a[b].renderer.$destroy();this.trackByWatcher&&this.trackByWatcher.unsubscribeAndDestroy();this.queue.destroy();this.watcher.unsubscribeAndDestroy(this.onChange,this)}},{$stopRenderer:!0,$registerBy:"id"}),$a=ma.current,
yb=function(){var a={},b=s({$mixins:["mixin.Observable"],extractor:null,context:null,regexp:null,valueIndex:1,prev:null,value:null,enabled:!0,$init:function(a){t(this,a,!0,!1);this.regexp&&A(this.regexp)&&(this.regexp=ta(this.regexp));!this.name||this.regexp||this.extractor||(this.regexp=ta(this.name+"=([^&]+)"));if(!this.regexp&&!this.extractor)throw"Invalid UrlParam config, missing regexp or extractor";this.enabled&&(this.enabled=!1,this.enable())},enable:function(){this.enabled||(this.enabled=
!0,ma.on("location-change",this.onLocationChange,this),this.onLocationChange($a()))},disable:function(){this.enabled&&(this.enabled=!1,ma.un("location-change",this.onLocationChange,this))},onLocationChange:function(a){a=this.extractValue(a);this.value!=a&&(this.prev=this.value,this.value=a,this.trigger("change",a,this.prev))},extractValue:function(a){if(this.regexp)return(a=a.match(this.regexp))?a[this.valueIndex]:null;if(this.extractor)return this.extractor.call(this.context,a)},getValue:function(){return this.value},
getPrev:function(){return this.prev},destroyIfIdle:function(){this.$$observable.hasListener()||this.$destroy()},destroy:function(){this.disable()}},{get:function(c){return c.id&&a[c.id]?a[c.id]:new b(c)}});return b}();s({$class:"View",route:null,node:null,scope:null,cmp:null,id:null,currentViewId:null,currentComponent:null,cmpCache:null,domCache:null,currentView:null,watchable:null,defaultCmp:null,currentCls:null,currentHtmlCls:null,scrollOnChange:!0,$init:function(a){t(this,a,!0,!1);a=this.node;
var b=O(a,this.scope);t(this,b,!0,!1);a&&a.firstChild&&y(a,"mjs-transclude",M(a.childNodes));this.id||(this.id=U());this.cmpCache={};this.domCache={};this.initView();this.scope.$app.registerCmp(this,this.scope,"id");this.route?(ma.init(),ma.on("location-change",this.onLocationChange,this),this.initRoutes(),this.onLocationChange()):this.cmp&&(this.watchable=V(this.scope,this.cmp,this.onCmpChange,this,null,z),this.onCmpChange())},initView:function(){},initRoutes:function(){var a=this.route,b,c,d,e,
f,h,k;e=0;for(f=a.length;e<f;e++)if(d=a[e],d.id=d.id||U(),d.params){b={};h=0;for(k=d.params.length;h<k;h++)c=d.params[h],c.name&&(b[c.name]=new yb(t({},c,{enabled:!1},!0,!1)));d.params=b}},onCmpChange:function(){var a=this.watchable.getLastResult()||this.defaultCmp;a?this.setComponent(a):this.defaultCmp&&this.setComponent(this.defaultCmp)},onLocationChange:function(){var a=$a(),b=this.route,c,d,e,f,h;d=0;for(e=b.length;d<e;d++){f=b[d];if(f.reg&&(h=a.match(f.reg))){this.setRouteComponent(f,h);return}f["default"]&&
!c&&(c=f)}c?this.setRouteComponent(c,[]):this.defaultCmp&&this.setComponent(this.defaultCmp)},clearComponent:function(){var a=this,b=a.node,c=a.currentView||{};a.currentCls&&P(a.node,a.currentCls);a.currentHtmlCls&&P(window.document.documentElement,a.currentHtmlCls);a.currentComponent&&G(b,"leave",null,!0).done(function(){if(c.keepAlive)for(var d=a.domCache[c.id];b.firstChild;)d.appendChild(b.firstChild);else for(a.currentComponent.destroy();b.firstChild;)b.removeChild(b.firstChild);a.currentComponent=
null})},toggleRouteParams:function(a,b){if(a.params)for(var c in a.params)a.params[c][b]()},setRouteClasses:function(a){a.cls&&(this.currentCls=a.cls,N(this.node,a.cls));a.htmlCls&&(this.currentHtmlCls=a.htmlCls,N(window.document.documentElement,a.htmlCls))},setRouteComponent:function(a,b){var c=this,d=c.node,e=a.params,f=c.currentView||{};a.id!=f.id&&(c.beforeRouteCmpChange(a),c.toggleRouteParams(f,"disable"),c.toggleRouteParams(a,"enable"),ja(c.node),c.clearComponent(),c.setRouteClasses(a),c.currentView=
a,G(d,"enter",function(){var h=b||[],f={destroyEl:!1,node:d,scope:a.$isolateScope?c.scope.$newIsolated():c.scope.$new()};a.as&&(f.as=a.as);a.template&&(f.template=a.template);h.shift();e&&t(f,e,!1,!1);if(c.cmpCache[a.id])c.currentComponent=c.cmpCache[a.id],d.appendChild(c.domCache[a.id]),c.afterRouteCmpChange(),c.afterCmpChange();else return wa(a.cmp||"MetaphorJs.Component",f,f.scope,d,null,h).done(function(b){c.currentComponent=b;a.keepAlive&&(c.cmpCache[a.id]=b,c.domCache[a.id]=window.document.createDocumentFragment());
c.afterRouteCmpChange();c.afterCmpChange()})},!0))},setComponent:function(a){var b=this,c=b.node;b.beforeCmpChange(a);ja(b.node);b.clearComponent();b.currentView=null;G(c,"enter",function(){var d=Qa(a)?a:{},e=(A(a)?a:null)||"MetaphorJs.Component",f=d.scope||b.scope.$new();d.destroyEl=!1;return wa(e,d,f,c).done(function(a){b.currentComponent=a;b.afterCmpChange()})},!0)},beforeRouteCmpChange:function(a){},afterRouteCmpChange:function(){},beforeCmpChange:function(a){},afterCmpChange:function(){var a=
this;a.scrollOnChange&&I(function(){a.node.scrollTop=0})},destroy:function(){this.clearComponent();if(this.route){ma.un("location-change",this.onLocationChange,this);var a,b,c;a=0;for(b=this.route.length;a<b;a++)if(this.route[a].params)for(c in this.route[a].params)this.route[a].params[c].$destroy();this.route=null}this.watchable&&(this.watchable.unsubscribeAndDestroy(this.onCmpChange,this),this.watchable=null);this.currentComponent=this.scope=null;this.$super()}});q.registerAttribute("mjs-app",100,
qa);q.registerAttribute("mjs-bind",1E3,s({$extends:q,isInput:!1,input:null,lockInput:null,recursive:!1,textRenderer:null,$init:function(a,b,c){var d=O(b,a);this.isInput=Sa(b);this.recursive=d.recursive||null!==x(b,"mjs-recursive");this.lockInput=d.lockInput;b.removeAttribute("mjs-recursive");this.isInput&&(this.input=new ba(b,this.onInputChange,this));this.recursive?(this.scope=a,this.node=b,this.textRenderer=new Wa(a,"{{"+c+"}}",null,null,!0),this.textRenderer.subscribe(this.onTextRendererChange,
this),this.onTextRendererChange(),a instanceof aa&&a.$on("destroy",this.onScopeDestroy,this)):this.$super(a,b,c)},onInputChange:function(){if(this.lockInput)this.onChange()},onTextRendererChange:function(){this.updateElement(this.textRenderer.getString())},onChange:function(){var a=this.watcher.getLastResult();this.updateElement(a)},updateElement:function(a){this.isInput?this.input.setValue(a):this.node["string"==typeof this.node.textContent?"textContent":"innerText"]=a},destroy:function(){this.textRenderer&&
(this.textRenderer.$destroy(),this.textRenderer=null);this.input&&(this.input.destroy(),this.input=null);this.$super()}}));q.registerAttribute("mjs-bind-html",1E3,s({$extends:"attr.mjs-bind",updateElement:function(a){this.node.innerHTML=a}}));q.registerAttribute("mjs-break-if",500,function(a,b,c){(a=!!R(c)(a))&&b.parentNode.removeChild(b);return!a});(function(){var a=function(a,b,e,f){if(null!==e){if(e==va(a,b))return;e=!e}else e=va(a,b);e?f?G(a,[b+"-remove"],null,!0).done(function(){P(a,b)}):P(a,
b):f?G(a,[b+"-add"],null,!0).done(function(){N(a,b)}):N(a,b)},b=function(a){var b={},e,f,h;if(!a)return b;if(A(a))b[a]=!0;else if(H(a))for(e=-1,h=a.length;++e<h;b[a[e]]=!0);else for(e in a)if("_"==e)for(f=-1,h=a._.length;++f<h;b[a._[f]]=!0);else b[e]=a[e];return b};q.registerAttribute("mjs-class",1E3,s({$extends:q,initial:!0,onChange:function(){var c=this.node,d=b(this.watcher.getLastResult()),e=b(this.watcher.getPrevValue()),f;ja(c);for(f in e)e.hasOwnProperty(f)&&void 0===d[f]&&a(c,f,!1,!1);for(f in d)d.hasOwnProperty(f)&&
a(c,f,d[f]?!0:!1,!this.initial);this.initial=!1}}))})();q.registerAttribute("mjs-cmp-prop",200,["$parentCmp","$node","$attrValue",function(a,b,c){a&&(a[c]=b)}]);(function(){var a=function(a,c,d,e){var f,h,k,l,m,r=O(c,a);d=d.split(" ");k=0;for(l=d.length;k<l;k++)m=d[k],""!=m&&"as"!=m&&(f?h=m:f=m);d=ga(f,!0);k=r.sameScope||d.$sameScope;a=r.isolateScope||d.$isolateScope?a.$newIsolated():k?a:a.$new();e=t({scope:a,node:c,as:h,parentRenderer:e,destroyScope:!0},r,!1,!1);wa(f,e,a,c);return d.$resumeRenderer||
!!d.$shadow};a.$breakScope=!1;q.registerAttribute("mjs-cmp",200,a)})();q.registerAttribute("mjs-config",50,function(a,b,c){O(b,a,c)});q.registerAttribute("mjs-each",100,Ka);var ua=function(a){if(a instanceof ua)return a;if(!(this instanceof ua))return new ua(a);for(var b in a)if(!this[b])try{this[b]=a[b]}catch(c){}this.originalEvent=a;this.type=a.type;!this.target&&a.srcElement&&(this.target=a.srcElement);var d,e=a.button;void 0===this.pageX&&null!==a.clientX&&(d=this.target?this.target.ownerDocument||
window.document:window.document,b=d.documentElement,d=d.body,this.pageX=a.clientX+(b&&b.scrollLeft||d&&d.scrollLeft||0)-(b&&b.clientLeft||d&&d.clientLeft||0),this.pageY=a.clientY+(b&&b.scrollTop||d&&d.scrollTop||0)-(b&&b.clientTop||d&&d.clientTop||0));this.which||void 0===e||(this.which=e&1?1:e&2?3:e&4?2:0);this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&!1===a.returnValue?xa:qa;this.timeStamp=a&&a.timeStamp||(new Date).getTime()};t(ua.prototype,{isDefaultPrevented:qa,isPropagationStopped:qa,
isImmediatePropagationStopped:qa,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=xa;a.returnValue=!1;a&&a.preventDefault&&a.preventDefault()},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=xa;a&&a.stopPropagation&&a.stopPropagation()},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=xa;a&&a.stopImmediatePropagation&&a.stopImmediatePropagation();this.stopPropagation()}},!0,!1);var ab=function(a){function b(){d=
null}var c,d;a=function(a){return function(f){var h=S(f||window.event),k=da.call(arguments,1),l=0,m=0,r=0,n=0,p=0,q=0;h.type="mousewheel";"detail"in h&&(r=-1*h.detail);"wheelDelta"in h&&(r=h.wheelDelta);"wheelDeltaY"in h&&(r=h.wheelDeltaY);"wheelDeltaX"in h&&(m=-1*h.wheelDeltaX);"axis"in h&&h.axis===h.HORIZONTAL_AXIS&&(m=-1*r,r=0);l=0===r?m:r;"deltaY"in h&&(l=r=-1*h.deltaY);"deltaX"in h&&(m=h.deltaX,0===r&&(l=-1*m));if(0!==r||0!==m){n=Math.max(Math.abs(r),Math.abs(m));if(!d||n<d)d=n,"mousewheel"===
h.type&&0===n%120&&(d/=40);"mousewheel"===h.type&&0===n%120&&(l/=40,m/=40,r/=40);l=Math[1<=l?"floor":"ceil"](l/d);m=Math[1<=m?"floor":"ceil"](m/d);r=Math[1<=r?"floor":"ceil"](r/d);this.getBoundingClientRect&&(n=this.getBoundingClientRect(),p=h.clientX-n.left,q=h.clientY-n.top);h.deltaX=m;h.deltaY=r;h.deltaFactor=d;h.offsetX=p;h.offsetY=q;h.deltaMode=0;k.unshift(h,l,m,r);c&&clearTimeout(c);c=setTimeout(b,200);return a.apply(this,k)}}};a.events=function(){var a=window.document;return"onwheel"in a||
9<=a.documentMode?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"]};return a}(),K=function(){var a=null,b=null;return function(c,d,e){null===a&&(a=c.attachEvent?"attachEvent":"addEventListener",b=c.attachEvent?"on":"");if("mousewheel"==d){e=ab(e);d=ab.events();var f,h;f=0;for(h=d.length;f<h;f++)c[a](b+d[f],e,!1)}else c[a](b+d,e,!1);return e}}(),T=function(){var a=null,b=null;return function(c,d,e){null===a&&(a=c.detachEvent?"detachEvent":"removeEventListener",b=c.detachEvent?"on":"");
c[a](b+d,e)}}(),ka=function(a,b,c){if(window.getComputedStyle){if(a===window)return b?c?0:null:{};a=getComputedStyle(a,null)}else a=a.currentStyle||a.style||{};b=b?a[b]:a;return c?parseFloat(b)||0:b},zb=function(){var a;return function(){if(void 0===a){var b=window.document,c=b.createElement("div"),d=b.createElement("div"),b=b.body;d.style&&window.getComputedStyle?(c.style.cssText="border:0;width:0;height:0;top:0;left:-9999px;margin-top:1px;position:absolute",c.appendChild(d),d.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",
d.innerHTML="",b.appendChild(c),d="4px"===window.getComputedStyle(d,null).width,b.removeChild(c),a=d):a=!1}return a}}(),Da=function(a,b){var c=/^([+-]?(?:d*.|)d+(?:[eE][+-]?d+|))(?!px)[a-z%]+$/i,d=["Top","Right","Bottom","Left"],e=a?"inner"==a?"padding":"":"content";return function(a,h){if(a===window)return a.document.documentElement["client"+b];if(9===a.nodeType){var k=a.documentElement;return Math.max(a.body["scroll"+b],k["scroll"+b],a.body["offset"+b],k["offset"+b],k["client"+b])}a:{var l=b.toLowerCase(),
m=e||(!0===h?"margin":"border"),k=ka(a),r=!0,n="width"===l?a.offsetWidth:a.offsetHeight,p="border-box"===k.boxSizing;if(0>=n||null==n){n=a.style[l];if(c.test(n)){k=n;break a}r=p&&(zb()||n===a.style[l]);n=parseFloat(n)||0}m=m||(p?"border":"content");l=m===(r?"border":"content")?4:"width"===l?1:0;for(p=0;4>l;l+=2)"margin"===m&&(p+=parseFloat(k[m+d[l]])),r?("content"===m&&(p-=parseFloat(k["padding"+d[l]])),"margin"!==m&&(p-=parseFloat(k["border"+d[l]+"Width"]))):(p+=parseFloat(k["padding"+d[l]]),"padding"!==
m&&(p+=parseFloat(k["border"+d[l]+"Width"])));k=n+p}return k}},bb=Da("","Width"),cb=Da("","Height"),db=function(a){var b,c=a?"pageYOffset":"pageXOffset",d=a?"scrollTop":"scrollLeft";a=window.document;var e=a.body,f=a.documentElement;b=void 0!==window[c]?function(){return window[c]}:f.clientHeight?function(){return f[d]}:function(){return e[d]};return function(a){return a&&a!==window?a&&1==a.nodeType&&a!==e&&a!==f?a[d]:b():b()}},Aa=db(!0),Ba=db(!1),Ab=function(){var a=s({queue:null,observable:null,
handlerDelegate:null,triggerDelegate:null,watchers:null,breaks:null,running:!1,lastEvent:null,currentEvent:null,interval:null,$init:function(a,c,d){var e="$$"+c+"_"+d;if(a[e])return a[e];a[e]=this;this.breaks={};this.watchers={};this.node=a;this.event=c;this.observable=new la;this.interval=d||0;this.handlerDelegate=D(this.handler,this);this.triggerDelegate=D(this.trigger,this);this.up()},handler:function(a){this.running?a&&(this.lastEvent=a):this.next(a)},next:function(a){var c=this.interval;if(a=
a||this.lastEvent)this.lastEvent=null,this.running=!0,this.currentEvent=a,"raf"==c?I(this.triggerDelegate):setTimeout(this.triggerDelegate,c)},watchWidth:function(){this.addWatcher("width",bb)},watchHeight:function(){this.addWatcher("width",cb)},watchScrollTop:function(){this.addWatcher("scrollTop",Aa)},watchScrollLeft:function(){this.addWatcher("scrollLeft",Ba)},addWatcher:function(a,c,d){this.watchers[a]||(this.watchers[a]={fn:c,context:d,prev:null,current:parseInt(c.call(d,this.node),10)})},removeWatcher:function(a){delete this.watchers[a]},
breakFilter:function(a,c,d){a=a.breakValue;var e=this.watchers[d.watcher];d=e.current;var f=e.prev,e=Math.min(f,d),f=Math.max(f,d);c[0].breakPosition=d<a?-1:1;return e<=a&&a<=f},onBreak:function(a,c,d,e,f){var h=a+"_"+c;f=f||{};f.breakValue=c;this.breaks[h]||(this.breaks[h]=this.observable.createEvent(h,{watcher:a,triggerFilter:this.breakFilter,filterContext:this}));this.breaks[h].on(d,e,f)},unBreak:function(a,c,d,e,f){a=a+"_"+c;this.breaks[a]&&(this.breaks[a].un(d,e),this.breaks[a].hasListener()||
(this.breaks[a].destroy(),delete this.breaks[a]));f&&this.destroyIfIdle()},on:function(a,c){this.observable.on(this.event,a,c)},un:function(a,c,d){this.observable.un(this.event,a,c);d&&this.destroyIfIdle()},trigger:function(){var a=this.currentEvent,c=this.watchers,d=this.breaks,e=this.node,f,h;this.observable.trigger(this.event,a);for(f in c)c[f].prev=c[f].current,c[f].current=parseInt(c[f].fn.call(c[f].context,e,a),10);for(h in d)d[h].trigger(a);this.running=!1;this.currentEvent=null;this.next()},
up:function(){K(this.node,this.event,this.handlerDelegate)},down:function(){T(this.node,this.event,this.handlerDelegate)},destroyIfIdle:function(){if(!this.observable.hasListener())return this.$destroy(),!0},destroy:function(){this.down();this.observable.destroy();this.queue.destroy()}},{get:function(b,c,d){var e="$$"+c+"_"+d;return b[e]?b[e]:b[e]=new a(b,c,d)}});return a}(),eb=s({cfg:null,scope:null,node:null,listeners:null,event:null,buffers:null,updateRoot:!1,$init:function(a,b,c,d,e){this.event=
d;e=e||{};c=c||{};"string"==typeof c&&(this.updateRoot=-2!=c.indexOf("$root")+c.indexOf("$parent"),d=c.substr(0,1),"{"==d?(this.watcher=V(a,c,this.onConfigChange,this),c=this.watcher.getLastResult()):"="==d?(c=c.substr(1),this.watcher=V(a,c,this.onConfigChange,this),c=this.watcher.getLastResult()):c={handler:R(c)});this.prepareConfig(c,e);this.buffers={};this.listeners=[];this.scope=a;this.node=b;this.up()},prepareConfig:function(a,b){var c,d=this.event;if(a.event){c={};var d=a.event.split(","),e,
f;delete a.event;e=0;for(f=d.length;e<f;e++)c[ea(d[e])]=a;a=c}else d&&(c={},c[d]=a,a=c);t(a,b,!1,!1);this.cfg=a},onConfigChange:function(a){this.down();this.prepareConfig(a);this.up()},createHandler:function(a,b){var c=this.updateRoot;return function(d){var e,f=!0,h=!1,k=!1;void 0!==a.preventDefault&&(f=a.preventDefault);void 0!==a.stopPropagation&&(k=a.stopPropagation);void 0!==a.returnValue&&(h=a.returnValue);void 0!==a.keyCode&&(e=a.keyCode);d=S(d||window.event);if(e&&("number"==typeof e&&e!=d.keyCode||
-1==e.indexOf(d.keyCode)))return null;b.$event=d;a.handler&&a.handler.call(a.context||null,b);b.$event=null;c?b.$root.$check():b.$check();k&&d.stopPropagation();f&&d.preventDefault();return h}},up:function(){var a=this.cfg,b=this.listeners,c=this.buffers,d=this.node,e=this.scope,f=a.buffer,h,k;for(k in a)if(void 0===a.if||a.if)h=this.createHandler(a[k],e),b.push([k,h]),f?c[k]||(c[k]=Ab.get(d,k,f),c[k].on(h)):K(d,k,h)},down:function(){var a=this.listeners,b=this.buffers,c=this.node,d=this.cfg.buffer,
e,f,h,k;h=0;for(k=a.length;h<k;h++)e=a[h][0],f=a[h][1],d?(b[e].un(f),!0===b[e].destroyIfIdle()&&delete b[e]):T(c,e,f);this.listeners=[]},destroy:function(){this.down();this.watcher&&this.watcher.unsubscribeAndDestroy(this.onConfigChange,this)}});(function(){q.registerAttribute("mjs-event",1E3,function(a,b,c){var d=new eb(a,b,c);return function(){d.$destroy();d=null}})})();var La=Za.createFunc;(function(){var a="click dblclick mousedown mouseup mouseover mouseout mousemove keydown keyup keypress focus blur copy cut paste mousewheel touchstart touchend touchcancel touchleave touchmove".split(" "),
b,c;b=0;for(c=a.length;b<c;b++)(function(a){q.registerAttribute("mjs-"+a,1E3,function(b,c,h){var k=new eb(b,c,h,a,{stopPropagation:!0});return function(){k.$destroy();k=null}})})(a[b]);q.registerAttribute("mjs-submit",1E3,function(a,b,c){var h=La(c),k=-2!=c.indexOf("$root")+c.indexOf("$parent"),l=function(){h(a);k?a.$root.$check():a.$check()};ba.get(b).onKey(13,l);return function(){ba.get(b).unKey(13,l);h=l=null}});a=null})();q.registerAttribute("mjs-show",500,s({$extends:q,initial:!0,display:"",
$init:function(a,b,c){this.display=O(b,a).display||"";this.$super(a,b,c)},runAnimation:function(a){var b=this,c=b.node.style,d=function(){c.display=a?b.display:"none"};b.initial?d():G(b.node,a?"show":"hide",function(){a&&(c.display=b.display)},!0).done(d)},onChange:function(){var a=this.watcher.getLastResult();this.runAnimation(a);this.initial=!1}}));q.registerAttribute("mjs-hide",500,s({$extends:"attr.mjs-show",onChange:function(){var a=this.watcher.getLastResult();this.runAnimation(!a);this.initial=
!1}}));q.registerAttribute("mjs-if",500,q.$extend({parentEl:null,prevEl:null,el:null,initial:!0,cfg:null,$init:function(a,b,c){this.parentEl=b.parentNode;this.prevEl=b.previousSibling;this.$super(a,b,c)},onScopeDestroy:function(){this.parentEl=this.prevEl=null;this.$super()},onChange:function(){var a=this,b=a.watcher.getLastResult(),c=a.parentEl,d=a.node,e=function(){a.prevEl?c.insertBefore(d,a.prevEl?a.prevEl.nextSibling:null):c.appendChild(d)},f=function(){c.removeChild(d)};b?a.initial?e():G(d,
"enter",e,!0):d.parentNode&&(a.initial?f():G(d,"leave",null,!0).done(f));a.initial?a.initial=!1:(a.cfg||(a.cfg=O(d,a.scope)),a.cfg.ifOnce&&a.$destroy())}}));q.registerAttribute("mjs-ignore",0,qa);q.registerAttribute("mjs-include-file",900,function(a,b,c){a=require("fs");b.innerHTML=a.readFileSync(c).toString()});q.registerAttribute("mjs-include",900,function(a,b,c,d){a=new pa({scope:a,node:b,url:c,parentRenderer:d});return a.ownRenderer?!1:a.initPromise});q.registerAttribute("mjs-init",250,function(a,
b,c){La(c)(a)});q.registerAttribute("mjs-key",1E3,function(a,b,c){var d=R(c)(a),e=d.handler,f=d.context||a;delete d.handler;delete d.context;ba.get(b).onKey(d,e,f);return function(){ba.get(b).unKey(d,e,f)}});var Ma=function(){var a;return function(){if(null===a){var b=navigator.userAgent;a=parseInt((/msie (\d+)/i.exec(b)||[])[1],10);isNaN(a)&&(a=parseInt((/trident\/.*; rv:(\d+)/i.exec(b)||[])[1],10)||!1)}return a}}();q.registerAttribute("mjs-model",1E3,q.$extend({inProg:!1,input:null,binding:null,
updateRoot:!1,autoOnChange:!1,$init:function(a,b,c){var d=O(b,a);this.node=b;this.input=ba.get(b);this.binding=d.binding||"both";this.updateRoot=-2!=c.indexOf("$root")+c.indexOf("$parent");this.input.onChange(this.onInputChange,this);this.$super(a,b,c);a=this.input.getValue();b=this.watcher.getLastResult();if(b!=a)if("input"!=this.binding&&void 0!=b)this.onChange(b);else if("scope"!=this.binding&&void 0!=a)this.onInputChange(a)},onInputChange:function(a){var b=this.scope;"scope"!=this.binding&&(a&&
A(a)&&-1!=a.indexOf("\\{")&&(a=a.replace(/\\{/g,"{")),this.watcher.getLastResult()!=a&&(this.watcher.setValue(a),this.inProg=!0,b instanceof aa?this.updateRoot?b.$root.$check():b.$check():this.watcher.checkAll(),this.inProg=!1))},destroy:function(){this.input.destroy();this.$super()},onChange:function(){var a=this.watcher.getLastResult()||"",b;"input"==this.binding||this.inProg||((b=Ma())&&8>b?Y(this.input.setValue,this.input,[a]):this.input.setValue(a))}}));q.registerAttribute("mjs-on",1E3,function(a,
b,c){var d=R(c)(a),e=function(b){var c,e,l,m,r;l=0;for(m=d.length;l<m;l++)c=d[l],e=c[0],(c=c[1])&&e&&(c[b]||c["$"+b])&&(r=c[b]||c["$"+b],r.call(c,e,a.$check,a))};e("on");return function(){e("un");d=null}});q.registerAttribute("mjs-options",100,s({$extends:q,model:null,getterFn:null,defOption:null,prevGroup:null,groupEl:null,fragment:null,$init:function(a,b,c){this.parseExpr(c);this.node=b;this.scope=a;for(this.defOption=b.options.length?b.options[0]:null;b.firstChild;)b.removeChild(b.firstChild);
this.defOption&&this.defOption.setAttribute("mjs-default-option","");try{this.watcher=V(a,this.model,this.onChange,this,null,z)}catch(d){Z(d)}this.render(Q(this.watcher.getValue()))},onChange:function(){this.render(Q(this.watcher.getValue()))},renderOption:function(a,b,c){var d=this.groupEl||this.fragment,e=Ma();c.item=a;c.$index=b;a=this.getterFn(c);void 0!=a.group&&(a.group=""+a.group);a.group!==this.prevGroup&&(a.group?(this.groupEl=d=window.document.createElement("optgroup"),d.setAttribute("label",
a.group),a.disabledGroup&&d.setAttribute("disabled","disabled"),this.fragment.appendChild(d)):(d=this.fragment,this.groupEl=null));this.prevGroup=a.group;b=window.document.createElement("option");b.setAttribute("value",a.value);b.text=a.name;e&&9>e&&(b.innerHTML=a.name);a.disabled&&b.setAttribute("disabled","disabled");d.appendChild(b)},render:function(a){var b=this.node,c=qb(b),d=this.defOption,e=this.scope.$new(),f=Ma(),h,k,l,m;this.fragment=window.document.createDocumentFragment();for(this.groupEl=
this.prevGroup=null;b.firstChild;)b.removeChild(b.firstChild);l=0;for(m=a.length;l<m;l++)this.renderOption(a[l],l,e);d&&b.insertBefore(d,b.firstChild);e.$destroy();f&&8>f&&(k=b.nextSibling,h=b.parentNode,h.removeChild(b));b.appendChild(this.fragment);this.fragment=null;f&&8>f&&h.insertBefore(b,k);rb(b,c)},parseExpr:function(a){var b=a.indexOf(" in "),c;-1==b?(c=a,a="{name: .item, value: .$index}"):(c=a.substr(b+4),a=a.substr(0,b));this.model=c;this.getterFn=R(a)}}));(function(){var a="selected checked disabled readonly open required".split(" "),
b,c,d=s({$extends:q,propName:null,$init:function(a,b,c,d){this.propName=d;this.$super(a,b,c)},onChange:function(a){var b=this.propName;a?this.node.setAttribute(b,b):this.node.removeAttribute(b)}});b=0;for(c=a.length;b<c;b++)(function(a){q.registerAttribute("mjs-"+a,1E3,function(b,c,k){return new d(b,c,k,a)})})(a[b])})();q.registerAttribute("mjs-scope-prop",200,function(a,b,c){a[c]=b});var fb=function(){var a={},b=0;return function(c){if(a[c])return v.resolve(c);1E3<b&&(a={},b=0);var d=window.document,
e=d.createElement("img"),f=e.style,h=new v;K(e,"load",function(){a[c]=!0;b++;d.body.removeChild(e);h.resolve(c)});f.position="absolute";f.visibility="hidden";f.left="-10000px";f.top="0";e.src=c;d.body.appendChild(e);return h}}();q.registerAttribute("mjs-src",1E3,s({$extends:q,queue:null,usePreload:!0,noCache:!1,$constructor:function(a,b,c){var d=O(b,a);d.deferred&&this.$plugins.push("plugin.SrcDeferred");d.preloadSize&&this.$plugins.push("plugin.SrcSize");if(d.srcPlugin){var d=d.srcPlugin.split(","),
e,f;e=0;for(f=d.length;e<f;e++)this.$plugins.push(ea(d[e]))}this.$super(a,b,c)},$init:function(a,b,c){var d=O(b,a);d.noCache&&(this.noCache=!0);d.noPreload?this.usePreload=!1:b.style.visibility="hidden";this.queue=new L({auto:!0,async:!0,mode:L.REPLACE,thenable:!0});this.$super(a,b,c)},onChange:function(){this.usePreload&&(this.node.style.visibility="hidden");this.queue.add(this.doChange,this)},doChange:function(){var a=this,b=a.watcher.getLastResult();if(b){a.noCache&&(b+=(-1!=b.indexOf("?")?"&amp;":
"?")+"_"+(new Date).getTime());if(a.usePreload)return fb(b).done(function(){a&&a.node&&I(function(){a.node.src=b;a.node.setAttribute("src",b);a.onSrcChanged();a.node.style.visibility=""})});a.node&&(a.node.src=b,a.node.setAttribute("src",b),a.onSrcChanged())}},onSrcChanged:function(){},destroy:function(){this.queue.destroy();this.$super()}}));var gb=function(){return window.document.createElement("div").style.removeProperty?function(a,b){a.style.removeProperty(b)}:function(a,b){a.style.removeAttribute(b)}}();
q.registerAttribute("mjs-style",1E3,q.$extend({onChange:function(){var a=this.node,b=a.style,c=this.watcher.getLastResult(),d=this.watcher.getPrevValue(),e;for(e in d)void 0===c[e]&&gb(a,e);for(e in c)c[e]?b[e]=c[e]:gb(a,e)}}));q.registerAttribute("mjs-transclude",1E3,function(a,b){return Ta(b)});q.registerAttribute("mjs-view",200,function(a,b,c){wa(c||"MetaphorJs.View",{scope:a,node:b},a,b);return!1});q.registerTag("mjs-bind-html",function(a,b){var c=x(b,"value"),c=V(a,c,null,null,null,z),d=c.getLastResult(),
d=M(d),e=b.nextSibling,f=Q(d.childNodes);b.parentNode.insertBefore(d,e);b.parentNode.removeChild(b);c.unsubscribeAndDestroy();return f});q.registerTag("mjs-bind",function(a,b){var c=x(b,"value"),c=R(c)(a),c=window.document.createTextNode(c);b.parentNode.insertBefore(c,b.nextSibling);b.parentNode.removeChild(b);return[c]});q.registerTag("mjs-each",Ka);q.registerTag("mjs-if",function(a,b){var c=x(b,"value");if(R(c)(a)){var c=Q(b.childNodes),d=M(b.childNodes);b.parentNode.insertBefore(d,b.nextSibling);
b.parentNode.removeChild(b);return c}b.parentNode.removeChild(b);return!1});q.registerTag("mjs-include",function(a,b,c,d){return(new pa({scope:a,node:b,url:x(b,"src"),parentRenderer:d,replace:!0})).initPromise});q.registerTag("mjs-tag",function(a,b){var c=x(b,"value");if(c=R(c)(a)){for(var c=window.document.createElement(c),d=b.nextSibling,e=Pa(b),f;b.firstChild;)c.appendChild(b.firstChild);delete e.value;for(f in e)c.setAttribute(f,e[f]);b.parentNode.insertBefore(c,d);b.parentNode.removeChild(b);
return[c]}b.parentNode.removeChild(b);return!1});q.registerTag("mjs-transclude",function(a,b){return Ta(b,!0)});w("filter.collect",function(a,b,c){b=[];var d,e,f;d=0;for(e=a.length;d<e;d++)f=a[d][c],void 0!=f&&b.push(f);return b});var Bb=function(){var a=function(a,b,c){if(E(b))return b(a,c);if(""===b||void 0===b)return!0;if(void 0!==a){if(na(a))return a===b;if(b instanceof RegExp)return b.test(""+a);if("strict"==c)return""+a===""+b;if(!0===c||null===c||void 0===c)return-1!=""+a.indexOf(b);if(!1===
c)return-1==""+a.indexOf(b)}return!1},b=function(b,c,f){if(Ha(b))return void 0===c.$?!0:a(b,c.$,f);var h,k;for(h in c)if("$"==h)for(k in b){if(a(b[k],c.$,f))return!0}else if(a(b[h],c[h],f))return!0;return!1},c=function(a,c,f){fa(c)||(c={$:c});var h=[],k,l;k=-1;for(l=a.length;++k<l;)b(a[k],c,f)&&h.push(a[k]);return h};c.compare=b;return c}();w("filter.filter",function(a,b,c,d){return Bb(a,c,d)});w("filter.get",function(a,b,c){for(b=(""+c).split(".");c=b.shift();)if(a=a[c],void 0==a)return;return a});
w("filter.join",function(a,b,c){c=c||", ";return a&&a.length?(H(a)||(a=Q(a)),a.join(c)):""});w("filter.l",function(a,b){return b.$app.lang.get(a)});w("filter.limitTo",function(a,b,c){b=A(a);if(!H(a)&&!b)return a;c=Infinity===Math.abs(Number(c))?Number(c):parseInt(c,10);if(b)return c?0<=c?a.slice(0,c):a.slice(c,a.length):"";b=[];var d;c>a.length?c=a.length:c<-a.length&&(c=-a.length);0<c?d=0:(d=a.length+c,c=a.length);for(;d<c;d++)b.push(a[d]);return b});w("filter.linkify",function(a,b,c){return a?a.replace(/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/ig,
'<a href="$1"'+(c?' target="'+c+'"':"")+">$1</a>"):""});w("filter.lowercase",function(a){return a.toLowerCase()});w("filter.map",function(a,b,c){var d=ga(c,!0)||window[c]||R(c)(b);if(d)for(b=0,c=a.length;b<c;b++)a[b]=d(a[b]);return a});var Cb={};w("filter.moment",function(a,b,c){c=Cb[c]||c;return moment(a).format(c)});var Db={};w("filter.numeral",function(a,b,c){c=Db[c]||c;return numeral(a).format(c)});w("filter.offset",function(a,b,c){b=A(a);if(!H(a)&&!b)return a;c=Infinity===Math.abs(Number(c))?
Number(c):parseInt(c,10);return b?a.substr(c):a.slice(c)});w("filter.p",function(a,b,c){return b.$app.lang.plural(a,parseInt(c,10)||0)});w("filter.preloaded",function(a,b){if(!a)return!1;var c=fb(a);if(c.isFulfilled())return!0;c.done(function(){b.$check()});return!1});w("filter.sortBy",function(a,b,c,d){return nb(a,c,d)});w("filter.split",function(a,b,c,d){d=d||void 0;c=c||"/\\n|,/";if(!a)return[];a=""+a;"/"==c.substr(0,1)&&"/"==c.substr(c.length-1)&&(c=ta(c.substring(1,c.length-1)));a=a.split(c,
d);b=-1;for(c=a.length;++b<c;a[b]=ea(a[b]));return a});w("filter.toArray",function(a){if(fa(a)){var b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push({key:c,value:a[c]});return b}return Q(a)});w("filter.ucfirst",function(a){return a.substr(0,1).toUpperCase()+a.substr(1)});w("filter.uppercase",function(a){return a.toUpperCase()});(function(){var a="undefined"!=typeof window?window:null,b="undefined"!=typeof global?global:null;return function d(e,f){if(a&&e===a)throw Error("Cannot copy window object");
if(b&&e===b)throw Error("Cannot copy global object");if(f){if(e===f)throw Error("Objects are identical");if(H(e))for(var h=f.length=0,k=e.length;h<k;h++)f.push(d(e[h]));else{for(h in f)delete f[h];for(h in e)e.hasOwnProperty(h)&&("$"==h.charAt(0)||E(e[h])?f[h]=e[h]:f[h]=d(e[h]))}}else(f=e)&&(H(e)?f=d(e,[]):10===J(e)?f=new Date(e.getTime()):9===J(e)?f=new RegExp(e.source):fa(e)&&(f=d(e,{})));return f}})();(function(){return function b(c,d){if(c===d)return!0;if(null===c||null===d)return!1;if(c!==c&&
d!==d)return!0;var e=typeof c,f;if(e==typeof d&&"object"==e)if(H(c)){if(!H(d))return!1;if((e=c.length)==d.length){for(f=0;f<e;f++)if(!b(c[f],d[f]))return!1;return!0}}else{if(10===J(c))return 10===J(d)&&c.getTime()==d.getTime();if(9===J(c)&&9===J(d))return c.toString()==d.toString();if(Ua(c)||Ua(d)||H(d))return!1;e={};for(f in c)if("$"!=f.charAt(0)&&!E(c[f])){if(!b(c[f],d[f]))return!1;e[f]=!0}for(f in d)if(!e.hasOwnProperty(f)&&"$"!=f.charAt(0)&&void 0!==d[f]&&!E(d[f]))return!1;return!0}return!1}})();
(function(){var a=Object.prototype.toString,b=Function.prototype.toString,c=/^\[object .+?Constructor\]$/,d=RegExp("^"+String(a).replace(/[.*+?^${}()|[\]\/\\]/g,"\\$&").replace(/toString|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");return function(e){var f=typeof e;return"function"==f?!("prototype"in e)||d.test(b.call(e)):e&&"object"==f&&c.test(a.call(e))||!1}})();(function(){return"undefined"!=typeof JSON?function(a){return JSON.parse(a)}:function(a){return(new Function("return "+a))()}})();
var Eb=Ka.$extend({$class:"StoreRenderer",store:null,$constructor:function(a,b,c){var d=O(b,a);d.pullNext&&(d.buffered&&(d.bufferedPullNext=!0,d.buffered=!1),this.$plugins.push("plugin.ListPullNext"));this.$super(a,b,c)},afterInit:function(a,b,c){this.store=a=R(this.model)(a);this.watcher=V(a,".current",this.onChange,this,null,z);this.trackByFn=D(a.getRecordId,a);this.griDelegate=D(a.indexOfId,a);this.bindStore(a,"on")},bindStore:function(a,b){a[b]("update",this.onStoreUpdate,this);a[b]("clear",this.onStoreUpdate,
this);a[b]("destroy",this.onStoreDestroy,this)},onStoreUpdate:function(){this.watcher.check()},getListItem:function(a,b){return this.store.getRecordData(a[b])},onStoreDestroy:function(){this.onStoreUpdate();this.watcher.unsubscribeAndDestroy(this.onChange,this);this.watcher=null},destroy:function(){this.bindStore(this.store,"un");this.$super()}},{$stopRenderer:!0,$registerBy:"id"});q.registerAttribute("mjs-each-in-store",100,Eb);var sa=ra.factory,ya=B.is,Ea=Da("outer","Width"),Fa=Da("outer","Height"),
za={};s({$class:"dialog.position.Abstract",dialog:null,positionBase:null,correct:"solid",$init:function(a){this.dialog=a;t(this,a.getCfg().position,!0,!1);this.onWindowResizeDelegate=D(this.onWindowResize,this);this.onWindowScrollDelegate=D(this.onWindowScroll,this);var b=this.preferredType||this.type;if("string"==typeof b){var c=this.getAllPositions(),d;-1!=(d=c.indexOf(b))&&(c.splice(d,1),c.unshift(b));this.preferredType=c}else b||(this.preferredType=this.getAllPositions());a.on("reposition",this.onReposition,
this);a.on("show-after-delay",this.onShowAfterDelay,this);a.on("hide-after-delay",this.onHideAfterDelay,this);if(a.isVisible())this.onShowAfterDelay()},getPositionBase:function(){if(this.positionBase)return this.positionBase;var a;return(a=this.dialog.getCfg().position.base)?this.positionBase="string"==typeof a?B(a).shift():a:null},getBoundary:function(){var a=this.getPositionBase(),b=this.screenX||0,c=this.screenY||0,d,e,f;if(a)return e=ha(a),d=Ea(a),a=Fa(a),{x:e.left+b,y:e.top+c,x1:e.left+d-b,y1:e.top+
a-c,w:d,h:a};d=bb(window);a=cb(window);e=Aa(window);f=Ba(window);return{x:f+b,y:e+c,x1:f+d-b,y1:e+a-c,w:d,h:a}},getPrimaryPosition:function(a){return!1},getSecondaryPosition:function(a){return!1},getAllPositions:function(){return[]},correctPosition:function(a){var b=this.getPrimaryPosition(),c=this.correct;if(b&&c){var d=this.dialog,b=this.getBoundary(),d=d.getDialogSize(),e=this.preferredType,f=e[0];if(c&&"solid"!=c){if(this.type!=f&&this.checkIfFits(a,f,b,d,!1))return this.changeType(f),this.fitToBoundary(this.getCoords(a),
b,d);if(this.checkIfFits(a,this.type,b,d,!1))return this.fitToBoundary(this.getCoords(a),b,d)}if(c&&"position-only"!=c)for(c=0,f=e.length;c<f;c++)if(this.checkIfFits(a,e[c],b,d,!0)){this.changeType(e[c]);break}return this.getCoords(a)}},checkIfFits:function(a,b,c,d,e){a=this.getCoords(a,b,!0);if(!e&&this.getSecondaryPosition(b))return!1;if(e)return!(a.x<c.x||a.y<c.y||a.x+d.width>c.x1||a.y+d.height>c.y1);switch(this.getPrimaryPosition(b)){case "t":return a.y>=c.y;case "r":return a.x+d.width<=c.x1;
case "b":return a.y+d.height<=c.y1;case "l":return a.x>=c.x}},fitToBoundary:function(a,b,c){var d=this.getPositionBase(),e=d?0:b.x,f=d?0:b.y,h=d?b.w:b.x1;b=d?b.h:b.y1;var k=d=0,l=this.dialog.getPointer();a.x<e&&(d=a.x-e,a.x=e);a.y<f&&(k=a.y-f,a.y=f);a.x+c.width>h&&(d=a.x+c.width-h,a.x-=d);a.y+c.height>b&&(k=a.y+c.height-b,a.y-=k);l.setCorrectionOffset(d,k);l.reposition();return a},changeType:function(a){var b=this.dialog.getPointer();this.type=a;b.setType(null,null)},onReposition:function(a,b){var c;
c=!1!==this.screenX||!1!==this.screenY?this.correctPosition(b):this.getCoords(b);this.apply(c)},getCoords:function(a){return{left:0,top:0}},apply:function(a){a&&X(this.dialog.getElem(),{left:a.x+"px",top:a.y+"px"})},onWindowResize:function(a){this.dialog.reposition(S(a))},onWindowScroll:function(a){this.dialog.reposition(S(a))},onShowAfterDelay:function(){(this.resize||this.screenX||this.screenY)&&K(window,"resize",this.onWindowResizeDelegate);(this.scroll||this.screenX||this.screenY)&&K(this.dialog.getScrollEl(this.scroll),
"scroll",this.onWindowScrollDelegate)},onHideAfterDelay:function(){(this.resize||this.screenX||this.screenY)&&T(window,"resize",this.onWindowResizeDelegate);(this.scroll||this.screenX||this.screenY)&&T(this.dialog.getScrollEl(this.scroll),"scroll",this.onWindowScrollDelegate)},destroy:function(){var a=this.dialog;a.un("reposition",this.onReposition,this);a.un("show-after-delay",this.onShowAfterDelay,this);a.un("hide-after-delay",this.onHideAfterDelay,this);if(this.dialog.isVisible())this.onHideAfterDelay()}});
s({$class:"dialog.position.Target",$extends:"dialog.position.Abstract",getCoords:function(a,b,c){var d=this.dialog,e=d.getCfg(),f=d.getTarget();if(!f)return null;var h=this.getPositionBase();a=d.getDialogSize();if(h&&!c)a:{var k;c={top:0,left:0};var l=window.document.documentElement;if(f===window||f===l)f=c;else{if("fixed"==ka(f,"position"))k=f.getBoundingClientRect();else{if(h){f=ha(f);c=ha(h);f={left:f.left-c.left,top:f.top-c.top};0>f.left&&(f.left=0);0>f.top&&(f.top=0);break a}h=window.document.documentElement;
for(k=f.offsetParent||h;k&&k!=h&&"static"==ka(k,"position");)k=k.offsetParent;h=k||h;k=ha(f);h!==l&&(c=ha(h));c.top+=ka(h,"borderTopWidth",!0);c.left+=ka(h,"borderLeftWidth",!0)}f={top:k.top-c.top-ka(f,"marginTop",!0),left:k.left-c.left-ka(f,"marginLeft",!0)}}}else f=ha(f);c=d.getTargetSize();l={};b=b||this.type;h=b.substr(0,1);k=b.substr(1);var m=e.position.offsetX,e=e.position.offsetY;b=d.pointer.getDialogPositionOffset(b);switch(h){case "t":l.y=f.top-a.height-e;break;case "r":l.x=f.left+c.width+
m;break;case "b":l.y=f.top+c.height+e;break;case "l":l.x=f.left-a.width-m}switch(k){case "t":l.y=f.top+e;break;case "r":l.x=f.left+c.width-a.width-m;break;case "b":l.y=f.top+c.height-a.height-e;break;case "l":l.x=f.left+m;break;case "rc":l.x=f.left+c.width+m;break;case "lc":l.x=f.left-a.width-m;break;case "":switch(h){case "t":case "b":l.x=f.left+c.width/2-a.width/2;break;case "r":case "l":l.y=f.top+c.height/2-a.height/2}}b&&(l.x+=b.x,l.y+=b.y);return l},getPrimaryPosition:function(a){return(a||this.type).substr(0,
1)},getSecondaryPosition:function(a){return(a||this.type).substr(1)},getAllPositions:function(){return"t r b l tl tr rt rb br bl lb lt tlc trc brc blc".split(" ")}});s({$class:"dialog.position.Mouse",$extends:"dialog.position.Target",correct:"position",$init:function(a){this.onMouseMoveDelegate=D(this.onMouseMove,this);this.$super(a)},getCoords:function(a,b,c){if(!a)return null;var d=b||this.type,e=this.dialog,f=e.getCfg(),h=e.getDialogSize(),k=this.getPositionBase(),l={};b=(b||this.type).substr(1);
var m=f.position.offsetX,r=f.position.offsetY,f=f.position.axis,d=e.getPointer().getDialogPositionOffset(d),n=0,p=0;!c&&k&&(k=ha(k),n=k.left,p=k.top);switch(b){case "":l=this.get.call(e.$$callbackContext,e,a,b,c);break;case "c":l.y=a.pageY-p-h.height/2;l.x=a.pageX-n-h.width/2;break;case "t":l.y=a.pageY-p-h.height-r;l.x=a.pageX-n-h.width/2;break;case "r":l.y=a.pageY-p-h.height/2;l.x=a.pageX-n+m;break;case "b":l.y=a.pageY-p+r;l.x=a.pageX-n-h.width/2;break;case "l":l.y=a.pageY-p-h.height/2;l.x=a.pageX-
n-h.width-m;break;case "rt":l.y=a.pageY-p-h.height-r;l.x=a.pageX-n+m;break;case "rb":l.y=a.pageY-p+r;l.x=a.pageX-n+m;break;case "lt":l.y=a.pageY-p-h.height-r;l.x=a.pageX-n-h.width-m;break;case "lb":l.y=a.pageY-p+r,l.x=a.pageX-n-h.width-m}d&&(l.x+=d.x,l.y+=d.y);f&&(a=this.$super(a,b))&&("x"==f?l.y=a.y:l.x=a.x);return l},onShowAfterDelay:function(){this.$super();K(window.document.documentElement,"mousemove",this.onMouseMoveDelegate)},onHideAfterDelay:function(){this.$super();T(window.document.documentElement,
"mousemove",this.onMouseMoveDelegate)},onMouseMove:function(a){this.dialog.reposition(S(a))},getPrimaryPosition:function(a){return(a||this.type).substr(1,1)},getSecondaryPosition:function(a){return(a||this.type).substr(2)},getAllPositions:function(){return"mt mr mb ml mrt mrb mlb mlt".split(" ")}});s({$class:"dialog.position.Window",$extends:"dialog.position.Abstract",getCoords:function(a){var b=this.dialog;a=this.getPositionBase()||window;var b=b.getDialogSize(),c={},d=this.type.substr(1),e=this.offsetX,
f=this.offsetY,h=Aa(a),k=Ba(a),l=Ea(a);a=Fa(a);switch(d){case "c":c.y=a/2-b.height/2+h;c.x=l/2-b.width/2+k;break;case "t":c.y=h+f;c.x=l/2-b.width/2+k;break;case "r":c.y=a/2-b.height/2+h;c.x=l-b.width+k-e;break;case "b":c.y=a-b.height+h-f;c.x=l/2-b.width/2+k;break;case "l":c.y=a/2-b.height/2+h;c.x=k+e;break;case "rt":c.y=h+f;c.x=l-b.width+k-e;break;case "rb":c.y=a-b.height+h-f;c.x=l-b.width+k-e;break;case "lt":c.y=h+f;c.x=k+e;break;case "lb":c.y=a-b.height+h-f,c.x=k+e}return c},getPrimaryPosition:function(){return this.type.substr(1,
1)},getSecondaryPosition:function(){return this.type.substr(2)},correctType:function(){},correctPosition:function(){}});s({$class:"dialog.position.Custom",$extends:"dialog.position.Abstract",getCoords:function(a){var b=this.dialog;return this.get.call(b.$$callbackContext,b,a)}});s({$class:"dialog.pointer.Abstract",enabled:null,node:null,correctX:0,correctY:0,$init:function(a,b){t(this,b,!0,!1);this.origCfg=b;this.dialog=a;this.opposite={t:"b",r:"l",b:"t",l:"r"};this.names={t:"top",r:"right",b:"bottom",
l:"left"};this.sides={t:["l","r"],r:["t","b"],b:["r","l"],l:["b","t"]};this.enabled=!1!==this.enabled&&b.size?!0:!1},enable:function(){this.enabled||(this.enabled=!0,this.render(),this.dialog.isVisible()&&this.dialog.reposition())},disable:function(){this.enabled&&(this.remove(),this.enabled=!1,this.dialog.isVisible()&&this.dialog.reposition())},getElem:function(){return this.node},getSize:function(){return this.enabled?this.size:0},setCorrectionOffset:function(a,b){this.correctX=a;this.correctY=
b},getCorrectionValue:function(a,b,c){if(!b)return 0;var d=c.substr(0,1);c=c.substr(1,1);var e=this.dialog.getDialogSize(),f=this.width,h="t"==d||"b"==d?"width":"height",k,l;switch(c){case "":l=e[h]/2-f/2;k=-l;break;case "l":k=0;l=e[h]-f/2;break;case "r":k=-(e[h]-f/2),l=0}b=0>b?Math.max(k,b):Math.min(l,b);return("t"==d||"b"==d)&&"x"==a||("l"==d||"r"==d)&&"y"==a?b:0},getDialogPositionOffset:function(a){var b=(this.detectPointerPosition(a)||"").substr(0,1);a=this.dialog.getPosition().getPrimaryPosition(a);
var c={x:0,y:0};if(!this.enabled)return c;b==this.opposite[a]&&(c["t"==b||"b"==b?"y":"x"]="b"==b||"r"==b?-this.size:this.size);return c},detectPointerPosition:function(a){var b;if(this.position&&!a)return E(this.position)?this.position.call(this.dialog.$$callbackContext,this.dialog,this.origCfg):this.position;b=this.dialog.getPosition().getPrimaryPosition(a);a=this.dialog.getPosition().getSecondaryPosition(a);if(!b)return null;b=this.opposite[b];a&&(a=a.substr(0,1),b+=a);return b},detectPointerDirection:function(a){return this.direction?
E(this.direction)?this.direction.call(this.dialog.$$callbackContext,this.dialog,a,this.origCfg):this.direction:a},update:function(){this.remove();this.render();this.append();this.dialog.isVisible()&&this.dialog.reposition()},setType:function(a,b){this.position=a;this.direction=b;this.update();this.reposition()},render:function(){},destroy:function(){this.remove()},reposition:function(){},append:function(){if(this.enabled&&(this.node||this.render(),this.node)){this.reposition();var a=this.dialog.getElem();
a&&a.appendChild(this.node)}},remove:function(){var a=this.node;a&&(a.parentNode&&a.parentNode.removeChild(a),this.node=null)}});(function(){var a=null,b={backgroundColor:"transparent",width:"0px",height:"0px",position:"absolute",fontSize:"0px",lineHeight:"0px"};return s({$class:"dialog.pointer.Html",$extends:"dialog.pointer.Abstract",node:null,sub:null,$init:function(b,d){null===a&&(a=window.document.all&&!window.XMLHttpRequest);this.$super(b,d);this.width=this.width||2*this.size;this.inner&&(this.enabled=
!0)},createInner:function(){var a=t({},this.origCfg);a.size=this.size-2*this.border;a.width=this.width-4*this.border;a.border=0;a.borderColor=null;a.borderCls=null;a.offset=0;a.inner=this.border;this.sub=sa("dialog.pointer.Html",this.dialog,a)},getBorders:function(b,d,e){var f={},h=b.substr(0,1);b=d.substr(0,1);var k=d.substr(1);d=a?"dotted":"solid";var l=this.names,m=this.sides,r=this.opposite;f["border"+ca(l[r[h]])]=this.size+"px solid "+e;f["border"+ca(l[h])]="0 "+d+" transparent";k?(f["border"+
ca(l[k])]="0 solid transparent",f["border"+ca(l[r[k]])]=this.width+"px "+d+" transparent"):(e=Math.floor(this.width/2),f["border"+ca(l[m[b][0]])]=e+"px "+d+" transparent",f["border"+ca(l[m[b][1]])]=e+"px "+d+" transparent");return f},getOffsets:function(a,b){var e={},f=this.names,h=this.opposite,k=a.substr(0,1),l="t"==k||"b"==k?"r":"b";e[f[k]]=this.inner?"auto":-this.size+"px";e[f[l]]="auto";if(this.inner){var k=b.substr(0,1),m=b.substr(1);e[f[h[l]]]=m?"l"==m||"t"==m?this.inner+"px":-this.width-this.inner+
"px":Math.floor(-this.width/2)+"px";e[f[h[k]]]=-(this.size+2*this.inner)+"px"}else{switch(a){case "t":case "r":case "b":case "l":k=b!=a?"l"==b||"t"==b?this.offset:-this.width+this.offset:-this.width/2+this.offset;break;case "bl":case "tl":case "lt":case "rt":k=this.offset;break;default:k=-this.width-this.offset}e["margin"+ca(f[h[l]])]=k+"px";switch(a){case "t":case "r":case "b":case "l":k="50%";break;case "tr":case "rb":case "br":case "lb":k="100%";break;default:k=0}e[f[h[l]]]=k;f=Ya().transform;
h="";l=this.correctX;k=this.correctY;f&&(l&&(h+=" translateX("+this.getCorrectionValue("x",l,a)+"px)"),k&&(h+=" translateY("+this.getCorrectionValue("y",k,a)+"px)"),e[f]=h)}return e},render:function(){if(this.enabled&&!this.node&&this.detectPointerPosition()){this.border&&!this.sub&&this.createInner();this.node=window.document.createElement("div");var a=window.document.createComment(" ");this.node.appendChild(a);X(this.node,b);N(this.node,this.borderCls||this.cls);this.sub&&(this.sub.render(),this.node.appendChild(this.sub.getElem()))}},
reposition:function(){var a=this.detectPointerPosition(),b=this.detectPointerDirection(a);this.node&&(X(this.node,this.getBorders(a,b,this.borderColor||this.color)),X(this.node,this.getOffsets(a,b)),this.sub&&this.sub.reposition())},update:function(){this.sub&&(this.sub.$destroy(),this.sub=null);this.remove();this.node=null;this.render();this.append();this.dialog.isVisible()&&this.dialog.reposition()},destroy:function(){this.sub&&(this.sub.$destroy(),this.sub=null);this.$super()},remove:function(){this.sub&&
this.sub.remove();this.$super()}})})();s({$class:"dialog.Overlay",dialog:null,enabled:!1,color:"#000",opacity:.5,cls:null,animateShow:!1,animateHide:!1,$init:function(a){this.dialog=a;this.onClickDelegate=D(this.onClick,this);t(this,a.getCfg().overlay,!0,!1);this.enabled&&(this.enabled=!1,this.enable())},getElem:function(){this.enabled&&!this.node&&this.render();return this.node},enable:function(){this.enabled||(this.enabled=!0)},disable:function(){this.enabled&&(this.remove(),this.enabled=!1)},show:function(a){this.enabled&&
(this.animateShow?this.animate("show",a):this.node.style.display="block")},hide:function(a){this.node&&(this.animateHide?this.animate("hide",a):this.node.style.display="none")},render:function(){if(this.enabled){var a=window.document.createElement("div"),b=this.dialog.getCfg();X(a,{display:"none",position:"fixed",left:0,top:0,right:0,bottom:0,opacity:this.opacity,backgroundColor:this.color});K(a,"click",this.onClickDelegate);b.render.zIndex&&X(a,"zIndex",b.render.zIndex);this.cls&&N(a,this.cls);this.node=
a}},remove:function(){var a=this.dialog,b=this.node;b&&I(function(){!a.isVisible()&&b.parentNode&&b.parentNode.removeChild(b)})},append:function(){var a=this.dialog.getCfg().render.appendTo||window.document.body;this.enabled&&(this.node||this.render(),a.appendChild(this.node))},animate:function(a,b){var c=this.node,d;d="show"==a?this.animateShow:this.animateHide;E(d)&&(d=d(this,b));na(d)?d=a:A(d)&&(d=[d]);return G(c,d,function(){if("show"==a){var b=new v;I(function(){c.style.display="";b.resolve()});
return b}},!1)},onClick:function(a){return this.modal?(a=S(a),a.preventDefault(),a.stopPropagation(),!1):null},destroy:function(){this.remove()}});s({$class:"dialog.Manager",all:null,groups:null,$init:function(){this.all={};this.groups={}},register:function(a){var b=a.getInstanceId(),c=a.getGroup(),d=this.groups,e,f,h;this.all[b]=a;e=0;for(f=c.length;e<f;e++)h=c[e],d[h]||(d[h]={}),d[h][b]=!0;a.on("destroy",this.unregister,this)},unregister:function(a){a=a.getInstanceId();delete this.all[a]},hideAll:function(a){var b=
a.getInstanceId();a=a.getGroup();var c=this.all,d=this.groups,e,f,h,k;e=0;for(f=a.length;e<f;e++)for(k in h=a[e],h=d[h],h)c[k]?k==b||c[k].isHideAllIgnored()||c[k].hide(null,!0,!0):delete h[k]}});Oa=function(){var a=sa("dialog.Manager"),b=function(a,b,c,d){if("show"==c||!d)return b.preventDefault(),b.stopPropagation(),!1},c=function(a,b,c,d){var e=a[b],f=!1;if(void 0!==e){switch(d){case "string":f=A(e);break;case "function":f=E(e);break;case "number":f=1===J(e)||e==parseInt(e);break;case "dom":f=e&&
(e.tagName||e.nodeName)?!0:!1;break;case "jquery":(f=e&&e.jquery?!0:!1)&&(e=e.get(0));break;case "boolean":if(!0===e||!1===e)f=!0;break;default:!0===d&&!0===e&&(f=!0),!1===d&&!1===e&&(f=!0)}f&&(a[b]={},a[b][c]=e)}},d=function(a){if(!a)return{};c(a,"content","value","string");c(a,"content","value","boolean");c(a,"content","fn","function");c(a,"ajax","url","string");c(a,"cls","dialog","string");c(a,"render","tpl","string");c(a,"render","fn","function");c(a,"render","el","dom");c(a,"render","el","jquery");
c(a,"show","events",!1);c(a,"show","events","string");c(a,"hide","events",!1);c(a,"hide","events","string");c(a,"toggle","events",!1);c(a,"toggle","events","string");c(a,"position","type","string");c(a,"position","type",!1);c(a,"position","get","function");c(a,"overlay","enabled","boolean");c(a,"pointer","position","string");c(a,"pointer","size","number");return a},e={target:null,group:null,modal:!1,useHref:!1,content:{value:"",fn:null,prepare:null,attr:null},ajax:{url:null,data:null,dataType:"text",
method:"GET"},cls:{dialog:null,visible:null,hidden:null,loading:null},selector:{content:null},buttons:null,render:{tpl:"<div></div>",fn:null,el:null,zIndex:null,lazy:!0,style:null,appendTo:null,id:null,keepVisible:!1,keepInDOM:!1,lifetime:null},events:{show:{"*":{process:b}},hide:{"*":{process:b}}},show:{delay:null,single:!1,events:null,animate:!1,ignoreHideAll:!1,focus:!1,preventScroll:!1,display:"block"},hide:{delay:null,timeout:null,events:null,destroy:!1,remove:!1,animate:!1,cancelShowDelay:!0},
toggle:{events:null},position:{type:"t",preferredType:null,offsetX:0,offsetY:0,axis:null,get:null,screenX:!1,screenY:!1,base:null,scroll:!1,resize:!0},pointer:{position:null,direction:null,size:0,width:null,color:null,offset:0,border:0,borderColor:null,el:null,cls:null,borderCls:null},overlay:{enabled:!1,color:"#000",opacity:.5,cls:null,animateShow:!1,animateHide:!1},callback:{scope:null,contentchange:null,beforeshow:null,show:null,beforehide:null,hide:null,render:null,lifetime:null,targetchange:null,
button:null}},f=s({$class:"Dialog",$mixins:["mixin.Observable"],id:null,node:null,overlay:null,pointer:null,cfg:null,position:null,target:null,dynamicTarget:!1,dynamicTargetEl:null,visible:!1,enabled:!0,frozen:!1,rendered:!1,bindSelfOnRender:!1,hideTimeout:null,hideDelay:null,showDelay:null,destroyDelay:null,images:0,positionGetType:null,positionClass:null,positionAttempt:0,$init:function(b){b=b||{};var c=b.preset;b.preset=null;this.cfg=b=t({},e,d(f.defaults),d(f[c]),d(b),!0,!0);this.id=U();this.onPreventScrollDelegate=
D(this.onPreventScroll,this);this.onButtonClickDelegate=D(this.onButtonClick,this);this.onButtonKeyupDelegate=D(this.onButtonKeyup,this);this.showDelegate=D(this.show,this);this.hideDelegate=D(this.hide,this);this.toggleDelegate=D(this.toggle,this);this.onImageLoadDelegate=D(this.onImageLoad,this);a.register(this);b.modal&&(b.overlay.enabled=!0);this.overlay=sa("dialog.Overlay",this);c=ca(b.pointer.$class||"Html");this.pointer=sa("dialog.pointer."+c,this,b.pointer);E(b.position.type)&&(this.positionGetType=
b.position.type);this.setTarget(b.target);b.target&&b.useHref&&(c=x(this.getTarget(),"href"),"#"==c.substr(0,1)?b.render.el=c:b.ajax.url=c);b.render.lazy||this.render();this.trigger("init",this);this.setHandlers("bind")},getElem:function(){return this.node},getInstanceId:function(){return this.id},getCfg:function(){return this.cfg},getPointer:function(){return this.pointer},getOverlay:function(){return this.overlay},isEnabled:function(){return this.enabled},isVisible:function(){return this.visible},
isHideAllIgnored:function(){return this.cfg.show.ignoreHideAll},isFrozen:function(){return this.frozen},isRendered:function(){return this.rendered},enable:function(){this.enabled=!0},disable:function(){this.hide();this.enabled=!1},freeze:function(){this.frozen=!0},unfreeze:function(){this.frozen=!1},getGroup:function(){var a=this.cfg;return a.group?A(a.group)?[a.group]:a.group:[""]},toggle:function(a,b){return a&&a.stopPropagation&&this.dynamicTarget&&this.visible&&this.isDynamicTargetChanged(a)?
this.show(a):this[this.visible?"hide":"show"](a,b)},resetHandlers:function(a,b){this.setHandlers("unbind");this.bindSelfOnRender=!1;a&&a.call(b,this,this.getCfg());this.setHandlers("bind")},setHandlers:function(a,b){for(var c=this.cfg,d=["show","hide","toggle"],e="bind"==a?K:T,f="bind"==a?ob:pb,p,q,s,u,t,x,w,v,y,z;p=d.shift();)if(q=c[p].events,!1!==q){if(A(q)||H(q))this.dynamicTarget?(t={},t[q]=c.target,q={_html:t}):q={_target:q};for(s in q){if(b)if("_self"==b){if("_self"!=s&&"_overlay"!=s&&">"!=
s.substr(0,1))continue}else if(s!=b)continue;if("_self"!=s&&"_overlay"!=s&&">"!=s.substr(0,1)||this.node){if(w=q[s]){switch(s){case "_target":v=[this.getTarget()];break;case "_self":v=[this.node];break;case "_window":v=[window];break;case "_document":v=[window.document];break;case "_html":v=[window.document.documentElement];break;case "_overlay":v=[this.overlay.getElem()];break;default:v=">"==s.substr(0,1)?B(s.substr(1),this.node):B(s)}if(v&&v.length)if(A(w)&&(w=[w]),H(w))for(t=0,x=w.length;t<x;t++)for(y=
-1,z=v.length;++y<z;e(v[y],w[t],this[p+"Delegate"]));else for(u in w)for(y=-1,z=v.length;++y<z;f(v[y],w[u],u,this[p+"Delegate"]));}}else this.bindSelfOnRender=!0}}},onPreventScroll:function(a){S(a).preventDefault()},onButtonClick:function(a){var b=S(a).target;(b=y(b,"metaphorjsTooltip-button-id"))&&this.trigger("button",this,b,a)},onButtonKeyup:function(a){if(13==a.keyCode||32==a.keyCode){var b=y(a.target,"metaphorjsTooltip-button-id");b&&this.trigger("button",this,b,S(a))}},show:function(b,c){var d=
this.cfg,e=null,f=d.show,n=null;this.isEnabled()||(n="disabled");!n&&this.visible&&this.hideTimeout&&(window.clearTimeout(this.hideTimeout),this.hideTimeout=Y(this.hide,this,null,d.hide.timeout),n="hidetimeout");!n&&this.hideDelay&&(window.clearTimeout(this.hideDelay),this.hideDelay=null,this.visible=!0,n="hidedelay");!n&&this.frozen&&(n="frozen");this.destroyDelay&&(window.clearTimeout(this.destroyDelay),this.destroyDelay=null);var p=!1;b&&b.stopPropagation&&this.dynamicTarget&&(p=this.changeDynamicTarget(b));
this.visible&&(p?(this.reposition(b),n="reposition"):n=n||"visible");if(!n||p)this.node?p&&this.changeDynamicContent():this.render();n||!1!==this.trigger("before-show",this,b)||(n="beforeshow");b&&b.stopPropagation&&d.events.show&&(d.events.show[b.type]||d.events.show["*"])&&(d=d.events.show[b.type]||d.events.show["*"],d.process?e=d.process(this,b,"show",n):(d.stopPropagation&&b.stopPropagation(),d.preventDefault&&b.preventDefault(),e=d.returnValue));if(n)return n;ja(this.node);this.visible=!0;f.single&&
a.hideAll(this);this.toggleTitleAttribute(!1);f.delay&&!c?this.showDelay=Y(this.showAfterDelay,this,[b],f.delay):this.showAfterDelay(b,c);return e},showAfterDelay:function(a,b){var c=this,d=c.cfg;c.showDelay=null;if(c.visible){c.trigger("show-after-delay",c,a);d.hide.remove&&c.appendElem();c.reposition(a);if(d.show.preventScroll){var e=d.show.preventScroll,f,p;!0===e&&(e="body");e=B(e);f=-1;for(p=e.length;++f<p;K(e[f],"mousewheel",c.onPreventScrollDelegate)&&K(e[f],"touchmove",c.onPreventScrollDelegate));
}c.overlay.show();d.show.animate&&!b?c.animate("show").done(function(){c.showAfterAnimation(a)}):I(function(){c.showAfterAnimation(a)})}},showAfterAnimation:function(a){var b=this.cfg,c=this.node;this.visible&&(P(c,b.cls.hidden),N(c,b.cls.visible),b.render.keepVisible||(c.style.display=b.show.display||"block"),b.hide.timeout&&(this.hideTimeout=Y(this.hide,this,null,b.hide.timeout)),b.show.focus&&Y(this.setFocus,this,null,20),this.trigger("show",this,a))},hide:function(a,b,c){var d=null,e=null,f=this.cfg;
this.hideTimeout=null;!this.visible&&this.hideDelay&&b&&(window.clearTimeout(this.hideDelay),this.hideDelay=null,this.visible=!0);this.node&&this.visible&&this.isEnabled()||(e=this.node?this.visible?"disabled":"hidden":"noelem");this.showDelay&&!e&&(f.hide.cancelShowDelay||c?(window.clearTimeout(this.showDelay),this.showDelay=null,this.visible=!1,e="cancel"):e="delay");this.frozen&&!e&&(e="frozen");e||!1!==this.trigger("before-hide",this,a)||(e="beforehide");a&&a.stopPropagation&&f.events.hide&&(f.events.hide[a.type]||
f.events.hide["*"])&&(c=f.events.hide[a.type]||f.events.hide["*"],c.process?d=c.process(this,a,"hide",e):(c.stopPropagation&&a.stopPropagation(),c.preventDefault&&a.preventDefault(),d=c.returnValue));if(e)return d;ja(this.node);this.visible=!1;this.toggleTitleAttribute(!0);this.dynamicTarget&&this.resetDynamicTarget();f.hide.delay&&!b?this.hideDelay=Y(this.hideAfterDelay,this,[a],f.hide.delay):this.hideAfterDelay(a,b);return d},hideAfterDelay:function(a,b){var c=this,d=c.cfg;c.hideDelay=null;if(!c.visible){c.trigger("hide-after-delay",
c,a);if(d.show.preventScroll){var e=d.show.preventScroll,f,p;!0===e&&(e="body");e=B(e);f=-1;for(p=e.length;++f<p;T(e[f],"mousewheel",c.onPreventScrollDelegate)&&T(e[f],"touchmove",c.onPreventScrollDelegate));}c.overlay.hide();d.hide.animate&&!b?c.animate("hide").done(function(){c.hideAfterAnimation(a)}):I(function(){c.hideAfterAnimation(a)})}},hideAfterAnimation:function(a){var b=this,c=b.cfg,d=b.node;b.visible||(P(d,c.cls.visible),N(d,c.cls.hidden),c.render.keepVisible||(d.style.display="none"),
b.trigger("hide",b,a),a=c.render.lifetime,null!==a&&(0===a?b.destroyElem():b.destroyDelay=Y(b.destroyElem,b,null,a)),d&&c.hide.destroy&&I(function(){y(d,c.instanceName,null);b.destroy()}),d&&c.hide.remove&&I(function(){b.removeElem()}))},render:function(){var a=this.cfg,b;if(!this.node){var c=a.render,d=a.cls;c.fn&&(b=c.fn.call(this.$$callbackContext,this),c[A(b)?"tpl":"el"]=b);c.el?A(c.el)?(b=B(c.el).shift(),c.keepInDOM=!0):b=c.el:(b=window.document.createElement("div"),b.innerHTML=c.tpl,b=b.firstChild);
b||(b=window.document.createElement("div"));this.node=b;c.id&&b.setAttribute("id",c.id);a.render.keepVisible||(b.style.display="none");N(b,d.dialog);N(b,d.hidden);c.style&&X(b,c.style);this.overlay.render();a.hide.remove?b.parentNode&&b.parentNode.removeChild(b):this.appendElem();c.zIndex&&X(b,{zIndex:c.zIndex});c=a.content;if(!1!==c.value)if(c.value)this.setContent(c.value);else if(c.fn)this.setContent(c.fn.call(this.$$callbackContext,this));else this[a.ajax.url?"loadContent":"readContent"]();this.pointer.render();
this.pointer.append();if(a.buttons)for(var e in a.buttons)if(c=B(a.buttons[e],b).shift())y(c,"metaphorjsTooltip-button-id",e),K(c,"click",this.onButtonClickDelegate),K(c,"keyup",this.onButtonKeyupDelegate);this.bindSelfOnRender&&(this.setHandlers("bind","_self"),this.bindSelfOnRender=!1);this.rendered=!0;this.trigger("render",this)}},setPositionType:function(a){var b=this.getPositionClass(a);this.cfg.position.type=a;this.positionClass==b&&this.position?this.position.type=a:(this.position&&(this.position.$destroy(),
this.position=null),b&&(this.position=sa(b,this)));this.isVisible()&&this.reposition()},getPosition:function(a){var b=this.cfg.position;if(!this.position){!this.positionGetType&&"custom"!=b.type&&E(b.get)&&"m"!=b.type&&(b.type="custom");a=this.positionGetType?this.positionGetType.call(this.$$callbackContext,this,a):b.type;var c=this.getPositionClass(a);b.type=a;if(!1===c)return;this.positionClass!=c?this.position=sa(this.getPositionClass(a),this):this.position.type=a}return this.position},getPositionClass:function(a){return a?
E(a)||"custom"==a?"dialog.position.Custom":(a=a.substr(0,1))?"w"==a?"dialog.position.Window":"m"==a?"dialog.position.Mouse":"dialog.position.Target":!1:!1},reposition:function(a){this.repositioning||(this.repositioning=!0,a&&(a=S(a)),this.getPosition(a),this.trigger("before-reposition",this,a),this.getPosition(a),this.trigger("reposition",this,a),this.repositioning=!1)},getTarget:function(){return this.dynamicTarget?this.dynamicTargetEl:this.target},setTarget:function(a){if(a){var b=!1,c=this.target;
this.target?(this.setHandlers("unbind","_target"),b=!0):this.dynamicTarget&&(b=!0);var d=A(a);d&&"#"!=a.substr(0,1)?(this.dynamicTarget=!0,this.target=null):(d&&(a=B(a).shift()),this.dynamicTarget=!1,this.target=a);b&&(this.setHandlers("bind","_target"),this.trigger("target-change",this,a,c))}},resetDynamicTarget:function(){var a=this.dynamicTargetEl;a&&(this.setHandlers("unbind","_target"),this.trigger("target-change",this,null,a))},isDynamicTargetChanged:function(a){var b=this.cfg.target;a=a.target;
for(var c=this.dynamicTargetEl;a&&!ya(a,b);)a=a.parentNode;return a?!c||c!==a:!1},changeDynamicTarget:function(a){var b=this.cfg.target;a=a.target;for(var c=this.dynamicTargetEl;a&&!ya(a,b);)a=a.parentNode;if(!a||c&&c===a)return!1;c&&this.setHandlers("unbind","_target");this.dynamicTargetEl=a;this.setHandlers("bind","_target");this.trigger("target-change",this,a,c);return!0},getContentElem:function(){var a=this.node;return a?this.cfg.selector.content?B(this.cfg.selector.content,a).shift()||a:a:null},
setContent:function(a,b){b=b||"";var c=this.node,d=this.cfg,e=this.pointer;if(!c)return d.content.value=a,this;d.content.prepare&&(a=d.content.prepare.call(this.$$callbackContext,this,b,a));var f=this.getContentElem(),p=this.rendered&&!d.selector.content&&e,e=p&&e.getElem();if(p&&e)try{c.removeChild(e)}catch(q){}if(A(a))f.innerHTML=a;else for(var s in a){var t=d.selector[s];t&&(t=B(t,f).shift())&&(t.innerHTML=a[s])}if(p&&e)try{c.appendChild(e)}catch(v){}c=B("img",f);this.images=c.length;s=-1;for(d=
c.length;++s<d;K(c[s],"load",this.onImageLoadDelegate));this.trigger("content-change",this,a,b);this.onContentChange()},readContent:function(){var a=this.cfg,b=this.getTarget(),c;b&&(c=a.content.attr?x(b,a.content.attr):x(b,"tooltip")||x(b,"title")||x(b,"alt"));c&&this.setContent(c,"attribute")},loadContent:function(a){var b=this.cfg;N(this.node,b.cls.loading);a=t({},b.ajax,a,!0,!0);this.trigger("before-ajax",this,a);return Na(a).done(this.onAjaxLoad,this)},onAjaxLoad:function(a){P(this.node,this.cfg.cls.loading);
this.setContent(a,"ajax")},onImageLoad:function(){this.images--;this.onContentChange()},onContentChange:function(){this.visible&&this.reposition()},changeDynamicContent:function(){var a=this.cfg;a.content.fn?this.setContent(a.content.fn.call(this.$$callbackContext,this)):a.content.attr&&this.readContent()},toggleTitleAttribute:function(a){var b=this.getTarget(),c;b&&(!1===a?(y(b,"tmp-title",x(b,"title")),b.removeAttribute("title")):(c=y(b,"tmp-title"))&&b.setAttribute("title",c))},getDialogSize:function(){this.rendered||
this.render();var a=this.cfg,b=this.node,c=a.cls.hidden?va(b,a.cls.hidden):!(b&&!(0>=b.offsetWidth||0>=b.offsetHeight)),d=b.style.left;c&&(X(b,{left:"-1000px"}),b.style.display=a.show.display);a={width:Ea(b),height:Fa(b)};c&&(X(b,{left:d}),b.style.display="none");return a},getTargetSize:function(){var a=this.getTarget();return a?{width:Ea(a),height:Fa(a)}:null},setFocus:function(){var a=this.cfg,b=a.show.focus,c=this.node,d;if(!0===b)if(b=B("input",c).concat(B("textarea",c)),0<b.length)b[0].focus();
else{if(a.buttons)for(d in a.buttons){(a=B(a.buttons[d],c).shift())&&a.focus();break}}else(a=B(b,c).shift())&&a.focus()},getScrollEl:function(a){return!0===a||!1===a?window:"string"==typeof a?B(a).shift():a},animate:function(a,b){var c=this.cfg,d=this.node,e,f;e=c[a].animate;E(e)&&(e=e(this,b));f=e.skipDisplayChange||!1;na(e)?e=a:A(e)&&(e=[e]);return G(d,e,function(){if("show"==a&&!f){var b=new v;I(function(){d.style.display=c.show.display||"block";b.resolve()});return b}},!1)},removeElem:function(){var a=
this,b=a.node;a.overlay.remove();b&&b.parentNode&&I(function(){a.visible||b.parentNode.removeChild(b)})},appendElem:function(){var a=window.document.body,a=this.cfg.render.appendTo||a;this.overlay.append();this.node&&a.appendChild(this.node)},destroyElem:function(){var a=this.node;this.setHandlers("unbind","_self");this.bindSelfOnRender=!0;this.pointer.remove();this.overlay.remove();a&&(this.cfg.render.keepInDOM||a.parentNode.removeChild(a),this.node=null);this.trigger("lifetime",this)},destroy:function(){this.trigger("destroy",
this);T(window,"resize",this.onWindowResizeDelegate);T(window,"scroll",this.onWindowScrollDelegate);this.setHandlers("unbind");this.destroyElem();this.overlay&&this.overlay.$destroy();this.pointer&&this.pointer.$destroy();this.position&&this.position.$destroy()}},{defaults:null});return f}();xb.$extend({$class:"dialog.Component",dialog:null,dialogPreset:null,dialogCfg:null,dialogNode:null,hidden:!0,target:null,isTooltip:!1,$init:function(a){this.isTooltip&&(this.target=a.node,a.node=null);this.$super(a)},
initComponent:function(){this.$super();this._createDialog()},_getDialogCfg:function(){return t({},this.dialogCfg,{preset:this.dialogPreset,render:{el:this.dialogNode||this.node,keepInDOM:!0}},!0,!0)},_createDialog:function(){this.dialog=new Oa(this._getDialogCfg());this.dialog.on("show",this.onDialogShow,this);this.dialog.on("hide",this.onDialogHide,this);this.dialog.on("before-show",this.onBeforeDialogShow,this);this.dialog.on("before-hide",this.onBeforeDialogHide,this);this.dialog.on("destroy",
this.onDialogDestroy,this)},onRenderingFinished:function(){this.rendered=!0;this.afterRender();this.trigger("after-render",this)},show:function(){this.dialog.show()},hide:function(){this.dialog.hide()},onBeforeDialogShow:function(){this.rendered||this.render();this.template.setAnimation(!0);this.hidden=!1},onDialogShow:function(){this.onShow();this.trigger("show",this)},onBeforeDialogHide:function(){},onDialogHide:function(){this.template.setAnimation(!1);this.hidden=!0;this.onHide();this.trigger("hide",
this)},onDialogDestroy:function(){this.destroying||(this.dialog=null,this.$destroy())},destroy:function(){this.destroying=!0;this.dialog&&this.dialog.destroy();this.$super()}});s({$class:"validator.Component",node:null,scope:null,validator:null,scopeState:null,fields:null,formName:null,$init:function(a,b,c){this.node=a;this.scope=b;this.scopeState={};this.fields=[];this.validator=this.createValidator();this.formName=x(a,"name")||x(a,"id")||"$form";this.initScope();this.initScopeState();this.initValidatorEvents();
c.once("rendered",this.validator.check,this.validator);c.on("destroy",this.$destroy,this);b.$on("destroy",this.$destroy,this)},createValidator:function(){var a=this.node,b={},c;if(c=O(a).submit)b.callback=b.callback||{},b.callback.submit=function(a,b){return function(){try{return a(b)}catch(c){Z(c)}}}(La(c),this.scope);return new jb(a,b)},initValidatorEvents:function(){var a=this.validator;a.on("field-state-change",this.onFieldStateChange,this);a.on("state-change",this.onFormStateChange,this);a.on("display-state-change",
this.onDisplayStateChange,this);a.on("field-error-change",this.onFieldErrorChange,this);a.on("reset",this.onFormReset,this)},initScope:function(){this.scope[this.formName]=this.scopeState},initScopeState:function(){var a=this.node,b=this.scopeState,c=this.fields,d,e,f;a.elements?d=a.elements:(d=[],Va(a,function(a){Sa(a)&&d.push(a)}));a=-1;for(f=d.length;++a<f;)e=d[a],(e=x(e,"name")||x(e,"id"))&&!b[e]&&(c.push(e),b[e]={$error:null,$invalid:null,$pristine:!0,$errorMessage:null});b.$$validator=this.validator;
b.$invalid=!1;b.$pristine=!0;b.$submit=D(this.validator.onSubmit,this.validator);b.$reset=D(this.validator.reset,this.validator)},onDisplayStateChange:function(a,b){if(b){b=this.scopeState;var c,d,e,f=this.fields;c=0;for(d=f.length;c<d;c++)e=b[f[c]],e.$real&&(b[f[c]]=e.$real);b.$invalid=!a.isValid();b.$pristine=!1;this.scope.$check()}else this.onFormReset(a)},onFieldErrorChange:function(a,b,c){this.onFieldStateChange(a,b,b.isValid())},onFormReset:function(a){a=this.scopeState;var b,c,d,e=this.fields;
b=0;for(c=e.length;b<c;b++)d=a[e[b]],d.$error=null,d.$errorMessage=null,d.$invalid=null,d.$pristine=!0;a.$invalid=!1;a.$pristine=!0;this.scope.$check()},onFormStateChange:function(a,b){var c=this.scopeState;c.$invalid=!1===b&&a.isDisplayStateEnabled();c.$pristine=!1;this.scope.$check()},onFieldStateChange:function(a,b,c){var d=this.scopeState,e=b.getName();a=a.isDisplayStateEnabled();b={$error:b.getErrorRule(),$errorMessage:b.getError(),$invalid:!1===c,$pristine:null===b.getExactValidState()};a?d[e]=
b:d[e].$real=b;this.scope.$check()},destroy:function(){this.destroyed||this.validator.destroy();this.scope&&delete this.scope[this.formName]}});q.registerAttribute("mjs-validate",250,function(a,b,c,d){c=c||"validator.Component";var e=ga(c);e?new e(b,a,d):Z(Error("Class '"+c+"' not found"))});return ia});
