(function(){window.MetaphorJs={lib:{}};var ba=Array.prototype.slice,ta=function(r){return"function"===typeof r};(function(){var r="undefined"!=typeof window?window:global,b={};MetaphorJs.ns={register:function(c,a){var d;d=c.split(".");var e,g=d.pop();e=d.join(".");var f=d.length,l,h=r;if(b[e])d=[b[e],g];else{for(e=0;e<f;e++)l=d[e],h[l]||(h[l]={}),h=h[l];d=[h,g]}d[0][d[1]]=a;return b[c]=a},exists:function(c){return b[c]?!0:!1},get:function(c,a){if(b[c]||a)return b[c];var d=c.split("."),e,g=d.length,
f,l=r;for(e=0;e<g;e++){f=d[e];if(!l[f])return null;l=l[f]}l&&(b[c]=l);return l},add:function(c,a){return b[c]=a},remove:function(c){delete b[c]}}})();(function(){var r=r||MetaphorJs.ns,b=function(a,b){return d(function(){},a,b)},c=function(a,d,b){return function(){var c=void 0,e=this.supr;this.supr=a.prototype[d]||function(){};try{c=b.apply(this,arguments)}catch(I){}this.supr=e;return c}},a=function(a,d,b){for(var e in d)d.hasOwnProperty(e)&&(a[e]=ta(d[e])&&b.prototype&&ta(b.prototype[e])?c(b,e,d[e]):
d[e])},d=function(d,b,c){var e=function(){};e.prototype=d.prototype;e=new e;c=c||function(){this.initialize&&this.initialize.apply(this,arguments)};a(e,b,d);c.prototype=e;c.prototype.constructor=c;c.prototype.getClass=function(){return this.__proto__.constructor.__class};c.prototype.getParentClass=function(){return this.__proto__.constructor.__parentClass};c.__instantiate=function(a){return function(){var d=function(){},b;d.prototype=a.prototype;d=new d;b=a.prototype.constructor.apply(d,arguments);
return"object"==typeof b?b:d}}(c);return c},e=function(a,c,e,h,q,I){null===a&&(a="");"function"==typeof a?(q=e,"string"==typeof c?(q=h,h=e):(h=c,e=a,c=null),a=null):"string"!=typeof a&&(q=c,h=a,a=e=c=null);"string"!=typeof c&&"function"!=typeof c&&(q=h,h=e,e=c,c=null);"function"!=typeof e&&(q=h,h=e,e=null);h=h||{};var z=c&&"string"==typeof c?r.get(c):c;if(c&&!z)throw Error(c+" not found");c=z?d(z,h,e):b(h,e);c.__isMetaphorClass=!0;c.__parent=z;c.__parentClass=z?z.__class:null;c.__class=a;if(q)for(var C in q)q.hasOwnProperty(C)&&
(c[C]=q[C]);a&&(I?r.add(a,c):r.register(a,c));q&&q.alias&&r.add(q.alias,c);return c};MetaphorJs.define=e;MetaphorJs.defineCache=function(a,d,b,c,q){return e(a,d,b,c,q,!0)};MetaphorJs.factory=function(a){var d=r.get(a),b=ba.call(arguments,1);if(!d)throw Error(a+" not found");return d.__instantiate.apply(this,b)};MetaphorJs.isInstanceOf=function(a,d){var b="string"==typeof d?r.get(d):d;return b?a instanceof b:!1};MetaphorJs.isSubclassOf=function(a,d){var b=a,c=r.get;"string"!=typeof d&&(d=d.getClass?
d.getClass():d.prototype.constructor.__class);for("string"==typeof a&&(b=c(a));b;){if(b.prototype.constructor.__class==d)return!0;b&&(b=b.getParentClass?c(b.getParentClass()):b.__parent)}return!1}})();var L=MetaphorJs.define,v=MetaphorJs.bind=Function.prototype.bind?function(r,b){return r.bind(b)}:function(r,b){return function(){return r.apply(b,arguments)}},ua=MetaphorJs.isPlainObject=function(r){return!(!r||r.constructor!==Object)},r=MetaphorJs.extend=function b(){var c=!1,a=!1,d=ba.call(arguments),
e=d.shift(),g,f,l;"boolean"==typeof d[d.length-1]&&(c=d.pop());"boolean"==typeof d[d.length-1]&&(a=c,c=d.pop());for(;d.length;)if(g=d.shift())for(f in g)if(g.hasOwnProperty(f)&&"undefined"!=typeof(l=g[f]))if(a)if(e[f]&&ua(e[f])&&ua(l))b(e[f],l,c,a);else{if(!0===c||"undefined"==typeof e[f]||null===e[f])ua(l)?(e[f]={},b(e[f],l,c,!0)):e[f]=l}else if(!0===c||"undefined"==typeof e[f]||null===e[f])e[f]=l;return e},B=MetaphorJs.emptyFn=function(){},ja=MetaphorJs.toFragment=function(b){var c=document.createDocumentFragment();
if("string"==typeof b){var a=document.createElement("div");a.innerHTML=b;b=a.childNodes}if(b.nodeType)c.appendChild(b);else for(var a=-1,d=b.length>>>0;++a!==d;c.appendChild(b[0]));return c},ia=MetaphorJs.nextUid=function(){var b=["0","0","0"];return function(){for(var c=b.length,a;c;){c--;a=b[c].charCodeAt(0);if(57==a)return b[c]="A",b.join("");if(90==a)b[c]="0";else return b[c]=String.fromCharCode(a+1),b.join("")}b.unshift("0");return b.join("")}}(),H=MetaphorJs.data=function(){var b={};return function(c,
a,d){c=c._mjsId||(c._mjsId=ia());var e=b[c];return"undefined"!=typeof d?(e||(e=b[c]={}),e[a]=d):e?e[a]:void 0}}(),Ba=function(){var b={};return function(c){return b[c]||(b[c]=new RegExp(c))}}(),qa=MetaphorJs.hasClass=function(b,c){return c?Ba("(?:^|\\s)"+c+"(?!\\S)").test(b.className):!1},M=MetaphorJs.addClass=function(b,c){c&&!qa(b,c)&&(b.className+=" "+c)},R=MetaphorJs.removeClass=function(b,c){c&&(b.className=b.className.replace(Ba("(?:^|\\s)"+c+"(?!\\S)"),""))},ea=MetaphorJs.ns.get,Ca=Object.prototype.toString,
G=MetaphorJs.isArray=function(b){return!(!b||"object"!=typeof b||"number"!=typeof b.length||"[object Array]"!=Ca.call(b))},va=MetaphorJs.clone=function(b){var c,a,d;if(G(b)){d=[];c=0;for(a=b.length;c<a;c++)d.push(va(b[c]));return d}if(b)switch(b.nodeType){case 1:return b.cloneNode(!0);case 3:return document.createTextNode(b.innerText||b.textContent);case 11:return b.cloneNode(!0)}return null},Qa=function(){var b=["Moz","Webkit","ms","O","Khtml"],c="animationDelay",a="animationDuration",d="transitionDelay",
e="transitionDuration",g=null;(function(){var g=document.createElement("div"),l=!1,h,q,I;if(void 0!==g.style.animationName)l=!0;else for(q=0,I=b.length;q<I;q++)if(h=b[q],void 0!==g.style[h+"AnimationName"]){l=!0;c=h+"AnimationDelay";a=h+"AnimationDuration";d=h+"TransitionDelay";e=h+"TransitionDuration";break}return l})()&&(g={animationDelay:c,animationDuration:a,transitionDelay:d,transitionDuration:e});return function(){return g}}(),hb=MetaphorJs.getAnimationDuration=function(){var b=function(a){if(!a)return 0;
var d=parseFloat(a);-1==a.indexOf("ms")&&(d*=1E3);return d},c=function(a,d,c){var e,g,f=d.length;for(e=0;e<f;e++)g=b(d[e])+b(c[e]),a=Math.max(g,a);return a},a=Qa(),d=a?a.animationDuration:null,e=a?a.animationDelay:null,g=a?a.transitionDuration:null,f=a?a.transitionDelay:null;return function(b){if(!a)return 0;var h=window.getComputedStyle?window.getComputedStyle(b,null):b.style;b=0;var q=(h[d]||"").split(","),I=(h[e]||"").split(","),z=(h[g]||"").split(","),h=(h[f]||"").split(",");b=Math.max(b,c(b,
q,I));return b=Math.max(b,c(b,z,h))}}(),ca=MetaphorJs.isThenable=function(b){var c;return!b||"object"!=typeof b&&"function"!=typeof b?!1:"function"==typeof(c=b.then)?c:!1};(function(){var b=[],c=!1,a="undefined"!=typeof process?process.nextTick:function(a){setTimeout(a,0)},d=function(){c=!0;var e=b.shift();a(function(){e[0].apply(e[1],e[2]);b.length?d():c=!1},0)},e=function(a,e,g){g=g||[];b.push([a,e,g]);c||d()},g=function(a,d){return function(b){try{d.resolve(a(b))}catch(c){d.reject(c)}}},f=function(a,
d){if(a instanceof f)return a;if(!(this instanceof f))return new f(a,d);this._fulfills=[];this._rejects=[];this._dones=[];this._fails=[];if("undefined"!=typeof a)if(ca(a)||"function"!=typeof a)this.resolve(a);else try{a.call(d,v(this.resolve,this),v(this.reject,this))}catch(b){this.reject(b)}};f.prototype={_state:0,_fulfills:null,_rejects:null,_dones:null,_fails:null,_wait:0,_value:null,_reason:null,_triggered:!1,isPending:function(){return 0==this._state},isFulfilled:function(){return 1==this._state},
isRejected:function(){return 2==this._state},_cleanup:function(){delete this._fulfills;delete this._rejects;delete this._dones;delete this._fails},_processValue:function(a,d){var b;if(0==this._state)if(a===this)this._doReject(new TypeError("cannot resolve promise with itself"));else{try{if(b=ca(a)){a instanceof f?a.then(v(this._processResolveValue,this),v(this._processRejectReason,this)):(new f(b,a)).then(v(this._processResolveValue,this),v(this._processRejectReason,this));return}}catch(c){0==this._state&&
this._doReject(c);return}d.call(this,a)}},_callResolveHandlers:function(){this._done();for(var a=this._fulfills,d;d=a.shift();)e(d[0],d[1],[this._value]);this._cleanup()},_doResolve:function(a){this._value=a;this._state=1;0==this._wait&&this._callResolveHandlers()},_processResolveValue:function(a){this._processValue(a,this._doResolve)},resolve:function(a){if(this._triggered)return this;this._triggered=!0;this._processResolveValue(a);return this},_callRejectHandlers:function(){this._fail();for(var a=
this._rejects,d;d=a.shift();)e(d[0],d[1],[this._reason]);this._cleanup()},_doReject:function(a){this._state=2;this._reason=a;0==this._wait&&this._callRejectHandlers()},_processRejectReason:function(a){this._processValue(a,this._doReject)},reject:function(a){if(this._triggered)return this;this._triggered=!0;this._processRejectReason(a);return this},then:function(a,d){var b=new f,c=this._state;0==c||0!=this._wait?(a&&"function"==typeof a?this._fulfills.push([g(a,b),null]):this._fulfills.push([b.resolve,
b]),d&&"function"==typeof d?this._rejects.push([g(d,b),null]):this._rejects.push([b.reject,b])):1==c?a&&"function"==typeof a?e(g(a,b),null,[this._value]):b.resolve(this._value):2==c&&(d&&"function"==typeof d?e(g(d,b),null,[this._reason]):b.reject(this._reason));return b},"catch":function(a){return this.then(null,a)},_done:function(){for(var a=this._dones,d;d=a.shift();)d[0].call(d[1]||null,this._value)},done:function(a,d){var b=this._state;1==b&&0==this._wait?a.call(d||null,this._value):0==b&&this._dones.push([a,
d]);return this},_fail:function(){for(var a=this._fails,d;d=a.shift();)d[0].call(d[1]||null,this._reason)},fail:function(a,d){var b=this._state;2==b&&0==this._wait?a.call(d||null,this._reason):0==b&&this._fails.push([a,d]);return this},always:function(a,d){this.done(a,d);this.fail(a,d);return this},promise:function(){return{then:v(this.then,this),done:v(this.done,this),fail:v(this.fail,this),always:v(this.always,this)}},after:function(a){var d=this;if(ca(a)){d._wait++;var b=function(){d._wait--;0==
d._wait&&0!=d._state&&(1==d._state?d._callResolveHandlers():d._callRejectHandlers())};"function"==typeof a.done?a.done(b):a.then(b)}return d}};f.resolve=function(a){return new f(a)};f.reject=function(a){var d=new f;d.reject(a);return d};f.all=function(a){if(!a.length)return f.resolve(null);var d=new f,b=a.length,c=Array(b),e=b,g,w,k=function(a,b){c[b]=a;e--;0==e&&d.resolve(c)};for(g=0;g<b;g++)(function(b){w=a[g];w instanceof f?w.done(function(a){k(a,b)}).fail(d.reject,d):ca(w)||"function"==typeof w?
(new f(w)).done(function(a){k(a,b)}).fail(d.reject,d):k(w,b)})(g);return d};f.when=function(){return f.all(arguments)};f.allResolved=function(a){if(!a.length)return f.resolve(null);var d=new f,b=a.length,c=[],e=b,g,w,k=function(a){c.push(a);p()},p=function(){e--;0==e&&d.resolve(c)};for(g=0;g<b;g++)w=a[g],w instanceof f?w.done(k).fail(p):ca(w)||"function"==typeof w?(new f(w)).done(k).fail(p):k(w);return d};f.race=function(a){if(!a.length)return f.resolve(null);var d=new f,b=a.length,c,e;for(c=0;c<
b&&(e=a[c],e instanceof f?e.done(d.resolve,d).fail(d.reject,d):ca(e)||"function"==typeof e?(new f(e)).done(d.resolve,d).fail(d.reject,d):d.resolve(e),d.isPending());c++);return d};MetaphorJs.lib.Promise=f})();var P=MetaphorJs.lib.Promise,Y=MetaphorJs.animate=function(){var b={show:["mjs-show"],hide:["mjs-hide"],enter:["mjs-enter"],leave:["mjs-leave"],move:["mjs-move"]},c=0,a=!!Qa(),d=window.requestAnimationFrame?window.requestAnimationFrame:function(a){window.setTimeout(a,0)},e=function(a,b,c){var e=
function(){(new Date).getTime()-b>=c?a():d(e)};d(e)},g=function h(a,b,c,f,w,k,p){var u=function(){var d=H(a,"mjsAnimationQueue");return d&&d.length&&d[0].id==p?!1:(w.reject(a),!0)},x=function(){if(!u()){var d=c;c++;if(c==b.length){w.resolve(a);H(a,"mjsAnimationQueue").shift();var e=H(a,"mjsAnimationQueue");e.length?(e=e[0],g(e.el,e.stages,0,e.start,e.deferred,!1,e.id)):H(a,"mjsAnimationQueue",null)}else H(a,"mjsAnimationQueue")[0].position=c,h(a,b,c,null,w);R(a,b[d]);R(a,b[d]+"-active")}},A=function(){if(!u()){M(a,
b[c]+"-active");var d=hb(a);d?e(x,(new Date).getTime(),d):x()}},n=function(){if(!u()){M(a,b[c]);var e;f&&(e=f(a),f=null);ca(e)?e.done(A):d(A)}};k?d(n):n()},f=function(d,e,f,z){var C=new P,w=H(d,"mjsAnimationQueue")||[],k=++c,p=d.getAttribute("mjs-animate"),u,x,A,n,V,F,D;e=e||p;z&&null===p&&(e=null);if(e){"string"==typeof e?"["==e.substr(0,1)?u=(new Function("","return "+e))():(u=b[e],e=ea&&ea("animate."+e,!0)):"function"==typeof e?x=e:G(e)&&("string"==typeof e[0]?u=e:(A=e[0],n=e[1]));e&&e.constructor===
Object&&(u=e.stages,x=e.fn,A=e.before,n=e.after,V=e.options?r({},e.options):{},F=e.context||null,D=e.duration||null,f=f||V.start);if(a&&u)return w.push({el:d,stages:u,start:f,deferred:C,position:0,id:k}),H(d,"mjsAnimationQueue",w),1==w.length&&g(d,u,0,f,C,!0,k),C;V=V||{};f&&(V.start=function(){f(d)});V.complete=function(){C.resolve(d)};D&&(V.duration=D);if(x&&"function"==typeof x)return A&&r(d.style,A,!0,!1),f&&f(d),H(d,"mjsAnimationQueue",x.call(F,d,function(){C.resolve(d)})),C;if(window.jQuery){e=
$(d);A&&e.css(A);H(d,"mjsAnimationQueue","stop");if(x&&"string"==typeof x)return e[x](V),C;if(n)return e.animate(n,V),C}}f?(x=f(d),ca(x)?x.done(function(){C.resolve(d)}):C.resolve(d)):C.resolve(d);return C};f.addAnimationType=function(a,d){b[a]=d};return f}(),O=MetaphorJs.trim=function(){return String.prototype.trim?function(b){return"string"==typeof b?b.trim():b}:function(b){return"string"==typeof b?b.replace(/^\s\s*/,"").replace(/\s\s*$/,""):b}}(),Da=function(b){return"[object Date]"===Ca.call(b)},
Ea=function(b){return"[object RegExp]"===Ca.call(b)},Fa=function(b){return b&&b.document&&b.location&&b.alert&&b.setInterval},Ra=MetaphorJs.async=function(b,c,a){setTimeout(function(){b.apply(c,a||[])},0)};(function(){var b=function(){this.events={}};b.prototype={createEvent:function(a,b){a=a.toLowerCase();var g=this.events;g[a]||(g[a]=new c(a,b));return g[a]},getEvent:function(a){a=a.toLowerCase();return this.events[a]},on:function(a,b,g,f){a=a.toLowerCase();var l=this.events;l[a]||(l[a]=new c(a));
return l[a].on(b,g,f)},once:function(a,b,c,f){f=f||{};f.limit=1;return this.on(a,b,c,f)},un:function(a,b,c){a=a.toLowerCase();var f=this.events;f[a]&&f[a].un(b,c)},hasListener:function(a,b,c){a=a.toLowerCase();var f=this.events;return f[a]?f[a].hasListener(b,c):!1},removeAllListeners:function(a){var b=this.events;b[a]&&b[a].removeAllListeners()},triggerAsync:function(){var a=arguments[0],b=this.events,a=a.toLowerCase();if(!b[a])return[];a=b[a];return a.triggerAsync.apply(a,ba.call(arguments,1))},
trigger:function(){var a=arguments[0],b=this.events,a=a.toLowerCase();if(!b[a])return null;a=b[a];return a.trigger.apply(a,ba.call(arguments,1))},suspendEvent:function(a){a=a.toLowerCase();var b=this.events;b[a]&&b[a].suspend()},suspendAllEvents:function(){var a=this.events,b;for(b in a)a[b].suspend()},resumeEvent:function(a){a=a.toLowerCase();var b=this.events;b[a]&&b[a].resume()},resumeAllEvents:function(){var a=this.events,b;for(b in a)a[b].resume()},destroyEvent:function(a){var b=this.events;
b[a]&&(b[a].removeAllListeners(),b[a].destroy(),delete b[a])},destroy:function(a){var b=this.events;if(a)a=a.toLowerCase(),b[a]&&(b[a].destroy(),delete b[a]);else{for(var c in b)b[c].destroy();this.events={}}},getApi:function(){if(!this.api){for(var a="createEvent getEvent on un once hasListener removeAllListeners triggerAsync trigger suspendEvent suspendAllEvents resumeEvent resumeAllEvents destroyEvent".split(" "),b={},c,f=-1,l=a.length;++f<l;c=a[f],b[c]=v(this[c],this));this.api=b}return this.api}};
var c=function(a,b){this.name=a;this.listeners=[];this.map={};this.hash=ia();this.uni="$$"+a+"_"+this.hash;this.suspended=!1;this.lid=0;this.returnResult=b||!1};c.prototype={getName:function(){return this.name},destroy:function(){this.map=this.listeners=null},on:function(a,b,c){if(!a)return null;b=b||null;c=c||{};var f=this.uni,l=b||a;if(l[f]&&!c.allowDupes)return null;var h=++this.lid,q=c.first||!1;l[f]=h;a={fn:a,scope:b,uniScope:l,id:h,called:0,limit:c.limit||0,start:c.start||1,count:0,append:c.append,
prepend:c.prepend};q?this.listeners.unshift(a):this.listeners.push(a);this.map[h]=a;return h},once:function(a,b,c){c=c||{};c.once=!0;return this.on(a,b,c)},un:function(a,b){var c=-1,f=this.uni,l=this.listeners,h;h=a==parseInt(a)?a:(b||a)[f];if(!h)return!1;for(var q=0,I=l.length;q<I;q++)if(l[q].id==h){c=q;delete l[q].uniScope[f];break}if(-1==c)return!1;l.splice(c,1);delete this.map[h];return!0},hasListener:function(a,b){var c=this.listeners,f;if(a){f="function"!=typeof a?a:(b||a)[this.uni];if(!f)return!1;
for(var l=0,h=c.length;l<h;l++)if(c[l].id==f)return!0;return!1}return 0<c.length},removeAllListeners:function(){var a=this.listeners,b=this.uni,c,f;c=0;for(f=a.length;c<f;c++)delete a[c].uniScope[b];this.listeners=[];this.map={}},suspend:function(){this.suspended=!0},resume:function(){this.suspended=!1},_prepareArgs:function(a,b){var c;a.append||a.prepend?(c=ba.call(b),a.prepend&&(c=a.prepend.concat(c)),a.append&&(c=c.concat(a.append))):c=b;return c},triggerAsync:function(){if("undefined"==typeof P)throw Error("Promises are not defined");
var a=this,b=a.listeners,c=a.returnResult,f=ba.call(arguments),l=[],h=[],q,I,z;if(a.suspended||0==b.length)return P.resolve(null);I=0;for(z=b.length;I<z;I++)l.push(b[I]);for(I=function(b){q=a._prepareArgs(b,f);return new P(function(c,e){Ra(function(){try{c(b.fn.apply(b.scope,q))}catch(g){e(g)}b.called++;b.called==b.limit&&a.un(b.id)},0)})};(b=l.shift())&&(!b||!a.map[b.id]||(b.count++,b.count<b.start||(h.push(I(b)),"first"!=c))););return"last"==c?[h.pop()]:h},trigger:function(){var a=this.listeners,
b=this.returnResult;if(this.suspended||0==a.length)return null;for(var c="all"==b?[]:null,f,l,a="first"==b?[a[0]]:ba.call(a);f=a.shift();)if(f&&this.map[f.id]&&(f.count++,!(f.count<f.start))){l=f.fn.apply(f.scope,this._prepareArgs(f,arguments));f.called++;f.called==f.limit&&this.un(f.id);"all"==b&&c.push(l);if("first"==b)return l;"last"==b&&(c=l);if(!1==b&&!1===l)break}if(b)return c}};var a=new b;r(MetaphorJs,a.getApi(),!0,!1);MetaphorJs.lib.Observable=b})();var da=MetaphorJs.lib.Observable;(function(){var b=
/(^|[^a-z0-9_$])(\.)([^0-9])/ig,c=function(a){if("string"!=typeof a)return!0;var b=a.substr(0,1),d=a.length-1;return'"'!=b&&"'"!=b||a.indexOf(b,1)!=d?!1:a.substring(1,d)},a=function(b,d){if(Fa(b))throw Error("Cannot copy window object");if(d){if(b===d)throw Error("Objects are identical");if(G(b))for(var c=d.length=0;c<b.length;c++)d.push(a(b[c]));else{for(c in d)delete d[c];for(c in b)d[c]=a(b[c])}}else(d=b)&&(G(b)?d=a(b,[]):Da(b)?d=new Date(b.getTime()):Ea(b)?d=new RegExp(b.source):null!=b&&"object"===
typeof b&&(d=a(b,{})));return d},d=function(a,b){if(a===b)return!0;if(null===a||null===b)return!1;if(a!==a&&b!==b)return!0;var c=typeof a,e;if(c==typeof b&&"object"==c)if(G(a)){if(!G(b))return!1;if((c=a.length)==b.length){for(e=0;e<c;e++)if(!d(a[e],b[e]))return!1;return!0}}else{if(Da(a))return Da(b)&&a.getTime()==b.getTime();if(Ea(a)&&Ea(b))return a.toString()==b.toString();if(Fa(a)||Fa(b)||G(b))return!1;c={};for(e in a)if(("$"!==e.charAt(0)||"object"!=typeof a[e])&&!ta(a[e])){if(!d(a[e],b[e]))return!1;
c[e]=!0}for(e in b)if(!c.hasOwnProperty(e)&&"$"!==e.charAt(0)&&void 0!==b[e]&&!ta(b[e]))return!1;return!0}return!1},e=function(a,b){var c=a.length,e=b.length,k=Array(c+1),g=Array(c+1),f,p,F,u,h=0;if(c==e&&0==c)return{changes:0,distance:0,prescription:[]};for(f=0;f<=c;f++)k[f]=Array(e+1),g[f]=Array(e+1),k[f][0]=f,g[f][0]="D";for(f=0;f<=e;f++)k[0][f]=f,g[0][f]="I";for(f=1;f<=c;f++)for(p=1;p<=e;p++)F=d(a[f-1],b[p-1])?0:1,k[f][p-1]<k[f-1][p]&&k[f][p-1]<k[f-1][p-1]+F?(k[f][p]=k[f][p-1]+1,g[f][p]="I"):
k[f-1][p]<k[f-1][p-1]+F?(k[f][p]=k[f-1][p]+1,g[f][p]="D"):(k[f][p]=k[f-1][p-1]+F,g[f][p]=1==F?"R":"-");u=[];f=c;p=e;do F=g[f][p],u.push(F),"-"!=F&&h++,"R"==F||"-"==F?(f--,p--):"D"==F?f--:p--;while(0!=f||0!=p);return{changes:h/u.length,distance:k[c][e],prescription:u.reverse()}},g,f=function(a,b,d,e,f){g||(g=new da);var p=ia(),F;this.origCode=b;G(a)&&null===b?F="array":("string"!=typeof b&&(e=d,d=b,b=null,F="object"),"string"==typeof a&&(e=d,d=b,b=a,a=null),b&&a&&(F=a.hasOwnProperty(b)?"attr":"expr"),
b&&!a&&(F="expr"));if(d)g.on(p,d,e||this,{append:[f],allowDupes:!0});if("expr"==F){b=this._processInputPipes(b,a);b=this._processPipes(b,a);if(this.inputPipes||this.pipes)b=h(a,b),F=a.hasOwnProperty(b)?"attr":"expr";if(this.staticValue=c(b))F="static"}this.userData=f;this.code=b;this.id=p;this.type=F;this.obj=a;"expr"==F&&(this.getterFn=k(b));this.curr=this._getValue()};f.prototype={staticValue:null,origCode:null,code:null,getterFn:null,setterFn:null,id:null,type:null,obj:null,itv:null,curr:null,
pipes:null,inputPipes:null,lastSetValue:null,userData:null,_processInputPipes:function(a,b){if(-1==a.indexOf(">>"))return a;for(var d=0,c=a.length,e=[],k,g,f,p=a;d<c&&-1!=(k=a.indexOf(">>",d));)g=a.charAt(k-1),f=a.charAt(k+2),"\\"!=g&&"'"!=g&&'"'!=g&&"'"!=f&&'"'!=f&&(d=O(a.substring(d,k)).split(":"),p=a.substr(k+2),this._addPipe(e,d,b,this.onInputParamChange)),d=k+2;e.length&&(this.inputPipes=e);return O(p)},_addPipe:function(a,b,d,c){var e=b.shift(),k=null,g=[],f;ea&&(k=ea("filter."+e,!0));k||(k=
window[e]||d[e]);if("function"==typeof k){e=-1;for(f=b.length;++e<f;g.push(l(d,b[e],c,this)));a.push([k,b,g])}},_processPipes:function(a,b){if(-1==a.indexOf("|"))return a;for(var d=0,c=a.length,e=[],k,g,f,p=!1,F=a;d<c;)if(-1!=(k=a.indexOf("|",d)))g=a.charAt(k-1),f=a.charAt(k+1),"|"!=g&&"'"!=g&&'"'!=g&&"|"!=f&&"'"!=f&&'"'!=f&&(p?(d=O(a.substring(d,k)).split(":"),this._addPipe(e,d,b)):(p=!0,F=O(a.substring(0,k)))),d=k+1;else{p&&(d=O(a.substr(d)).split(":"),this._addPipe(e,d,b,this.onPipeParamChange));
break}e.length&&(this.pipes=e);return F},_checkCode:function(){var a=this._getValue(),b=!1,d=this.curr;if(G(d)&&G(a))return b=e(d,a),b.changes?(this.curr=a.slice(),g.trigger(this.id,b,a,d),!0):!1;a!==d&&(this.curr=a,g.trigger(this.id,a,d),b=!0);return b},_checkObject:function(){var b=this.obj,c=this.curr;return d(c,b)?!1:(this.curr=a(b),g.trigger(this.id,b,c),!0)},_checkArray:function(){var a=this.curr,b=this.obj,d=e(a,b);return d.changes?(this.curr=b.slice(),g.trigger(this.id,d,b,a),!0):!1},_getValue:function(){var b;
switch(this.type){case "static":b=this.staticValue;break;case "attr":b=this.obj[this.code];break;case "expr":b=this.getterFn(this.obj);"undefined"==typeof b&&(b="");break;case "object":b=a(this.obj);break;case "array":b=this.obj}G(b)&&(b=b.slice());return b=this._runThroughPipes(b,this.pipes)},_runThroughPipes:function(a,b){if(b){var d,c,e,k=b.length,g=this.obj,f,p;for(d=0;d<k;d++){e=b[d][1];c=[];f=-1;for(p=e.length;++f<p;c.push(V(e[f],g)));c.unshift(g);c.unshift(a);a=b[d][0].apply(null,c)}}return a},
subscribe:function(a,b,d){g.on(this.id,a,b,d)},unsubscribe:function(a,b){return g.un(this.id,a,b)},hasPipes:function(){return null!==this.pipes},hasInputPipes:function(){return null!=this.inputPipes},getValue:function(){return this._getValue()},setValue:function(a){var b=this.type;this.lastSetValue=a;a=this._runThroughPipes(a,this.inputPipes);if("attr"==b)this.obj[this.code]=a;else if("expr"==b)this.setterFn||(this.setterFn=x(this.code)),this.setterFn(this.obj,a);else if("array"==b)this.obj=a;else throw"Cannot set value";
},onInputParamChange:function(){this.setValue(this.lastSetValue)},onPipeParamChange:function(){this.check()},check:function(){switch(this.type){case "expr":case "attr":case "static":return this._checkCode();case "object":return this._checkObject();case "array":return this._checkArray()}return!1},checkAll:function(){return this.obj.$$watchers.$checkAll()},getLastResult:function(){return this.curr},setInterval:function(a){var b=this;b.itv&&b.clearInterval();b.itv=setInterval(function(){b.check()},a)},
clearInterval:function(){this.itv&&(clearInterval(this.itv),this.itv=null)},unsubscribeAndDestroy:function(a,b){var d=this.id;g.un(d,a,b);return g.hasListener(d)?!1:(this.destroy(),!0)},destroy:function(){var a=this.pipes,b=this.inputPipes,d,c,e,k,f;this.itv&&this.clearInterval();if(a)for(d=-1,c=a.length;++d<c;)for(f=a[d][2],e=-1,k=f.length;++e<k;)f[e].unsubscribeAndDestroy(this.check,this);if(b)for(d=-1,c=b.length;++d<c;)for(f=b[d][2],e=-1,k=f.length;++e<k;)f[e].unsubscribeAndDestroy(this.onInputParamChange,
this);this.obj&&delete this.obj.$$watchers[this.origCode];delete this.id;delete this.curr;delete this.obj;delete this.pipes;delete this.inputPipes;delete this.origCode;delete this.code;delete this.getterFn;delete this.setterFn;delete this.lastSetValue;delete this.staticValue;delete this.userData;g.destroyEvent(this.id)}};var l=function(a,b,d,c,e){b=h(a,O(b));return a?(a.$$watchers||(a.$$watchers={$checkAll:function(){var a,b=0;for(a in this)"$"!=a.charAt(0)&&this[a].check()?b++:"$"==a.charAt(0)&&
this[a]instanceof f&&this[a].check()&&b++;return b},$destroyAll:function(){for(var a in this)if("$"!=a.charAt(0)||this[a]instanceof f)this[a].destroy(),delete this[a]}}),a.$$watchers[b]?a.$$watchers[b].subscribe(d,c,{append:[e],allowDupes:!0}):a.$$watchers[b]=new f(a,b,d,c,e),a.$$watchers[b]):new f(a,b,d,c,e)},h=function(a,b){if(a&&b){if(a.hasOwnProperty(b))return b;var d;if("."==b.charAt(0)&&(d=b.substr(1),a.hasOwnProperty(d)))return d}return b},q=Function,I=function(a,b,d,c){for(;d&&!d.$isRoot;)if(d=
d.$parent)try{return 4==arguments.length?b.call(null,d,c,B,b):b.call(null,d,B,b)}catch(e){}},z=function(a){return function(){var b=ba.call(arguments);b.push(I);b.push(a);b=a.apply(null,b);return void 0==b||!b&&"number"==typeof b&&isNaN(b)?(b=ba.call(arguments),b.unshift(a),b.unshift(null),I.apply(null,b)):b}},C={},w=0,k=function(a){try{return C[a]?C[a]:(w++,C[a]=z(new q("____","$$interceptor","$$itself","".concat("try {","return ",a.replace(b,"$1____.$3"),";} catch (thrownError) { return $$interceptor(thrownError, $$itself, ____); }"))))}catch(d){return B}},
p={},u=0,x=function(a){try{if(!p[a]){u++;var d=a.replace(b,"$1____.$3");return p[a]=z(new q("____","$$$$","$$interceptor","$$itself","".concat("try {",d," = $$$$",";} catch (thrownError) { return $$interceptor(thrownError, $$itself, ____, $$$$); }")))}return p[a]}catch(c){return B}},A={},n=0,V=function(a,b){var d;return(d=c(a))?d:k(a)(b)},F=function(){1E3<=w&&(C={});1E3<=u&&(p={});1E3<=n&&(A={})};f.create=l;f.unsubscribeAndDestroy=function(a,b,d,c){b=O(b);(a=a.$$watchers)&&a[b]&&a[b].unsubscribeAndDestroy(d,
c)&&delete a[b]};f.normalizeExpr=h;f.prepareCode=function(a){return a.replace(b,"$1____.$3")};f.createGetter=k;f.createSetter=x;f.createFunc=function(a){try{return A[a]?A[a]:(n++,A[a]=z(new q("____","$$interceptor","$$itself","".concat("try {",a.replace(b,"$1____.$3"),";} catch (thrownError) { return $$interceptor(thrownError, $$itself, ____); }"))))}catch(d){return B}};f.eval=V;f.enableResetCacheInterval=function(){setTimeout(F,1E4)};MetaphorJs.lib.Watchable=f})();var ka=MetaphorJs.createWatchable=
MetaphorJs.lib.Watchable.create,Ga=MetaphorJs.ns.register,Z=MetaphorJs.toArray=function(b){if(b&&void 0!=b.length&&"string"!=typeof b){for(var c=[],a=-1,d=b.length>>>0;++a!==d;c[a]=b[a]);return c}return b?[b]:[]},U=MetaphorJs.ns.add,N,Ta,Ha;(function(){var b=[],c=[],a=!1,d=!1,e=function(a,b){return a.priority<b.priority?-1:a.priority>b.priority?1:0};MetaphorJs.registerAttributeHandler=N=function(d,c,e){ea("attr."+d,!0)||(b.push({priority:c,name:d,handler:U("attr."+d,e)}),a=!1)};MetaphorJs.getAttributeHandlers=
Ta=function(){a||(b.sort(e),a=!0);return b};MetaphorJs.registerTagHandler=Ha=function(a,b,e){ea("tag."+a,!0)||(c.push({priority:b,name:a,handler:U("tag."+a,e)}),d=!1)};MetaphorJs.getTagHandlers=function(){d||(c.sort(e),d=!0);return c}})();var Q=MetaphorJs.select=function(){var b=/^[\w[:#.][\w\]*^|=!]*$/,c=/=([^\]]+)/,a=/ *, */,d=/(\([^)]*)\+/,e=/(\[[^\]]+)~/,g=/(~|>|\+)/,f=/ +/,l=/([^[:.#]+)?(?:#([^[:.#]+))?(?:\.([^[:.]+))?(?:\[([^!&^*|$[:=]+)([!$^*|&]?=)?([^:\]]+)?\])?(?::([^(]+)(?:\(([^)]+)\))?)?/,
h=/(?:(-?\d*)n)?(?:(%|-)(\d*))?/,q=/\D/,I=/[^(]*\(([^)]*)\)/,z=/\(.*/,C=/\[([^!~^*|$ [:=]+)([$^*|]?=)?([^ :\]]+)?\]/,w=document,k=!!w.getElementsByClassName,p=!!w.querySelectorAll,u={"first-child":function(a){return a.parentNode.getElementsByTagName("*")[0]!==a},"last-child":function(a){for(;(a=a.nextSibling)&&1!=a.nodeType;);return!!a},root:function(a){return"html"!==a.nodeName.toLowerCase()},"nth-child":function(a,b){var d=a.nodeIndex||0,c=b[3]=b[3]?("%"===b[2]?-1:1)*b[3]:0,e=b[1];if(d)return!((d+
c)%e);var k=a.parentNode.firstChild;d++;do if(1==k.nodeType&&(k.nodeIndex=++d)&&a===k&&(d+c)%e)return 0;while(k=k.nextSibling);return 1},"nth-last-child":function(a,b){var d=a.nodeIndexLast||0,c=b[3]?("%"===b[2]?-1:1)*b[3]:0,e=b[1];if(d)return!((d+c)%e);var k=a.parentNode.lastChild;d++;do if(1==k.nodeType&&(k.nodeLastIndex=d++)&&a===k&&(d+c)%e)return 0;while(k=k.previousSibling);return 1},empty:function(a){return!!a.firstChild},parent:function(a){return!a.firstChild},"only-child":function(a){return 1!=
a.parentNode.getElementsByTagName("*").length},checked:function(a){return!a.checked},lang:function(a,b){return a.lang!==b&&w.documentElement.lang!==b},enabled:function(a){return a.disabled||"hidden"===a.type},disabled:function(a){return!a.disabled},selected:function(a){return!a.selected}},x={},A=function(a){return x[a]||(x[a]=new RegExp("(^| +)"+a+"($| +)"))},n={"":function(a,b){return!!a.getAttribute(b)},"=":function(a,b,d){return(b=a.getAttribute(b))&&b===d},"&=":function(a,b,d){return(b=a.getAttribute(b))&&
A(d).test(b)},"^=":function(a,b,d){return(b=a.getAttribute(b)+"")&&!b.indexOf(d)},"$=":function(a,b,d){return(b=a.getAttribute(b)+"")&&b.indexOf(d)==b.length-d.length},"*=":function(a,b,d){return(b=a.getAttribute(b)+"")&&-1!=b.indexOf(d)},"|=":function(a,b,d){return(b=a.getAttribute(b)+"")&&(b===d||!!b.indexOf(d+"-"))},"!=":function(a,b,d){return!(b=a.getAttribute(b))||!A(d).test(b)}};return function(x,F){F=F||w;var D=[],m=null,A,s,r,y,t,S,T;if(p)try{D=Z(F.querySelectorAll(x.replace(c,'="$1"')))}catch(rb){m=
!0}if(!p||m)if(b.test(x))switch(m=0,x.charAt(0)){case "#":m=x.slice(1);D=w.getElementById(m);D.id!==m&&(D=w.all[m]);D=D?[D]:[];break;case ".":A=x.slice(1);if(k)D=Z((D=F.getElementsByClassName(A)).length?D:[]);else{A=" "+A+" ";s=F.getElementsByTagName("*");for(r=0;y=s[r++];)-1!=(" "+y.className+" ").indexOf(A)&&(D[m++]=y);D=m?D:[]}break;case ":":s=F.getElementsByTagName("*");r=0;t=x.replace(I,"$1");for(S=x.replace(z,"");y=s[r++];)u[S]&&!u[S](y,t)&&(D[m++]=y);D=m?D:[];break;case "[":s=F.getElementsByTagName("*");
r=0;y=C.exec(x);A=y[1];T=y[2]||"";for(t=y[3];y=s[r++];)n[T]&&(n[T](y,A,t)||"class"===A&&n[T](y,"className",t))&&(D[m++]=y);D=m?D:[];break;default:D=Z((D=F.getElementsByTagName(x)).length?D:[])}else{for(var Sa=x.split(a),Ua=Sa.length-1,ib=!!Ua,Va,v,K,E,G,B,H,fa,N,J,L,M;m=Sa[Ua--];){v=(Va=m.replace(d,"$1%").replace(e,"$1&").replace(g," $1 ").split(f)).length;r=0;E=" ";for(s=[F];K=Va[r++];)if(" "!==K&&">"!==K&&"~"!==K&&"+"!==K&&s){K=K.match(l);G=K[1]||"*";B=K[2];H=K[3]?" "+K[3]+" ":"";A=K[4];T=K[5]||
"";S=K[7];t="nth-child"===S||"nth-last-child"===S?h.exec("even"===K[8]&&"2n"||"odd"===K[8]&&"2n%1"||!q.test(K[8])&&"0n%"+K[8]||K[8]):K[8];fa=[];m=N=0;for(L=r==v;J=s[N++];)switch(E){case " ":M=J.getElementsByTagName(G);for(J=0;y=M[J++];)B&&y.id!==B||H&&-1==(" "+y.className+" ").indexOf(H)||!(!A||n[T]&&(n[T](y,A,K[6])||"class"===A&&n[T](y,"className",K[6])))||y.yeasss||(u[S]?u[S](y,t):S)||(L&&(y.yeasss=1),fa[m++]=y);break;case "~":for(G=G.toLowerCase();(J=J.nextSibling)&&!J.yeasss;)1!=J.nodeType||"*"!==
G&&J.nodeName.toLowerCase()!==G||B&&J.id!==B||H&&-1==(" "+J.className+" ").indexOf(H)||!(!A||n[T]&&(n[T](y,A,K[6])||"class"===A&&n[T](y,"className",K[6])))||J.yeasss||(u[S]?u[S](J,t):S)||(L&&(J.yeasss=1),fa[m++]=J);break;case "+":for(;(J=J.nextSibling)&&1!=J.nodeType;);!J||J.nodeName.toLowerCase()!==G.toLowerCase()&&"*"!==G||B&&J.id!==B||H&&-1==(" "+y.className+" ").indexOf(H)||!(!A||n[T]&&(n[T](y,A,K[6])||"class"===A&&n[T](y,"className",K[6])))||J.yeasss||(u[S]?u[S](J,t):S)||(L&&(J.yeasss=1),fa[m++]=
J);break;case ">":for(M=J.getElementsByTagName(G),r=0;y=M[r++];)y.parentNode!==J||B&&y.id!==B||H&&-1==(" "+y.className+" ").indexOf(H)||!(!A||n[T]&&(n[T](y,A,K[6])||"class"===A&&n[T](y,"className",K[6])))||y.yeasss||(u[S]?u[S](y,t):S)||(L&&(y.yeasss=1),fa[m++]=y)}s=fa}else E=K;if(ib){if(!s.concat){fa=[];for(J=0;y=s[J];)fa[J++]=y;s=fa}D=s.concat(1==D.length?D[0]:D)}else D=s}for(m=D.length;m--;)D[m].yeasss=D[m].nodeIndex=D[m].nodeIndexLast=null}return D}}(),la=MetaphorJs.error=function(b){var c=b.stack||
Error().stack;setTimeout(function(){"undefined"!=typeof console&&console.log&&(console.log(b),c&&console.log(c))},0)},Ia="string"==typeof document.createTextNode("").textContent?"textContent":"nodeValue",wa=MetaphorJs.lib.Watchable,W=function(b){this.$$observable=new da;r(this,b,!0,!1);this.$parent?(this.$parent.$on("check",this.$$onParentCheck,this),this.$parent.$on("destroy",this.$$onParentDestroy,this)):(this.$root=this,this.$isRoot=!0)};W.prototype={$app:null,$parent:null,$root:null,$isRoot:!1,
$$observable:null,$$watchers:null,$$checking:!1,$$destroyed:!1,$new:function(){return new W({$parent:this,$root:this.$root,$app:this.$app})},$newIsolated:function(){return new W({$app:this.$app})},$on:function(b,c,a){return this.$$observable.on(b,c,a)},$un:function(b,c,a){return this.$$observable.un(b,c,a)},$watch:function(b,c,a){return wa.create(this,b,c,a,null)},$unwatch:function(b,c,a){return wa.unsubscribeAndDestroy(this,b,c,a)},$get:function(b){for(var c=this;c;){if(void 0!=c[b])return c[b];
c=c.$parent}},$$onParentDestroy:function(){this.$destroy()},$$onParentCheck:function(){this.$check()},$check:function(){var b;this.$$checking||(this.$$checking=!0,this.$$watchers&&(b=this.$$watchers.$checkAll()),this.$$checking=!1,this.$$destroyed||this.$$observable.trigger("check",b))},$destroy:function(){this.$$observable.trigger("destroy");this.$$observable.destroy();delete this.$$observable;delete this.$app;delete this.$root;delete this.$parent;this.$$watchers&&(this.$$watchers.$destroyAll(),
delete this.$$watchers);this.$$destroyed=!0}};MetaphorJs.lib.Scope=W;W=MetaphorJs.lib.Scope;(function(){var b=/\\{/g,c=new da,a=function(a,b,c,l,h){return!b||"string"!=typeof b||-1==b.indexOf("{{")&&-1==b.indexOf("{[")?null:new d(a,b,c,l,h)},d=function(a,b,d,c,h){this.id=ia();this.origin=b;this.scope=a;this.parent=d;this.isRoot=!d;this.data=c;this.lang=a.$app.lang;if(!0===h||!1===h)this.recursive=h;this.watchers=[];this.children=[];this.dataChangeDelegate=v(this.doDataChange,this);this.processed=
this.processText(b);this.render()};d.prototype={id:null,parent:null,isRoot:null,scope:null,origin:"",processed:null,text:null,watchers:null,children:null,data:null,recursive:!1,dataChangeDelegate:null,changeTmt:null,lang:null,subscribe:function(a,b){return c.on(this.id,a,b)},unsubscribe:function(a,b){return c.un(this.id,a,b)},getString:function(){null===this.text&&this.render();var a=this.text;return-1!=a.indexOf("\\{")?a.replace(b,"{"):a},render:function(){var a=this.processed,b,c,l;this.children.length||
this.createChildren();l=this.children;b=-1;for(c=l.length;++b<c;a=a.replace("---"+b+"---",l[b]instanceof d?l[b].getString():l[b]));return this.text=a},processText:function(a){for(var b=0,d=a.length,c,h,q="";b<d;)if(-1!=(c=a.indexOf("{{",b))&&-1!=(h=a.indexOf("}}",c+2))&&"\\"!=a.substr(c-1,1))q+=a.substring(b,c),h!=c+2&&(q+=this.watcherMatch(a.substring(c+2,h))),b=h+2;else{b!==d&&(q+=a.substring(b));break}b=0;a=q;d=a.length;for(q="";b<d;)if(-1!=(c=a.indexOf("{[",b))&&-1!=(h=a.indexOf("]}",c+2))&&"\\"!=
a.substr(c-1,1))q+=a.substring(b,c),h!=c+2&&(q+=this.watcherMatch(a.substring(c+2,h),!0)),b=h+2;else{b!==d&&(q+=a.substring(b));break}return q},watcherMatch:function(a,b){var d=this.watchers;if(b){a=O(a);var c=a.split("|"),h=O(c[0]);"."!=h.substr(0,1)&&(c[0]="'"+h+"'");1==c.length&&c.push("l");a=c.join(" | ")}d.push(ka(this.scope,a,this.onDataChange,this));return"---"+(d.length-1)+"---"},onDataChange:function(){this.changeTmt||(this.changeTmt=setTimeout(this.dataChangeDelegate,0))},doDataChange:function(){this.destroyChildren();
this.triggerChange();this.changeTmt=null},triggerChange:function(){this.text=null;this.isRoot?c.trigger(this.id,this,this.data):this.parent.triggerChange()},createChildren:function(){var b=this.watchers,d=this.children,c=this.scope,l=this.recursive,h,q,I;h=-1;for(q=b.length;++h<q;)I=b[h].getLastResult(),d.push(l&&a(c,I,this,null,!0)||I)},destroyChildren:function(){var a=this.children,b,c;b=-1;for(c=a.length;++b<c;)a[b]instanceof d&&a[b].destroy();this.children=[]},destroyWatchers:function(){var a=
this.watchers,b,d;b=-1;for(d=a.length;++b<d;a[b].unsubscribeAndDestroy(this.onDataChange,this));this.watchers=[]},destroy:function(){this.destroyChildren();this.destroyWatchers();c.destroyEvent(this.id);delete this.watchers;delete this.children;delete this.origin;delete this.processed;delete this.text;delete this.scope;delete this.data;delete this.dataChangeDelegate;delete this.lang;this.changeTmt&&clearTimeout(this.changeTmt);delete this.changeTmt}};d.create=a;Ga("MetaphorJs.view.TextRenderer",d)})();
var Wa=MetaphorJs.view.TextRenderer;(function(){var b=null,c=Wa.create,a=function(a,b,d,c,e,f){var k=[];if(a&&!0!==a){if(a.nodeType){f.countdown+=1;g(a,d,c,e,f);return}k=Z(a)}k.length||(k=Z(b.childNodes));b=k.length;f.countdown+=b;for(a=-1;++a<b;g(k[a],d,c,e,f));},d=function(a,b){if(b)if(b.nodeType)a.push(b);else if(G(b))for(var c=-1,e=b.length;++c<e;d(a,b[c]));},e=/^(script|template|mjs-template|style)$/i,g=function(b,d,c,f,g){if(b){var l,k=b.nodeName;g||(g={countdown:1});if(!k||!k.match(e)){if(b.nodeType)try{l=
d.call(c,b)}catch(p){la(p)}if(!1!==l){if(ca(l)){l.done(function(e){!1!==e&&a(e,b,d,c,f,g);0==--g.countdown&&f&&f.call(c)});return}a(l,b,d,c,f,g)}}0==--g.countdown&&f&&f.call(c)}},f=new da,l=function(a,b,d){this.id=ia();this.el=a;this.scope=b;this.texts=[];this.parent=d;b instanceof W&&b.$on("destroy",this.destroy,this);if(d)d.on("destroy",this.destroy,this)};l.prototype={id:null,el:null,scope:null,texts:null,parent:null,destroyed:!1,_observable:null,on:function(a,b,d){return f.on(a+"-"+this.id,b,
d)},un:function(a,b,d){return f.un(a+"-"+this.id,b,d)},createChild:function(a){return new l(a,this.scope,this)},getEl:function(){return this.el},runHandler:function(a,b,d,c){var e=a.$isolateScope?b.$newIsolated():a.$breakScope?b.$new():b;b=b.$app;var f={$scope:e,$node:d,$attrValue:c,$renderer:this};d=[e,d,c,this];return a.__isMetaphorClass?(d=b.inject(a,null,!0,f,d),a.$stopRenderer?!1:d):b.inject(a,null,!1,f,d)},processNode:function(a){var e=a.nodeType,f=this.texts,g=this.scope,l,w;if(3==e){if(w=
null!==a.parentNode.getAttribute("mjs-recursive"),l=c(g,a[Ia],null,f.length,w))l.subscribe(this.onTextChange,this),f.push({node:a,tr:l}),this.renderText(f.length-1)}else if(1==e){b||(b=Ta());var k=a.attributes;l=[];var p=[],u,x,A,e="tag."+a.tagName.toLowerCase();if(u=ea(e,!0)){A=this.runHandler(u,g,a);if(!1===A)return!1;ca(A)?l.push(A):d(p,A)}u=0;for(x=b.length;u<x;u++)if(w=b[u].name,null!==(A=a.getAttribute(w))){A=this.runHandler(b[u].handler,g,a,A);a.removeAttribute(w);if(!1===A)return!1;ca(A)?
l.push(A):d(p,A)}if(l.length){var n=new P;P.all(l).done(function(a){d(p,a);n.resolve(p)});return n}w=null!==a.getAttribute("mjs-recursive");u=0;for(x=k.length;u<x;u++)!ea(e,!0)&&(l=c(g,k[u].value,null,f.length,w))&&(l.subscribe(this.onTextChange,this),f.push({node:a,attr:k[u].name,tr:l}),this.renderText(f.length-1));return p.length?p:!0}return!0},process:function(){g(this.el,this.processNode,this,this.onProcessingFinished,{countdown:1})},onProcessingFinished:function(){f.trigger("rendered-"+this.id,
this)},onTextChange:function(a,b){this.renderText(b)},renderText:function(a){a=this.texts[a];var b=a.tr.getString(),d=a.attr;d?(a.node.setAttribute(d,b),"value"==d&&(a.node.value=b),"class"==d&&(a.node.className=b)):a.node[Ia]=b},destroy:function(){var a=this.texts,b,d;if(!this.destroyed){this.destroyed=!0;b=-1;for(d=a.length;++b<d;a[b].tr.destroy());this.parent&&this.parent.un("destroy",this.destroy,this);delete this.texts;delete this.el;delete this.scope;delete this.parent;f.trigger("destroy-"+
this.id)}}};Ga("MetaphorJs.view.Renderer",l)})();var Ja=MetaphorJs.view.Renderer;(function(){var b=new da,c={},a=function(a){if(!c[a]){var b=document.getElementById(a),d;b&&(d=b.tagName.toLowerCase(),"script"==d?(d=document.createElement("div"),d.innerHTML=b.innerHTML,c[a]=ja(d.childNodes)):c[a]="content"in b?b.content:ja(b.childNodes))}return c[a]},d=function(a){return c[a]?c[a]:c[a]=MetaphorJs.ajax(a,{dataType:"fragment"}).then(function(b){return c[a]=b})},e=function(a){r(this,a,!0,!1);this.id=
ia();this.tpl&&(this.tpl=O(this.tpl));this.url&&(this.url=O(this.url));a=this.node;var b=this.tpl||this.url;a&&a.removeAttribute("mjs-include");a||(this.deferRendering=!0);if(b){if(a&&a.firstChild&&H(a,"mjs-transclude",ja(a.childNodes)),"."!=b.substr(0,1)||this.replace||(this.ownRenderer=!0,this._watcher=ka(this.scope,b,this.onChange,this)),this.replace&&(this.ownRenderer=!1),this.initPromise=this.resolveTemplate(),this.deferRendering&&this.ownRenderer||this.initPromise.done(this.applyTemplate,this),
this.ownRenderer&&this.parentRenderer)this.parentRenderer.on("destroy",this.onParentRendererDestroy,this)}else!this.deferRendering&&this.ownRenderer&&this.doRender();this.scope instanceof W&&this.scope.$on("destroy",this.onScopeDestroy,this)};e.prototype={_watcher:null,_tpl:null,_renderer:null,_initial:!0,_fragment:null,_id:null,scope:null,node:null,tpl:null,url:null,ownRenderer:!1,initPromise:null,parentRenderer:null,deferRendering:!1,replace:!1,doRender:function(){this._renderer||(this._renderer=
new Ja(this.node,this.scope),this._renderer.on("rendered",this.onRendered,this),this._renderer.process())},onRendered:function(){b.trigger("rendered-"+this.id,this)},on:function(a,d,c){return b.on(a+"-"+this.id,d,c)},un:function(a,d,c){return b.un(a+"-"+this.id,d,c)},startRendering:function(){var a=this.tpl||this.url;if(this.deferRendering&&this.node){this.deferRendering=!1;if(this.initPromise)return this.initPromise.done(a?this.applyTemplate:this.doRender,this),this.initPromise;a?this.applyTemplate():
this.doRender()}return null},resolveTemplate:function(){var b=this,c=b.url,e=b._watcher?b._watcher.getLastResult():b.tpl||c,h=new P;(new P(function(b){c?b(a(e)||d(c)):b(a(e)||ja(e))})).done(function(a){b._fragment=a;h.resolve(b.ownRenderer?!1:b.node)}).fail(h.reject,h);return h},onChange:function(){this._renderer&&(this._renderer.destroy(),this._renderer=null);this.resolveTemplate().done(this.applyTemplate,this)},doApplyTemplate:function(){for(var a=this.node;a.firstChild;)a.removeChild(a.firstChild);
this.replace?a.parentNode.replaceChild(va(this._fragment),a):a.appendChild(va(this._fragment));this.ownRenderer&&this.doRender()},applyTemplate:function(){var a=this.node,b=new P;this._initial?(this.doApplyTemplate(),b.resolve()):(Y(a,"leave",null,!0).done(this.doApplyTemplate,this).done(b.resolve,b),Y(a,"enter",null,!0));this._initial=!1;return b},onParentRendererDestroy:function(){this._renderer.destroy();this.destroy();delete this._renderer},onScopeDestroy:function(){this.destroy();delete this._renderer},
destroy:function(){delete this.node;delete this.scope;delete this.initPromise;this._watcher&&(this._watcher.unsubscribeAndDestroy(this.onChange,this),delete this._watcher);delete this.tpl}};e.getTemplate=a;e.loadTemplate=d;Ga("MetaphorJs.view.Template",e)})();var oa=MetaphorJs.view.Template;(function(){var b,c=function(){this.store={}};c.prototype={store:null,getApi:function(){return{value:v(this.value,this),constant:v(this.constant,this),factory:v(this.factory,this),service:v(this.service,this),
provider:v(this.provider,this),resolve:v(this.resolve,this),inject:v(this.inject,this)}},instantiate:function(a,b){var c=function(){},g;c.prototype=a.prototype;c=new c;g=a.prototype.constructor.apply(c,b);return"object"==typeof g?g:c},inject:function(a,b,c,g,f){g=g||{};f=f||[];if("function"==typeof a)if(a.inject)f=ba.call(a.inject),f.push(a),a=f;else return c||a.__isMetaphorClass?this.instantiate(a,f):a.apply(b,f);a=ba.call(a);var l=this;f=[];var h=a.pop(),q,r;q=-1;for(r=a.length;++q<r;f.push(l.resolve(a[q],
g)));return P.all(f).then(function(a){return c||h.__isMetaphorClass?l.instantiate(h,a):h.apply(b,a)})},value:function(a,b){this.store[a]={type:1,value:b}},constant:function(a,b){var c=this.store;c[a]||(c[a]={type:2,value:b})},factory:function(a,b,c,g){"boolean"==typeof c&&(g=c,c=null);this.store[a]={type:3,singleton:g,fn:b,context:c}},service:function(a,b,c){this.store[a]={type:4,singleton:c,fn:b}},provider:function(a,b){this.store[a+"Provider"]={name:a,type:5,fn:b,instance:null}},resolve:function(a,
d){var c=this.store,g,f,l;if("undefined"!=typeof d[a])return d[a];if(f=c[a]){g=f.type;if(1==g||2==g)return f.value;if(3==g)l=this.inject(f.fn,f.context,!1,d);else if(4==g)l=this.inject(f.fn,null,!0,d);else if(5==g)return f.instance||(f.instance=P.resolve(this.inject(f.fn,null,!0,d)).done(function(a){f.instance=a;c[f.name]={type:3,fn:a.$get,context:a}})),f.instance;f.singleton&&(f.type=1,f.value=l,3==g&&ca(l)&&l.done(function(a){f.value=a}));return d[a]=l}if(c[a+"Provider"])return this.resolve(a+"Provider",
d),this.resolve(a,d);if(this===b)throw"Could not provide value for "+a;return b.resolve(a)},destroy:function(){delete this.store;delete this.scope}};MetaphorJs.lib.Provider=c;c.global=function(){return b};b=new c})();var Xa=MetaphorJs.lib.Provider,ra=MetaphorJs.resolveComponent=function(b,c,a,d,e){var g=!1!==c;c=c||{};e=e||[];a=a||c.scope;d=d||c.node;c.scope=c.scope||a;c.node=c.node||d;var f="string"==typeof b?ea(b):b;if(!f)throw"Component "+b+" not found";a&&f.$isolateScope&&(c.scope=a=a.$newIsolated());
var l,h=[];b=f.template||c.template||null;var q=f.templateUrl||c.templateUrl||null,I=a?a.$app:null,z=Xa.global(),C=I?I.inject:z.inject,w=I?I:z,k=d?d.getAttribute("mjs-cloak"):null,p={$node:d||null,$scope:a||null,$config:c||null,$args:e||null};if(f.resolve)for(l in f.resolve)(function(b){var k=new P,g;h.push(k.done(function(a){p[b]=a;c[b]=a;e.push(a)}));g=f.resolve[l];"function"==typeof g?k.resolve(g(a,d)):"string"==typeof g?k.resolve(C.resolve(g)):k.resolve(C.call(w,g,null,!1,r({},p,c,!1,!1)))})(l);
g&&(b||q)&&(c.template=new oa({scope:a,node:d,deferRendering:!0,ownRenderer:!0,tpl:b,url:q}),h.push(c.template.initPromise),d&&d.firstChild&&H(d,"mjs-transclude",ja(d.childNodes)));g&&e.unshift(c);var u;h.length?(u=new P,P.all(h).done(function(){u.resolve(C.call(w,f,null,!0,r({},p,c,!1,!1),e))})):u=P.resolve(C.call(w,f,null,!0,r({},p,c,!1,!1),e));d&&u.isPending()&&null!==k&&(k?M(d,k):d.style.visibility="hidden",u.done(function(){k?R(d,k):d.style.visibility=""}));return u};(function(){var b=function(a,
b){"pt_BR"==b&&(b="xbr");3<b.length&&(b=b.substr(0,-b.lastIndexOf("_")));switch(b){case "bo":case "dz":case "id":case "ja":case "jv":case "ka":case "km":case "kn":case "ko":case "ms":case "th":case "tr":case "vi":case "zh":return 0;case "af":case "az":case "bn":case "bg":case "ca":case "da":case "de":case "el":case "en":case "eo":case "es":case "et":case "eu":case "fa":case "fi":case "fo":case "fur":case "fy":case "gl":case "gu":case "ha":case "he":case "hu":case "is":case "it":case "ku":case "lb":case "ml":case "mn":case "mr":case "nah":case "nb":case "ne":case "nl":case "nn":case "no":case "om":case "or":case "pa":case "pap":case "ps":case "pt":case "so":case "sq":case "sv":case "sw":case "ta":case "te":case "tk":case "ur":case "zu":return 1==
a?0:1;case "am":case "bh":case "fil":case "fr":case "gun":case "hi":case "ln":case "mg":case "nso":case "xbr":case "ti":case "wa":return 0==a||1==a?0:1;case "be":case "bs":case "hr":case "ru":case "sr":case "uk":return 1==a%10&&11!=a%100?0:2<=a%10&&4>=a%10&&(10>a%100||20<=a%100)?1:2;case "cs":case "sk":return 1==a?0:2<=a&&4>=a?1:2;case "ga":return 1==a?0:2==a?1:2;case "lt":return 1==a%10&&11!=a%100?0:2<=a%10&&(10>a%100||20<=a%100)?1:2;case "sl":return 1==a%100?0:2==a%100?1:3==a%100||4==a%100?2:3;
case "mk":return 1==a%10?0:1;case "mt":return 1==a?0:0==a||1<a%100&&11>a%100?1:10<a%100&&20>a%100?2:3;case "lv":return 0==a?0:1==a%10&&11!=a%100?1:2;case "pl":return 1==a?0:2<=a%10&&4>=a%10&&(12>a%100||14<a%100)?1:2;case "cy":return 1==a?0:2==a?1:8==a||11==a?2:3;case "ro":return 1==a?0:0==a||0<a%100&&20>a%100?1:2;case "ar":return 0==a?0:1==a?1:2==a?2:3<=a&&10>=a?3:11<=a&&99>=a?4:5;default:return 0}},c=function(a){this.store={};a&&(this.locale=a)};c.prototype={store:null,locale:"en",setLocale:function(a){this.locale=
a},set:function(a,b){var c=this.store;"undefined"==typeof c[a]&&(c[a]=b)},load:function(a){r(this.store,a,!1,!1)},get:function(b){return this.store[b]||(this===a?"-- "+b+" --":a.get(b))},plural:function(a,c){var g=this.get(a),f=b(c,this.locale);return G(g)?g[f]:ua(g)?g[c]?g[c]:1==c&&void 0!=g.one?g.one:0>c&&void 0!=g.negative?g.negative:g.other:g}};var a=new c;c.global=function(){return a};MetaphorJs.lib.Text=c;U("filter.l",function(a,b){return b.$app.lang.get(a)});U("filter.p",function(a,b,c){return b.$app.lang.plural(a,
parseInt(c,10)||0)})})();var jb=MetaphorJs.lib.Text;L("MetaphorJs.cmp.Base",{destroyed:!1,_observable:null,initialize:function(b){b=b||{};this._observable=new da;r(this,this._observable.getApi(),!0,!1);if(b.callback){var c=b.callback,a=c.scope||this;delete c.scope;for(var d in c)if(c.hasOwnProperty(d))this.on(d,c[d],a);delete b.callback}r(this,b,!0,!1)},destroy:function(){if(!this.destroyed){if(!1===this.trigger("beforedestroy",this))return!1;this.onDestroy();this.destroyed=!0;this.trigger("destroy",
this);this._observable.destroy();delete this._observable}},onDestroy:B});L("MetaphorJs.cmp.App","MetaphorJs.cmp.Base",{lang:null,scope:null,renderer:null,cmpListeners:null,components:null,initialize:function(b,c){var a=c instanceof W?c:new W(c),d,e;a.$app=this;this.supr();d=new Xa;e=new da;this.lang=new jb;r(this,d.getApi(),!0,!1);this.destroyProvider=v(d.destroy,d);r(this,e.getApi(),!0,!1);this.destroyObservable=v(e.destroy,e);this.scope=a;this.cmpListeners={};this.components={};this.factory("$parentCmp",
["$node",this.getParentCmp],this);this.value("$app",this);this.value("$rootScope",a.$root);this.value("$lang",this.lang);this.renderer=new Ja(b,a);d=ba.call(arguments);d[1]=a;this.initApp.apply(this,d)},initApp:B,run:function(){this.renderer.process()},getParentCmp:function(b){b=b.parentNode;for(var c;b;){if(c=b.getAttribute("cmp-id"))return this.getCmp(c);b=b.parentNode}return null},onAvailable:function(b,c,a){var d=this.cmpListeners;d[b]||(d[b]=new P);c&&d[b].done(c,a);return d[b]},getCmp:function(b){return this.components[b]||
null},registerCmp:function(b){var c=this;c.components[b.id]=b;c.onAvailable(b.id).resolve(b);b.on("destroy",function(a){delete c.cmpListeners[a.id];delete c.components[a.id]})},destroy:function(){var b;this.destroyObservable();this.destroyProvider();this.renderer.destroy();this.scope.$destroy();for(b in this)this.hasOwnProperty(b)&&delete this[b]}});var sa=MetaphorJs.isAttached=function(b){var c=document.body;return b===c?!0:c.contains(b)};L("MetaphorJs.cmp.Component","MetaphorJs.cmp.Base",{id:null,
originalId:!1,node:null,renderTo:null,autoRender:!0,rendered:!1,hidden:!1,destroyEl:!0,destroyScope:!1,scope:null,template:null,templateUrl:null,tag:null,initialize:function(b){this.supr(b);this.scope||(this.scope=new W);b.as&&(this.scope[b.as]=this);this.node&&(this.id=this.node.getAttribute("id"))&&(this.originalId=!0);this.id=this.id||"cmp-"+ia();this.node||this._createNode();this.initComponent.apply(this,arguments);this.scope.$app&&this.scope.$app.registerCmp(this);var c=this.template,a=this.templateUrl;
c&&c instanceof oa?c instanceof oa&&(this.template.node=this.node):this.template=c=new oa({scope:this.scope,node:this.node,deferRendering:!c,ownRenderer:!0,tpl:c,url:a});if(this.parentRenderer)this.parentRenderer.on("destroy",this.onParentRendererDestroy,this);this._initElement();this.autoRender&&(c.initPromise?c.initPromise.done(this.render,this):this.render())},_createNode:function(){this.node=document.createElement(this.tag||"div")},_initElement:function(){var b=this.node;b.setAttribute("id",this.id);
b.setAttribute("cmp-id",this.id);this.hidden&&(b.style.display="none")},render:function(){this.rendered||(this.trigger("render",this),this.template.on("rendered",this.onRenderingFinished,this),this.template.startRendering())},onRenderingFinished:function(){this.renderTo?this.renderTo.appendChild(this.node):sa(this.node)||document.body.appendChild(this.node);this.rendered=!0;this.afterRender();this.trigger("afterrender",this)},show:function(){if(this.hidden){if(!1===this.trigger("beforeshow",this))return!1;
this.node.style.display="block";this.hidden=!1;this.onShow();this.trigger("show",this)}},hide:function(){if(!this.hidden){if(!1===this.trigger("beforehide",this))return!1;this.node.style.display="none";this.hidden=!0;this.onHide();this.trigger("hide",this)}},isHidden:function(){return this.hidden},isRendered:function(){return this.rendered},isDestroyed:function(){return this.destroyed},getEl:function(){return this.node},initComponent:B,afterRender:B,onShow:B,onHide:B,onParentRendererDestroy:function(){this.destroy()},
onDestroy:function(){this.template&&(this.template.destroy(),delete this.template);this.destroyEl?sa(this.node)&&this.node.parentNode.removeChild(this.node):(this.node.removeAttribute("cmp-id"),this.originalId||this.node.removeAttribute("id"));this.destroyScope&&this.scope&&this.scope.$destroy();delete this.scope;delete this.node;this.supr()}});var xa=MetaphorJs.stopAnimation=function(b){var c=H(b,"mjsAnimationQueue"),a;G(c)&&c.length?(a=c[0])&&a.stages&&(c=a.position,a=a.stages,R(b,a[c]),R(b,a[c]+
"-active")):"function"==typeof c?c(b):"stop"==c&&$(b).stop(!0,!0);H(b,"mjsAnimationQueue",null)},E=MetaphorJs.addListener=function(b,c,a){b.attachEvent?b.attachEvent("on"+c,a):b.addEventListener(c,a,!1)};(function(){var b={locationChange:[],beforeLocationChange:[]},c=!1,a=/(?:(\w+:))?(?:\/\/(?:[^@]*@)?([^\/:\?#]+)(?::([0-9]+))?)?([^\?#]*)(?:(\?[^#]+)|\?)?(?:(#.*))?/,d=!!history.pushState,e="onhashchange"in window,g=function(a){var b=location.protocol+"//"+location.hostname;location.port&&(b+=":"+
location.port);a=a.replace(b,"");d||(a=encodeURIComponent(a));return a},f=function(b){b=(""+b).match(a);var c,e;d||(e=b[6],"!"==e.substr(0,1)&&(c=e.substr(1)));c||(c=b[4],b[5]&&(c+="?"+b[5]));return c},l=function(){var a;d?a=location.pathname+location.search:(a=location.hash.substr(1))?("!"==a.substr(0,1)&&(a=a.substr(1)),a=decodeURIComponent(a)):a=location.pathname+location.search;return a},h=function(a,d,c){c=c||l();for(var e,f=-1,k=b[a].length;++f<k;)if(e=b[a][f].call(null,c),d&&!1===e)return!1;
if(window.MetaphorJs){if(d)return MetaphorJs.trigger(a,c);MetaphorJs.triggerAsync(a,c)}return null};E(window,"load",function(){c=!0});history.initPushState=function(){if(d)history.origPushState=history.pushState,history.origReplaceState=history.replaceState,E(window,"popstate",function(){h("locationChange")}),history.pushState=function(a,b,d){if(!1===h("beforeLocationChange",!0,d))return!1;history.origPushState(a,b,g(d));h("locationChange")},history.replaceState=function(a,b,d){if(!1===h("beforeLocationChange",
!0,d))return!1;history.origReplaceState(a,b,g(d));h("locationChange")};else if(e)history.replaceState=history.pushState=function(a,b,d){if(!1===h("beforeLocationChange",!0,d))return!1;a=g(d);location.hash=a?"!"+a:""},E(window,"hashchange",function(){h("locationChange")});else{var b=null,l=!1;window.onIframeHistoryChange=function(a){l||(location.hash=a?"!"+a:"",h("locationChange"))};var r=function(a){var d=b.contentWindow.document;d.open();d.write("<html><head><title>"+document.title+'</title><script type="text/javascript">var hashValue = "'+
a+'";window.top.onIframeHistoryChange(hashValue);\x3c/script></head><body>&nbsp;</body></html>');d.close()};history.pushState=function(a,b,d){if(!1===h("beforeLocationChange",!0,d))return!1;r(g(d))};history.replaceState=function(a,d,c){if(!1===h("beforeLocationChange",!0,c))return!1;a=g(c);b.contentWindow.hashValue=a};var C=function(){b=document.createElement("iframe");b.src="about:blank";b.style.display="none";document.body.appendChild(b);l=!0;r(g(location.hash.substr(1)));l=!1};c?C():E(window,"load",
C)}E(document.documentElement,"click",function(b){b=b||window.event;for(var d=b.target||b.srcElement,c;d&&"a"!=d.nodeName.toLowerCase();)d=d.parentNode;if(d){if(d=(c=d.getAttribute("href"))&&"#"!=c.substr(0,1)&&!d.getAttribute("target"))d=c.match(a),d=d[1]&&location.protocol!=d[1]||d[2]&&location.hostname!=d[2]?!1:d[2]||d[3]?location.port==d[3]:!0;if(d&&f(c)!=f(window.location))return history.pushState(null,null,f(c)),b.preventDefault&&b.preventDefault(),b.stopPropagation&&b.stopPropagation(),!1}return null});
history.initPushState=function(){}};MetaphorJs.pushUrl=function(a){history.pushState(null,null,a)};MetaphorJs.replaceUrl=function(a){history.replaceState(null,null,a)};MetaphorJs.currentUrl=function(){return l()};history.onBeforeChange=function(a){b.beforeLocationChange.push(a)};history.onChange=function(a){b.locationChange.push(a)}})();var kb=MetaphorJs.currentUrl;L("MetaphorJs.cmp.View",{route:null,node:null,scope:null,cmp:null,currentComponent:null,watchable:null,defaultCmp:null,initialize:function(b){r(this,
b,!0,!1);(b=this.node)&&b.firstChild&&H(b,"mjs-transclude",ja(b.childNodes));this.cmp||(this.cmp=b.getAttribute("mjs-view-cmp"));this.defaultCmp=b.getAttribute("mjs-view-default");b.removeAttribute("mjs-view");b.removeAttribute("mjs-view-cmp");b.removeAttribute("mjs-view-default");this.route?(history.initPushState(),MetaphorJs.on("locationChange",this.onLocationChange,this),this.onLocationChange()):this.cmp&&(this.watchable=ka(this.scope,this.cmp,this.onCmpChange,this),this.onCmpChange())},onCmpChange:function(){var b=
this.watchable.getLastResult()||this.defaultCmp;this.clearComponent();b&&this.setComponent(b)},onLocationChange:function(){var b=kb(),c=this.route,a,d,e,g,f;d=0;for(e=c.length;d<e;d++){g=c[d];if(f=b.match(g.reg)){this.changeRouteComponent(g,f);return}g["default"]&&!a&&(a=g)}a?this.setRouteComponent(a,[]):this.clearComponent();!a&&this.defaultCmp&&this.setComponent(this.defaultCmp)},changeRouteComponent:function(b,c){xa(this.node);this.clearComponent();this.setRouteComponent(b,c)},clearComponent:function(){var b=
this,c=b.node;b.currentComponent&&Y(c,"leave",null,!0).done(function(){b.currentComponent.destroy();for(b.currentComponent=null;c.firstChild;)c.removeChild(c.firstChild)})},setRouteComponent:function(b,c){var a=this,d=a.node,e=b.params;Y(d,"enter",function(){var g=c||[],f={destroyEl:!1,node:d,scope:b.$isolateScope?a.scope.$newIsolated():a.scope.$new()},l,h;b.as&&(f.as=b.as);b.template&&(f.template=b.template);g.shift();if(e)for(l=-1,h=e.length;++l<h;f[e[l]]=g[l]);return ra(b.cmp||"MetaphorJs.cmp.Component",
f,f.scope,d,null,g).done(function(b){a.currentComponent=b})},!0)},setComponent:function(b){var c=this,a=c.node;Y(a,"enter",function(){var d="object"==typeof b?b:{},e=("string"==typeof b?b:null)||"MetaphorJs.cmp.Component",g=d.scope||c.scope.$new();d.destroyEl=!1;return ra(e,d,g,a).done(function(a){c.currentComponent=a})},!0)},destroy:function(){this.clearComponent();this.route&&(MetaphorJs.un("locationchange",this.onLocationChange,this),delete this.route);this.watchable&&(this.watchable.unsubscribeAndDestroy(this.onCmpChange,
this),delete this.watchable);delete this.scope;delete this.currentComponent}});var pa=MetaphorJs.returnFalse=function(){return!1};N("mjs-app",0,pa);L("MetaphorJs.view.AttributeHandler",{watcher:null,scope:null,node:null,expr:null,initialize:function(b,c,a){a=O(a);this.node=c;this.expr=a;this.scope=b;this.watcher=ka(b,a,this.onChange,this);if(this.watcher.getLastResult())this.onChange();b instanceof W&&b.$on("destroy",this.onScopeDestroy,this)},onScopeDestroy:function(){this.destroy()},onChange:function(){},
destroy:function(){delete this.node;delete this.scope;this.watcher&&(this.watcher.unsubscribeAndDestroy(this.onChange,this),delete this.watcher)}});var Ka=function(b){var c=b.nodeName.toLowerCase();b=b.type;return"input"!=c&&"textarea"!=c&&"select"!=c||"submit"==b||"reset"==b||"button"==b?!1:!0},La=Array.prototype.indexOf;La||(La=Array.prototype.indexOf=function(b,c){var a;if(null==this)throw new TypeError('"this" is null or not defined');var d=Object(this),e=d.length>>>0;if(0===e)return-1;a=+c||
0;Infinity===Math.abs(a)&&(a=0);if(a>=e)return-1;for(a=Math.max(0<=a?a:e-Math.abs(a),0);a<e;){if(a in d&&d[a]===b)return a;a++}return-1});var Ya=MetaphorJs.inArray=function(b,c){return c?-1!=La.call(c,b):!1},ma=MetaphorJs.getValue=function(){var b=/\r/,c={option:function(a){var b=a.getAttribute("value")||a.value;return null!=b&&"undefined"!=typeof b?b:O(a.innerText||a.textContent)},select:function(a){for(var b,c=a.options,g=a.selectedIndex,f=(a="select-one"===a.type||0>g)?null:[],l=a?g+1:c.length,
h,q=0>g?l:a?g:0;q<l;q++)if(b=c[q],h=b.disabled||b.parentNode.disabled,(b.selected||q===g)&&!h){b=ma(b);if(a)return b;f.push(b)}return f},radio:function(a){return null===a.getAttribute("value")?"on":a.value},checkbox:function(a){return null===a.getAttribute("value")?"on":a.value}};return function(a){var d,e;if((d=c[a.type]||c[a.nodeName.toLowerCase()])&&void 0!==(e=d(a,"value")))return e;e=a.value;return"string"===typeof e?e.replace(b,""):null==e?"":e}}(),Ma=MetaphorJs.setValue=function(){var b={select:function(b,
a){for(var d,e,g=b.options,f=Z(a),l=g.length,h=-1;l--;)e=g[l],(e.selected=Ya(e.value,f))?d=!0:null!==e.getAttribute("mjs-default-option")&&(h=l);d||(b.selectedIndex=h);return f}};b.radio=b.checkbox=function(b,a){if(G(a))return b.checked=Ya(ma(b),a)};return function(c,a){if(1===c.nodeType){null===a?a="":"number"===typeof a&&(a+="");var d=b[c.type]||b[c.nodeName.toLowerCase()];d&&void 0!==d(c,a,"value")||(c.value=a)}}}();N("mjs-bind",1E3,L(null,"MetaphorJs.view.AttributeHandler",{isInput:!1,recursive:!1,
textRenderer:null,initialize:function(b,c,a){this.isInput=Ka(c);(this.recursive=null!==c.getAttribute("mjs-recursive"))?(this.scope=b,this.node=c,this.textRenderer=new Wa(b,"{{"+a+"}}",null,null,!0),this.textRenderer.subscribe(this.onTextRendererChange,this),this.onTextRendererChange(),b instanceof W&&b.$on("destroy",this.onScopeDestroy,this)):this.supr(b,c,a)},onTextRendererChange:function(){this.updateElement(this.textRenderer.getString())},onChange:function(){var b=this.watcher.getLastResult();
this.updateElement(b)},updateElement:function(b){this.isInput?Ma(this.node,b):this.node[Ia]=b},destroy:function(){this.textRenderer&&(this.textRenderer.destroy(),delete this.textRenderer);this.supr()}}));N("mjs-bind-html",1E3,L(null,"attr.mjs-bind",{updateElement:function(b){this.node.innerHTML=b}}));(function(){var b=function(b,a,d,e){if(null!==d){if(d==qa(b,a))return;d=!d}else d=qa(b,a);d?e?Y(b,[a+"-remove"],null,!0).done(function(){R(b,a)}):R(b,a):e?Y(b,[a+"-add"],null,!0).done(function(){M(b,
a)}):M(b,a)};N("mjs-class",1E3,L(null,"MetaphorJs.view.AttributeHandler",{initial:!0,onChange:function(){var c=this.node,a=this.watcher.getLastResult(),d;xa(c);if("string"==typeof a)b(c,a,null,!this.initial);else if(G(a)){var e;d=-1;for(e=a.length;++d<e;b(c,a[d],!0,!this.initial));}else for(d in a)b(c,d,a[d]?!0:!1,!this.initial);this.initial=!1}}))})();N("mjs-cmp-prop",200,["$parentCmp","$node","$attrValue",function(b,c,a){b&&(b[a]=c)}]);(function(){var b=function(b,a,d,e){var g,f,l,h,q;a.removeAttribute("mjs-cmp");
d=d.split(" ");l=0;for(h=d.length;l<h;l++)q=d[l],""!=q&&"as"!=q&&(g?f=q:g=q);ra(g,{scope:b,node:a,as:f,parentRenderer:e,destroyScope:!0},b,a);return!1};b.$breakScope=!0;N("mjs-cmp",200,b)})();var Za=wa.createGetter;N("mjs-each",100,L(null,"MetaphorJs.view.AttributeHandler",{model:null,itemName:null,tpl:null,renderers:null,parentEl:null,prevEl:null,nextEl:null,initialize:function(b,c,a){this.parseExpr(a);c.removeAttribute("mjs-each");c.removeAttribute("mjs-include");this.tpl=c;this.renderers=[];this.prevEl=
c.previousSibling;this.nextEl=c.nextSibling;this.parentEl=c.parentNode;this.node=c;this.scope=b;try{this.watcher=ka(b,this.model,this.onChange,this)}catch(d){la(d)}this.parentEl.removeChild(c);this.render(Z(this.watcher.getValue()))},onScopeDestroy:function(){var b=this.renderers,c,a;c=0;for(a=b.length;c<a;c++)b[c].renderer.destroy();delete this.renderers;delete this.tpl;delete this.prevEl;delete this.nextEl;delete this.parentEl;this.supr()},doUpdate:function(b,c){for(var a=this.renderers,d=c,e=a.length,
g=e-1,f=!(d%2),l,h;d<e;d++)l=a[d],h=l.scope,h.$index=d,h.$first=0===d,h.$last=d===g,h.$even=f,h.$odd=!f,f=!f,l.renderer?h.$check():(l.renderer=new Ja(l.el,l.scope),l.renderer.process())},render:function(b){var c=this.renderers,a=this.tpl,d=this.parentEl,e=this.nextEl,g=document.createDocumentFragment(),f,l,h;l=0;for(h=b.length;l<h;l++)f=a.cloneNode(!0),g.appendChild(f),c.push(this.createItem(f,b,l));d.insertBefore(g,e);this.doUpdate(b,0)},createItem:function(b,c,a){var d=this.itemName,e=this.scope.$new();
e[d]=c[a];return{el:b,scope:e}},onChange:function(b){var c=this,a=c.renderers;b=b.prescription||[];var d=c.tpl,e=0,g=c.parentEl,f=Z(c.watcher.getValue()),l=null,h,q,r,z;q=0;for(r=b.length;q<r;q++)z=b[q],"-"==z?(a[e].scope.$index=e,e++):(null===l&&(l=0<q?q-1:0),"I"!=z&&a[e]&&(h=a[e],h.scope.$destroy(),Y(h.el,"leave",null,!0).done(function(a){sa(a)&&a.parentNode.removeChild(a)})),"D"==z?a.splice(e,1):(h=d.cloneNode(!0),Y(h,"enter",function(b){return function(d){0<b?g.insertBefore(d,a[b-1].el.nextSibling):
c.prevEl?g.insertBefore(d,c.prevEl.nextSibling):g.insertBefore(d,g.firstChild)}}(e),!0),"R"==z?a[e]=c.createItem(h,f,e):"I"==z&&(q<a.length?a.splice(e,0,c.createItem(h,f,e)):a.push(c.createItem(h,f,e))),e++));c.doUpdate(f,l)},parseExpr:function(b){b=b.split(" ");var c,a,d,e,g;c=0;for(a=b.length;c<a;c++)if(g=b[c],""!=g&&"in"!=g)if(e){d=b.slice(c).join(" ");break}else e=g;this.model=d;this.itemName=e||"item"}},{$stopRenderer:!0}));N("mjs-each-in-store",100,L(null,"attr.mjs-each",{store:null,initialize:function(b,
c,a){this.parseExpr(a);c.removeAttribute("mjs-each-in-store");c.removeAttribute("mjs-include");this.tpl=c;this.renderers=[];this.prevEl=c.previousSibling;this.nextEl=c.nextSibling;this.parentEl=c.parentNode;this.node=c;this.scope=b;this.store=b=Za(this.model)(b);this.parentEl.removeChild(c);this.initWatcher();this.render(this.watcher.getValue());this.bindStore(b,"on")},onScopeDestroy:function(){this.bindStore(this.store,"un");delete this.store;this.supr()},initWatcher:function(){this.watcher=ka(this.store,
".items",null);this.watcher.subscribe(this.onChange,this)},resetWatcher:function(){this.watcher.setValue(this.store.items)},bindStore:function(b,c){b[c]("load",this.onStoreUpdate,this);b[c]("update",this.onStoreUpdate,this);b[c]("add",this.onStoreUpdate,this);b[c]("remove",this.onStoreUpdate,this);b[c]("replace",this.onStoreUpdate,this);b[c]("filter",this.onStoreFilter,this);b[c]("clearfilter",this.onStoreFilter,this);b[c]("clear",this.onStoreClear,this);b[c]("destroy",this.onStoreDestroy,this)},
onStoreUpdate:function(){this.watcher.check()},onStoreFilter:function(){this.resetWatcher();this.onStoreUpdate()},onStoreClear:function(){this.resetWatcher();this.onStoreUpdate()},onStoreDestroy:function(){this.onStoreClear();this.watcher.unsubscribeAndDestroy(this.onChange,this);delete this.watcher}},{$stopRenderer:!0}));var Na=wa.createFunc,ya=MetaphorJs.returnTrue=function(){return!0};(function(){var b=function(c){if(c instanceof b)return c;if(!(this instanceof b))return new b(c);for(var a in c)if(!this[a])try{this[a]=
c[a]}catch(d){}this.originalEvent=c;this.type=c.type;!this.target&&c.srcElement&&(this.target=c.srcElement);var e,g=c.button;"undefined"==typeof this.pageX&&null!=c.clientX&&(e=this.target?this.target.ownerDocument||document:document,a=e.documentElement,e=e.body,this.pageX=c.clientX+(a&&a.scrollLeft||e&&e.scrollLeft||0)-(a&&a.clientLeft||e&&e.clientLeft||0),this.pageY=c.clientY+(a&&a.scrollTop||e&&e.scrollTop||0)-(a&&a.clientTop||e&&e.clientTop||0));this.which||void 0===g||(this.which=g&1?1:g&2?3:
g&4?2:0);this.isDefaultPrevented=c.defaultPrevented||void 0===c.defaultPrevented&&!1===c.returnValue?ya:pa;this.timeStamp=c&&c.timeStamp||(new Date).getTime()};b.prototype={isDefaultPrevented:pa,isPropagationStopped:pa,isImmediatePropagationStopped:pa,preventDefault:function(){var b=this.originalEvent;this.isDefaultPrevented=ya;b.returnValue=!1;b&&b.preventDefault&&b.preventDefault()},stopPropagation:function(){var b=this.originalEvent;this.isPropagationStopped=ya;b&&b.stopPropagation&&b.stopPropagation()},
stopImmediatePropagation:function(){var b=this.originalEvent;this.isImmediatePropagationStopped=ya;b&&b.stopImmediatePropagation&&b.stopImmediatePropagation();this.stopPropagation()}};MetaphorJs.lib.NormalizedEvent=b})();var X=MetaphorJs.normalizeEvent=function(){var b=MetaphorJs.lib.NormalizedEvent;return function(c){return new b(c)}}();(function(){var b="click dblclick mousedown mouseup mouseover mouseout mousemove mouseenter mouseleave keydown keyup keypress submit focus blur copy cut paste enter".split(" "),
c,a;c=0;for(a=b.length;c<a;c++)(function(a){var b=a;"enter"==b&&(b="keyup");N("mjs-"+a,1E3,function(c,f,l){var h=Na(l);E(f,b,function(b){b=b||window.event;b=X(b);if("enter"==a&&13!=b.keyCode)return null;c.$event=b;try{h(c)}catch(e){la(e)}delete c.$event;c instanceof W?c.$root.$check():c.$$watchers&&c.$$watchers.$checkAll();b.preventDefault();return!1})})})(b[c])})();N("mjs-show",500,L(null,"MetaphorJs.view.AttributeHandler",{initial:!0,initialize:function(b,c,a){this.supr(b,c,a)},runAnimation:function(b){var c=
this.node.style,a=function(){c.display=b?"":"none"};this.initial?a():Y(this.node,b?"show":"hide",function(){b&&(c.display="")},!0).done(a)},onChange:function(){var b=this.watcher.getLastResult();this.runAnimation(b);this.initial=!1}}));N("mjs-hide",500,L(null,"attr.mjs-show",{onChange:function(){var b=this.watcher.getLastResult();this.runAnimation(!b);this.initial=!1}}));N("mjs-if",500,L(null,"MetaphorJs.view.AttributeHandler",{parentEl:null,prevEl:null,el:null,initial:!0,initialize:function(b,c,
a){this.parentEl=c.parentNode;this.prevEl=c.previousSibling;this.supr(b,c,a)},onScopeDestroy:function(){delete this.prevEl;delete this.parentEl;this.supr()},onChange:function(){var b=this,c=b.watcher.getLastResult(),a=b.parentEl,d=b.node,e=function(){b.prevEl?a.insertBefore(d,b.prevEl?b.prevEl.nextSibling:null):a.appendChild(d)},g=function(){a.removeChild(d)};c?sa(d)||(b.initial?e():Y(d,"enter",e,!0)):sa(d)&&(b.initial?g():Y(d,"leave",null,!0).done(g));b.initial=!1}}));N("mjs-ignore",0,pa);N("mjs-include",
900,function(b,c,a,d){b=new oa({scope:b,node:c,url:a,parentRenderer:d});return b.ownRenderer?!1:b.initPromise});N("mjs-init",250,function(b,c,a){c.removeAttribute("mjs-init");Na(a)(b)});var aa=MetaphorJs.removeListener=function(b,c,a){b.detachEvent?b.detachEvent("on"+c,a):b.removeEventListener(c,a,!1)},lb=MetaphorJs.isSubmittable=function(b){var c=b.type?b.type.toLowerCase():"";return"input"==b.nodeName.toLowerCase()&&"radio"!=c&&"checkbox"!=c},Oa=navigator.userAgent.toLowerCase(),mb=function(){var b=
parseInt((/android (\d+)/.exec(Oa)||[])[1],10)||!1;return function(){return b}}(),$a=function(){var b=parseInt((/msie (\d+)/.exec(Oa)||[])[1],10);isNaN(b)&&(b=parseInt((/trident\/.*; rv:(\d+)/.exec(Oa)||[])[1],10)||!1);return function(){return b}}(),ab=function(){var b={};return function(c){if(void 0===b[c]){if("input"==c&&9==$a())return b[c]=!1;var a=document.createElement("div");b[c]=!!("on"+c in a)}return b[c]}}();(function(){var b=function(b,a,d,e){this.el=b;this.cb=a;this.scb=e;this.cbContext=
d;this.inputType=a=b.getAttribute("mjs-input-type")||b.type.toLowerCase();this.listeners=[];this.submittable=lb(b);"radio"==a?this.initRadioInput():"checkbox"==a?this.initCheckboxInput():this.initTextInput()};b.prototype={el:null,inputType:null,cb:null,scb:null,cbContext:null,listeners:[],radio:null,submittable:!1,destroy:function(){var b=this.inputType,a=this.listeners,d=this.radio,e=this.el,g,f,l,h;g=0;for(f=a.length;g<f;g++)if("radio"==b)for(l=0,h=d.length;l<h;l++)aa(d[l],a[g][0],a[g][1]);else aa(e,
a[g][0],a[g][1]);delete this.radio;delete this.el;delete this.cb;delete this.cbContext},initRadioInput:function(){var b=this.el,a=b.type,b=b.name,d,e,g;this.onRadioInputChangeDelegate=v(this.onRadioInputChange,this);if(document.querySelectorAll)d=document.querySelectorAll("input[name="+b+"]");else{var f=document.getElementsByTagName("input"),l;d=[];e=0;for(g=f.length;e<g;e++)l=f[e],l.type==a&&l.name==b&&d.push(l)}this.radio=d;this.listeners.push(["click",this.onRadioInputChangeDelegate]);e=0;for(g=
d.length;e<g;e++)E(d[e],"click",this.onRadioInputChangeDelegate)},initCheckboxInput:function(){this.onCheckboxInputChangeDelegate=v(this.onCheckboxInputChange,this);this.listeners.push(["click",this.onCheckboxInputChangeDelegate]);E(this.el,"click",this.onCheckboxInputChangeDelegate)},initTextInput:function(){var b=!1,a=this,d=a.el,e=a.listeners,g;if(!mb()){var f=function(){b=!0},l=function(){b=!1;h()};e.push(["compositionstart",f]);e.push(["compositionend",l]);E(d,"compositionstart",f);E(d,"compositionend",
l)}var h=a.onTextInputChangeDelegate=function(){if(!b)a.onTextInputChange()};if(ab("input"))e.push(["input",h]),E(d,"input",h);else{var q=function(a){g||(g=window.setTimeout(function(){h(a);g=null},0))},f=function(b){b=b||window.event;var d=b.keyCode;if(13==d&&a.submittable&&a.scb)return a.scb.call(a.cbContext,b);91===d||15<d&&19>d||37<=d&&40>=d||q(b)};e.push(["keydown",f]);E(d,"keydown",f);ab("paste")&&(e.push(["paste",q]),e.push(["cut",q]),E(d,"paste",q),E(d,"cut",q))}e.push(["change",h]);E(d,"change",
h)},processValue:function(b){switch(this.inputType){case "number":b=parseInt(b,10),isNaN(b)&&(b=0)}return b},onTextInputChange:function(){var b=this.getValue();this.cb.call(this.cbContext,b)},onCheckboxInputChange:function(){var b=this.el;this.cb.call(this.cbContext,b.checked?b.getAttribute("value")||!0:!1)},onRadioInputChange:function(b){b=b||window.event;this.cb.call(this.cbContext,(b.target||b.srcElement).value)},setValue:function(b){var a=this.inputType,d,e;if("radio"==a)for(a=this.radio,d=0,
e=a.length;d<e;d++){if(a[d].value==b){a[d].checked=!0;break}}else"checkbox"==a?(a=this.el,a.checked=!0===b||b==a.value):Ma(this.el,b)},getValue:function(){var b=this.inputType,a,d;if("radio"==b){b=this.radio;a=0;for(d=b.length;a<d;a++)if(b[a].checked)return b[a].value;return null}return"checkbox"==b?this.el.checked?this.el.getAttribute("value")||!0:!1:this.processValue(ma(this.el))}};MetaphorJs.lib.Input=b})();var bb=MetaphorJs.lib.Input;N("mjs-model",1E3,L(null,"MetaphorJs.view.AttributeHandler",
{inProg:!1,input:null,binding:null,initialize:function(b,c,a){this.node=c;this.input=new bb(c,this.onInputChange,this);this.binding=c.getAttribute("mjs-data-binding")||"both";var d=this.input.getValue();this.supr(b,c,a);b=this.watcher.getLastResult();if("scope"!=this.binding&&this.watcher&&(d||b&&this.watcher.hasInputPipes()))this.onInputChange(b||d)},onInputChange:function(b){var c=this.scope;"scope"!=this.binding&&(b&&"string"==typeof b&&-1!=b.indexOf("\\{")&&(b=b.replace(/\\{/g,"{")),this.watcher.setValue(b),
this.inProg=!0,c instanceof W?c.$root.$check():this.watcher.checkAll(),this.inProg=!1)},destroy:function(){this.input.destroy();delete this.input;this.supr()},onChange:function(){var b=this.watcher.getLastResult();"input"==this.binding||this.inProg||this.input.setValue(b)}}));N("mjs-options",100,L(null,"MetaphorJs.view.AttributeHandler",{model:null,getterFn:null,defOption:null,prevGroup:null,groupEl:null,fragment:null,initialize:function(b,c,a){this.parseExpr(a);c.removeAttribute("mjs-options");this.node=
c;this.scope=b;for(this.defOption=c.options.length?c.options[0]:null;c.firstChild;)c.removeChild(c.firstChild);this.defOption&&this.defOption.setAttribute("mjs-default-option","");try{this.watcher=ka(b,this.model,this.onChange,this)}catch(d){la(d)}this.render(Z(this.watcher.getValue()))},onChange:function(){this.render(Z(this.watcher.getValue()))},renderOption:function(b,c,a){var d=this.groupEl||this.fragment,e=$a();a.item=b;a.$index=c;b=this.getterFn(a);void 0!=b.group&&(b.group=""+b.group);b.group!==
this.prevGroup&&(b.group?(this.groupEl=d=document.createElement("optgroup"),d.setAttribute("label",b.group),b.disabledGroup&&d.setAttribute("disabled","disabled"),this.fragment.appendChild(d)):(d=this.fragment,this.groupEl=null));this.prevGroup=b.group;c=document.createElement("option");c.setAttribute("value",b.value);c.text=b.name;e&&9>e&&(c.innerHTML=b.name);b.disabled&&c.setAttribute("disabled","disabled");d.appendChild(c)},render:function(b){var c=this.node,a=ma(c),d=this.defOption,e=this.scope.$new(),
g,f;this.fragment=document.createDocumentFragment();for(this.groupEl=this.prevGroup=null;c.firstChild;)c.removeChild(c.firstChild);g=0;for(f=b.length;g<f;g++)this.renderOption(b[g],g,e);d&&c.insertBefore(d,c.firstChild);e.$destroy();c.appendChild(this.fragment);this.fragment=null;Ma(c,a)},parseExpr:function(b){var c=b.indexOf(" in "),a;-1==c?(a=b,b="{name: .item, value: .$index}"):(a=b.substr(c+4),b=b.substr(0,c));this.model=a;this.getterFn=Za(b)}}));(function(){var b="selected checked disabled readonly required open".split(" "),
c,a;c=0;for(a=b.length;c<a;c++)(function(a){N("mjs-"+a,1E3,L(null,"MetaphorJs.view.AttributeHandler",{onChange:function(){this.watcher.getLastResult()?this.node.setAttribute(a,!0):this.node.removeAttribute(a)}}))})(b[c])})();var nb=MetaphorJs.parentData=function(b,c){for(var a;b;){a=H(b,c);if(void 0!=a)return a;b=b.parentNode}},cb=function(b){var c=nb(b,"mjs-transclude");if(c){b.firstChild&&H(b,"mjs-transclude",ja(b.childNodes));var a=b.parentNode,d=b.nextSibling,c=va(c),e=Z(c.childNodes);a.removeChild(b);
a.insertBefore(c,d);return e}return null};N("mjs-transclude",1E3,function(b,c){return cb(c)});N("mjs-view",200,function(b,c,a){c.removeAttribute("mjs-view");ra(a||"MetaphorJs.cmp.View",{scope:b,node:c},b,c);return!1});Ha("mjs-include",900,function(b,c,a,d){return(new oa({scope:b,node:c,tpl:c.getAttribute("src"),parentRenderer:d,replace:!0})).initPromise});Ha("mjs-transclude",900,function(b,c){return cb(c)});(function(){var b=function(a,b,c){if(""===b||"undefined"==typeof b)return!0;if("undefined"!=
typeof a){if("boolean"==typeof a)return a===b;if(c instanceof RegExp)return b.test(""+a);if("strict"==c)return""+a===""+b;if(!0===c||null===c||"undefined"==typeof c)return-1!=""+a.indexOf(b);if(!1===c)return-1==""+a.indexOf(b)}return!1},c=function(a,d,c){if("object"!=typeof a)return"undefined"==typeof d.$?!0:b(a,d.$,c);var g,f;for(g in d)if("$"==g)for(f in a){if(b(a[f],d.$,c))return!0}else if(b(a[g],d[g],c))return!0;return!1};U("filter.filter",function(a,b,e,g){b=e;"object"!=typeof b&&(b={$:b});e=
[];var f,l;f=-1;for(l=a.length;++f<l;)c(a[f],b,g)&&e.push(a[f]);return e})})();U("filter.fromList",function(b,c,a){a=a||", ";return b&&b.length?(G(b)||(b=Z(b)),b.join(a)):""});U("filter.limitTo",function(b,c,a){c=typeof b;if(!G(b)&&"string"!=c)return b;a=Infinity===Math.abs(Number(a))?Number(a):parseInt(a,10);if("string"==c)return a?0<=a?b.slice(0,a):b.slice(a,b.length):"";c=[];var d;a>b.length?a=b.length:a<-b.length&&(a=-b.length);0<a?d=0:(d=b.length+a,a=b.length);for(;d<a;d++)c.push(b[d]);return c});
U("filter.linkify",function(b,c,a){return b?b.replace(/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/ig,'<a href="$1"'+(a?' target="'+a+'"':"")+">$1</a>"):""});U("filter.lowercase",function(b){return b.toLowerCase()});MetaphorJs.dateFormats={};U("filter.moment",function(b,c,a){a=db[a]||a;return moment(b).format(a)});var db=MetaphorJs.numberFormats={};U("filter.numeral",function(b,c,a){a=db[a]||a;return numeral(b).format(a)});U("filter.sortBy",function(b,c,a,d){d||(d="asc");
b=b.slice();b.sort(function(b,d){var c=typeof b,l=b,h=d;if(c!=typeof d)return 0;"object"==c&&(l=b[a],h=d[a]);if("number"==typeof l)return l-h;l=(""+l).toLowerCase();h=(""+h).toLowerCase();return l===h?0:l>h?1:-1});return"desc"==d?b.reverse():b});U("filter.toArray",function(b){return Z(b)});U("filter.toList",function(b,c,a,d){d=d||void 0;a=a||"/\\n|,/";if(!b)return[];b=""+b;"/"==a.substr(0,1)&&"/"==a.substr(a.length-1)&&(a=Ba(a.substring(1,a.length-1)));b=b.split(a,d);c=-1;for(a=b.length;++c<a;b[c]=
O(b[c]));return b});U("filter.ucfirst",function(b){return b.substr(0,1).toUpperCase()+b.substr(1)});U("filter.uppercase",function(b){return b.toUpperCase()});var ob=MetaphorJs.initApp=function(b,c,a){b.removeAttribute("mjs-app");try{return ra(c||"MetaphorJs.cmp.App",!1,a,b,[b,a])}catch(d){return la(d),P.reject(d)}};(MetaphorJs.onReady=function(b){var c=!1,a=!0,d=window,e=d.document,g=e.documentElement,f=function(a){if("readystatechange"!=a.type||"complete"==e.readyState)aa("load"==a.type?d:e,a.type,
f),!c&&(c=!0)&&b.call(d,a.type||a)},l=function(){try{g.doScroll("left")}catch(a){setTimeout(l,50);return}f("poll")};if("complete"==e.readyState)b.call(d,"lazy");else{if(e.createEventObject&&g.doScroll){try{a=!d.frameElement}catch(h){}a&&l()}E(e,"DOMContentLoaded",f);E(e,"readystatechange",f);E(d,"load",f)}})(function(){var b=Q("[mjs-app]"),c,a,d,e=function(a){a.run()};c=-1;for(a=b.length;++c<a;)d=b[c],ob(d,d.getAttribute&&d.getAttribute("mjs-app")).done(e)});var eb=function(b,c){var a,d;if(!b||"string"!==
typeof b)return null;try{d=new DOMParser,a=d.parseFromString(b,c||"text/xml")}catch(e){a=void 0}if(!a||a.getElementsByTagName("parsererror").length)throw"Invalid XML: "+b;return a};(function(){var b=/#.*$/,c=/([?&])_=[^&]*/,a=/\?/,d=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,e=/^(?:GET|HEAD)$/i,g=0,f=function(a,b,d){var c,e;if("string"==typeof a&&d)b.push(encodeURIComponent(d)+"="+encodeURIComponent(a));else if(G(a)&&d)for(c=0,e=a.length;c<e;c++)f(a[c],b,d+"["+c+"]");else if("object"==
typeof a)for(c in a)a.hasOwnProperty(c)&&f(a[c],b,d?d+"["+c+"]":c)},l=function(d,k){d.replace(b,"");if(!1===k.cache){var g=(new Date).getTime();return c.test(d)?d.replace(c,"$1_="+g):d+(a.test(d)?"&":"?")+"_="+g}!k.data||window.FormData&&k.data instanceof window.FormData||("string"!=typeof k.data?(g=[],f(k.data,g,null),g=g.join("&").replace(/%20/g,"+")):g=k.data,k.data=g,e.test(k.method)&&(d+=(a.test(d)?"&":"?")+k.data,k.data=null));return d},h={xml:"application/xml, text/xml",html:"text/html",script:"text/javascript, application/javascript",
json:"application/json, text/javascript",text:"text/plain",_default:"*/*"},q={url:null,data:null,method:"GET",headers:null,username:null,password:null,cache:null,dataType:null,timeout:0,contentType:"application/x-www-form-urlencoded",xhrFields:null,jsonp:!1,jsonpParam:null,jsonpCallback:null,transport:null,replace:!1,selector:null,form:null,beforeSend:null,progress:null,uploadProgress:null,processResponse:null,callbackScope:null},I={},z=new da,C=function(a){var b;b=eval;a&&(/^[^\S]*use strict/.test(a)?
(b=document.createElement("script"),b.text=a,document.head.appendChild(b).parentNode.removeChild(b)):b(a))},w=function(a,b,d){var c,e;if("object"!=typeof a&&"function"!=typeof a&&d)c=document.createElement("input"),c.setAttribute("type","hidden"),c.setAttribute("name",d),c.setAttribute("value",a),b.appendChild(c);else if(G(a)&&d)for(c=0,e=a.length;c<e;c++)w(a[c],b,d+"["+c+"]");else if("object"==typeof a)for(c in a)a.hasOwnProperty(c)&&w(a[c],b,d?d+"["+c+"]":c)},k=function(a){for(var b,d,c="",e=0;e<
a.elements.length;e++)if(b=a.elements[e],b.hasAttribute("name"))if(d="INPUT"===b.nodeName.toUpperCase()?b.getAttribute("type").toUpperCase():"TEXT","FILE"===d)for(d=0;d<b.files.length;c+="&"+encodeURIComponent(b.name)+"="+encodeURIComponent(b.files[d++].name));else if("RADIO"!==d&&"CHECKBOX"!==d||b.checked)c+="&"+encodeURIComponent(b.name)+"="+encodeURIComponent(b.value);return c},p=function(a,b,d){var c=b?b.dataType:null;b=b?b.selector:null;if("string"!=typeof a)return a;d=d||"";if("xml"===c||!c&&
0<=d.indexOf("xml"))return a=eb(O(a)),b?Q(b,a):a;if("html"===c)return a=eb(a,"text/html"),b?Q(b,a):a;if("fragment"==c){d=document.createDocumentFragment();c=document.createElement("div");for(c.innerHTML=a;c.firstChild;)d.appendChild(c.firstChild);return d}if("json"===c||!c&&0<=d.indexOf("json"))return a=O(a),a="undefined"!=typeof JSON?JSON.parse(a):(new Function("return "+a))(),a;("script"===c||!c&&0<=d.indexOf("javascript"))&&C(a);return a+""},u=function(a){var b=d.exec(("undefined"!=typeof window?
window.location.href:"").toLowerCase())||[],c=d.exec(a.url.toLowerCase());this._opt=a;a.crossDomain=!(!c||c[1]===b[1]&&c[2]===b[2]&&(c[3]||("http:"===c[1]?"80":"443"))===(b[3]||("http:"===b[1]?"80":"443")));b=new P;"iframe"!=a.transport||a.form?a.form&&(this._form=a.form,"POST"!=a.method||"undefined"!=typeof window&&window.FormData||"iframe"==a.transport||(a.transport="iframe")):(this.createForm(),a.form=this._form);a.form&&"iframe"!=a.transport&&(a.data="POST"==a.method?new FormData(a.form):k(a.form));
a.url=l(a.url,a);c=!a.crossDomain&&"script"!=a.transport||a.form?"iframe"==a.transport?new V(a,b,this):new A(a,b,this):new n(a,b,this);this._deferred=b;this._transport=c;b.done(function(a){z.trigger("success",a)});b.fail(function(a){z.trigger("error",a)});b.always(function(){z.trigger("end")});z.trigger("start");a.timeout&&(this._timeout=setTimeout(v(this.onTimeout,this),a.timeout));a.jsonp&&this.createJsonp();!1===z.trigger("beforeSend",a,c)&&(this._promise=P.reject());a.beforeSend&&!1===a.beforeSend.call(a.callbackScope,
a,c)&&(this._promise=P.reject());this._promise||(Ra(c.send,c),b.abort=v(this.abort,this),b.always(this.destroy,this),this._promise=b)};u.prototype={_jsonpName:null,_transport:null,_opt:null,_deferred:null,_promise:null,_timeout:null,_form:null,_removeForm:!1,promise:function(){return this._promise},abort:function(a){this._transport.abort();this._deferred.reject(a||"abort")},onTimeout:function(){this.abort("timeout")},createForm:function(){var a=document.createElement("form");a.style.display="none";
a.setAttribute("method",this._opt.method);w(this._opt.data,a,null);document.body.appendChild(a);this._form=a;this._removeForm=!0},createJsonp:function(){var b=this._opt,d=b.jsonpParam||"callback",c=b.jsonpCallback||"jsonp_"+ ++g;b.url+=(a.test(b.url)?"&":"?")+d+"="+c;this._jsonpName=c;"undefined"!=typeof window&&(window[c]=v(this.jsonpCallback,this));"undefined"!=typeof global&&(global[c]=v(this.jsonpCallback,this));return c},jsonpCallback:function(a){try{this._deferred.resolve(this.processResponseData(a))}catch(b){this._deferred.reject(b)}},
processResponseData:function(a,b){var d=this._opt;a=p(a,d,b);z.hasListener("processResponse")&&(a=z.trigger("processResponse",a,this._deferred));d.processResponse&&(a=d.processResponse.call(d.callbackScope,a,this._deferred));return a},processResponse:function(a,b){var d=this._deferred;if(this._opt.jsonp)if(a){try{C(a)}catch(c){d.reject(c)}d.isPending()&&d.reject("jsonp script didn't invoke callback")}else d.reject("jsonp script is empty");else try{d.resolve(this.processResponseData(a,b))}catch(e){d.reject(e)}},
destroy:function(){this._timeout&&clearTimeout(this._timeout);this._form&&this._form.parentNode&&this._removeForm&&this._form.parentNode.removeChild(this._form);this._transport.destroy();delete this._transport;delete this._opt;delete this._deferred;delete this._promise;delete this._timeout;delete this._form;this._jsonpName&&("undefined"!=typeof window&&delete window[this._jsonpName],"undefined"!=typeof global&&delete global[this._jsonpName])}};var x=function(a,b){b=b||{};a&&"string"!=typeof a?b=a:
b.url=a;if(!b.url&&(b.form&&(b.url=b.form.getAttribute("action")),!b.url))throw"Must provide url";r(b,I,!1,!0);r(b,q,!1,!0);b.method=b.method?b.method.toUpperCase():b.form?b.form.getAttribute("method").toUpperCase()||"GET":"GET";return(new u(b)).promise()};x.setup=function(a){r(I,a,!0,!0)};x.on=function(){z.on.apply(z,arguments)};x.un=function(){z.un.apply(z,arguments)};x.get=function(a,b){b=b||{};b.method="GET";return x(a,b)};x.post=function(a,b){b=b||{};b.method="POST";return x(a,b)};x.load=function(a,
b,d){d=d||{};"string"!=typeof b&&(d=b);d.dataType="fragment";return x(b,d).done(function(b){if(d.replace)for(;a.firstChild;)a.removeChild(a.firstChild);a.appendChild(b)})};x.loadScript=function(a){return x(a,{transport:"script"})};x.submit=function(a,b){b=b||{};b.form=a;return x(null,b)};var A=function(a,b,d){var c;if(!(window.XMLHttpRequest&&(c=new XMLHttpRequest)||(c=new ActiveXObject("Msxml2.XMLHTTP"))||(c=new ActiveXObject("Microsoft.XMLHTTP"))))throw"Unable to create XHR object";this._xhr=c;
this._deferred=b;this._opt=a;this._ajax=d;a.progress&&E(c,"progress",v(a.progress,a.callbackScope));a.uploadProgress&&c.upload&&E(c.upload,"progress",v(a.uploadProgress,a.callbackScope));try{var e;if(a.xhrFields)for(e in a.xhrFields)c[e]=a.xhrFields[e];a.data&&a.contentType&&c.setRequestHeader("Content-Type",a.contentType);c.setRequestHeader("X-Requested-With","XMLHttpRequest");c.setRequestHeader("Accept",a.dataType&&h[a.dataType]?h[a.dataType]+", */*; q=0.01":h._default);for(e in a.headers)c.setRequestHeader(e,
a.headers[e])}catch(k){}c.onreadystatechange=v(this.onReadyStateChange,this)};A.prototype={_xhr:null,_deferred:null,_ajax:null,onReadyStateChange:function(){var a=this._xhr,b=this._deferred;if(0===a.readyState)a.onreadystatechange=B,b.resolve(a);else if(4===a.readyState){a.onreadystatechange=B;var d;a:{try{d=!a.status&&"undefined"!=typeof location&&"file:"==location.protocol||200<=a.status&&300>a.status||304===a.status||1223===a.status;break a}catch(c){}d=!1}d?this._ajax.processResponse("string"==
typeof a.responseText?a.responseText:void 0,a.getResponseHeader("content-type")||""):b.reject(a)}},abort:function(){this._xhr.onreadystatechange=B;this._xhr.abort()},send:function(){var a=this._opt;try{this._xhr.open(a.method,a.url,!0,a.username,a.password),this._xhr.send(a.data)}catch(b){this._deferred.reject(b)}},destroy:function(){delete this._xhr;delete this._deferred;delete this._opt;delete this._ajax}};var n=function(a,b,d){this._opt=a;this._ajax=d;this._deferred=b};n.prototype={_opt:null,_deferred:null,
_ajax:null,_el:null,send:function(){var a=document.createElement("script");a.setAttribute("async","async");a.setAttribute("charset","utf-8");a.setAttribute("src",this._opt.url);E(a,"load",v(this.onLoad,this));E(a,"error",v(this.onError,this));document.head.appendChild(a);this._el=a},onLoad:function(a){this._deferred&&this._deferred.resolve(a)},onError:function(a){this._deferred.reject(a)},abort:function(){this._el.parentNode&&this._el.parentNode.removeChild(this._el)},destroy:function(){this._el.parentNode&&
this._el.parentNode.removeChild(this._el);delete this._el;delete this._opt;delete this._ajax;delete this._deferred}};var V=function(a,b,d){this._opt=a;this._ajax=d;this._deferred=b};V.prototype={_opt:null,_deferred:null,_ajax:null,_el:null,send:function(){var a=document.createElement("iframe"),b="frame-"+ ++g,d=this._opt.form;a.setAttribute("id",b);a.setAttribute("name",b);a.style.display="none";document.body.appendChild(a);d.setAttribute("action",this._opt.url);d.setAttribute("target",b);E(a,"load",
v(this.onLoad,this));E(a,"error",v(this.onError,this));this._el=a;try{d.submit()}catch(c){this._deferred.reject(c)}},onLoad:function(){var a=this._el;this._opt&&!this._opt.jsonp&&(a=a.contentDocument||a.contentWindow.document,a=a.body.innerHTML,this._ajax.processResponse(a))},onError:function(a){this._deferred.reject(a)},abort:function(){this._el.parentNode&&this._el.parentNode.removeChild(this._el)},destroy:function(){this._el.parentNode&&this._el.parentNode.removeChild(this._el);delete this._el;
delete this._opt;delete this._ajax;delete this._deferred}};MetaphorJs.ajax=x})();var na=MetaphorJs.ajax,ga=MetaphorJs.factory;(function(){var b={},c={};L("MetaphorJs.data.Model",{type:null,fields:null,record:null,store:null,plain:!1,initialize:function(a){this.fields={};r(this,{record:{load:null,save:null,"delete":null,id:null,data:null,success:null,extra:{}},store:{load:null,save:null,"delete":null,id:null,data:null,total:null,start:null,limit:null,success:null,extra:{}}},!1,!0);r(this,a,!0,!0);
this.plain=!this.type},isPlain:function(){return this.plain},getRecordProp:function(a,b){return this.getProp("record",a,b)},setRecordProp:function(a,b){this.record[a]=b},getStoreProp:function(a,b){return this.getProp("store",a,b)},setStoreProp:function(a,b){this.store[a]=b},getProp:function(a,b,c){a=this[a];return a[b]&&a[b][c]||a[c]||this[c]||null},setProp:function(a,b){return this[a]=b},_createAjaxCfg:function(a,b,c,g){var f=this,l=f[a],h=r({},"string"==typeof l[b]?{url:l[b]}:l[b]),q=f.getProp(a,
b,"id"),v=f.getProp(a,b,"data"),z=f.getProp(a,b,"url"),C=f.getProp(a,b,"json");if(!h)if(z)h={url:z};else throw a+"."+b+" not defined";"string"==typeof h&&(h={url:h});if(!h.url){if(!z)throw a+"."+b+" url not defined";h.url=z}h.data=r({},h.data,f.extra,l.extra,l[b]?l[b].extra:{},!1,!0);h.method||(h.method="load"==b?"GET":"POST");c&&(h.data[q]=c);g&&(v?h.data[v]=g:h.data=g);C&&h.data&&"GET"!=h.method&&(h.data=JSON.stringify(h.data));h.callbackScope=f;"record"==a?h.processResponse=function(a,c){f._processRecordResponse(b,
a,c)}:"store"==a&&(h.processResponse=function(a,c){f._processStoreResponse(b,a,c)});return h},_processRecordResponse:function(a,b,c){var g=this.getRecordProp(a,"id"),f=this.getRecordProp(a,"data"),g=(f=f?b[f]:b)&&f[g]||b[g];this._getSuccess("record",a,b)?c.resolve({id:g,data:f}):c.reject(b)},_processStoreResponse:function(a,b,c){var g=this.getStoreProp(a,"data"),f=this.getStoreProp(a,"total"),g=g?b[g]:b,f=f?b[f]:null;this._getSuccess("store",a,b)?c.resolve({data:g,total:f}):c.reject(b)},_getSuccess:function(a,
b,c){return(a=this.getProp(a,b,"success"))&&void 0!=c[a]?c[a]:!0},loadRecord:function(a){return na(this._createAjaxCfg("record","load",a))},saveRecord:function(a,b,c){return na(this._createAjaxCfg("record",a.getId()?"save":"create",a.getId(),r({},a.storeData(a.getData(b)),c)))},deleteRecord:function(a){return na(this._createAjaxCfg("record","delete",a.getId()))},loadStore:function(a,b){return na(r(this._createAjaxCfg("store","load"),b,!0,!0))},saveStore:function(a,b){return na(this._createAjaxCfg("store",
"save",null,b))},deleteRecords:function(a,b){return na(this._createAjaxCfg("store","delete",b))},getFields:function(){return this.fields},restoreField:function(a,b,c){var g=this.fields[b];if(g){switch("string"==typeof g?g:g.type){case "int":c=parseInt(c);break;case "bool":case "boolean":"string"==typeof c?(c=c.toLowerCase(),c=!("off"===c||"no"===c||"0"===c||"false"==c||"null"==c)):c=c?!0:!1;break;case "double":case "float":c=parseFloat(c);break;case "date":g.parseFn?c=g.parseFn(c,g.format):Date.parse?
c=Date.parse(c,g.format):("timestamp"==g.format&&(c=1E3*parseInt(c)),c=new Date(c))}g.restore&&(c=g.restore.call(a,c,b))}return this.onRestoreField(a,b,c)},onRestoreField:function(a,b,c){return c},storeField:function(a,b,c){var g=this.fields[b];if(g){switch("string"==typeof g?g:g.type){case "bool":case "boolean":c=c?"1":"0";break;case "date":c=g.formatFn?g.formatFn(c,g.format):Date.format?Date.format(c,g.format):"timestamp"==g.format?c.getTime()/1E3:c.format?c.format(g.format):c.toString();break;
default:c=c.toString()}g.store&&(c=g.store.call(a,c,b))}return this.onStoreField(a,b,c)},onStoreField:function(a,b,c){return c}},{create:function(a,c){return"MetaphorJs.data.Model"==a?ga(a,c):c?ga(a,c):b[a]?b[a]:b[a]=ga(a)},addToCache:function(a){var b=a.getClass(),e=a.getId();"MetaphorJs.data.Record"!=b&&(c[b]||(c[b]={}),c[b][e]=a)},getFromCache:function(a,b){return c[a]&&c[a][b]?c[a][b]:null},removeFromCache:function(a,b){c[a]&&c[a][b]&&delete c[a][b]}})})();var fb=MetaphorJs.isInstanceOf,za=MetaphorJs.data.Model;
L("MetaphorJs.data.Record","MetaphorJs.cmp.Base",{id:null,data:null,orig:null,modified:null,loaded:!1,dirty:!1,destroyed:!1,model:null,standalone:!0,stores:null,initialize:function(b,c,a){var d=arguments.length;1==d?(a=b,c=b=null):2==d&&(a=c,c=null);this.data={};this.orig={};this.stores=[];this.modified={};a=a||{};this.supr(a);"string"==typeof this.model?this.model=ga(this.model):fb(this.model,"MetaphorJs.data.Model")||(this.model=ga("MetaphorJs.data.Model",this.model));this.id=b;c?this.importData(c):
!1!==a.autoLoad&&b&&this.load();"MetaphorJs.data.Record"!=this.getClass()&&za.addToCache(this)},isLoaded:function(){return this.loaded},isStandalone:function(){return this.standalone},isDirty:function(){return this.dirty},getModel:function(){return this.model},attachStore:function(b){b=b.getId();-1==this.stores.indexOf(b)&&this.stores.push(b)},detachStore:function(b){b=b.getId();var c;this.destroyed||-1==(c=this.stores.indexOf(b))||(this.stores.splice(c,1),0!=this.stores.length||this.standalone||
this.destroy())},setDirty:function(b){this.dirty!=b&&(this.dirty=!!b,this.trigger("dirtychange",this,b))},importData:function(b){var c={},a;if(b){for(a in b)c[a]=this.model.restoreField(this,a,b[a]);this.data=c}this.orig=r({},this.data);this.modified={};this.loaded=!0;this.setDirty(!1)},storeData:function(b){var c={},a;for(a in b)c[a]=this.model.storeField(this,a,b[a]);return c},getId:function(){return this.id},getData:function(b){if(b){var c={},a,d;b="string"==typeof b?[b]:b;a=0;for(d=b.length;a<
d;a++)c[b[a]]=this.data[b[a]];return c}return r({},this.data)},getChanged:function(){return r({},this.modified)},isChanged:function(b){return this.modified[b]||!1},get:function(b){return this.data[b]},setId:function(b){!this.id&&b&&(this.id=b)},set:function(b,c){var a=this.data[b];c=this.model.restoreField(this,b,c);this.data[b]=c;a!=c&&(this.modified[b]=!0,this.setDirty(!0),this.trigger("change",this,b,c,a),this.trigger("change-"+b,this,b,c,a))},revert:function(){this.dirty&&(this.data=r({},this.orig),
this.modified={},this.setDirty(!1))},load:function(){var b=this;b.trigger("beforeload",b);return b.model.loadRecord(b.id).done(function(c){b.setId(c.id);b.importData(c.data);b.trigger("load",b)}).fail(function(){b.trigger("failedload",b)})},save:function(b,c){var a=this;a.trigger("beforesave",a);return a.model.saveRecord(a,b,c).done(function(b){a.setId(b.id);a.importData(b.data);a.trigger("save",a)}).fail(function(b){a.trigger("failedsave",a)})},"delete":function(){var b=this;b.trigger("beforedelete",
b);return b.model.deleteRecord(b).done(function(){b.trigger("delete",b);b.destroy()}).fail(function(){b.trigger("faileddelete",b)})},reset:function(){this.id=null;this.data={};this.orig={};this.modified={};this.dirty=this.loaded=!1;this.trigger("reset",this)},destroy:function(){this.destroyed||(this.destroyed=!0,this.trigger("destroy",this),this.stores=this.model=this.modified=this.orig=this.data=null,za.removeFromCache(this.getClass(),this.id),this.supr())}});var ha=MetaphorJs.data.Record;(function(){var b=
0,c={};L("MetaphorJs.data.Store","MetaphorJs.cmp.Base",{id:null,autoLoad:!1,clearOnLoad:!0,model:null,extraParams:null,loaded:!1,loading:!1,local:!1,items:null,map:null,keys:null,length:0,totalLength:0,start:0,pageSize:null,pages:null,filtered:!1,filterBackup:null,filterFn:null,filterScope:null,filterParams:null,initialize:function(a,d,e){this.items=[];this.map={};this.keys=[];this.loaded=!1;this.extraParams=this.extraParams||{};a&&"string"!=typeof a&&(e=d,d=a,a=null);d=d||{};this.supr(d);this.id=
this.id||++b;c[this.id]=this;"string"==typeof this.model?this.model=ga(this.model):fb(this.model,za)||(this.model=ga("MetaphorJs.data.Model",this.model));if(a||d.url)this.model.store.load=a||d.url;!this.local&&this.autoLoad?this.load():e&&(G(e)?this.loadArray(e):this.loadAjaxData(e));this.local&&(this.loaded=!0)},getId:function(){return this.id},isLoaded:function(){return this.loaded},isLocal:function(){return this.local},setLocal:function(a){this.local=!!a},isLoading:function(){return this.loading},
isFiltered:function(){return this.filtered},getLength:function(){return this.length},getTotalLength:function(){return this.filtered?this.length:this.totalLength||this.length},getPagesCount:function(){return null!==this.pageSize?parseInt(this.totalLength/this.pageSize):1},setParam:function(a,b){this.extraParams[a]=b},getParam:function(a){return this.extraParams[a]},setStart:function(a){this.start=a},setPageSize:function(a){this.pageSize=a},getAjaxData:function(){return this.ajaxData},hasDirty:function(){if(this.model.isPlain())return!1;
var a=!1;this.each(function(b){return b.isDirty()?(a=!0,!1):!0});return a},getDirty:function(){var a=[];if(this.model.isPlain())return a;this.each(function(b){b.isDirty()&&a.push(b)});return a},getModel:function(){return this.model},importData:function(a){this.suspendAllEvents();for(var b=0;b<a.length;b++)this.add(a[b]);this.resumeAllEvents();this.loaded=!0;this.loading=!1;this.onLoad();this.trigger("load",this)},load:function(a){var b=this,c=b.model.store,g=c.start,c=c.limit;if(b.local)return null;
a=r({},b.extraParams,a||{});null===b.pageSize||a[g]||a[c]||(a[g]=b.start,a[c]=b.pageSize);return!1===b.trigger("beforeload",b)?null:b.model.loadStore(b,a).done(function(a){b.totalLength=parseInt(a.total);b.importData(a.data);b.totalLength=parseInt(a.total)}).fail(function(a){b.onFailedLoad();b.trigger("failedload",b,a)})},onLoad:B,onFailedLoad:B,save:function(){var a=this,b={},c=0;if(a.local)return null;if(a.model.isPlain())throw Error("Cannot save plain store");a.each(function(a){a.isDirty()&&(b[a.getId()]=
a.storeData(a.getData()),c++)});if(!c)throw Error("Nothing to save");return!1===a.trigger("beforesave",a,b)?null:a.model.saveStore(a,b).done(function(b){var c,d,e=b.data;if(e&&e.length)for(b=0,c=e.length;b<c;b++)d=a.getRecordId(e[b]),(d=a.getById(d))&&d.importData(e[b]);a.onSave();a.trigger("save",a)}).fail(function(){a.onFailedSave();a.trigger("failedsave",a)})},onSave:B,onFailedSave:B,deleteById:function(a){var b=this,c,g,f;if(b.local)return null;if(!a||G(a)&&!a.length)throw Error("Record id required");
G(a)||(a=[a]);c=0;for(g=a.length;c<g;c++)f=b.getById(a[c]),f instanceof ha?f.destroy():b.removeId(a[c]);return!1===b.trigger("beforedelete",b,a)?null:b.model.deleteRecords(b,a).done(function(){b.onDelete();b.trigger("delete",b,a)}).fail(function(){b.onFailedDelete();b.trigger("faileddelete",b,a)})},onDelete:B,onFailedDelete:B,deleteAt:function(a){var b=this.getAt(a);if(!b)throw Error("Record not found at "+a);return this.deleteRecord(b)},"delete":function(a){return this.deleteById(this.getRecordId(a))},
deleteRecords:function(a){var b=[],c,g;c=0;for(g=a.length;c<g;c++)b.push(this.getRecordId(a[c]));return this.deleteById(b)},loadAjaxData:function(a){var b=this;!1!==b.trigger("beforeload",b)&&b.model._processStoreResponse("load",a,{resolve:function(a,c){b.importData(a);b.totalLength=parseInt(c)},reject:function(){}})},loadArray:function(a,b){!1!==this.trigger("beforeload",this)&&(!b&&this.clearOnLoad&&0<this.length&&this.clear(),G(a)&&(this.importData(a),this.totalLength=this.length))},loadOr:function(a,
b){this.local||this.isLoading()||(this.isLoaded()?a&&a.call(b||this):this.load())},addNextPage:function(){!this.local&&this.length<this.totalLength&&this.load({start:this.length,limit:this.pageSize},!0)},loadNextPage:function(){this.local||(this.start+=this.pageSize,this.load())},loadPrevPage:function(){this.local||(this.start-=this.pageSize,this.load())},getRecordId:function(a){return a instanceof ha?a.getId():a[this.model.getStoreProp("load","id")]||null},processRawDataItem:function(a){if(a instanceof
ha||this.model.isPlain())return a;var b=this.model.type,c=this.getRecordId(a),g;c&&(g=za.getFromCache(b,c));g||(g=ga(b,c,a,{model:this.model,standalone:!1}));return g},bindRecord:function(a,b){b[a]("change",this.onRecordChange,this);b[a]("destroy",this.onRecordDestroy,this);b[a]("dirtychange",this.onRecordDirtyChange,this);return b},onRecordDirtyChange:function(a){this.trigger("update",this,a)},onRecordChange:function(a,b,c,g){this.trigger("update",this,a)},onRecordDestroy:function(a){this.remove(a)},
add:function(a,b,c){if(this.filtered)throw"Cannot add to filtered store";if("string"!=typeof a&&"number"!=typeof a){b=a;if(G(b)){if(!b.length)return;a=this.length;for(var g=0,f=b.length;g<f;g++)b[g]=this.processRawDataItem(b[g]),this.add(this.getRecordId(b[g]),b[g],!0);this.onAdd(a,b);c||this.trigger("add",a,b);return}b=this.processRawDataItem(b);a=this.getRecordId(b)}if("undefined"!=typeof a&&null!==a){if("undefined"!=typeof this.map[a]){this.replace(a,b);return}this.map[a]=b}this.length++;this.items.push(b);
this.keys.push(a);b instanceof ha&&(b.attachStore(this),this.bindRecord("on",b));this.onAdd(this.length-1,[b]);c||this.trigger("add",this.length-1,[b])},onAdd:B,removeAt:function(a){if(a<this.length&&0<=a){this.length--;this.totalLength--;var b=this.items[a];this.items.splice(a,1);var c=this.keys[a];"undefined"!=typeof c&&delete this.map[c];this.keys.splice(a,1);this.onRemove(b,c);this.trigger("remove",b,c);return b instanceof ha?(this.bindRecord("un",b),b.detachStore(this),null):b}return!1},onRemove:B,
insert:function(a,b,c,g){if(this.filtered)throw Error("Cannot insert into filtered store");2==arguments.length&&(c=arguments[1],b=this.getRecordId(c));c=this.processRawDataItem(c);this.containsId(b)&&(this.suspendAllEvents(),this.removeId(b),this.resumeAllEvents());if(a>=this.length)return this.add(b,c,g);this.length++;this.items.splice(a,0,c);"undefined"!=typeof b&&null!==b&&(this.map[b]=c);this.keys.splice(a,0,b);c instanceof ha&&(c.attachStore(this),this.bindRecord("on",c));this.onAdd(a,[c]);g||
this.trigger("add",a,[c]);return c},replace:function(a,b){var c,g;1==arguments.length&&(b=arguments[0],a=this.getRecordId(b));b=this.processRawDataItem(b);c=this.map[a];if("undefined"==typeof a||null===a||"undefined"==typeof c)return this.add(a,b);c instanceof ha&&(this.bindRecord("un",c),c.detachStore(this));g=this.indexOfId(a);this.items[g]=b;this.map[a]=b;b instanceof ha&&(this.bindRecord("on",b),b.attachStore(this));this.onReplace(a,c,b);this.trigger("replace",a,c,b);return b},onReplace:B,remove:function(a){return this.removeAt(this.indexOf(a))},
removeId:function(a){return this.removeAt(this.indexOfId(a))},contains:function(a){return-1!=this.indexOf(a)},containsId:function(a){return"undefined"!=typeof this.map[a]},clear:function(){var a=this.getRange();this.clearFilter(!0);this._reset();this.onClear();this.trigger("clear",a)},onClear:B,reset:function(){this._reset()},_reset:function(a){var b,c;if(!a)for(a=0,b=this.items.length;a<b;a++)c=this.items[a],c instanceof ha&&(this.bindRecord("un",c),c.detachStore(this));this.totalLength=this.length=
this.start=0;this.items=[];this.keys=[];this.map={};this.loaded=this.local},filter:function(a,b,c){this.filtered&&this.clearFilter(!0);this.filtered=!0;this.filterFn=a;this.filterScope=b;this.filterParams=c;this.trigger("beforefilter",this);this.suspendAllEvents();this.filterBackup={length:this.length,items:this.items,keys:this.keys,map:this.map};this._reset(!0);a=this.filterBackup.keys;b=this.filterBackup.items;c=0;for(var g=b.length;c<g;c++)this._filterRecord(b[c],a[c])&&(this.items.push(b[c]),
this.keys.push(a[c]),this.length++,this.map[a[c]]=b[c]);this.resumeAllEvents();this.onFilter();this.trigger("filter",this)},onFilter:B,_filterRecord:function(a,b){return this.filtered&&this.filterFn.call(this.filterScope,a,b,this.filterParams)},clearFilter:function(a){this.filtered&&(a||this.trigger("beforeclearfilter",this),this.suspendAllEvents(),this.filtered=!1,this._reset(!0),this.length=this.filterBackup.length,this.items=this.filterBackup.items,this.keys=this.filterBackup.keys,this.map=this.filterBackup.map,
this.filterBackup=null,this.resumeAllEvents(),this.onClearFilter(),a||this.trigger("clearfilter",this))},onClearFilter:B,getAt:function(a){return this.items[a]||null},getById:function(a){return this.map[a]||null},indexOf:function(a){return this.items.indexOf(a)},indexOfId:function(a){return this.keys.indexOf(a)},each:function(a,b){var c=[].concat(this.items);b=b||window;for(var g=0,f=c.length;g<f&&!1!==a.call(b,c[g],g,f);g++);},eachId:function(a,b){b=b||window;for(var c=0,g=this.keys.length;c<g;c++)a.call(b,
this.keys[c],this.items[c],c,g)},collect:function(a){var b=[],c=!this.model.isPlain();this.each(function(g){(g=c?g.get(a):g[a])&&b.push(g)});return b},first:function(){return this.items[0]},last:function(){return this.items[this.length-1]},getRange:function(a,b){var c=this.items;if(1>c.length)return[];a=a||0;b=Math.min("undefined"==typeof b||null===b?this.length-1:b,this.length-1);var g,f=[];if(a<=b)for(g=a;g<=b;g++)f[f.length]=c[g];else for(g=a;g>=b;g--)f[f.length]=c[g];return f},findBy:function(a,
b,c){a=this.findIndexBy(a,b,c);return-1==a?null:this.getAt(a)},findIndexBy:function(a,b,c){b=b||this;var g=this.keys,f=this.items;c=c||0;for(var l=f.length;c<l;c++)if(a.call(b,f[c],g[c]))return c;return-1},find:function(a,b,c){var g=!this.model.isPlain(),f;return this.findIndexBy(function(l){f=g?l.get(a):l[a];return c?f===b:f==b},this)},findExact:function(a,b){return this.find(a,b,!0)},findBySet:function(a){var b=null,c,g;this.each(function(f){c=!0;for(g in a)if(a[g]!=f[g]){c=!1;break}return c?(b=
f,!1):!0});return b},onDestroy:function(){delete c[this.id];this.clear();this.supr()}},{createFromSelect:function(a){var b=[];a=a.options;for(var c=0,g=a.length;c<g;c++){var f=a[c],l=(f.hasAttribute?f.hasAttribute("value"):f.getAttributeNode("value").specified)?f.value:f.text;b.push([l,f.text])}a=ga("MetaphorJs.data.Store",{server:{load:{id:0}}});a.loadArray(b);return a},lookupStore:function(a){return c[a]||null},eachStore:function(a,b){for(var e in c)if(!1===a.call(b||window,c[e]))break}})})();var gb=
MetaphorJs.isVisible=function(b){return!(0>=b.offsetWidth||0>=b.offsetHeight)},Pa=MetaphorJs.is=function(b,c){var a=Q(c,b.parentNode),d,e;d=-1;for(e=a.length;++d<e;)if(a[d]===b)return!0;return!1};(function(){var b=function(a){return a.substr(0,1).toUpperCase()+a.substr(1)},c=function(a,b){var c=a.style,d;for(d in b)c[d]=b[d]},a=function(a){var b;b=d();var c=e();if(a===window)c=document.documentElement,b={left:0,right:c.clientWidth,top:b,bottom:c.clientHeight+b,width:c.clientWidth,height:c.clientHeight};
else if(a.getBoundingClientRect)a=a.getBoundingClientRect(),b={left:a.left+c,top:a.top+b,right:a.right+c,bottom:a.bottom+b},b.width=b.right-b.left,b.height=b.bottom-b.top;else{var k=a.style;b={left:(parseInt(k.left,10)||0)+c,top:(parseInt(k.top,10)||0)+b,width:a.offsetWidth,height:a.offsetHeight,right:0,bottom:0}}b.getCenter=function(){return this.width/2};b.getCenterX=function(){return this.left+this.width/2};return b},d=function(){if("undefined"!=typeof window.pageYOffset)return window.pageYOffset;
var a=document.body,b=document.documentElement;return(b.clientHeight?b:a).scrollTop},e=function(){if("undefined"!=typeof window.pageXOffset)return window.pageXOffset;var a=document.body,b=document.documentElement;return(b.clientWidth?b:a).scrollLeft},g={},f=function(a,b,c,d){var k=b+"-"+c,e=function(a){a=X(a);return Pa(a.target,b)?d(a):null};g[k]||(g[k]=[]);g[k].push({el:a,ls:e,fn:d});E(a,c,e)},l=function(a,b,c,d){var k,e;if(e=g[b+"-"+c])for(b=-1,k=e.length;++b<k;)e[b].el===a&&e[b].fn===d&&aa(a,c,
e[b].ls)},h={t:"b",r:"l",b:"t",l:"r"},q={t:"top",r:"right",b:"bottom",l:"left"},v={t:["l","r"],r:["t","b"],b:["r","l"],l:["b","t"]},z=document.all&&!window.XMLHttpRequest,C=function(){var a={},b={};return{register:function(c){var d=c.getInstanceId(),k=c.getGroup(),e,f,g;a[d]=c;e=0;for(f=k.length;e<f;e++)g=k[e],b[g]||(b[g]={}),b[g][d]=!0;c.on("destroy",this.unregister,this)},unregister:function(b){b=b.getInstanceId();delete a[b]},hideAll:function(c){var d=c.getInstanceId();c=c.getGroup();var k,e,f,
g;k=0;for(e=c.length;k<e;k++)for(g in f=c[k],f=b[f],f)a[g]?g==d||a[g].isHideAllIgnored()||a[g].hide(null,!0,!0):delete f[g]}}}(),w=function(d,k,e){var f,g=this,p,u={backgroundColor:"transparent",width:"0px",height:"0px",position:"absolute",fontSize:"0px",lineHeight:"0px"},l=k.size,s=k.width||2*l;r(g,{init:function(){k.border&&g.createInner()},getEl:function(){return f},getDialogPositionOffset:function(){var a=(g.detectPointerPosition()||"").substr(0,1),b=(d.getCfg().position.type||"").replace(/(w|m|c)/,
"").substr(0,1),c={x:0,y:0};a==h[b]&&(c["t"==a||"b"==a?"y":"x"]="b"==a||"r"==a?-l:l);return c},createInner:function(){var a=r({},k);a.size=l-2*k.border;a.width=s-4*k.border;delete a.border;delete a.borderColor;delete a.borderCls;delete a.offset;p=new w(d,a,k.border)},detectPointerPosition:function(){if(k.position)return k.position;var a=(d.getCfg().position.type||"").replace(/(w|m|c)/,"").substr(0,1);return a?h[a]:null},detectPointerDirection:function(a){return k.direction?k.direction:a},getBorders:function(a,
c,d){var k={},e=a.substr(0,1);a=c.substr(0,1);var f=c.substr(1);c=z?"dotted":"solid";k["border"+b(q[h[e]])]=l+"px solid "+d;k["border"+b(q[e])]="0 "+c+" transparent";f?(k["border"+b(q[f])]="0 solid transparent",k["border"+b(q[h[f]])]=s+"px "+c+" transparent"):(d=Math.floor(s/2),k["border"+b(q[v[a][0]])]=d+"px "+c+" transparent",k["border"+b(q[v[a][1]])]=d+"px "+c+" transparent");return k},getOffsets:function(c,d){var g={},p=c.substr(0,1),u="t"==p||"b"==p?"r":"b";if(!l)switch(document.body.appendChild(f),
p){case "t":case "b":l=a(f).height;s=a(f).width;break;case "l":case "r":s=a(f).height,l=a(f).width}g[q[p]]=e?"auto":-l+"px";g[q[u]]="auto";if(e){var p=d.substr(0,1),x=d.substr(1);g[q[h[u]]]=x?"l"==x||"t"==x?e+"px":-s-e+"px":Math.floor(-s/2)+"px";g[q[h[p]]]=-(l+2*e)+"px"}else{switch(c){case "t":case "r":case "b":case "l":p=d!=c?"l"==d||"t"==d?k.offset:-s+k.offset:-s/2+k.offset;break;case "bl":case "tl":case "lt":case "rt":p=k.offset;break;default:p=-s-k.offset}g["margin"+b(q[h[u]])]=p+"px";switch(c){case "t":case "r":case "b":case "l":p=
"50%";break;case "tr":case "rb":case "br":case "lb":p="100%";break;default:p=0}g[q[h[u]]]=p}return g},render:function(){if(!f){var a=g.detectPointerPosition();if(a)if(k.el){if("string"==typeof k.el){var b=document.createElement("div");b.innerHTML=k.el;f=b.firstChild}else f=k.el;c(f,{position:"absolute"});c(f,g.getOffsets(a));M(f,k.cls);d.getElem().appendChild(f)}else{b=g.detectPointerDirection(a);f=document.createElement("div");var l=document.createComment(" ");f.appendChild(l);c(f,u);c(f,g.getBorders(a,
b,k.borderColor||k.color));c(f,g.getOffsets(a,b));M(f,k.borderCls||k.cls);p&&(p.render(),f.appendChild(p.getEl()));e||d.getElem().appendChild(f)}}},destroy:function(){g.remove();p=g=null},remove:function(){p&&p.remove();f&&(f.parentNode.removeChild(f),f=null)}},!0,!1);g.init();return g},k=function(a){if(!a)return{};var b=function(b,c,d){var k=a[b],e=!1;if(void 0!==k){switch(d){case "string":e="string"==typeof k;break;case "function":e="function"==typeof k;break;case "number":e="number"==typeof k||
k==parseInt(k);break;case "dom":e=k&&(k.tagName||k.nodeName)?!0:!1;break;case "jquery":(e=k&&k.jquery?!0:!1)&&(k=k.get(0));break;case "boolean":if(!0===k||!1===k)e=!0;break;default:!0===d&&!0===k&&(e=!0),!1===d&&!1===k&&(e=!0)}e&&(a[b]={},a[b][c]=k)}};b("content","value","string");b("content","value","boolean");b("content","fn","function");b("ajax","url","string");b("cls","dialog","string");b("render","tpl","string");b("render","fn","function");b("render","el","dom");b("render","el","jquery");b("show",
"events",!1);b("show","events","string");b("hide","events",!1);b("hide","events","string");b("toggle","events",!1);b("toggle","events","string");b("position","type","string");b("position","type",!1);b("position","get","function");b("overlay","enabled","boolean");b("pointer","position","string");b("pointer","size","number");return a},p={target:null,debug:!1,group:null,modal:!1,useHref:!1,content:{value:"",fn:null,prepare:null,attr:null},ajax:{url:null,data:null,dataType:"text",method:"GET"},cls:{dialog:null,
visible:null,hidden:null,loading:null},selector:{content:null},buttons:null,render:{tpl:"<div></div>",fn:null,el:null,zIndex:null,lazy:!0,style:null,appendTo:null,id:null,keepVisible:!1,keepInDOM:!1,lifetime:null},events:{show:{click:{preventDefault:!0,stopPropagation:!0,returnValue:!1,process:null}}},show:{delay:null,single:!1,events:null,animate:!1,ignoreHideAll:!1,focus:!1,preventScroll:!1},hide:{delay:null,timeout:null,events:null,destroy:!1,animate:!1,cancelShowDelay:!0},toggle:{events:null},
position:{type:"t",offsetX:0,offsetY:0,axis:null,get:null,screenX:!1,screenY:!1,resize:!0},pointer:{position:null,direction:null,size:0,width:null,color:null,offset:0,border:0,borderColor:null,el:null,cls:null,borderCls:null},overlay:{enabled:!1,color:"#000",opacity:.5,cls:null,animateShow:!1,animateHide:!1,preventScroll:!1},callback:{scope:null,contentchange:null,beforeshow:null,show:null,beforehide:null,hide:null,render:null,lifetime:null,targetchange:null,button:null}},u=function(b,g){b&&"string"!=
typeof b&&(g=b,b=null);g=g||{};var n=this,h={},q=ia(),D=new da,m=r({},p,k(u.defaults),k(u[b]),k(g),!0,!0),z=m.callback.scope||h,s,v,y,t={bindSelfOnRender:!1,target:null,visible:!1,enabled:!0,frozen:!1,rendered:!1,hideTimeout:null,hideDelay:null,showDelay:null,dynamicTarget:!1,dynamicTargetEl:null,images:0,position:null,destroyDelay:null};g=null;r(h,D.getApi(),{getElem:function(){return s},getInstanceId:function(){return q},getCfg:function(){return r({},m)},getGroup:function(){return m.group?"string"==
typeof m.group?[m.group]:m.group:[""]},setTarget:function(a){if(!a)return h;var b=!1,c=t.target;t.target?(n.setHandlers("unbind","_target"),b=!0):t.dynamicTarget&&(b=!0);"string"==typeof a?(t.dynamicTarget=!0,t.target=null):(t.dynamicTarget=!1,t.target=a);b&&(n.setHandlers("bind","_target"),n.trigger("targetchange",h,a,c));return h},getTarget:function(){return t.dynamicTarget?t.dynamicTargetEl:m.target},isEnabled:function(){return t.enabled},isVisible:function(){return t.visible},isHideAllIgnored:function(){return m.show.ignoreHideAll},
isFrozen:function(){return t.frozen},enable:function(){t.enabled=!0;return h},disable:function(){n.hide();t.enabled=!1;return h},freeze:function(){t.frozen=!0;return h},unfreeze:function(){t.frozen=!1;return h},toggle:function(a,b){return a&&a.stopPropagation&&t.dynamicTarget&&t.visible&&n.isDynamicTargetChanged(a)?n.show(a):n[t.visible?"hide":"show"](a,b)},show:function(a,b){var c=a&&a.stopPropagation?null:h,d=m.show;if(!h.isEnabled())return m.debug&&console.log("show: not enabled",h.getTarget()),
c;a&&a.stopPropagation&&m.events.show&&m.events.show[a.type]&&(c=m.events.show[a.type],c.process?c=c.process(h,a):(c.stopPropagation&&a.stopPropagation(),c.preventDefault&&a.preventDefault(),c=c.returnValue));if(t.visible&&t.hideTimeout)return window.clearTimeout(t.hideTimeout),t.hideTimeout=window.setTimeout(n.hide,m.hide.timeout),m.debug&&console.log("show: hide timeout was set",h.getTarget()),c;if(t.hideDelay)return window.clearTimeout(t.hideDelay),t.hideDelay=null,t.visible=!0,m.debug&&console.log("show: hide delay was set; already shown",
h.getTarget()),c;if(t.frozen)return m.debug&&console.log("show: frozen",h.getTarget()),c;t.destroyDelay&&(window.clearTimeout(t.destroyDelay),t.destroyDelay=null);var k=!1;a&&a.stopPropagation&&t.dynamicTarget&&(k=n.changeDynamicTarget(a));if(t.visible)if(k)if(m.render.fn)n.hide(null,!0);else return n.reposition(a),c;else return m.debug&&console.log("show: already shown",s),c;s?k&&n.changeDynamicContent():n.render();if(!1===n.trigger("beforeshow",h,a))return m.debug&&console.log("show: beforeshow return false",
h.getTarget()),c;xa(s);t.visible=!0;d.single&&C.hideAll(n);n.toggleTitleAttribute(!1);d.delay&&!b?t.showDelay=window.setTimeout(function(){n.showAfterDelay(a)},d.delay):n.showAfterDelay(a,b);return c},hide:function(a,b,c){t.hideTimeout=null;var d=a&&a.stopPropagation?null:h;a&&a.stopPropagation&&m.events.hide&&m.events.hide[a.type]&&(d=m.events.hide[a.type],d.process?d=d.process(h,a):(d.stopPropagation&&a.stopPropagation(),d.preventDefault&&a.preventDefault(),d=d.returnValue));!t.visible&&t.hideDelay&&
b&&(window.clearTimeout(t.hideDelay),t.hideDelay=null,t.visible=!0);if(!s||!t.visible||!n.isEnabled())return m.debug&&console.log("hide: elem/visible/enabled: ",s,t.visible,n.isEnabled()),d;if(t.showDelay)return m.hide.cancelShowDelay||c?(window.clearTimeout(t.showDelay),t.showDelay=null,t.visible=!1,m.debug&&console.log("hide: cancelShowDelay: ",n.getTarget())):m.debug&&console.log("hide: show delay was set",n.getTarget()),d;if(t.frozen)return m.debug&&console.log("hide: frozen",n.getTarget()),d;
if(!1===n.trigger("beforehide",h,a))return m.debug&&console.log("hide: beforehide returned false",n.getTarget()),d;xa(s);t.visible=!1;n.toggleTitleAttribute(!0);t.dynamicTarget&&n.resetDynamicTarget();m.hide.delay&&!b?t.hideDelay=window.setTimeout(function(){n.hideAfterDelay(a)},m.hide.delay):n.hideAfterDelay(a,b);return d},setPositionType:function(a){a&&("function"==typeof a?(m.position.get=a,m.position.type=!1):(m.position.get=null,m.position.type=a));a=m.position.type;!1===a?t.position=!1:m.position.get&&
"m"!=a?t.position="fn":(a=a.substr(0,1),t.position="w"==a?"window":"m"==a?"mouse":"target");v&&(v.remove(),s&&v.render())},getPosition:function(a){if(!s)return null;var b,c=m.position;switch(t.position){case !1:return null;case "target":b=n.getTargetPosition(a);break;case "mouse":b=n.getMousePosition(a);break;case "window":b=n.getWindowPosition(a);break;case "fn":b=c.get.call(z,h,a)}if(!1!==c.screenX||!1!==c.screenY)b=n.correctScreenPosition(b,c.screenX,c.screenY);return b},reposition:function(a){a&&
(a=X(a));if(a=n.getPosition(a))void 0!=a.x&&c(s,{left:a.x+"px"}),void 0!=a.y&&c(s,{top:a.y+"px"}),void 0==a.x&&void 0==a.y&&c(s,a)},getContentElem:function(){return s?m.selector.content?Q(m.selector.content,s).shift()||s:s:null},setContent:function(a,b){b=b||"";if(!s)return m.content.value=a,h;m.content.prepare&&(a=m.content.prepare(h,b,a));var c=h.getContentElem(),d=t.rendered&&!m.selector.content&&v,k=d&&v.getEl();if(d&&k)try{s.removeChild(k)}catch(e){}if("string"!=typeof a)for(var f in a){var g=
m.selector[f];g&&(g=Q(g,c).shift())&&(g.innerHTML=a[f])}else c.innerHTML=a;if(d&&k)try{s.appendChild(k)}catch(p){}c=Q("img",c);t.images=c.length;f=-1;for(d=c.length;++f<d;E(c[f],"load",n.onImageLoad));n.trigger("contentchange",h,a,b);n.onContentChange();return h},readContent:function(){var a=h.getTarget(),b;a&&(b=m.content.attr?a.getAttribute(m.content.attr):a.getAttribute("tooltip")||a.getAttribute("title")||a.getAttribute("alt"));b&&n.setContent(b,"attribute");return h},loadContent:function(a){M(s,
m.cls.loading);a=r({},m.ajax,a,!0,!0);n.trigger("beforeajax",h,a);return na(a).done(n.onAjaxLoad)},destroy:function(){n.trigger("destroy",h);aa(window,"resize",n.onWindowResize);aa(window,"scroll",n.onWindowScroll);n.destroyElem();v&&(v.destroy(),v=null);n.setHandlers("unbind");D.destroy();y=t=h=n=D=null},setFocus:function(){var a=m.show.focus,b;if(!0===a)if(a=Q("input",s).concat(Q("textarea",s)),0<a.length)a[0].focus();else{if(m.buttons)for(b in m.buttons){(b=Q(m.buttons[b],s).shift())&&b.focus();
break}}else(b=Q(a,s).shift())&&b.focus()}},!0,!1);r(n,h,{init:function(){C.register(n);m.modal&&(m.overlay.enabled=!0);n.setPositionType();n.setTarget(m.target);if(m.pointer.size||m.pointer.el)v=new w(n,m.pointer);m.render.lazy||n.render();n.setHandlers("bind")},setHandlers:function(a,b){for(var c=["show","hide","toggle"],d="bind"==a?E:aa,k="bind"==a?f:l,e,g,p,u,x,A,q,r,v,w;e=c.shift();)if(g=m[e].events,!1!==g){if("string"==typeof g||G(g))t.dynamicTarget?(x={},x[g]=m.target,g={_html:x}):g={_target:g};
for(p in g){if(b)if("_self"==b){if("_self"!=p&&"_overlay"!=p&&">"!=p.substr(0,1))continue}else if(p!=b)continue;if("_self"!=p&&"_overlay"!=p&&">"!=p.substr(0,1)||s){if(q=g[p]){switch(p){case "_target":r=[n.getTarget()];break;case "_self":r=[s];break;case "_window":r=[window];break;case "_document":r=[document];break;case "_html":r=[document.documentElement];break;case "_overlay":r=[y];break;default:r=">"==p.substr(0,1)?Q(p.substr(1),s):Q(p)}if(r&&r.length)if("string"==typeof q&&(q=[q]),G(q))for(x=
0,A=q.length;x<A;x++)for(v=-1,w=r.length;++v<w;d(r[v],q[x],h[e]));else for(u in q)for(v=-1,w=r.length;++v<w;k(r[v],q[u],u,h[e]));}}else t.bindSelfOnRender=!0}}},resetDynamicTarget:function(){var a=t.dynamicTargetEl;a&&(n.setHandlers("unbind","_target"),n.trigger("targetchange",h,null,a))},isDynamicTargetChanged:function(a){var b=m.target;a=a.target;for(var c=t.dynamicTargetEl;a&&!Pa(a,b);)a=a.parentNode;return a?!c||c!==a:!1},changeDynamicTarget:function(a){var b=m.target;a=a.target;for(var c=t.dynamicTargetEl;a&&
!Pa(a,b);)a=a.parentNode;if(!a||c&&c===a)return!1;c&&n.setHandlers("unbind","_target");t.dynamicTargetEl=a;n.setHandlers("bind","_target");n.trigger("targetchange",h,a,c);return!0},showAfterDelay:function(a,b){t.showDelay=null;if(t.visible){m.position.manual||n.reposition(a);"mouse"==t.position&&E(document.documentElement,"mousemove",n.onMouseMove);var c=m.position;(c.resize||c.screenX||c.screenY)&&E(window,"resize",n.onWindowResize);(c.scroll||c.screenX||c.screenY)&&E(window,"scroll",n.onWindowScroll);
if(b||!1!==n.trigger("afterdelay",h,a)){y&&(m.overlay.animateShow?n.animate("show",null,!0):y.style.display="");if(m.show.preventScroll){var c=m.show.preventScroll,d,k;!0===c&&(c="body");c=Q(c);d=-1;for(k=c.length;++d<k;E(c[d],"mousewheel",n.onPreventScroll)&&E(c[d],"touchmove",n.onPreventScroll));}m.show.animate&&!b?n.animate("show").done(function(){n.showAfterAnimation(a)}):n.showAfterAnimation(a)}else t.visible=!1,m.debug&&console.log("showAfterDelay: afterdelay returned false",h.getTarget())}else m.debug&&
console.log("showAfterDelay: already hidden",n.getTarget())},showAfterAnimation:function(a){t.visible?(R(s,m.cls.hidden),M(s,m.cls.visible),m.render.keepVisible||(s.style.display=""),m.hide.timeout&&(t.hideTimeout=window.setTimeout(n.hide,m.hide.timeout)),m.show.focus&&window.setTimeout(n.setFocus,20),n.trigger("show",h,a)):m.debug&&console.log("showAfterAnimation: already hidden",n.getTarget())},hideAfterDelay:function(a,b){t.hideDelay=null;if(t.visible)m.debug&&console.log("hideAfterDelay: already shown again",
n.getTarget());else{"mouse"==t.position&&aa(document.documentElement,"mousemove",n.onMouseMove);var c=m.position;(c.resize||c.screenX||c.screenY)&&aa(window,"resize",n.onWindowResize);(c.scroll||c.screenX||c.screenY)&&aa(window,"scroll",n.onWindowScroll);if(b||!1!==n.trigger("afterhidedelay",h,a)){if(m.show.preventScroll){var c=m.show.preventScroll,d,k;!0===c&&(c="body");c=Q(c);d=-1;for(k=c.length;++d<k;aa(c[d],"mousewheel",n.onPreventScroll)&&aa(c[d],"touchmove",n.onPreventScroll));}y&&(m.overlay.animateShow?
n.animate("hide",null,!0).done(function(){y.style.display="none"}):y.style.display="none");m.hide.animate&&!b?n.animate("hide").done(function(){n.hideAfterAnimation(a)}):n.hideAfterAnimation(a)}else t.visible=m.cls.hidden?!qa(s,m.cls.hidden):gb(s),m.debug&&console.log("hideAfterDelay: afterhdelay returned false",n.getTarget())}},hideAfterAnimation:function(a){t.visible?m.debug&&console.log("hideAfterAnimation: already shown again",n.getTarget()):(R(s,m.cls.visible),M(s,m.cls.hidden),m.render.keepVisible||
(s.style.display="none"),n.trigger("hide",h,a),a=m.render.lifetime,null!==a&&(0===a?n.destroyElem():t.destroyDelay=window.setTimeout(n.destroyElem,a)),s&&m.hide.destroy&&window.setTimeout(function(){H(s,m.instanceName,null);n.destroy()},0))},render:function(){if(s)m.debug&&console.log("element already rendered",s);else{var a=m.render,b=m.cls;if(a.fn){var d=a.fn.call(z,h);a["string"==typeof d?"tpl":"el"]=d}a.el?"string"==typeof a.el?(s=Q(a.el).shift(),a.keepInDOM=!0):s=a.el:(d=document.createElement("div"),
d.innerHTML=a.tpl,s=d.firstChild);s||(s=document.createElement("div"));a.id&&s.setAttribute("id",a.id);m.render.keepVisible||(s.style.display="none");M(s,b.dialog);M(s,b.hidden);a.style&&c(s,a.style);m.overlay.enabled&&(y=document.createElement("div"),c(y,{display:"none",position:"fixed",left:0,top:0,right:0,bottom:0,opacity:m.overlay.opacity,backgroundColor:m.overlay.color}),document.body.appendChild(y),E(y,"click",n.onOverlayClick),a.zIndex&&c(y,{zIndex:a.zIndex}),m.overlay.cls&&M(y,m.overlay.cls));
a.appendTo?a.appendTo.appendChild(s):!1!==a.appendTo&&document.body.appendChild(s);a.zIndex&&c(s,{zIndex:a.zIndex});a=m.content;if(!1!==a.value)if(a.value)n.setContent(a.value);else if(a.fn)n.setContent(a.fn.call(z,h));else n[m.ajax.url?"loadContent":"readContent"]();v&&v.render();if(m.buttons)for(var k in m.buttons)if(a=Q(m.buttons[k],s).shift())H(a,"metaphorjsTooltip-button-id",k),E(a,"click",n.onButtonClick),E(a,"keyup",n.onButtonKeyup);t.bindSelfOnRender&&(n.setHandlers("bind","_self"),t.bindSelfOnRender=
!1);t.rendered=!0;n.trigger("render",h)}},animate:function(a,b,c){var d,k;d=c?"show"==a?m.overlay.animateShow:m.overlay.animateHide:m[a].animate;"function"==typeof d&&(d=d(n,b));k=d.skipDisplayChange||!1;"boolean"==typeof d?d=a:"string"==typeof d&&(d=[d]);return Y(s,d,function(){"show"!=a||k||(c?y.style.display="":s.style.display="")})},toggleTitleAttribute:function(a){var b=h.getTarget(),c;b&&(!1===a?(H(b,"tmp-title",b.getAttribute("title")),b.removeAttribute("title")):(c=H(b,"tmp-title"))&&b.setAttribute("title",
c))},changeDynamicContent:function(){m.content.fn?n.setContent(m.content.fn.call(z,h)):m.content.attr&&n.readContent()},getDialogSize:function(){var b=m.cls.hidden?qa(s,m.cls.hidden):!gb(s),d,k=s.style.left;b&&(c(s,{left:"-1000px"}),s.style.display="");d={width:a(s).width,height:a(s).height};b&&(c(s,{left:k}),s.style.display="none");return d},getTargetSize:function(){var b=n.getTarget();return b?{width:a(b).width,height:a(b).height}:null},getTargetPosition:function(b,c){var d=n.getTarget();if(!d)return null;
var k=n.getDialogSize(),d=a(d),e=n.getTargetSize(),f={};c=c||m.position.type;var g=c.substr(0,1),p=c.substr(1),u=m.position.offsetX,h=m.position.offsetY,l=v?v.getDialogPositionOffset():null;switch(g){case "t":f.y=d.top-k.height-h;break;case "r":f.x=d.left+e.width+u;break;case "b":f.y=d.top+e.height+h;break;case "l":f.x=d.left-k.width-u}switch(p){case "t":f.y=d.top+h;break;case "r":f.x=d.left+e.width-k.width-u;break;case "b":f.y=d.top+e.height-k.height-h;break;case "l":f.x=d.left+u;break;case "rc":f.x=
d.left+e.width+u;break;case "lc":f.x=d.left-k.width-u;break;case "":switch(g){case "t":case "b":f.x=d.left+e.width/2-k.width/2;break;case "r":case "l":f.y=d.top+e.height/2-k.height/2}}l&&(f.x+=l.x,f.y+=l.y);return f},getMousePosition:function(a){if(!a)return null;var b=n.getDialogSize(),c={},d=m.position.type.substr(1),k=m.position.offsetX,e=m.position.offsetY,f=m.position.axis,g=v?v.getDialogPositionOffset():null;switch(d){case "":c=m.position.get.call(z,h,a);break;case "t":c.y=a.pageY-b.height-
e;c.x=a.pageX-b.width/2;break;case "r":c.y=a.pageY-b.height/2;c.x=a.pageX+k;break;case "b":c.y=a.pageY+e;c.x=a.pageX-b.width/2;break;case "l":c.y=a.pageY-b.height/2;c.x=a.pageX-b.width-k;break;case "rt":c.y=a.pageY-b.height-e;c.x=a.pageX+k;break;case "rb":c.y=a.pageY+e;c.x=a.pageX+k;break;case "lt":c.y=a.pageY-b.height-e;c.x=a.pageX-b.width-k;break;case "lb":c.y=a.pageY+e,c.x=a.pageX-b.width-k}g&&(c.x+=g.x,c.y+=g.y);f&&(a=n.getTargetPosition(a,d))&&("x"==f?c.y=a.y:c.x=a.x);return c},getWindowPosition:function(){var b=
n.getDialogSize(),c={},k=m.position.type.substr(1),f=m.position.offsetX,g=m.position.offsetY,p=d(),u=e(),h=a(window).width,l=a(window).height;switch(k){case "c":c.y=l/2-b.height/2+p;c.x=h/2-b.width/2+u;break;case "t":c.y=p+g;c.x=h/2-b.width/2+u;break;case "r":c.y=l/2-b.height/2+p;c.x=h-b.width+u-f;break;case "b":c.y=l-b.height+p-g;c.x=h/2-b.width/2+u;break;case "l":c.y=l/2-b.height/2+p;c.x=u+f;break;case "rt":c.y=p+g;c.x=h-b.width+u-f;break;case "rb":c.y=l-b.height+p-g;c.x=h-b.width+u-f;break;case "lt":c.y=
p+g;c.x=u+f;break;case "lb":c.y=l-b.height+p-g,c.x=u+f}return c},correctScreenPosition:function(b,c,k){var f=n.getDialogSize(),g=d(),p=e(),u=a(window).width,h=a(window).height;k&&b.y+f.height>h+g-k&&(b.y=h+g-k-f.height);c&&b.x+f.width>u+p-c&&(b.x=u+p-c-f.width);k&&b.y<g+k&&(b.y=g+k);c&&b.x<p+c&&(b.x=p+c);return b},onMouseMove:function(a){n.reposition(X(a))},onWindowResize:function(a){n.reposition(X(a))},onWindowScroll:function(a){n.reposition(X(a))},onPreventScroll:function(a){X(a).preventDefault()},
onOverlayClick:function(a){return m.modal?(a=X(a),a.preventDefault(),a.stopPropagation(),!1):null},onButtonClick:function(a){var b=X(a).target;(b=H(b,"metaphorjsTooltip-button-id"))&&n.trigger("button",h,b,a)},onButtonKeyup:function(a){if(13==a.keyCode||32==a.keyCode){var b=H(a.target,"metaphorjsTooltip-button-id");b&&n.trigger("button",h,b,X(a))}},onAjaxLoad:function(a){R(s,m.cls.loading);n.setContent(a,"ajax")},onImageLoad:function(){t.images--;n.onContentChange()},onContentChange:function(){t.visible&&
n.reposition()},destroyElem:function(){n.setHandlers("unbind","_self");t.bindSelfOnRender=!0;v&&v.remove();y&&(y.parentNode.removeChild(y),y=null);s&&(m.render.keepInDOM||s.parentNode.removeChild(s),s=null);n.trigger("lifetime",h)}},!0,!1);delete m.callback.scope;for(var B in m.callback)h.on(B,m.callback[B],z);m.target&&m.useHref&&(B=m.target.getAttribute("href"),"#"==B.substr(0,1)?m.render.el=B:m.ajax.url=B);n.init();return h};r(u,{defaults:{}});MetaphorJs.lib.Dialog=u;window.jQuery&&(jQuery.fn.metaphorjsTooltip=
function(a,b,c){var d="dialog",k;"string"==typeof a&&"destroy"!=a&&(k=a,a=b,b=c);a=a||{};d+="-"+(b||"default");this.each(function(){var b=H(this,d);if(b)if("destroy"==a)b.destroy(),H(this,d,null);else throw Error("MetaphorJs tooltip already instantiated for this html element");else a.target=this,a.instanceName=d,H(this,d,new u(k,a))})})})();var pb=MetaphorJs.lib.Dialog;L("MetaphorJs.cmp.Dialog","MetaphorJs.cmp.Component",{dialog:null,dialogPreset:null,dialogCfg:null,initComponent:function(){this.supr();
this._createDialog();this._oldShow=this.show;this._oldHide=this.hide},_getDialogCfg:function(){return r({},this.dialogCfg||{},{render:{el:this.node,keepInDOM:!0}},!0,!0)},_createDialog:function(){this.dialog=new pb(this.dialogPreset,this._getDialogCfg());this.dialog.on("show",this._oldShow,this);this.dialog.on("hide",this._oldHide,this);this.dialog.on("destroy",this.onDialogDestroy,this)},show:function(){this.dialog.show()},hide:function(){this.dialog.hide()},onDialogDestroy:function(){this.destroying||
(delete this.dialog,this.destroy())},onDestroy:function(){this.destroying=!0;this.dialog&&this.dialog.destroy();delete this.dialog;delete this.dialogCfg;delete this.dialogPreset;this.supr();this.destroying=!1}});var Aa=function(b,c,a){var d,e=b.childNodes;if(!1!==c.call(a,b))for(b=-1,d=e.length>>>0;++b!==d;Aa(e[b],c,a));};(function(){var b=0,c={},a=function(a,b){var c=0;switch(b.nodeName.toLowerCase()){case "select":return Aa(b,function(a){a.selected&&c++}),c;case "input":if(/radio|checkbox/i.test(b.type))return Aa(b.form,
function(a){a.type==b.type&&a.name==b.name&&a.checked&&c++}),c}return a.length},d=function(b,c){if(!c)return void 0===b||""===b||null===b;switch(c.nodeName.toLowerCase()){case "select":var d=ma(c);return!d||0==d.length;case "input":if(/radio|checkbox/i.test(c.type))return 0==a(b,c)}return 0==O(b).length},e=function(a,b){if("function"==typeof b)return a;G(b)||(b=[b]);var c,d=b.length;for(c=-1;++c<d;a=a.replace(new RegExp("\\{"+c+"\\}","g"),b[c]));return a},g={};r(g,{required:function(a,b,c){return!1===
c?!0:!d(a,b)},regexp:function(a,b,c){c=c instanceof RegExp?c:new RegExp(c);return d(a,b)||c.test(a)},notregexp:function(a,b,c){c=c instanceof RegExp?c:new RegExp(c);return d(a,b)||!c.test(a)},minlength:function(b,c,e){return d(b,c)||(c?a(O(b),c)>=e:b.toString().length>=e)},maxlength:function(b,c,e){return d(b,c)||(c?a(O(b),c)<=e:b.toString().length<=e)},rangelength:function(b,c,e){var f=c?a(O(b),c):b.toString().length;return d(b,c)||f>=e[0]&&f<=e[1]},min:function(a,b,c){return d(a,b)||parseInt(a,
10)>=c},max:function(a,b,c){return d(a,b)||parseInt(a,10)<=c},range:function(a,b,c){a=parseInt(a,10);return d(a,b)||a>=c[0]&&a<=c[1]},email:function(a,b){return d(a,b)||/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i.test(a)},
url:function(a,b){return d(a,b)||/^((https?|ftp):\/\/|)(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(a)},
date:function(a,b){return d(a,b)||!/Invalid|NaN/.test(new Date(a))},dateiso:function(a,b){return d(a,b)||/^\d{4}[\/-]\d{1,2}[\/-]\d{1,2}$/.test(a)},number:function(a,b){return d(a,b)||/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/.test(a)},digits:function(a,b){return d(a,b)||/^\d+$/.test(a)},creditcard:function(a,b){if(d(a,b))return!0;if(/[^0-9-]+/.test(a))return!1;var c=0,e=!1,f;a=a.replace(/\D/g,"");for(var g=a.length-1;0<=g;g--)f=a.charAt(g),f=parseInt(f,10),e&&9<(f*=2)&&(f-=9),c+=f,e=!e;return 0==
c%10},accept:function(a,b,c){c="string"==typeof c?c.replace(/,/g,"|"):"png|jpe?g|gif";return d(a,b)||a.match(new RegExp(".("+c+")$","i"))},equalto:function(a,b,c,d){c=(b=d.getValidator().getField(c))?b.getElem():c;return a==ma(c)},notequalto:function(a,b,c,d){c=(b=d.getValidator().getField(c))?b.getElem():c;return a!=ma(c)},zxcvbn:function(a,b,c){return zxcvbn(a).score>=parseInt(c)}});var f={required:"This field is required.",remote:"Please fix this field.",email:"Please enter a valid email address.",
url:"Please enter a valid URL.",date:"Please enter a valid date.",dateISO:"Please enter a valid date (ISO).",number:"Please enter a valid number.",digits:"Please enter only digits.",creditcard:"Please enter a valid credit card number.",equalTo:"Please enter the same value again.",accept:"Please enter a value with a valid extension.",maxlength:"Please enter no more than {0} characters.",minlength:"Please enter at least {0} characters.",rangelength:"Please enter a value between {0} and {1} characters long.",
range:"Please enter a value between {0} and {1}.",max:"Please enter a value less than or equal to {0}.",min:"Please enter a value greater than or equal to {0}."},l={allowSubmit:!0,alwaysCheck:!1,alwaysDisplayState:!1,data:null,ignore:null,disabled:!1,cls:{valid:"",error:"",ajax:""},errorBox:{cls:"",fn:null,tag:"",position:"after",elem:null,enabled:!0},callback:{scope:null,destroy:null,statechange:null,errorchange:null,submit:null,check:null,beforeAjax:null,afterAjax:null,displaystate:null},rules:{},
messages:{}},h=function(a){if(!a)return{};var b=function(b,c,d){var e=a[b],f=!1;if(void 0!==e){switch(d){case "string":f="string"==typeof e;break;case "function":f="function"==typeof e;break;case "boolean":if(!0===e||!1===e)f=!0}f&&(a[b]={},a[b][c]=e)}};b("errorBox","enabled","boolean");b("errorBox","tag","string");b("errorBox","fn","function");return a},q=function(a,b,c){b=b||{};var d,e;this._observable=new da;r(this,this._observable.getApi());this.cfg=d=r({},l,h(w.fieldDefaults),h(b),!0,!0);this.input=
new bb(a,this.onInputChange,this,this.onInputSubmit);this.elem=a;this.vldr=c;this.callbackScope=e=d.callback.scope;this.enabled=!a.disabled;this.id=a.getAttribute("name")||a.getAttribute.attr("id");this.data=b.data;this.rules={};d.messages=r({},f,w.messages,d.messages,!0,!0);a.setAttribute("data-validator",c.getVldId());this.input.radio&&this.initRadio();for(var g in d.callback)if(d.callback[g])this.on(g,d.callback[g],e);d.rules&&this.setRules(d.rules,!1);this.readRules();this.prev=this.input.getValue();
d.disabled&&this.disable()};q.prototype={vldr:null,elem:null,rules:null,cfg:null,callbackScope:null,input:null,enabled:!0,valid:null,dirty:!1,id:null,prev:"",error:null,errorRule:null,pending:null,rulesNum:0,displayState:!1,data:null,checking:!1,checkTmt:null,errorBox:null,customError:!1,getValidator:function(){return this.vldr},initRadio:function(){var a=this.input.radio,b=this.vldr.getVldId(),c,d;c=0;for(d=a.length;c<d;c++)a[c].setAttribute("data-validator",b)},setRules:function(a,b){b=void 0==
b?!0:b;for(var c in a)this.setRule(c,a[c],!1);b?this.check(!1):this.setValidState(null);return this},setRule:function(a,b,c){var d=this.rules;c=void 0==c?!0:c;null===b?(d[a]&&this.rulesNum--,delete d[a]):(d[a]||this.rulesNum++,d[a]=b,null!==this.valid&&this.setValidState(!1));c?this.check(!1):this.setValidState(null);return this},setMessage:function(a,b){this.cfg.messages[a]=b;return this},setMessages:function(a){for(var b in a)this.setMessage(b,a[b]);return this},getMessages:function(){return r({},
this.cfg.messages)},readRules:function(){var a=this.elem,b=a.className,c={},d,e;for(e in g)g.hasOwnProperty(e)&&(d=a.getAttribute(e)||a.getAttribute("data-validate-"+e),null!==d&&void 0!=d&&!1!==d&&("minlength"!=e&&"maxlength"!=e||-1!=parseInt(d,10))&&(c[e]=d,(d=a.getAttribute("data-message-"+e))&&this.setMessage(e,d)));if(d=a.getAttribute("remote"))c.remote=d;if(b)for(b=b.split(" "),e=0,d=b.length;e<d;e++)if(a=O(b[e]),g[a]||"remote"==a)c[a]=!0;for(e in c)this.setRule(e,c[e],!1)},getRules:function(){return this.rules},
hasRule:function(a){return this.rules[a]?!0:!1},getValue:function(){return this.input.getValue()},getUserData:function(){return this.data},setUserData:function(a){var b=this.data;this.data=a;return b},isEmpty:function(){return d(this.getValue(),this.elem)},enable:function(){this.enabled=!0;this.vldr.reset();return this},disable:function(){this.enabled=!1;!1===this.valid&&(this.setValidState(!0),this.doDisplayState());return this},enableDisplayState:function(){this.displayState=!0},disableDisplayState:function(){this.displayState=
!1},isDisplayStateEnabled:function(){return this.displayState},toggleErrorBox:function(a){var b=this.cfg,c=b.errorBox.enabled;b.errorBox.enabled=a;!c&&a&&a.displayState&&!1===this.valid()&&this.doDisplayState()},isEnabled:function(){return this.enabled},getElem:function(){return this.elem},getName:function(){return this.id},getError:function(){return this.error},getErrorRule:function(){return this.errorRule},isValid:function(){return this.isEnabled()?this.customError?!1:!0===this.valid&&!this.pending||
0===this.rulesNum:!0},getExactValidState:function(){return this.valid},setCustomError:function(a,b){this.customError=a?!0:!1;this.setValidState(a?!1:!0);this.setError(!0===a?null:a,b);this.doDisplayState()},reset:function(){this.abort();this.dirty=!1;this.prev="";this.setValidState(null);this.setError(null);this.doDisplayState();return this},abort:function(){this.pending&&(this.pending.abort(),this.pending=null);return this},check:function(a){var b=this.rules,c=this.cfg,d=this.elem;if(!this.isEnabled())return!0;
if(this.customError)return!1;if(0==this.rulesNum&&!1!==this.valid)return!0;if(this.checking)return this.checkTmt||(this.checkTmt=setTimeout(v(this.checkTimeout,this),100)),!0===this.valid;this.checking=!0;if(!(!0===a||b.equalTo||b.notEqualTo||this.dirty||null===this.valid||c.alwaysCheck))return this.pending||this.doDisplayState(),this.checking=!1,!0===this.valid;var f=!0,h=!1,l=this.getValue(),q,r;for(r in b)if("remote"==r){if(this.dirty||c.alwaysCheck||null===this.valid||!0===a)if(l||b[r].checkEmpty)h=
!0}else if(!0!==(q=("function"==typeof b[r]?b[r]:g[r]).call(this.callbackScope,l,d,b[r],this))){f=!1;this.setError(e(q||c.messages[r]||"",b[r]),r);break}h=h&&f;f&&this.setError(null);h?this.ajaxCheck():(this.setValidState(f),this.doDisplayState());this.checking=this.dirty=!1;this.trigger("check",this,this.valid);return!0===this.valid&&!h},doDisplayState:function(){var a=this.cfg,b=this.isValid(),c=a.cls.error,d=a.cls.valid,e=this.elem;this.displayState||a.alwaysDisplayState||(b=null);null===this.valid&&
(b=null);c&&(!1===b?M(e,c):R(e,c));d&&(!0===b?M(e,d):R(e,d));c=this.getErrorBox();d=this.error;c&&(!1===b&&d&&(c.innerHTML=state.error),c.style.display=!1===b&&d&&a.errorBox.enabled?"block":"none");this.trigger("displaystate",this,b,this.error)},getErrorBox:function(){var a=this.cfg.errorBox;return a.tag||a.fn||a.selector?(!this.errorBox&&a.enabled&&this.createErrorBox(),this.errorBox):null},destroy:function(){this.trigger("destroy",this);this.elem.removeAttribute("data-validator");this.errorBox&&
this.errorBox.parentNode.removeChild(this.errorBox);this.input.destroy();delete this.input;this._observable.destroy();delete this._observable;delete this.vldr;delete this.cfg;delete this.errorBox;delete this.rules;delete this.elem},isPending:function(){return null!==this.pending},setValidState:function(a){this.valid!==a&&(this.valid=a,this.trigger("statechange",this,a))},setError:function(a,b){if(this.error!=a||this.errorRule!=b)this.error=a,this.errorRule=b,this.trigger("errorchange",this,a,b)},
checkTimeout:function(){this.checkTmt=null;this.checking||this.check(!1)},onInputChange:function(a){this.prev!==a&&(this.dirty=!0,this.customError=!1,this.abort(),this.pending||this.check(!1),this.prev=this.input.getValue())},onInputSubmit:function(a){a=X(a);if(!(a.isDefaultPrevented&&a.isDefaultPrevented()||!1!==this.trigger("submit",this,a)))return a.preventDefault(),!1},createErrorBox:function(){var a=this.cfg.errorBox,b=a.tag,c=a.cls,d=a.fn,e=a.position,a=a.elem;d?this.errorBox=d.call(this.callbackScope,
this):a?this.errorBox=a:(this.errorBox=document.createElement(b),this.errorBox.className=c,b=(b=this.input.radio)?b[b-1]:this.elem,"appendParent"==e?b.parentNode.appendChild(this.errorBox):"before"==e?b.parentNode.insertBefore(this.errorBox,b):b.parentNode.insertBefore(this.errorBox,b.nextSibling))},ajaxCheck:function(){var a=this.elem,b=this.rules.remote,c=this.getValue(),d=this.cfg,b=r({},"string"==typeof b?{url:b}:b,!0);b.data=b.data||{};b.data[b.paramName||a.getAttribute("name")||a.getAttribute("id")]=
c;b.handler||(b.dataType="text");b.cache=!1;d.cls.ajax&&M(a,d.cls.ajax);this.trigger("beforeAjax",this,b);this.pending=(window.MetaphorJs?MetaphorJs.ajax:jQuery.ajax)(b);this.pending.done(v(this.onAjaxSuccess,this));this.pending.fail(v(this.onAjaxError,this))},onAjaxSuccess:function(a){var b=this.rules,c=this.cfg;this.pending=null;var d=!0;b.remote.handler?(a=b.remote.handler.call(this.callbackScope,this,a),!0!==a&&(this.setError(e(a||c.messages.remote||"",b.remote),"remote"),d=!1)):a?(this.setError(a,
"remote"),d=!1):this.setError(null);c.cls.ajax&&R(this.elem,c.cls.ajax);this.setValidState(d);this.doDisplayState();this.trigger("afterAjax",this)},onAjaxError:function(a,b){var c=this.cfg;c.cls.ajax&&R(this.elem,c.cls.ajax);this.pending=null;"abort"!=b&&"abort"!=a&&(this.setValidState(!1),this.doDisplayState(),this.trigger("afterAjax",this))}};var B={alwaysCheck:!1,alwaysDisplayState:!1,disabled:!1,value:null,elem:null,errorBox:null,errorField:null,data:null,cls:{valid:"",error:""},fields:[],rules:{},
messages:{},callback:{scope:null,destroy:null,statechange:null,errorchange:null,displaystate:null}},z=function(a,b){a=a||{};var c,d;this._observable=new da;this._vldr=b;r(this,this._observable.getApi());this.cfg=c=r({},B,w.groupDefaults,a,!0,!0);this.callbackScope=d=c.callback.scope;this.data=a.data;this.el=a.elem;this.fields={};this.rules={};c.messages=r({},f,w.messages,c.messages,!0,!0);var e;if(c.callback)for(e in c.callback)if(c.callback[e])this.on(e,c.callback[e],d);c.rules&&this.setRules(c.rules,
!1);if(c.fields)for(e=0,d=a.fields.length;e<d;e++)this.add(b.getField(c.fields[e]));this.enabled=!c.disabled};z.prototype={fields:null,rules:null,cfg:null,callbackScope:null,vldr:null,enabled:!1,invalid:null,valid:null,displayState:!1,rulesNum:0,error:null,data:null,errorBox:null,el:null,enable:function(){this.enabled=!0;return this},disable:function(){this.enabled=!1;return this},isEnabled:function(){return this.enabled},isValid:function(){return!this.enabled||0===this.invalid&&!0===this.valid},
getExactValidState:function(){return this.valid},reset:function(){this.invalid=0;this.setValidState(null);this.setError(null);this.doDisplayState();return this},getUserData:function(){return this.data},getName:function(){return this.cfg.name},setRules:function(a,b){b=void 0==b?!0:b;for(var c in a)this.setRule(c,a[c],!1);b?this.check():this.setValidState(null);return this},setRule:function(a,b,c){var d=this.rules;c=void 0==c?!0:c;null===b?(d[a]&&this.rulesNum--,delete d[a]):(d[a]||this.rulesNum++,
d[a]=b,null!==this.valid&&this.setValidState(!1));c?this.check():this.setValidState(null);return this},getRules:function(){return r({},this.rules)},hasRule:function(a){return this.rules[a]?!0:!1},setError:function(a){var b=this.cfg;this.error!=a&&(b.errorField?(this.vldr.getField(b.errorField).setError(a),this.error=null):(this.error=a,this.trigger("errorchange",this,a)))},getError:function(){return this.error},getFields:function(){return this.fields},enableDisplayState:function(){this.displayState=
!0;return this},disableDisplayState:function(){this.displayState=!1;return this},check:function(){var a=this.cfg,b=this.fields,c=this.rules;if(!this.enabled||0==this.rulesNum)return this.setValidState(null),this.doDisplayState(),!0;this.countInvalid();if(0<this.invalid)return this.setValidState(null),this.doDisplayState(),!0;var d={},f=!0,h=null,l;if(a.value){for(l in b)d[l]=b[l].getValue();h=a.value.call(this.callbackScope,d,this)}for(l in c)if(!0!==(b=("function"==typeof c[l]?c[l]:g[l]).call(this.callbackScope,
h,null,c[l],this,d))){f=!1;b||a.messages[l]?this.setError(e(b||a.messages[l]||"",c[l])):this.setError(null);break}f&&this.setError(null);this.setValidState(f);this.doDisplayState();return!0===this.valid},doDisplayState:function(){var a=this.valid,b=this.cfg;this.displayState||b.alwaysDisplayState||(a=null);if(b.errorBox){var c=this.getErrorBox();null!==a?c&&(c.innerHTML=this.error||"",c.style.display=!1===this.valid?"block":"none"):c&&(c.style.display="none")}c=b.cls.error;b=b.cls.valid;a=this.valid;
c&&(!1===a?M(this.el,c):R(this.el,c));b&&(!0===a?M(this.el,b):R(this.el,b));this.trigger("displaystate",this,this.valid)},getErrorBox:function(){var a=this.cfg,b=this.fields,c=a.errorBox;if(b[c])return b[c].getErrorBox();this.errorBox||(this.errorBox="function"==typeof a.errorBox?a.errorBox.call(this.callbackScope,this):a.errorBox);return this.errorBox},destroy:function(){var a=this.fields,b;for(b in a)a[b]&&(this.setFieldEvents(a[b],"un"),delete a[b]);this.errorBox&&this.errorBox.parentNode.removeChild(this.errorBox);
this._observable.destroy();delete this._observable;delete this.vldr;delete this.rules;delete this.fields;delete this.cfg},add:function(a){var b=this.fields,c=a.getName();b[c]||(b[c]=a,this.setFieldEvents(a,"on"))},setFieldEvents:function(a,b){a[b]("statechange",this.onFieldStateChange,this)},remove:function(a){var b=this.fields,c=a.getName();b[c]&&(delete b[c],this.setFieldEvents(a,"un"));return this},setValidState:function(a){this.valid!==a&&(this.valid=a,this.trigger("statechange",this,a))},countInvalid:function(){var a=
this.fields;this.invalid=0;for(var b in a)this.invalid+=a[b].isValid()?0:1},onFieldStateChange:function(a,b){this.trigger("fieldstatechange",this,a,b);this.check()}};var C={form:null,all:{},fields:{},rules:{},cls:{valid:"",error:"",checking:""},groups:{},callback:{scope:null,destroy:null,reset:null,beforesubmit:null,submit:null,statechange:null,check:null,displaystate:null,displaystatechange:null}},w=function(a,d,e){var f=a.nodeName.toLowerCase();this.vldId=++b;c[this.vldId]=this;a.setAttribute("data-validator",
this.vldId);this.el=a;d&&"string"!=typeof d&&(e=d,d=null);this._observable=new da;this.cfg=a=r({},C,w.defaults,w[d],e,!0,!0);this.callbackScope=d=a.callback.scope;this.isForm="form"==f;this.isField=/input|select|textarea/.test(f);this.fields={};this.groups={};r(this,this._observable.getApi());this.onRealSubmitClickDelegate=v(this.onRealSubmitClick,this);this.resetDelegate=v(this.reset,this);this.onSubmitClickDelegate=v(this.onSubmitClick,this);this.onFormSubmitDelegate=v(this.onFormSubmit,this);delete a.callback.scope;
var g,h;for(h in a.callback)this.on(h,a.callback[h],d);this.initFields();f=this.fields;for(g in a.rules)f[g]&&f[g].setRules(a.rules[g],!1);a.rules=null;for(g in a.groups)this.addGroup(g,a.groups[g]);this.initForm("bind");delete a.rules;delete a.fields;delete a.groups;this.enabled=!0};w.prototype={vldId:null,el:null,cfg:null,enabled:!1,invalid:null,pending:0,grps:0,outside:!0,submitted:!1,displayState:!1,isForm:!1,isField:!1,submitButton:null,hidden:null,callbackScope:null,_observable:null,fields:null,
groups:null,getVldId:function(){return this.vldId},getElem:function(){return this.el},getGroup:function(a){return this.groups[a]||null},getField:function(a){return this.fields[a]||null},enable:function(){this.enabled=!0;return this},disable:function(){this.enabled=!1;return this},isEnabled:function(){return this.enabled},enableDisplayState:function(){var a=this.fields,b=this.groups,c;if(!0!==this.displayState){this.displayState=!0;for(c in a)a[c].enableDisplayState();for(c in b)b[c].enableDisplayState();
this.trigger("displaystatechange",this,!0)}return this},disableDisplayState:function(){var a=this.groups,b=this.fields,c;if(!1!==this.displayState){this.displayState=!1;for(c in b)b[c].disableDisplayState();for(c in a)a[c].disableDisplayState();this.trigger("displaystatechange",this,!1)}return this},isDisplayStateEnabled:function(){return this.displayState},isValid:function(){return!1===this.enabled?!0:0===this.invalid&&0===this.pending&&0===this.grps&&!0===this.outside},getErrors:function(a){var b=
!0==a?[]:{},c,d,e,f=[this.fields,this.groups],g;if(!this.isEnabled())return b;for(e=0;2>e;e++)for(d in g=f[e],g)null===g[d].getExactValidState()&&g[d].check(),g[d].isValid()||(c=g[d].getError())&&(a?b.push(c):b[d]=c);return b},check:function(){var a=this.fields,b=this.groups;if(!this.isEnabled())return!0;var c=this.isValid(),d;for(d in a)a[d].check();for(d in b)b[d].check();this.outside=!1!==this.trigger("check",this);a=this.isValid();c!=a&&(this.doDisplayState(),this.trigger("statechange",this,!1));
return a},add:function(a,b){if(!Ka(a)||null!==a.getAttribute("data-no-validate")||null!==a.getAttribute("data-validator"))return this;var c=a.getAttribute("name")||a.getAttribute("id"),d=this.cfg,e=this.fields;if(!c)return this;c=d.fields&&d.fields[c]?d.fields[c]:b||{};"string"==typeof c&&(c={rules:[c]});c=r({},d.all||{},c,!0,!0);if(c.ignore)return this;c.callback||(c.callback={scope:this.callbackScope});d=new q(a,c,this);c=d.getName();if(e[c])return this;e[c]=d;this.setFieldEvents(d,"on");this.displayState&&
d.enableDisplayState();this.isEnabled()&&null!==this.invalid&&d.check();return this},addGroup:function(a,b){var c=this.groups;c[a]||(b.name=a,c[a]=new z(b,this),this.setGroupEvents(c[a],"on"),this.isEnabled()&&null!==this.invalid&&c[a].check())},focusInvalid:function(){var a=this.fields,b;for(b in a)if(!a[b].isValid()){a[b].getElem().focus();break}},reset:function(){var a=this.fields,b=this.groups,c;this.submitted=!1;this.disableDisplayState();for(c in b)b[c].reset();for(c in a)a[c].reset();this.pending=
0;this.invalid=null;this.grps=0;this.outside=!1;this.doDisplayState();this.trigger("reset",this);return this},submit:function(){var a=this.el;if(this.isForm)if("function"==typeof a.submit)!1!==this.trigger("beforesubmit",this)&&!1!==this.trigger("submit",this)&&a.submit();else this.onSubmit();else this.onSubmit()},setFieldEvents:function(a,b){a[b]("statechange",this.onFieldStateChange,this);a[b]("beforeAjax",this.onBeforeAjax,this);a[b]("afterAjax",this.onAfterAjax,this);a[b]("submit",this.onFieldSubmit,
this);a[b]("destroy",this.onFieldDestroy,this)},setGroupEvents:function(a,b){a[b]("statechange",this.onGroupStateChange,this)},initFields:function(){var a=this.el,b,c;if(this.isField)return this.add(a),this;a=Q("input, textarea, select",a);b=-1;for(c=a.length;++b<c;this.add(a[b]));return this},initForm:function(a){var b=this.el,c=b.getElementsByTagName("input"),d=Q(".submit",b),e=Q(".reset",b);a="bind"==a?E:aa;var f,g,h,l;f=0;for(g=c.length;f<g;f++)l=c[f],h=l.type,"submit"==h?a(l,"click",this.onRealSubmitClickDelegate):
"reset"==h&&a(l,"click",this.resetDelegate);f=-1;for(g=d.length;++f<g;"submit"!=d[f].type&&a(d[f],"click",this.onSubmitClickDelegate));f=-1;for(g=e.length;++f<g;"reset"!=e[f].type&&a(e[f],"click",this.resetDelegate));this.isForm&&a(b,"submit",this.onFormSubmitDelegate)},onRealSubmitClick:function(a){a=X(a||window.event);this.submitButton=a.target||a.srcElement;return this.onSubmit(a)},onSubmitClick:function(a){return this.onSubmit(X(a||window.event))},onFormSubmit:function(a){a=X(a);if(!this.isValid())return a.preventDefault(),
!1},onFieldSubmit:function(a,b){this.enableDisplayState();this.submitted=!0;return this.onSubmit(b)},onSubmit:function(a){this.enableDisplayState();if(this.pending)return a&&a.preventDefault(),!1;var b=this.submitButton?!0:!1;this.isForm&&(this.hidden&&(this.el.removeChild(this.hidden),this.hidden=null),this.submitButton&&/input|button/.test(this.submitButton.nodeName)&&(this.hidden=document.createElement("input"),this.hidden.type="hidden",this.hidden.setAttribute("name",this.submitButton.name),this.hidden.value=
this.submitButton.value,this.el.appendChild(this.hidden)));this.submitButton=null;if(!this.isValid()&&(this.check(),this.onFieldStateChange(),this.pending))return a&&a.preventDefault(),!1;if(!1===this.trigger("beforesubmit",this)||!this.isValid())return a&&(a.preventDefault(),a.stopPropagation()),this.pending||(this.focusInvalid(),this.submitted=!1),this.trigger("failedsubmit",this,b),!1;this.pending||(this.submitted=!1);return!1!==this.trigger("submit",this)},onFieldDestroy:function(a){a=a.getElem();
a=a.getAttribute("name")||a.getAttribute("id");delete this.fields[a]},onFieldStateChange:function(a,b){var c=this.invalid,d=this.fields;this.invalid=0;for(var e in d)this.invalid+=d[e].isValid()?0:1;a&&this.trigger("fieldstatechange",this,a,b);if(null===c||null!==c&&this.invalid!==c)this.doDisplayState(),this.trigger("statechange",this,this.isValid())},onGroupStateChange:function(){var a=this.groups,b=this.grps;this.grps=0;for(var c in a)this.grps+=a[c].isValid()?0:1;if(null===b||null!==b&&this.grps!==
b)this.doDisplayState(),this.trigger("statechange",this,this.isValid())},doDisplayState:function(){var a=this.cfg,b=this.isValid(),c=a.cls.error,a=a.cls.valid,d=this.el;if(this.isField||!this.displayState)b=null;null===this.invalid&&(b=null);c&&(!1===b?M(d,c):R(d,c));a&&(!0===b?M(d,a):R(d,a));this.trigger("displaystate",this,b)},onBeforeAjax:function(){this.pending++;this.cfg.cls.ajax&&M(this.el,this.cfg.cls.ajax)},onAfterAjax:function(){var a=this.fields,b=this.cfg;this.pending=0;for(var c in a)this.pending+=
a[c].isPending()?1:0;this.doDisplayState();b.cls.ajax&&R(this.el,b.cls.ajax);this.submitted&&0==this.pending&&(this.submitted=!1,this.isValid()?this.submit():this.focusInvalid())},destroy:function(){var a=this.groups,b=this.fields,d;this.reset();this.trigger("destroy",this);delete c[this.vldId];for(d in a)a.hasOwnProperty(d)&&a[d]&&(this.setGroupEvents(a[d],"un"),a[d].destroy(),delete a[d]);for(d in b)b.hasOwnProperty(d)&&b[d]&&(this.setFieldEvents(b[d],"un"),b[d].destroy(),delete b[d]);this._observable.destroy();
delete this._observable;this.initForm("unbind");delete this.fields;delete this.groups;delete this.el;delete this.cfg}};w.defaults={};w.messages={};w.fieldDefaults={};w.groupDefaults={};w.addMethod=function(a,b,c){g[a]||(g[a]=b,c&&(w.messages[a]=c))};w.getValidator=function(a){a=a.getAttribute("data-validator");return c[a]||null};MetaphorJs.lib.Validator=w})();var qb=MetaphorJs.lib.Validator;L("MetaphorJs.view.Validator",{node:null,scope:null,validator:null,scopeState:null,initialize:function(b,c){this.node=
b;this.scope=c;this.scopeState={};this.validator=this.createValidator();this.initScope();this.initScopeState();this.initValidatorEvents()},createValidator:function(){var b=this.node,c={},a;if(a=b.getAttribute("mjs-validator-submit"))c.callback=c.callback||{},c.callback.submit=function(a,b){return function(){try{return a(b)}catch(c){la(c)}}}(Na(a),this.scope);return new qb(b,c)},initValidatorEvents:function(){var b=this.validator;b.on("fieldstatechange",this.onFieldStateChange,this);b.on("statechange",
this.onFormStateChange,this);b.on("displaystatechange",this.onDisplayStateChange,this);b.on("reset",this.onFormReset,this)},initScope:function(){var b=this.scope,c=this.node,c=c.getAttribute("name")||c.getAttribute("id")||"$form";b[c]=this.scopeState},initScopeState:function(){var b=this.node,c=this.scopeState,a,d,e;b.elements?a=b.elements:(a=[],Aa(b,function(b){Ka(b)&&a.push(b)}));b=-1;for(e=a.length;++b<e;)d=a[b],(d=d.getAttribute("name")||d.getAttribute("id"))&&!c[d]&&(c[d]={$error:null,$invalid:null,
$pristine:!0,$errorMessage:null});c.$invalid=!1;c.$pristine=!0;c.$submit=v(this.validator.onSubmit,this.validator)},onDisplayStateChange:function(b,c){if(c){c=this.scopeState;var a,d;for(a in c)d=c[a],d.$real&&(c[a]=d.$real);c.$invalid=!b.isValid();c.$pristine=!1;this.scope.$check()}else this.onFormReset(b)},onFormReset:function(b){b=this.scopeState;var c,a;for(c in b)a=b[c],a.$error=null,a.$errorMessage=null,a.$invalid=null,a.$pristine=!0;b.$invalid=!1;b.$pristine=!0;this.scope.$check()},onFormStateChange:function(b,
c){var a=this.scopeState;a.$invalid=!1===c&&b.isDisplayStateEnabled();a.$pristine=!1;this.scope.$check()},onFieldStateChange:function(b,c,a){var d=this.scopeState,e=c.getName();b=b.isDisplayStateEnabled();c={$error:c.getErrorRule(),$errorMessage:c.getError(),$invalid:!1===a,$pristine:null===c.getExactValidState()};b?d[e]=c:d[e].$real=c;this.scope.$check()}});N("mjs-validate",250,function(b,c,a){a=a||"MetaphorJs.view.Validator";var d=ea(a);d?new d(c,b):la(Error("Class '"+a+"' not found"))})})();
