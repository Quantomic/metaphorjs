(function(){"undefined"==typeof window&&(global.window=global);window.document&&!document.querySelectorAll&&(document.querySelectorAll=function(b){var m=document,a=m.documentElement.firstChild,k=m.createElement("STYLE");a.appendChild(k);m.__qsaels=[];k.sheet?k.sheet.insertRule(b+"{x:expression(document.__qsaels.push(this))}",0):k.styleSheet&&(k.styleSheet.cssText=b+"{x:expression(document.__qsaels.push(this))}");window.scrollBy(0,0);return m.__qsaels});var n={}.undefined,p=Function.prototype.bind?
function(b,m){return b.bind(m)}:function(b,m){return function(){b.apply(m,arguments)}},q={},h=Array.prototype.slice,e=function(){var b=!1,m=h.call(arguments),a=m.shift(),k,c;for("boolean"==typeof m[m.length-1]&&(b=m.pop());k=m.shift();)for(c in k)if(k.hasOwnProperty(c))if(a[c]&&"object"==typeof a[c]&&"object"==typeof k[c])e(a[c],k[c],b);else if(!0===b||"undefined"==typeof a[c]||null===a[c])a[c]=k[c];return a},d=["0","0","0"],f=function(){for(var b=d.length,m;b;){b--;m=d[b].charCodeAt(0);if(57==m)return d[b]=
"A",d.join("");if(90==m)d[b]="0";else return d[b]=String.fromCharCode(m+1),d.join("")}d.unshift("0");return d.join("")},g=function(b){var m=document.createDocumentFragment();if(b.nodeType)m.appendChild(b);else for(var a=-1,k=b.length>>>0;++a!==k;m.appendChild(b[0]));return m},l={},a=function(b){return b._mjsId||(b._mjsId=f())},c=[],b=[],k=!1,s=!1,r=function(b,m){return b.priority<m.priority?-1:b.priority>m.priority?1:0},x,t=function(){return String.prototype.trim?function(b){return"string"==typeof b?
b.trim():b}:function(b){return"string"==typeof b?b.replace(/^\s\s*/,"").replace(/\s\s*$/,""):b}}(),z=Array.prototype.indexOf,u=Object.prototype.toString,C=Object.prototype.hasOwnProperty,B=function(b){return b&&"object"==typeof b&&"number"==typeof b.length&&"[object Array]"==u.call(b)||!1},y=function(b){var m,a,k;if(B(b)){k=[];m=0;for(a=b.length;m<a;m++)k.push(y(b[m]));return k}switch(b.nodeType){case 1:return b.cloneNode(!0);case 3:return document.createTextNode(b.innerText||b.textContent);case 11:return b.cloneNode(!0);
default:return null}},D=function(b,m,a){b.attachEvent?b.attachEvent("on"+m,a):b.addEventListener(m,a,!1)},I=function(b,m,a){b.detachEvent?b.detachEvent("on"+m,a):b.removeEventListener(m,a,!1)},E={},G=function(b){return E[b]||(E[b]=new RegExp("(?:^|\\s)"+b+"(?!\\S)",""))},F=function(b,m){return G(m).test(b.className)},J=function(b,m,a){setTimeout(function(){b.apply(m,a||[])},0)},A,w,H=function(b,m,a){if(""===m||"undefined"==typeof m)return!0;if("undefined"!=typeof b){if("boolean"==typeof b)return b===
m;if(a instanceof RegExp)return m.test(""+b);if("strict"==a)return""+b===""+m;if(!0===a||null===a||"undefined"==typeof a)return-1!=""+b.indexOf(m);if(!1===a)return-1==""+b.indexOf(m)}return!1},K=function(b,m,a){if("object"!=typeof b)return"undefined"==typeof m.$?!0:H(b,m.$,a);var k,c;for(k in m)if("$"==k)for(c in b){if(H(b[c],m.$,a))return!0}else if(H(b[k],m[k],a))return!0;return!1},p={VERSION:"0.2",registerAttributeHandler:function(b,m,a){x||(x=MetaphorJs.add);c.push({priority:m,name:b,handler:x("attr."+
b,a)});k=!1},registerTagHandler:function(a,m,k){x||(x=MetaphorJs.add);b.push({priority:m,name:a,handler:x("tag."+a,k)});s=!1},getAttributeHandlers:function(){k||(c.sort(r),k=!0);return c},getTagHandlers:function(){s||(b.sort(r),s=!0);return b},apply:e,nextUid:f,getTemplate:function(b){if(!l[b]){var m=document.getElementById(b),a;if(m)a=m.tagName.toLowerCase(),"script"==a?(a=document.createElement("div"),a.innerHTML=m.innerHTML,l[b]=g(a.childNodes)):l[b]="content"in m?m.content:g(m.childNodes);else return l[b]=
MetaphorJs.ajax(b,{dataType:"fragment"}).then(function(m){return l[b]=m})}return l[b]},numberFormats:{},dateFormats:{},getNodeId:a,data:function(b,m,k){b=a(b);var c=q[b];return"undefined"!=typeof k?(c||(c=q[b]={}),c[m]=k):c?c[m]:n},emptyFn:function(){},trim:t,bind:p,inArray:function(b,m){return m?z.call(m,b):-1},isArray:B,isPlainObject:function(b){if("[object Object]"!==u.call(b)||b.nodeType)return!1;try{if(b.constructor&&!C.call(b.constructor.prototype,"isPrototypeOf"))return!1}catch(m){return!1}return!0},
clone:y,addListener:D,removeListener:I,hasClass:F,addClass:function(b,m){F(b,m)||(b.className+=" "+m)},removeClass:function(b,m){var a=G(m);b.className=b.className.replace(a,"")},isVisible:function(b){return!(0>=b.offsetWidth||0>=b.offsetHeight)},isThenable:function(b){var m;return b&&"function"==typeof(m=b.then)?m:!1},async:J,asyncError:function(b){J(function(){throw b;})},onReady:function(b){var m=!1,a=!0,k=window,c=k.document,s=c.documentElement,d=function(a){if("readystatechange"!=a.type||"complete"==
c.readyState)I("load"==a.type?k:c,a.type,d),!m&&(m=!0)&&b.call(k,a.type||a)},r=function(){try{s.doScroll("left")}catch(b){setTimeout(r,50);return}d("poll")};if("complete"==c.readyState)b.call(k,"lazy");else{if(c.createEventObject&&s.doScroll){try{a=!k.frameElement}catch(f){}a&&r()}D(c,"DOMContentLoaded",d);D(c,"readystatechange",d);D(k,"load",d)}},toFragment:g,toArray:function(b){for(var m=[],a=-1,k=b.length>>>0;++a!==k;m[a]=b[a]);return m},app:function(b,m){A||(A=MetaphorJs.view.Scope,w=MetaphorJs.view.Renderer);
m?m instanceof A||(m=new A(m)):m=new A;var a=new w(b,m);a.render();return a},filterArray:function(b,m,a){"object"!=typeof m&&(m={$:m});var k=[],c,s;c=-1;for(s=b.length;++c<s;)K(b[c],m,a)&&k.push(b[c]);return k}};window.MetaphorJs?e(window.MetaphorJs,p,!0):window.MetaphorJs=p})();
(function(){var n="undefined"!=typeof window?window:global,p={},q=function(d,f){if(p[d]||f)return p[d];var e=d.split("."),l,a=e.length,c,b=n;for(l=0;l<a;l++){c=e[l];if(!b[c])return null;b=b[c]}return b},h=function(d,f){var e;e=d.split(".");var l,a=e.pop();l=e.join(".");var c=e.length,b,k=n;if(p[l])e=[p[l],a];else{for(l=0;l<c;l++)b=e[l],k[b]||(k[b]={}),k=k[b];e=[k,a]}e[0][e[1]]=f;return p[d]=f},e=function(d,f){return p[d]=f};h("MetaphorJs.ns",{register:h,exists:function(d){return p[d]?!0:!1},get:q,
add:e,remove:function(d){delete p[d]}});MetaphorJs.r=h;MetaphorJs.g=q;MetaphorJs.add=e;"undefined"!=typeof module&&(module.exports=MetaphorJs.ns)})();
(function(){var n;if("undefined"!=typeof global)try{n=require("metaphorjs-namespace")}catch(p){n=global.MetaphorJs.ns}else n=window.MetaphorJs.ns;var q={}.undefined,h=Array.prototype.slice,e=function(b,a){return g(function(){},b,a)},d=function(b,a,k){return function(){var c=q,d=this.supr;this.supr=b.prototype[a]||function(){};try{c=k.apply(this,arguments)}catch(f){}this.supr=d;return c}},f=function(b,a,k){for(var c in a)a.hasOwnProperty(c)&&(b[c]="function"===typeof a[c]&&k.prototype&&"function"===
typeof k.prototype[c]?d(k,c,a[c]):a[c])},g=function(b,a,k){var c=function(){};c.prototype=b.prototype;c=new c;k=k||function(){this.initialize&&this.initialize.apply(this,arguments)};f(c,a,b);k.prototype=c;k.prototype.constructor=k;k.prototype.getClass=function(){return this.__proto__.constructor.__class};k.prototype.getParentClass=function(){return this.__proto__.constructor.__parentClass};k.__instantiate=function(b){return function(){var a=function(){},k;a.prototype=b.prototype;a=new a;k=b.prototype.constructor.apply(a,
arguments);return"object"==typeof k?k:a}}(k);return k},l=function(b,a,k,c,d,f){null===b&&(b="");"function"==typeof b?(d=k,"string"==typeof a?(d=c,c=k):(c=a,k=b,a=null),b=null):"string"!=typeof b&&(d=a,c=b,b=k=a=null);"string"!=typeof a&&"function"!=typeof a&&(d=c,c=k,k=a,a=null);"function"!=typeof k&&(d=c,c=k,k=null);c=c||{};var l=a&&"string"==typeof a?n.get(a):a;if(a&&!l)throw Error(a+" not found");a=l?g(l,c,k):e(c,k);a.__isMetaphorClass=!0;a.__parent=l;a.__parentClass=l?l.__class:null;a.__class=
b;if(d)for(var h in d)d.hasOwnProperty(h)&&(a[h]=d[h]);b&&(f?n.add(b,a):n.register(b,a));d&&d.alias&&n.add(d.alias,a);return a},a=function(b,a,k,c,d){return l(b,a,k,c,d,!0)},c=function(b){var a=n.get(b),k=h.call(arguments,1);if(!a)throw Error(b+" not found");return a.__instantiate.apply(this,k)},b=function(b,a){var k="string"==typeof a?n.get(a):a;return k?b instanceof k:!1},k=function(b,a){var k=b,c=n.get;"string"!=typeof a&&(a=a.getClass?a.getClass():a.prototype.constructor.__class);for("string"==
typeof b&&(k=c(b));k;){if(k.prototype.constructor.__class==a)return!0;k&&(k=k.getParentClass?c(k.getParentClass()):k.__parent)}return!1};"undefined"!=typeof global?module.exports={define:l,d:l,defineCache:a,dc:a,create:c,c:c,is:b,isSubclass:k}:(MetaphorJs.define=MetaphorJs.d=l,MetaphorJs.defineCache=MetaphorJs.dc=a,MetaphorJs.create=MetaphorJs.c=c,MetaphorJs.is=b,MetaphorJs.isSubclass=MetaphorJs.iss=k)})();
(function(){"undefined"==typeof window&&(global.window=global);if(window.Promise)n=window.Promise;else{var n;if("undefined"!=typeof global)try{n=require("metaphorjs-promise")}catch(p){global.Promise&&(n=global.Promise)}else window.MetaphorJs&&MetaphorJs.lib&&MetaphorJs.lib.Promise&&(n=MetaphorJs.lib.Promise)}var q=window.MetaphorJs&&MetaphorJs.nextUid?MetaphorJs.nextUid:function(){return Array(11).join((Math.random().toString(36)+"00000000000000000").slice(2,18)).slice(0,10)},h=function(b,a){for(var c in a)a.hasOwnProperty(c)&&
(b[c]=a[c])},e=Array.prototype.slice,d="undefined"!=typeof process?process.nextTick:function(b){window.setTimeout(b,0)},f=Function.prototype.bind?function(b,a){return b.bind(a)}:function(b,a){return function(){b.apply(a,arguments)}},g=function(){this.events={}};h(g.prototype,{createEvent:function(b,a){b=b.toLowerCase();var c=this.events;c[b]||(c[b]=new l(b,a));return c[b]},getEvent:function(b){b=b.toLowerCase();return this.events[b]},on:function(b,a,c,d){b=b.toLowerCase();var f=this.events;f[b]||
(f[b]=new l(b));return f[b].on(a,c,d)},once:function(b,a,c,d){d=d||{};d.limit=1;return this.on(b,a,c,d)},un:function(b,a,c){b=b.toLowerCase();var d=this.events;d[b]&&d[b].un(a,c)},hasListener:function(b,a,c){b=b.toLowerCase();var d=this.events;return d[b]?d[b].hasListener(a,c):!1},removeAllListeners:function(b){var a=this.events;a[b]&&a[b].removeAllListeners()},triggerAsync:function(){var b=arguments[0],a=this.events,b=b.toLowerCase();if(!a[b])return[];b=a[b];return b.triggerAsync.apply(b,e.call(arguments,
1))},trigger:function(){var b=arguments[0],a=this.events,b=b.toLowerCase();if(!a[b])return null;b=a[b];return b.trigger.apply(b,e.call(arguments,1))},suspendEvent:function(b){b=b.toLowerCase();var a=this.events;a[b]&&a[b].suspend()},suspendAllEvents:function(){var b=this.events,a;for(a in b)b[a].suspend()},resumeEvent:function(b){b=b.toLowerCase();var a=this.events;a[b]&&a[b].resume()},resumeAllEvents:function(){var b=this.events,a;for(a in b)b[a].resume()},destroyEvent:function(b){var a=this.events;
a[b]&&(a[b].removeAllListeners(),a[b].destroy(),delete a[b])},destroy:function(b){var a=this.events;if(b)b=b.toLowerCase(),a[b]&&(a[b].destroy(),delete a[b]);else{for(var c in a)a[c].destroy();this.events={}}},getApi:function(){if(!this.api){for(var b="createEvent getEvent on un once hasListener removeAllListeners triggerAsync trigger suspendEvent suspendAllEvents resumeEvent resumeAllEvents destroyEvent".split(" "),a={},c,d=-1,e=b.length;++d<e;c=b[d],a[c]=f(this[c],this));this.api=a}return this.api}});
var l=function(b,a){this.name=b;this.listeners=[];this.map={};this.hash=q();this.uni="$$"+b+"_"+this.hash;this.suspended=!1;this.lid=0;this.returnResult=a||!1};h(l.prototype,{getName:function(){return this.name},destroy:function(){this.map=this.listeners=null},on:function(b,a,c){if(!b)return null;a=a||null;c=c||{};var d=this.uni,f=a||b;if(f[d]&&!c.allowDupes)return null;var e=++this.lid,g=c.first||!1;f[d]=e;b={fn:b,scope:a,uniScope:f,id:e,called:0,limit:c.limit||0,start:c.start||1,count:0,append:c.append,
prepend:c.prepend};g?this.listeners.unshift(b):this.listeners.push(b);this.map[e]=b;return e},once:function(b,a,c){c=c||{};c.once=!0;return this.on(b,a,c)},un:function(b,a){var c=-1,d=this.uni,f=this.listeners,e;e=b==parseInt(b)?b:(a||b)[d];if(!e)return!1;for(var g=0,l=f.length;g<l;g++)if(f[g].id==e){c=g;delete f[g].uniScope[d];break}if(-1==c)return!1;f.splice(c,1);delete this.map[e];return!0},hasListener:function(b,a){var c=this.listeners,d;if(b){a=a||b;d=b==parseInt(b)?b:a[this.uni];if(!d)return!1;
for(var f=0,e=c.length;f<e;f++)if(c[f].id==d)return!0;return!1}return 0<c.length},removeAllListeners:function(){var b=this.listeners,a=this.uni,c,d;c=0;for(d=b.length;c<d;c++)delete b[c].uniScope[a];this.listeners=[];this.map={}},suspend:function(){this.suspended=!0},resume:function(){this.suspended=!1},_prepareArgs:function(b,a){var c;b.append||b.prepend?(c=e.call(a),b.prepend&&(c=b.prepend.concat(c)),b.append&&(c=c.concat(b.append))):c=a;return c},triggerAsync:function(){if("undefined"==typeof n)throw Error("Promises are not defined");
var b=this,a=b.listeners,c=b.returnResult,f=e.call(arguments),g=[],l=[],h,u,C;if(b.suspended||0==a.length)return n.resolve(null);u=0;for(C=a.length;u<C;u++)g.push(a[u]);for(u=function(a){h=b._prepareArgs(a,f);return new n(function(c,k){d(function(){try{c(a.fn.apply(a.scope,h))}catch(d){k(d)}a.called++;a.called==a.limit&&b.un(a.id)},0)})};(a=g.shift())&&(!a||!b.map[a.id]||(a.count++,a.count<a.start||(l.push(u(a)),"first"!=c))););return"last"==c?[l.pop()]:l},trigger:function(){var b=this.listeners,
a=this.returnResult;if(this.suspended||0==b.length)return null;var c="all"==a?[]:null,d=[],f,e;if("first"==a)d.push(b[0]);else for(f=0,e=b.length;f<e;f++)d.push(b[f]);for(;b=d.shift();)if(b&&this.map[b.id]&&(b.count++,!(b.count<b.start))){f=b.fn.apply(b.scope,this._prepareArgs(b,arguments));b.called++;b.called==b.limit&&this.un(b.id);"all"==a&&c.push(f);if("first"==a)return f;"last"==a&&(c=f);if(!1==a&&!1===f)break}if(a)return c}});var a=window.MetaphorJs;if(a&&a.VERSION){var c=new g;h(MetaphorJs,
c.getApi())}a&&a.r?a.r("MetaphorJs.lib.Observable",g):(window.MetaphorJs=window.MetaphorJs||{},MetaphorJs.lib=MetaphorJs.lib||{},MetaphorJs.lib.Observable=g);"undefined"!=typeof global&&(module.exports=g)})();
(function(){var n="undefined"!=typeof window?window.setTimeout:global.setTimeout,p=function(b){var a;return!b||"object"!=typeof b&&"function"!=typeof b||"function"!=typeof(a=b.then)?!1:a},q=Function.prototype.bind?function(b,a){return b.bind(a)}:function(b,a){return function(){b.apply(a,arguments)}},h=[],e=!1,d="undefined"!=typeof process?process.nextTick:function(b){n(b,0)},f=function(){e=!0;var b=h.shift();d(function(){b[0].apply(b[1],b[2]);h.length?f():e=!1},0)},g=function(b,a,c){c=c||[];h.push([b,
a,c]);e||f()},l=function(b,a){for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c])},a=function(b,a){return function(c){try{a.resolve(b(c))}catch(d){a.reject(d)}}},c=function(b,a){if(b instanceof c)return b;if(!(this instanceof c))return new c(b,a);this._fulfills=[];this._rejects=[];this._dones=[];this._fails=[];if(b)if(p(b))this.resolve(b);else if("function"==typeof b)try{b.call(a,q(this.resolve,this),q(this.reject,this))}catch(d){this.reject(d)}else throw"Cannot construct Promise with given value";};
l(c.prototype,{_state:0,_fulfills:null,_rejects:null,_dones:null,_fails:null,_wait:0,_value:null,_reason:null,_triggered:!1,isPending:function(){return 0==this._state},isFulfilled:function(){return 1==this._state},isRejected:function(){return 2==this._state},_cleanup:function(){delete this._fulfills;delete this._rejects;delete this._dones;delete this._fails},_processValue:function(b,a){var d;if(0==this._state)if(b===this)this._doReject(new TypeError("cannot resolve promise with itself"));else{try{if(d=
p(b)){b instanceof c?b.then(q(this._processResolveValue,this),q(this._processRejectReason,this)):(new c(d,b)).then(q(this._processResolveValue,this),q(this._processRejectReason,this));return}}catch(f){0==this._state&&this._doReject(f);return}a.call(this,b)}},_callResolveHandlers:function(){this._done();for(var b=this._fulfills,a;a=b.shift();)g(a[0],a[1],[this._value]);this._cleanup()},_doResolve:function(b){this._value=b;this._state=1;0==this._wait&&this._callResolveHandlers()},_processResolveValue:function(b){this._processValue(b,
this._doResolve)},resolve:function(b){if(this._triggered)return this;this._triggered=!0;this._processResolveValue(b);return this},_callRejectHandlers:function(){this._fail();for(var b=this._rejects,a;a=b.shift();)g(a[0],a[1],[this._reason]);this._cleanup()},_doReject:function(b){this._state=2;this._reason=b;0==this._wait&&this._callRejectHandlers()},_processRejectReason:function(b){this._processValue(b,this._doReject)},reject:function(b){if(this._triggered)return this;this._triggered=!0;this._processRejectReason(b);
return this},then:function(b,d){var f=new c,e=this._state;0==e||0!=this._wait?(b&&"function"==typeof b?this._fulfills.push([a(b,f),null]):this._fulfills.push([f.resolve,f]),d&&"function"==typeof d?this._rejects.push([a(d,f),null]):this._rejects.push([f.reject,f])):1==e?b&&"function"==typeof b?g(a(b,f),null,[this._value]):f.resolve(this._value):2==e&&(d&&"function"==typeof d?g(a(d,f),null,[this._reason]):f.reject(this._reason));return f},"catch":function(b){return this.then(null,b)},_done:function(){for(var b=
this._dones,a;a=b.shift();)a[0].call(a[1]||null,this._value)},done:function(b,a){var c=this._state;1==c&&0==this._wait?b.call(a||null,this._value):0==c&&this._dones.push([b,a]);return this},_fail:function(){for(var b=this._fails,a;a=b.shift();)a[0].call(a[1]||null,this._reason)},fail:function(b,a){var c=this._state;2==c&&0==this._wait?b.call(a||null,this._reason):0==c&&this._fails.push([b,a]);return this},always:function(b,a){this.done(b,a);this.fail(b,a);return this},promise:function(){return{then:q(this.then,
this),done:q(this.done,this),fail:q(this.fail,this),always:q(this.always,this)}},after:function(b){var a=this;if(p(b)){a._wait++;var c=function(){a._wait--;0==a._wait&&0!=a._state&&(1==a._state?a._callResolveHandlers():a._callRejectHandlers())};"function"==typeof b.done?b.done(c):b.then(c)}return a}});l(c,{resolve:function(a){if(p(a)||"function"==typeof a)return new c(a);var d=new c;d.resolve(a);return d},reject:function(a){var d=new c;d.reject(a);return d},all:function(a){if(!a.length)return c.resolve(null);
var d=new c,f=a.length,e=[],g=f,l,h,u=function(a){e.push(a);g--;0==g&&d.resolve(e)};for(l=0;l<f;l++)h=a[l],h instanceof c?h.done(u).fail(d.reject,d):p(h)||"function"==typeof h?(new c(h)).done(u).fail(d.reject,d):u(h);return d},when:function(){return c.all(arguments)},allResolved:function(a){if(!a.length)return c.resolve(null);var d=new c,f=a.length,e=[],g=f,l,h,u=function(a){e.push(a);n()},n=function(){g--;0==g&&d.resolve(e)};for(l=0;l<f;l++)h=a[l],h instanceof c?h.done(u).fail(n):p(h)||"function"==
typeof h?(new c(h)).done(u).fail(n):u(h);return d},race:function(a){if(!a.length)return c.resolve(null);var d=new c,f=a.length,e,g;for(e=0;e<f&&(g=a[e],g instanceof c?g.done(d.resolve,d).fail(d.reject,d):p(g)||"function"==typeof g?(new c(g)).done(d.resolve,d).fail(d.reject,d):d.resolve(g),d.isPending());e++);return d}});"undefined"==typeof global?(window.Promise||(window.Promise=c),window.MetaphorJs&&window.MetaphorJs.r("MetaphorJs.lib.Promise",c)):"undefined"!=typeof module&&(module.exports=c)})();
(function(){"undefined"==typeof window&&(global.window=global);var n;if("undefined"!=typeof global)try{n=require("metaphorjs-observable")}catch(p){global.Observable&&(n=global.Observable)}else window.MetaphorJs&&MetaphorJs.lib&&MetaphorJs.lib.Observable&&(n=MetaphorJs.lib.Observable);var q=/(^|[^a-z0-9_$])(\.)([^0-9])/ig,h={},e=window.MetaphorJs&&MetaphorJs.nextUid?MetaphorJs.nextUid:function(){var a;a=Array(11).join((Math.random().toString(36)+"00000000000000000").slice(2,18)).slice(0,10);return h[a]?
e():h[a]=a},d=Object.prototype.toString,f=function(a){return"[object Array]"===d.call(a)},g=function(a){return"[object Date]"===d.call(a)},l=function(a){return"[object RegExp]"===d.call(a)},a=function(a){return a&&a.document&&a.location&&a.alert&&a.setInterval},c=function(b,d){if(a(b))throw Error("Cannot copy window object");if(d){if(b===d)throw Error("Objects are identical");if(f(b))for(var e=d.length=0;e<b.length;e++)d.push(c(b[e]));else{for(e in d)delete d[e];for(e in b)d[e]=c(b[e])}}else(d=b)&&
(f(b)?d=c(b,[]):g(b)?d=new Date(b.getTime()):l(b)?d=new RegExp(b.source):null!=b&&"object"===typeof b&&(d=c(b,{})));return d},b=function(c,d){if(c===d)return!0;if(null===c||null===d)return!1;if(c!==c&&d!==d)return!0;var e=typeof c,k;if(e==typeof d&&"object"==e)if(f(c)){if(!f(d))return!1;if((e=c.length)==d.length){for(k=0;k<e;k++)if(!b(c[k],d[k]))return!1;return!0}}else{if(g(c))return g(d)&&c.getTime()==d.getTime();if(l(c)&&l(d))return c.toString()==d.toString();if(a(c)||a(d)||f(d))return!1;e={};for(k in c)if(("$"!==
k.charAt(0)||"object"!=typeof c[k])&&"function"!==typeof c[k]){if(!b(c[k],d[k]))return!1;e[k]=!0}for(k in d)if(!e.hasOwnProperty(k)&&"$"!==k.charAt(0)&&void 0!==d[k]&&"function"!==typeof d[k])return!1;return!0}return!1},k=function(a,c){var d=a.length,f=c.length,e=Array(d+1),k=Array(d+1),m,v,g,l,h=0;if(d==f&&0==d)return{changes:0,distance:0,prescription:[]};for(m=0;m<=d;m++)e[m]=Array(f+1),k[m]=Array(f+1),e[m][0]=m,k[m][0]="D";for(m=0;m<=f;m++)e[0][m]=m,k[0][m]="I";for(m=1;m<=d;m++)for(v=1;v<=f;v++)g=
b(a[m-1],c[v-1])?0:1,e[m][v-1]<e[m-1][v]&&e[m][v-1]<e[m-1][v-1]+g?(e[m][v]=e[m][v-1]+1,k[m][v]="I"):e[m-1][v]<e[m-1][v-1]+g?(e[m][v]=e[m-1][v]+1,k[m][v]="D"):(e[m][v]=e[m-1][v-1]+g,k[m][v]=1==g?"R":"-");l=[];m=d;v=f;do g=k[m][v],l.push(g),"-"!=g&&h++,"R"==g||"-"==g?(m--,v--):"D"==g?m--:v--;while(0!=m||0!=v);return{changes:h/l.length,distance:e[d][f],prescription:l.reverse()}},s=window.MetaphorJs?MetaphorJs.trim:function(){return String.prototype.trim?function(a){return"string"==typeof a?a.trim():
a}:function(a){return"string"==typeof a?a.replace(/^\s\s*/,"").replace(/\s\s*$/,""):a}}(),r,x=window.MetaphorJs?MetaphorJs.ns.get:null,t=function(a,b,c,d,k){r||(r=new n);var L=e(),m;f(a)&&null===b?m="array":("string"!=typeof b&&(d=c,c=b,b=null,m="object"),"string"==typeof a&&(d=c,c=b,b=a,a=null),b&&a&&(m=a.hasOwnProperty(b)?"attr":"expr"),b&&!a&&(m="expr"));if(c)r.on(L,c,d||this,{append:[k],allowDupes:!0});this.code=b=this._processPipes(b,a);this.getterFn="expr"==m?y(b):null;this.id=L;this.type=m;
this.obj=a;this.itv=null;this.curr=this._getValue()};(function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(t.prototype,{code:null,getterFn:null,setterFn:null,id:null,type:null,obj:null,itv:null,curr:null,arraySlice:!1,pipes:null,_addPipe:function(a,b,c){var d=b.shift(),f=null,e=[],m;x&&(f=x("filter."+d,!0));f||(f=window[d]||c[d]);if("function"==typeof f){d=-1;for(m=b.length;++d<m;e.push(z(c,b[d],self.check,self)));a.push([f,b,e])}},_processPipes:function(a,b){for(var c=0,d=a.length,f=[],
e,m,v,k=!1,g=a;c<d;)if(-1!=(e=a.indexOf("|",c)))m=a.charAt(e-1),v=a.charAt(e+1),"|"!=m&&"'"!=m&&'"'!=m&&"|"!=v&&"'"!=v&&'"'!=v&&(k?(c=s(a.substring(c,e)).split(":"),this._addPipe(f,c,b)):(k=!0,g=s(a.substring(0,e)))),c=e+1;else{k&&(c=s(a.substr(c)).split(":"),this._addPipe(f,c,b));break}f.length&&(this.pipes=f);return g},_checkCode:function(){var a=this._getValue(),b=!1,c=this.curr;if(f(c)&&f(a))return b=k(c,a),b.changes?(this.curr=a.slice(),r.trigger(this.id,b,a,c),!0):!1;a!==c&&(this.curr=a,r.trigger(this.id,
a,c),b=!0);return b},_checkObject:function(){var a=this.obj,d=this.curr;return b(d,a)?!1:(this.curr=c(a),r.trigger(this.id,a,d),!0)},_checkArray:function(){var a=this.curr,b=this.obj,c=k(a,b);return c.changes?(this.curr=b.slice(),r.trigger(this.id,c,b,a),!0):!1},_getValue:function(){var a;switch(this.type){case "attr":a=this.obj[this.code];break;case "expr":try{a=this.getterFn(this.obj)}catch(b){if(window.MetaphorJs)MetaphorJs.asyncError(b);else throw b;}"undefined"==typeof a&&(a="");break;case "object":a=
c(this.obj);break;case "array":a=this.obj}f(a)&&(a=a.slice());var d=this.pipes;if(d){var e,k,g,m=d.length,v=this.obj,l,h;for(e=0;e<m;e++){g=d[e][1];k=[];l=-1;for(h=g.length;++l<h;k.push(G(g[l],v)));k.unshift(a);k.push(v);a=d[e][0].apply(null,k)}}return a},addListener:function(a,b,c){return r.on(this.id,a,b,c)},removeListener:function(a,b){return r.un(this.id,a,b)},getValue:function(){return this._getValue()},setValue:function(a){var b=this.type;if("attr"==b)this.obj[this.code]=a;else if("expr"==b)this.setterFn||
(this.setterFn=I(this.code)),this.setterFn(this.obj,a);else if("array"==b)this.obj=a;else throw"Cannot set value";},check:function(){switch(this.type){case "expr":case "attr":return this._checkCode();case "object":return this._checkObject();case "array":return this._checkArray()}return!1},checkAll:function(){return this.obj.$$watchers.$checkAll()},getLastResult:function(){return this.curr},setInterval:function(a){var b=this;b.itv&&b.clearInterval();b.itv=setInterval(function(){b.check()},a)},clearInterval:function(){this.itv&&
(clearInterval(this.itv),this.itv=null)},unsubscribeAndDestroy:function(a,b){var c=this.id;r.un(c,a,b);return r.hasListener(c)?!1:(this.destroy(),!0)},destroy:function(){var a=this.pipes,b,c,d,e,f;this.itv&&this.clearInterval();if(a)for(b=-1,c=a.length;++b<c;)for(f=a[b][2],d=-1,e=f.length;++d<e;)f[d].unsubscribeAndDestroy(this.check,this);this.pipes=this.obj=this.curr=null;r.destroyEvent(this.id);this.obj&&delete this.obj.$$watchers[this.code]}});var z=function(a,b,c,d,e){b=u(a,s(b));return a?(a.$$watchers||
(a.$$watchers={$checkAll:function(){var a,b=0;for(a in this)"$"!=a.charAt(0)&&this[a].check()?b++:"$"==a.charAt(0)&&this[a]instanceof t&&this[a].check()&&b++;return b},$destroyAll:function(){for(var a in this)if("$"!=a.charAt(0)||this[a]instanceof t)this[a].destroy(),delete this[a]}}),a.$$watchers[b]?a.$$watchers[b].addListener(c,d,{append:[e],allowDupes:!0}):a.$$watchers[b]=new t(a,b,c,d,e),a.$$watchers[b]):new t(a,b,c,d,e)},u=function(a,b){if(a&&b){if(a.hasOwnProperty(b))return b;var c;if("."==
b.charAt(0)&&(c=b.substr(1),a.hasOwnProperty(c)))return c}return b},C=Function,B={},y=function(a){return B[a]?B[a]:B[a]=new C("____","return ".concat(a.replace(q,"$1____.$3")))},D={},I=function(a){if(!D[a]){var b=a.replace(q,"$1____.$3");return D[a]=new C("____","$$$$",b.concat(" = $$$$"))}return D[a]},E={},G=function(a,b){return y(a)(b)},F=function(a){if("string"!=typeof a)return!1;a=a.substr(0,1);return!('"'==a||"'"==a||"."==a)};t.create=z;t.unsubscribeAndDestroy=function(a,b,c,d){b=s(b);(a=a.$$watchers)&&
a[b]&&a[b].unsubscribeAndDestroy(c,d)&&delete a[b]};t.normalizeExpr=u;t.prepareCode=function(a){return a.replace(q,"$1____.$3")};t.createGetter=y;t.createSetter=I;t.createFunc=function(a){return E[a]?E[a]:E[a]=new C("____",a.replace(q,"$1____.$3"))};t.eval=G;t.isExpression=function(a){var b=a.substr(0,1);return('"'==b||"'"==b)&&a.substr(a.length-1)==b||""+parseInt(a,10)===a?!1:!0};t.isNativeString=F;t.toExpression=function(a){return F(a)?"'"+a+"'":a};window.MetaphorJs&&MetaphorJs.r&&MetaphorJs.r("MetaphorJs.lib.Watchable",
t);"undefined"!=typeof global&&(module.exports=t)})();
(function(){var n,p;if("undefined"!=typeof global)try{n=require("metaphorjs-promise"),p=require("metaphorjs-observable")}catch(q){n=global.MetaphorJs.lib.Promise,p=global.MetaphorJs.lib.Observable}else n=window.MetaphorJs.lib.Promise,p=window.MetaphorJs.lib.Observable;var h=function(a,b,c){for(var d in b)!b.hasOwnProperty(d)||void 0!=typeof a[d]&&!1===c||(a[d]=b[d])},e=Function.prototype.bind?function(a,b){return a.bind(b)}:function(a,b){return function(){a.apply(b,arguments)}},d;"undefined"!=typeof window&&
(d=document.querySelectorAll||function(a){var b=document,c=b.documentElement.firstChild,d=b.createElement("STYLE");c.appendChild(d);b.__qsaels=[];d.sheet?d.sheet.insertRule(a+"{x:expression(document.__qsaels.push(this))}",0):d.styleSheet&&(d.styleSheet.cssText=a+"{x:expression(document.__qsaels.push(this))}");window.scrollBy(0,0);return b.__qsaels});var f=/#.*$/,g=/([?&])_=[^&]*/,l=/\?/,a=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,c=/^(?:GET|HEAD)$/i,b=0,k=function(a,b){setTimeout(function(){a.call(b)},
0)},s=function(a,b,c){a.attachEvent?a.attachEvent("on"+b,c):a.addEventListener(b,c,!1)},r=function(){return String.prototype.trim?function(a){return"string"==typeof a?a.trim():a}:function(a){return"string"==typeof a?a.replace(/^\s\s*/,"").replace(/\s\s*$/,""):a}}(),x=function(a,b){var c,d;if(!a||"string"!==typeof a)return null;try{d=new DOMParser,c=d.parseFromString(a,b||"text/xml")}catch(e){c=void 0}if(!c||c.getElementsByTagName("parsererror").length)throw"Invalid XML: "+a;return c},t=function(a,
b,c){var d,e;if("string"==typeof a&&c)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a));else if(I(a)&&c)for(d=0,e=a.length;d<e;d++)t(a[d],b,c+"["+d+"]");else if("object"==typeof a)for(d in a)a.hasOwnProperty(d)&&t(a[d],b,c?c+"["+d+"]":d)},z=function(a,b){a.replace(f,"");if(!1===b.cache){var d=(new Date).getTime();return g.test(a)?a.replace(g,"$1_="+d):a+(l.test(a)?"&":"?")+"_="+d}!b.data||window.FormData&&b.data instanceof window.FormData||("string"!=typeof b.data?(d=[],t(b.data,d,null),d=d.join("&").replace(/%20/g,
"+")):d=b.data,b.data=d,c.test(b.method)&&(a+=(l.test(a)?"&":"?")+b.data,b.data=null));return a},u={xml:"application/xml, text/xml",html:"text/html",script:"text/javascript, application/javascript",json:"application/json, text/javascript",text:"text/plain",_default:"*/*"},C={url:null,data:null,method:"GET",headers:null,username:null,password:null,cache:null,dataType:null,timeout:0,contentType:"application/x-www-form-urlencoded",xhrFields:null,jsonp:!1,jsonpParam:null,jsonpCallback:null,transport:null,
replace:!1,selector:null,form:null,beforeSend:null,progress:null,uploadProgress:null,processResponse:null,callbackScope:null},B={},y=new p,D=function(a){var b;b=eval;a&&(/^[^\S]*use strict/.test(a)?(b=document.createElement("script"),b.text=a,document.head.appendChild(b).parentNode.removeChild(b)):b(a))},I=function(a){return a&&"object"==typeof a&&"number"==typeof a.length&&"[object Array]"==Object.prototype.toString.call(a)||!1},E=function(a,b,c){var d,e;if("object"!=typeof a&&"function"!=typeof a&&
c)d=document.createElement("input"),d.setAttribute("type","hidden"),d.setAttribute("name",c),d.setAttribute("value",a),b.appendChild(d);else if(I(a)&&c)for(d=0,e=a.length;d<e;d++)E(a[d],b,c+"["+d+"]");else if("object"==typeof a)for(d in a)a.hasOwnProperty(d)&&E(a[d],b,c?c+"["+d+"]":d)},G=function(a){for(var b,c,d="",e=0;e<a.elements.length;e++)if(b=a.elements[e],b.hasAttribute("name"))if(c="INPUT"===b.nodeName.toUpperCase()?b.getAttribute("type").toUpperCase():"TEXT","FILE"===c)for(c=0;c<b.files.length;d+=
"&"+encodeURIComponent(b.name)+"="+encodeURIComponent(b.files[c++].name));else if("RADIO"!==c&&"CHECKBOX"!==c||b.checked)d+="&"+encodeURIComponent(b.name)+"="+encodeURIComponent(b.value);return d},F=function(){},J=function(a,b,c){var e=b?b.dataType:null;b=b?b.selector:null;if("string"!=typeof a)return a;c=c||"";if("xml"===e||!e&&0<=c.indexOf("xml"))return a=x(r(a)),b?d.call(a,b):a;if("html"===e)return a=x(a,"text/html"),b?d.call(a,b):a;if("fragment"==e){c=document.createDocumentFragment();e=document.createElement("div");
for(e.innerHTML=a;e.firstChild;)c.appendChild(e.firstChild);return c}if("json"===e||!e&&0<=c.indexOf("json"))return a=r(a),JSON.parse(a);("script"===e||!e&&0<=c.indexOf("javascript"))&&D(a);return a+""},A=function(b){var c=a.exec(("undefined"!=typeof window?window.location.href:"").toLowerCase())||[],d=a.exec(b.url.toLowerCase());this._opt=b;b.crossDomain=!(!d||d[1]===c[1]&&d[2]===c[2]&&(d[3]||("http:"===d[1]?"80":"443"))===(c[3]||("http:"===c[1]?"80":"443")));c=new n;"iframe"!=b.transport||b.form?
b.form&&(this._form=b.form,"POST"!=b.method||"undefined"!=typeof window&&window.FormData||"iframe"==b.transport||(b.transport="iframe")):(this.createForm(),b.form=this._form);b.form&&"iframe"!=b.transport&&(b.data="POST"==b.method?new FormData(b.form):G(b.form));b.url=z(b.url,b);d=!b.crossDomain&&"script"!=b.transport||b.form?"iframe"==b.transport?new L(b,c,this):new H(b,c,this):new K(b,c,this);this._deferred=c;this._transport=d;c.done(function(a){y.trigger("success",a)});c.fail(function(a){y.trigger("error",
a)});c.always(function(){y.trigger("end")});y.trigger("start");b.timeout&&(this._timeout=setTimeout(e(this.onTimeout,this),b.timeout));b.jsonp&&this.createJsonp();!1===y.trigger("beforeSend",b,d)&&(this._promise=n.reject());b.beforeSend&&!1===b.beforeSend.call(b.callbackScope,b,d)&&(this._promise=n.reject());this._promise||(k(d.send,d),b=c.promise(),b.abort=e(this.abort,this),c.always(this.destroy,this),this._promise=b)};h(A.prototype,{_jsonpName:null,_transport:null,_opt:null,_deferred:null,_promise:null,
_timeout:null,_form:null,_removeForm:!1,promise:function(){return this._promise},abort:function(a){this._transport.abort();this._deferred.reject(a||"abort")},onTimeout:function(){this.abort("timeout")},createForm:function(){var a=document.createElement("form");a.style.display="none";a.setAttribute("method",this._opt.method);E(this._opt.data,a,null);document.body.appendChild(a);this._form=a;this._removeForm=!0},createJsonp:function(){var a=this._opt,c=a.jsonpParam||"callback",d=a.jsonpCallback||"jsonp_"+
++b;a.url+=(l.test(a.url)?"&":"?")+c+"="+d;this._jsonpName=d;"undefined"!=typeof window&&(window[d]=e(this.jsonpCallback,this));"undefined"!=typeof global&&(global[d]=e(this.jsonpCallback,this));return d},jsonpCallback:function(a){try{this._deferred.resolve(this.processResponseData(a))}catch(b){this._deferred.reject(b)}},processResponseData:function(a,b){var c=this._opt;a=J(a,c,b);y.hasListener("processResponse")&&(a=y.trigger("processResponse",a,this._deferred));c.processResponse&&(a=c.processResponse.call(c.callbackScope,
a,this._deferred));return a},processResponse:function(a,b){var c=this._deferred;if(this._opt.jsonp)if(a){try{D(a)}catch(d){c.reject(d)}c.isPending()&&c.reject("jsonp script didn't invoke callback")}else c.reject("jsonp script is empty");else try{c.resolve(this.processResponseData(a,b))}catch(e){c.reject(e)}},destroy:function(){this._timeout&&clearTimeout(this._timeout);this._form&&this._form.parentNode&&this._removeForm&&this._form.parentNode.removeChild(this._form);this._transport.destroy();delete this._transport;
delete this._opt;delete this._deferred;delete this._promise;delete this._timeout;delete this._form;this._jsonpName&&("undefined"!=typeof window&&delete window[this._jsonpName],"undefined"!=typeof global&&delete global[this._jsonpName])}},!0);var w=function(a,b){b=b||{};a&&"string"!=typeof a?b=a:b.url=a;if(!b.url&&(b.form&&(b.url=b.form.getAttribute("action")),!b.url))throw"Must provide url";h(b,B,!1);h(b,C,!1);b.method=b.method?b.method.toUpperCase():b.form?b.form.getAttribute("method").toUpperCase()||
"GET":"GET";return(new A(b)).promise()};w.setup=function(a){h(B,a,!0)};w.on=function(){y.on.apply(y,arguments)};w.un=function(){y.un.apply(y,arguments)};w.get=function(a,b){b=b||{};b.method="GET";return w(a,b)};w.post=function(a,b){b=b||{};b.method="POST";return w(a,b)};w.load=function(a,b,c){c=c||{};"string"!=typeof b&&(c=b);c.dataType="fragment";return w(b,c).done(function(b){if(c.replace)for(;a.firstChild;)a.removeChild(a.firstChild);a.appendChild(b)})};w.loadScript=function(a){return w(a,{transport:"script"})};
w.submit=function(a,b){b=b||{};b.form=a;return w(null,b)};var H=function(a,b,c){var d;if(!(window.XMLHttpRequest&&(d=new XMLHttpRequest)||(d=new ActiveXObject("Msxml2.XMLHTTP"))||(d=new ActiveXObject("Microsoft.XMLHTTP"))))throw"Unable to create XHR object";this._xhr=d;this._deferred=b;this._opt=a;this._ajax=c;a.progress&&s(d,"progress",e(a.progress,a.callbackScope));a.uploadProgress&&d.upload&&s(d.upload,"progress",e(a.uploadProgress,a.callbackScope));try{var f;if(a.xhrFields)for(f in a.xhrFields)d[f]=
a.xhrFields[f];a.data&&a.contentType&&d.setRequestHeader("Content-Type",a.contentType);d.setRequestHeader("X-Requested-With","XMLHttpRequest");d.setRequestHeader("Accept",a.dataType&&u[a.dataType]?u[a.dataType]+", */*; q=0.01":u._default);for(f in a.headers)d.setRequestHeader(f,a.headers[f])}catch(k){}d.onreadystatechange=e(this.onReadyStateChange,this)};h(H.prototype,{_xhr:null,_deferred:null,_ajax:null,onReadyStateChange:function(){var a=this._xhr,b=this._deferred;if(0===a.readyState)a.onreadystatechange=
F,b.resolve(a);else if(4===a.readyState){a.onreadystatechange=F;var c;a:{try{c=!a.status&&"undefined"!=typeof location&&"file:"==location.protocol||200<=a.status&&300>a.status||304===a.status||1223===a.status;break a}catch(d){}c=!1}c?this._ajax.processResponse("string"==typeof a.responseText?a.responseText:void 0,a.getResponseHeader("content-type")||""):b.reject(a)}},abort:function(){this._xhr.onreadystatechange=F;this._xhr.abort()},send:function(){var a=this._opt;try{this._xhr.open(a.method,a.url,
!0,a.username,a.password),this._xhr.send(a.data)}catch(b){this._deferred.reject(b)}},destroy:function(){delete this._xhr;delete this._deferred;delete this._opt;delete this._ajax}},!0);var K=function(a,b,c){this._opt=a;this._ajax=c;this._deferred=b};h(K.prototype,{_opt:null,_deferred:null,_ajax:null,_el:null,send:function(){var a=document.createElement("script");a.setAttribute("async","async");a.setAttribute("charset","utf-8");a.setAttribute("src",this._opt.url);s(a,"load",e(this.onLoad,this));s(a,
"error",e(this.onError,this));document.head.appendChild(a);this._el=a},onLoad:function(a){this._deferred&&this._deferred.resolve(a)},onError:function(a){this._deferred.reject(a)},abort:function(){this._el.parentNode&&this._el.parentNode.removeChild(this._el)},destroy:function(){this._el.parentNode&&this._el.parentNode.removeChild(this._el);delete this._el;delete this._opt;delete this._ajax;delete this._deferred}},!0);var L=function(a,b,c){this._opt=a;this._ajax=c;this._deferred=b};h(L.prototype,{_opt:null,
_deferred:null,_ajax:null,_el:null,send:function(){var a=document.createElement("iframe"),c="frame-"+ ++b,d=this._opt.form;a.setAttribute("id",c);a.setAttribute("name",c);a.style.display="none";document.body.appendChild(a);d.setAttribute("action",this._opt.url);d.setAttribute("target",c);s(a,"load",e(this.onLoad,this));s(a,"error",e(this.onError,this));this._el=a;try{d.submit()}catch(f){this._deferred.reject(f)}},onLoad:function(){var a=this._el;this._opt&&!this._opt.jsonp&&(a=a.contentDocument||
a.contentWindow.document,a=a.body.innerHTML,this._ajax.processResponse(a))},onError:function(a){this._deferred.reject(a)},abort:function(){this._el.parentNode&&this._el.parentNode.removeChild(this._el)},destroy:function(){this._el.parentNode&&this._el.parentNode.removeChild(this._el);delete this._el;delete this._opt;delete this._ajax;delete this._deferred}},!0);"undefined"!=typeof global?module.exports=w:window.MetaphorJs?MetaphorJs.ajax=w:window.MetaphorJs={ajax:w}})();
(function(){var n=[],p=!1,q=/(?:(\w+\:))?(?:\/\/(?:[^@]*@)?([^\/:\?#]+)(?::([0-9]+))?)?([^\?#]*)(?:(\?[^#]+)|\?)?(?:(#.*))?/,h=function(a,c,b){a.attachEvent?a.attachEvent("on"+c,b):a.addEventListener(c,b,!1)},e=!!history.pushState,d="onhashchange"in window,f=function(a){var c=location.protocol+"//"+location.hostname;location.port&&(c+=":"+location.port);a=a.replace(c,"");e||(a=encodeURIComponent(a));return a},g=function(){var a;e?a=location.pathname+location.search:(a=location.hash.substr(1))?("!"==
a.substr(0,1)&&(a=a.substr(1)),a=decodeURIComponent(a)):a=location.pathname+location.search;return a},l=function(){var a=g();if(n.length)for(var c=-1,b=n.length;++c<b;n[c].call(null,a));window.MetaphorJs&&MetaphorJs.triggerAsync("locationchange",a)};h(window,"load",function(){p=!0});history.initPushState=function(){if(e)history.origPushState=history.pushState,history.origReplaceState=history.replaceState,h(window,"popstate",l),history.pushState=function(a,b,c){history.origPushState(a,b,f(c));l()},
history.replaceState=function(a,b,c){history.origReplaceState(a,b,f(c));l()};else if(d)history.replaceState=history.pushState=function(a,b,c){a=f(c);location.hash=a?"!"+a:""},h(window,"hashchange",l);else{var a=null,c=!1;window.onIframeHistoryChange=function(a){c||(location.hash=a?"!"+a:"",l())};var b=function(b){var c=a.contentWindow.document;c.open();c.write("<html><head><title>"+document.title+'</title><script type="text/javascript">var hashValue = "'+b+'";window.top.onIframeHistoryChange(hashValue);\x3c/script></head><body>&nbsp;</body></html>');
c.close()};history.pushState=function(a,c,d){b(f(d))};history.replaceState=function(b,c,d){b=f(d);a.contentWindow.hashValue=b};var k=function(){a=document.createElement("iframe");a.src="about:blank";a.style.display="none";document.body.appendChild(a);c=!0;b(f(location.hash.substr(1)));c=!1};p?k():h(window,"load",k)}h(document.documentElement,"click",function(a){a=a||window.event;for(var b=a.target||a.srcElement,c;b&&"a"!=b.nodeName.toLowerCase();)b=b.parentNode;if(b){c=b.getAttribute("href");var d;
if(d=c&&"#"!=c.substr(0,1))c=c.match(q),d=c[1]&&location.protocol!=c[1]||c[2]&&location.hostname!=c[2]?!1:c[2]||c[3]?location.port!=c[3]?!1:!0:!0;if(d&&!b.getAttribute("target"))return history.pushState(null,null,b.getAttribute("href")),a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation(),!1}});history.initPushState=function(){}};window.MetaphorJs?(MetaphorJs.pushUrl=function(a){history.pushState(null,null,a)},MetaphorJs.replaceUrl=function(a){history.replaceState(null,null,
a)},MetaphorJs.currentUrl=function(){return g()}):history.onchange=function(a){n.push(a)}})();
(function(){var n=/\r/g,p=function(h){var e,d;if((e=q[h.type]||q[h.nodeName.toLowerCase()])&&"get"in e&&void 0!==(d=e.get(h,"value")))return d;d=h.value;return"string"===typeof d?d.replace(n,""):null==d?"":d},q={option:{get:function(h){var e=h.getAttribute("value");return null!=e?e:MetaphorJs.trim(h.innerText||h.textContent)}},select:{get:function(h){for(var e,d=h.options,f=h.selectedIndex,g=(h="select-one"===h.type||0>f)?null:[],l=h?f+1:d.length,a,c=0>f?l:h?f:0;c<l;c++)if(e=d[c],a=e.disabled||null!==
e.getAttribute("disabled")||d.parentNode.disabled,(e.selected||c===f)&&!a){e=p(e);if(h)return e;g.push(e)}return g},set:function(h,e){for(var d,f,g=h.options,l=MetaphorJs.toArray(e),a=g.length;a--;)if(f=g[a],f.selected=MetaphorJs.inArray(f.value,l))d=!0;d||(h.selectedIndex=-1);return l}}};q.radio=q.checkbox={set:function(h,e){if(MetaphorJs.isArray(e))return h.checked=0<=MetaphorJs.inArray(p(h),e)},get:function(h){return null===h.getAttribute("value")?"on":h.value}};MetaphorJs.getValue=p;MetaphorJs.setValue=
function(h,e){if(1===h.nodeType){null==e?e="":"number"===typeof e&&(e+="");var d=q[h.type]||q[h.nodeName.toLowerCase()];d&&"set"in d&&void 0!==d.set(this,e,"value")||(h.value=e)}}})();
(function(){var n=function(){return!1},p=function(){return!0},q=function(h){if(!(this instanceof q))return new q(h);for(var e in h)h.hasOwnProperty&&h.hasOwnProperty(e)||this[e]||(this[e]=h[e]);this.originalEvent=h;this.type=h.type;!this.target&&h.srcElement&&(this.target=h.srcElement);this.isDefaultPrevented=h.defaultPrevented||void 0===h.defaultPrevented&&!1===h.returnValue?p:n;this.timeStamp=h&&h.timeStamp||(new Date).getTime()};q.prototype={isDefaultPrevented:n,isPropagationStopped:n,isImmediatePropagationStopped:n,
preventDefault:function(){var h=this.originalEvent;this.isDefaultPrevented=p;h&&h.preventDefault&&h.preventDefault()},stopPropagation:function(){var h=this.originalEvent;this.isPropagationStopped=p;h&&h.stopPropagation&&h.stopPropagation()},stopImmediatePropagation:function(){var h=this.originalEvent;this.isImmediatePropagationStopped=p;h&&h.stopImmediatePropagation&&h.stopImmediatePropagation();this.stopPropagation()}};MetaphorJs.normalizeEvent=function(h){return new q(h)}})();
(function(){var n=MetaphorJs.lib.Observable,p=MetaphorJs.apply;MetaphorJs.d("MetaphorJs.cmp.Base",{destroyed:!1,_observable:null,initialize:function(q){q=q||{};this._observable=new n;p(this,this._observable.getApi());if(q.callback){var h=q.callback,e=h.scope||this;delete h.scope;for(var d in h)if(h.hasOwnProperty(d))this.on(d,h[d],e);delete q.callback}p(this,q,!0)},destroy:function(){if(!this.destroyed){if(!1===this.trigger("beforedestroy",this))return!1;this.onDestroy();this.destroyed=!0;this.trigger("destroy",
this);this._observable.destroy();delete this._observable}},onDestroy:MetaphorJs.emptyFn})})();
(function(){var n={},p={},q=MetaphorJs.apply,h=MetaphorJs.ajax,e=MetaphorJs.create;MetaphorJs.define("MetaphorJs.data.Model",{type:null,fields:null,record:null,store:null,plain:!1,initialize:function(d){this.fields={};q(this,{record:{load:null,save:null,"delete":null,id:null,data:null,success:null,extra:{}},store:{load:null,save:null,"delete":null,id:null,data:null,total:null,start:null,limit:null,success:null,extra:{}}},!1);q(this,d,!0);this.plain=!this.type},isPlain:function(){return this.plain},
getRecordProp:function(d,e){return this.getProp("record",d,e)},setRecordProp:function(d,e){this.record[d]=e},getStoreProp:function(d,e){return this.getProp("store",d,e)},setStoreProp:function(d,e){this.store[d]=e},getProp:function(d,e,g){d=this[d];return d[e]&&d[e][g]||d[g]||this[g]||null},setProp:function(d,e){return this[d]=e},_createAjaxCfg:function(d,e,g,l){var a=this,c=a[d],b=q({},"string"==typeof c[e]?{url:c[e]}:c[e]),k=a.getProp(d,e,"id"),h=a.getProp(d,e,"data"),n=a.getProp(d,e,"url"),p=a.getProp(d,
e,"json");if(!b)if(n)b={url:n};else throw d+"."+e+" not defined";"string"==typeof b&&(b={url:b});if(!b.url){if(!n)throw d+"."+e+" url not defined";b.url=n}b.data=q({},b.data,a.extra,c.extra,c[e]?c[e].extra:{});b.method||(b.method="load"==e?"GET":"POST");g&&(b.data[k]=g);l&&(h?b.data[h]=l:b.data=l);p&&b.data&&"GET"!=b.method&&(b.data=JSON.stringify(b.data));b.callbackScope=a;"record"==d?b.processResponse=function(b,c){a._processRecordResponse(e,b,c)}:"store"==d&&(b.processResponse=function(b,c){a._processStoreResponse(e,
b,c)});return b},_processRecordResponse:function(d,e,g){var l=this.getRecordProp(d,"id"),a=this.getRecordProp(d,"data"),l=(a=a?e[a]:e)&&a[l]||e[l];this._getSuccess("record",d,e)?g.resolve({id:l,data:a}):g.reject(e)},_processStoreResponse:function(d,e,g){var l=this.getStoreProp(d,"data"),a=this.getStoreProp(d,"total"),l=l?e[l]:e,a=a?e[a]:null;this._getSuccess("store",d,e)?g.resolve({data:l,total:a}):g.reject(e)},_getSuccess:function(d,e,g){return(d=this.getProp(d,e,"success"))&&void 0!=g[d]?g[d]:!0},
loadRecord:function(d){return h(this._createAjaxCfg("record","load",d))},saveRecord:function(d,e,g){return h(this._createAjaxCfg("record",d.getId()?"save":"create",d.getId(),q({},d.storeData(d.getData(e)),g)))},deleteRecord:function(d){return h(this._createAjaxCfg("record","delete",d.getId()))},loadStore:function(d,e){return h(q(this._createAjaxCfg("store","load"),e,!0))},saveStore:function(d,e){return h(this._createAjaxCfg("store","save",null,e))},deleteRecords:function(d,e){return h(this._createAjaxCfg("store",
"delete",e))},getFields:function(){return this.fields},restoreField:function(d,e,g){var l=this.fields[e];if(l){switch("string"==typeof l?l:l.type){case "int":g=parseInt(g);break;case "bool":case "boolean":"string"==typeof g?(g=g.toLowerCase(),g=!("off"===g||"no"===g||"0"===g||"false"==g||"null"==g)):g=g?!0:!1;break;case "double":case "float":g=parseFloat(g);break;case "date":l.parseFn?g=l.parseFn(g,l.format):Date.parse?g=Date.parse(g,l.format):("timestamp"==l.format&&(g=1E3*parseInt(g)),g=new Date(g))}l.restore&&
(g=l.restore.call(d,g,e))}return this.onRestoreField(d,e,g)},onRestoreField:function(d,e,g){return g},storeField:function(d,e,g){var l=this.fields[e];if(l){switch("string"==typeof l?l:l.type){case "bool":case "boolean":g=g?"1":"0";break;case "date":g=l.formatFn?l.formatFn(g,l.format):Date.format?Date.format(g,l.format):"timestamp"==l.format?g.getTime()/1E3:g.format?g.format(l.format):g.toString();break;default:g=g.toString()}l.store&&(g=l.store.call(d,g,e))}return this.onStoreField(d,e,g)},onStoreField:function(d,
e,g){return g}},{create:function(d,f){return"MetaphorJs.data.Model"==d?e(d,f):f?e(d,f):n[d]?n[d]:n[d]=e(d)},addToCache:function(d){var e=d.getClass(),g=d.getId();"MetaphorJs.data.Record"!=e&&(p[e]||(p[e]={}),p[e][g]=d)},getFromCache:function(d,e){return p[d]&&p[d][e]?p[d][e]:null},removeFromCache:function(d,e){p[d]&&p[d][e]&&delete p[d][e]}})})();
(function(){var n=MetaphorJs.data.Model,p=MetaphorJs.create,q=MetaphorJs.is,h=MetaphorJs.apply;MetaphorJs.define("MetaphorJs.data.Record","MetaphorJs.cmp.Base",{id:null,data:null,orig:null,modified:null,loaded:!1,dirty:!1,destroyed:!1,model:null,standalone:!0,stores:null,initialize:function(e,d,f){var g=arguments.length;1==g?(f=e,d=e=null):2==g&&(f=d,d=null);this.data={};this.orig={};this.stores=[];this.modified={};f=f||{};this.supr(f);"string"==typeof this.model?this.model=p(this.model):q(this.model,
"MetaphorJs.data.Model")||(this.model=p("MetaphorJs.data.Model",this.model));this.id=e;d?this.importData(d):!1!==f.autoLoad&&e&&this.load();"MetaphorJs.data.Record"!=this.getClass()&&n.addToCache(this)},isLoaded:function(){return this.loaded},isStandalone:function(){return this.standalone},isDirty:function(){return this.dirty},getModel:function(){return this.model},attachStore:function(e){e=e.getId();-1==this.stores.indexOf(e)&&this.stores.push(e)},detachStore:function(e){e=e.getId();var d;this.destroyed||
-1==(d=this.stores.indexOf(e))||(this.stores.splice(d,1),0!=this.stores.length||this.standalone||this.destroy())},setDirty:function(e){this.dirty!=e&&(this.dirty=!!e,this.trigger("dirtychange",this,e))},importData:function(e){var d={},f;if(e){for(f in e)d[f]=this.model.restoreField(this,f,e[f]);this.data=d}this.orig=h({},this.data);this.modified={};this.loaded=!0;this.setDirty(!1)},storeData:function(e){var d={},f;for(f in e)d[f]=this.model.storeField(this,f,e[f]);return d},getId:function(){return this.id},
getData:function(e){if(e){var d={},f,g;e="string"==typeof e?[e]:e;f=0;for(g=e.length;f<g;f++)d[e[f]]=this.data[e[f]];return d}return h({},this.data)},getChanged:function(){return h({},this.modified)},isChanged:function(e){return this.modified[e]||!1},get:function(e){return this.data[e]},setId:function(e){!this.id&&e&&(this.id=e)},set:function(e,d){var f=this.data[e];d=this.model.restoreField(this,e,d);this.data[e]=d;f!=d&&(this.modified[e]=!0,this.setDirty(!0),this.trigger("change",this,e,d,f),this.trigger("change-"+
e,this,e,d,f))},revert:function(){this.dirty&&(this.data=h({},this.orig),this.modified={},this.setDirty(!1))},load:function(){var e=this;e.trigger("beforeload",e);return e.model.loadRecord(e.id).done(function(d){e.setId(d.id);e.importData(d.data);e.trigger("load",e)}).fail(function(){e.trigger("failedload",e)})},save:function(e,d){var f=this;f.trigger("beforesave",f);return f.model.saveRecord(f,e,d).done(function(d){f.setId(d.id);f.importData(d.data);f.trigger("save",f)}).fail(function(d){f.trigger("failedsave",
f)})},"delete":function(){var e=this;e.trigger("beforedelete",e);return e.model.deleteRecord(e).done(function(){e.trigger("delete",e);e.destroy()}).fail(function(){e.trigger("faileddelete",e)})},reset:function(){this.id=null;this.data={};this.orig={};this.modified={};this.dirty=this.loaded=!1;this.trigger("reset",this)},destroy:function(){this.destroyed||(this.destroyed=!0,this.trigger("destroy",this),this.stores=this.model=this.modified=this.orig=this.data=null,n.removeFromCache(this.getClass(),
this.id),this.supr())}})})();
(function(){var n=0,p={},q=MetaphorJs.create,h=MetaphorJs.isArray,e=MetaphorJs.data.Record,d=MetaphorJs.data.Model,f=MetaphorJs.is,g=MetaphorJs.emptyFn,l=MetaphorJs.apply;MetaphorJs.d("MetaphorJs.data.Store","MetaphorJs.cmp.Base",{id:null,autoLoad:!1,clearOnLoad:!0,model:null,extraParams:null,loaded:!1,loading:!1,local:!1,items:null,map:null,keys:null,length:0,totalLength:0,start:0,pageSize:null,pages:null,filtered:!1,filterBackup:null,filterFn:null,filterScope:null,filterParams:null,initialize:function(a,
c,b){this.items=[];this.map={};this.keys=[];this.loaded=!1;this.extraParams=this.extraParams||{};a&&"string"!=typeof a&&(b=c,c=a,a=null);c=c||{};this.supr(c);this.id=this.id||++n;p[this.id]=this;"string"==typeof this.model?this.model=q(this.model):f(this.model,d)||(this.model=q("MetaphorJs.data.Model",this.model));if(a||c.url)this.model.store.load=a||c.url;!this.local&&this.autoLoad?this.load():b&&(h(b)?this.loadArray(b):this.loadAjaxData(b));this.local&&(this.loaded=!0)},getId:function(){return this.id},
isLoaded:function(){return this.loaded},isLocal:function(){return this.local},setLocal:function(a){this.local=!!a},isLoading:function(){return this.loading},isFiltered:function(){return this.filtered},getLength:function(){return this.length},getTotalLength:function(){return this.filtered?this.length:this.totalLength||this.length},getPagesCount:function(){return null!==this.pageSize?parseInt(this.totalLength/this.pageSize):1},setParam:function(a,c){this.extraParams[a]=c},getParam:function(a){return this.extraParams[a]},
setStart:function(a){this.start=a},setPageSize:function(a){this.pageSize=a},getAjaxData:function(){return this.ajaxData},hasDirty:function(){if(this.model.isPlain())return!1;var a=!1;this.each(function(c){return c.isDirty()?(a=!0,!1):!0});return a},getDirty:function(){var a=[];if(this.model.isPlain())return a;this.each(function(c){c.isDirty()&&a.push(c)});return a},getModel:function(){return this.model},importData:function(a){this.suspendAllEvents();for(var c=0;c<a.length;c++)this.add(a[c]);this.resumeAllEvents();
this.loaded=!0;this.loading=!1;this.onLoad();this.trigger("load",this)},load:function(a){var c=this,b=c.model.store,d=b.start,b=b.limit;if(c.local)return null;a=l({},c.extraParams,a||{});null===c.pageSize||a[d]||a[b]||(a[d]=c.start,a[b]=c.pageSize);return!1===c.trigger("beforeload",c)?null:c.model.loadStore(c,a).done(function(a){c.totalLength=parseInt(a.total);c.importData(a.data);c.totalLength=parseInt(a.total)}).fail(function(){c.onFailedLoad();c.trigger("failedload",c)})},onLoad:g,onFailedLoad:g,
save:function(){var a=this,c={},b=0;if(a.local)return null;if(a.model.isPlain())throw Error("Cannot save plain store");a.each(function(a){a.isDirty()&&(c[a.getId()]=a.storeData(a.getData()),b++)});if(!b)throw Error("Nothing to save");return!1===a.trigger("beforesave",a,c)?null:a.model.saveStore(a,c).done(function(b){var c,d,e=b.data;if(e&&e.length)for(b=0,c=e.length;b<c;b++)d=a.getRecordId(e[b]),(d=a.getById(d))&&d.importData(e[b]);a.onSave();a.trigger("save",a)}).fail(function(){a.onFailedSave();
a.trigger("failedsave",a)})},onSave:g,onFailedSave:g,deleteById:function(a){var c=this,b,d,f;if(c.local)return null;if(!a||h(a)&&!a.length)throw Error("Record id required");h(a)||(a=[a]);b=0;for(d=a.length;b<d;b++)f=c.getById(a[b]),f instanceof e?f.destroy():c.removeId(a[b]);return!1===c.trigger("beforedelete",c,a)?null:c.model.deleteRecords(c,a).done(function(){c.onDelete();c.trigger("delete",c,a)}).fail(function(){c.onFailedDelete();c.trigger("faileddelete",c,a)})},onDelete:g,onFailedDelete:g,deleteAt:function(a){var c=
this.getAt(a);if(!c)throw Error("Record not found at "+a);return this.deleteRecord(c)},"delete":function(a){return this.deleteById(this.getRecordId(a))},deleteRecords:function(a){var c=[],b,d;b=0;for(d=a.length;b<d;b++)c.push(this.getRecordId(a[b]));return this.deleteById(c)},loadAjaxData:function(a){var c=this;!1!==c.trigger("beforeload",c)&&c.model._processStoreResponse("load",a,{resolve:function(a,d){c.importData(a);c.totalLength=parseInt(d)},reject:function(){}})},loadArray:function(a,c){!1!==
this.trigger("beforeload",this)&&(!c&&this.clearOnLoad&&0<this.length&&this.clear(),h(a)&&(this.importData(a),this.totalLength=this.length))},loadOr:function(a,c){this.local||this.isLoading()||(this.isLoaded()?a&&a.call(c||this):this.load())},addNextPage:function(){!this.local&&this.length<this.totalLength&&this.load({start:this.length,limit:this.pageSize},!0)},loadNextPage:function(){this.local||(this.start+=this.pageSize,this.load())},loadPrevPage:function(){this.local||(this.start-=this.pageSize,
this.load())},getRecordId:function(a){return a instanceof e?a.getId():a[this.model.getStoreProp("load","id")]||null},processRawDataItem:function(a){if(a instanceof e||this.model.isPlain())return a;var c=this.model.type,b=this.getRecordId(a),f;b&&(f=d.getFromCache(c,b));f||(f=q(c,b,a,{model:this.model,standalone:!1}));return f},bindRecord:function(a,c){c[a]("change",this.onRecordChange,this);c[a]("destroy",this.onRecordDestroy,this);c[a]("dirtychange",this.onRecordDirtyChange,this);return c},onRecordDirtyChange:function(a){this.trigger("update",
this,a)},onRecordChange:function(a,c,b,d){this.trigger("update",this,a)},onRecordDestroy:function(a){this.remove(a)},add:function(a,c,b){if(this.filtered)throw"Cannot add to filtered store";if("string"!=typeof a&&"number"!=typeof a){c=a;if(h(c)){if(!c.length)return;a=this.length;for(var d=0,f=c.length;d<f;d++)c[d]=this.processRawDataItem(c[d]),this.add(this.getRecordId(c[d]),c[d],!0);this.onAdd(a,c);b||this.trigger("add",a,c);return}c=this.processRawDataItem(c);a=this.getRecordId(c)}if("undefined"!=
typeof a&&null!==a){if("undefined"!=typeof this.map[a]){this.replace(a,c);return}this.map[a]=c}this.length++;this.items.push(c);this.keys.push(a);c instanceof e&&(c.attachStore(this),this.bindRecord("on",c));this.onAdd(this.length-1,[c]);b||this.trigger("add",this.length-1,[c])},onAdd:g,removeAt:function(a){if(a<this.length&&0<=a){this.length--;this.totalLength--;var c=this.items[a];this.items.splice(a,1);var b=this.keys[a];"undefined"!=typeof b&&delete this.map[b];this.keys.splice(a,1);this.onRemove(c,
b);this.trigger("remove",c,b);return c instanceof e?(this.bindRecord("un",c),c.detachStore(this),null):c}return!1},onRemove:g,insert:function(a,c,b,d){if(this.filtered)throw Error("Cannot insert into filtered store");2==arguments.length&&(b=arguments[1],c=this.getRecordId(b));b=this.processRawDataItem(b);this.containsId(c)&&(this.suspendAllEvents(),this.removeId(c),this.resumeAllEvents());if(a>=this.length)return this.add(c,b,d);this.length++;this.items.splice(a,0,b);"undefined"!=typeof c&&null!==
c&&(this.map[c]=b);this.keys.splice(a,0,c);b instanceof e&&(b.attachStore(this),this.bindRecord("on",b));this.onAdd(a,[b]);d||this.trigger("add",a,[b]);return b},replace:function(a,c){var b,d;1==arguments.length&&(c=arguments[0],a=this.getRecordId(c));c=this.processRawDataItem(c);b=this.map[a];if("undefined"==typeof a||null===a||"undefined"==typeof b)return this.add(a,c);b instanceof e&&(this.bindRecord("un",b),b.detachStore(this));d=this.indexOfId(a);this.items[d]=c;this.map[a]=c;c instanceof e&&
(this.bindRecord("on",c),c.attachStore(this));this.onReplace(a,b,c);this.trigger("replace",a,b,c);return c},onReplace:g,remove:function(a){return this.removeAt(this.indexOf(a))},removeId:function(a){return this.removeAt(this.indexOfId(a))},contains:function(a){return-1!=this.indexOf(a)},containsId:function(a){return"undefined"!=typeof this.map[a]},clear:function(){var a=this.getRange();this.clearFilter(!0);this._reset();this.onClear();this.trigger("clear",a)},onClear:g,reset:function(){this._reset()},
_reset:function(a){var c,b;if(!a)for(a=0,c=this.items.length;a<c;a++)b=this.items[a],b instanceof e&&(this.bindRecord("un",b),b.detachStore(this));this.totalLength=this.length=this.start=0;this.items=[];this.keys=[];this.map={};this.loaded=this.local},filter:function(a,c,b){this.filtered&&this.clearFilter(!0);this.filtered=!0;this.filterFn=a;this.filterScope=c;this.filterParams=b;this.trigger("beforefilter",this);this.suspendAllEvents();this.filterBackup={length:this.length,items:this.items,keys:this.keys,
map:this.map};this._reset(!0);a=this.filterBackup.keys;c=this.filterBackup.items;b=0;for(var d=c.length;b<d;b++)this._filterRecord(c[b],a[b])&&(this.items.push(c[b]),this.keys.push(a[b]),this.length++,this.map[a[b]]=c[b]);this.resumeAllEvents();this.onFilter();this.trigger("filter",this)},onFilter:g,_filterRecord:function(a,c){return this.filtered&&this.filterFn.call(this.filterScope,a,c,this.filterParams)},clearFilter:function(a){this.filtered&&(a||this.trigger("beforeclearfilter",this),this.suspendAllEvents(),
this.filtered=!1,this._reset(!0),this.length=this.filterBackup.length,this.items=this.filterBackup.items,this.keys=this.filterBackup.keys,this.map=this.filterBackup.map,this.filterBackup=null,this.resumeAllEvents(),this.onClearFilter(),a||this.trigger("clearfilter",this))},onClearFilter:g,getAt:function(a){return this.items[a]||null},getById:function(a){return this.map[a]||null},indexOf:function(a){return this.items.indexOf(a)},indexOfId:function(a){return this.keys.indexOf(a)},each:function(a,c){var b=
[].concat(this.items);c=c||window;for(var d=0,e=b.length;d<e&&!1!==a.call(c,b[d],d,e);d++);},eachId:function(a,c){c=c||window;for(var b=0,d=this.keys.length;b<d;b++)a.call(c,this.keys[b],this.items[b],b,d)},collect:function(a){var c=[],b=!this.model.isPlain();this.each(function(d){(d=b?d.get(a):d[a])&&c.push(d)});return c},first:function(){return this.items[0]},last:function(){return this.items[this.length-1]},getRange:function(a,c){var b=this.items;if(1>b.length)return[];a=a||0;c=Math.min("undefined"==
typeof c||null===c?this.length-1:c,this.length-1);var d,e=[];if(a<=c)for(d=a;d<=c;d++)e[e.length]=b[d];else for(d=a;d>=c;d--)e[e.length]=b[d];return e},findBy:function(a,c,b){a=this.findIndexBy(a,c,b);return-1==a?null:this.getAt(a)},findIndexBy:function(a,c,b){c=c||this;var d=this.keys,e=this.items;b=b||0;for(var f=e.length;b<f;b++)if(a.call(c,e[b],d[b]))return b;return-1},find:function(a,c,b){var d=!this.model.isPlain(),e;return this.findIndexBy(function(f){e=d?f.get(a):f[a];return b?e===c:e==c},
this)},findExact:function(a,c){return this.find(a,c,!0)},findBySet:function(a){var c=null,b,d;this.each(function(e){b=!0;for(d in a)if(a[d]!=e[d]){b=!1;break}return b?(c=e,!1):!0});return c},onDestroy:function(){delete p[this.id];this.clear();this.supr()}},{createFromSelect:function(a){var c=[];a=a.options;for(var b=0,d=a.length;b<d;b++){var e=a[b],f=(e.hasAttribute?e.hasAttribute("value"):e.getAttributeNode("value").specified)?e.value:e.text;c.push([f,e.text])}a=q("MetaphorJs.data.Store",{server:{load:{id:0}}});
a.loadArray(c);return a},lookupStore:function(a){return p[a]||null},eachStore:function(a,c){for(var b in p)if(!1===a.call(c||window,p[b]))break}})})();
(function(){var n={show:["mjs-show"],hide:["mjs-hide"],enter:["mjs-enter"],leave:["mjs-leave"],move:["mjs-move"]},p=["Moz","Webkit","ms","O","Khtml"],q="animationDelay",h="animationDuration",e="transitionDelay",d="transitionDuration",f=0,g=function(){var a=document.createElement("div"),b=!1,c,f,g;if(void 0!==a.style.animationName)b=!0;else for(f=0,g=p.length;f<g;f++)if(c=p[f],void 0!==a.style[c+"AnimationName"]){b=!0;q=c+"AnimationDelay";h=c+"AnimationDuration";e=c+"TransitionDelay";d=c+"TransitionDuration";
break}return b}(),l=window.requestAnimationFrame?window.requestAnimationFrame:function(a){window.setTimeout(a,0)},a=MetaphorJs.g,c=MetaphorJs.lib.Promise,b=MetaphorJs.data,k=MetaphorJs.isThenable,s=function(a,b,c){var d=function(){(new Date).getTime()-b>=c?a():l(d)};l(d)},r=function(a){if(!a)return 0;var b=parseFloat(a);-1==a.indexOf("ms")&&(b*=1E3);return b},x=function(a,b,c){var d,e,f=b.length;for(d=0;d<f;d++)e=r(b[d])+r(c[d]),a=Math.max(e,a);return a},t=function B(a,c,f,g,n,p,r){var A=function(){var c=
b(a,"mjsAnimationQueue");return c&&c.length&&c[0].id==r?!1:(n.reject(a),!0)},w=function(){if(!A()){var d=f;f++;if(f==c.length){n.resolve(a);b(a,"mjsAnimationQueue").shift();var e=b(a,"mjsAnimationQueue");e.length?(e=e[0],t(e.el,e.stages,0,e.start,e.deferred,!1,e.id)):b(a,"mjsAnimationQueue",null)}else b(a,"mjsAnimationQueue")[0].position=f,B(a,c,f,null,n);u(a,c[d]);u(a,c[d]+"-active")}},H=function(){if(!A()){z(a,c[f]+"-active");var b,m=window.getComputedStyle?window.getComputedStyle(a):a.style;b=
0;var g=(m[h]||"").split(","),l=(m[q]||"").split(","),k=(m[d]||"").split(","),m=(m[e]||"").split(",");b=Math.max(b,x(b,g,l));(b=Math.max(b,x(b,k,m)))?s(w,(new Date).getTime(),b):w()}},K=function(){if(!A()){z(a,c[f]);var b;g&&(b=g(a),g=null);k(b)?b.done(H):l(H)}};p?l(K):K()},z=MetaphorJs.addClass,u=MetaphorJs.removeClass;MetaphorJs.stopAnimation=function(a){var c=b(a,"mjsAnimationQueue"),d;c&&c.length&&(d=c[0])&&d.stages&&(c=d.position,d=d.stages,u(a,d[c]),u(a,d[c]+"-active"));b(a,"mjsAnimationQueue",
null)};MetaphorJs.animate=function(d,e,l){var h=d.getAttribute("mjs-animate"),u=d.getAttribute("mjs-animate-js"),p=new c,q=b(d,"mjsAnimationQueue")||[],r=++f,s,x;e&&"string"==typeof e&&(e=n[e]);"string"==typeof h&&h&&"["==h.substr(0,1)&&(e=(new Function("","return "+h))(),h=null);q.push({el:d,stages:e,start:l,deferred:p,position:0,id:r});b(d,"mjsAnimationQueue",q);void 0!=h&&g&&e?1==q.length&&t(d,e,0,l,p,!0,r):(s=u||h)&&(x=a("animate."+s,!0))?x(d,l,p):l?(e=l(d),k(e)?e.done(function(){p.resolve(d)}):
p.resolve(d)):p.resolve(d);return p.promise()}})();
(function(){var n=MetaphorJs.lib.Observable,p=MetaphorJs.lib.Watchable,q=MetaphorJs.apply,h;h=MetaphorJs.d("MetaphorJs.view.Scope",{$parent:null,$root:null,$isRoot:!1,$$observable:null,$$watchers:null,$$checking:!1,$$destroyed:!1,initialize:function(e){this.$$observable=new n;q(this,e);this.$parent?(this.$parent.$on("check",this.$$onParentCheck,this),this.$parent.$on("destroy",this.$$onParentDestroy,this)):(this.$root=this,this.$isRoot=!0)},$new:function(){return new h({$parent:this,$root:this.$root})},
$on:function(e,d,f){return this.$$observable.on(e,d,f)},$un:function(e,d,f){return this.$$observable.un(e,d,f)},$watch:function(e,d,f){p.create(this,e,d,f,null)},$unwatch:function(e,d,f){p.unsubscribeAndDestroy(this,e,d,f)},$get:function(e){for(var d=this;d;){if(void 0!=d[e])return d[e];d=d.$parent}},$$onParentDestroy:function(){this.$destroy()},$$onParentCheck:function(){this.$check()},$check:function(){var e;this.$$checking||(this.$$checking=!0,this.$$watchers&&(e=this.$$watchers.$checkAll()),this.$$checking=
!1,this.$$destroyed||this.$$observable.trigger("check",e))},$destroy:function(){this.$$observable.trigger("destroy");this.$$observable.destroy();delete this.$$observable;this.$$watchers&&(this.$$watchers.$destroyAll(),delete this.$$watchers);this.$$destroyed=!0}})})();
(function(){var n=navigator.userAgent.toLowerCase(),p=parseInt((/msie (\d+)/.exec(n)||[])[1],10),q=parseInt((/android (\d+)/.exec(n)||[])[1],10),h={};isNaN(p)&&(p=parseInt((/trident\/.*; rv:(\d+)/.exec(n)||[])[1],10));MetaphorJs.browser={android:q,hasEvent:function(e){if("input"==e&&9==p)return!1;if(void 0===h[e]){var d=document.createElement("div");h[e]="on"+e in d}return h[e]}}})();
(function(){var n=MetaphorJs.nextUid,p=MetaphorJs.view.Scope,q=MetaphorJs.lib.Watchable,h=MetaphorJs.lib.Observable,e=MetaphorJs.isThenable,d=MetaphorJs.toArray,f=MetaphorJs.getAttributeHandlers,g=null,l=MetaphorJs.g,a=MetaphorJs.trim,c=q.create,b=q.unsubscribeAndDestroy,k,s="string"==typeof document.createTextNode("").textContent?"textContent":"nodeValue",r=function(a,b,c,e,f){var g=[];if(a&&!0!==a){if(a.nodeType){t(a,c,e,f);return}g=d(a)}g.length||(g=d(b.childNodes));a=-1;for(b=g.length>>>0;++a!==
b;t(g[a],c,e,f));},x=/^(script|template|mjs-template|style)$/i,t=function(a,b,c,d){var f;a.nodeName.match(x)||!1!==(f=b.call(c,a,d))&&(e(f)?f.done(function(e){!1!==e&&r(e,a,b,c,d)}):r(f,a,b,c,d))},z=new h;k=MetaphorJs.d("MetaphorJs.view.Renderer",{id:null,el:null,scope:null,texts:null,parent:null,destroyed:!1,_observable:null,initialize:function(a,b,c){this.id=n();this.el=a;this.scope=b;this.texts=[];this.parent=c;b instanceof p&&b.$on("destroy",this.destroy,this);if(c)c.on("destroy",this.destroy,
this);this.process()},on:function(a,b,c){return z.on(a+"-"+this.id,b,c)},un:function(a,b,c){return z.un(a+"-"+this.id,b,c)},createChild:function(a){return new k(a,this.scope,this)},reset:function(){},getEl:function(){return this.el},runHandler:function(a,b,c,d){var e;if(a.$breakRenderer)return this.createChild(c).render(),!1;a.$isolateScope?e=new p:a.$breakScope?b instanceof p?e=b.$new():(e={},e.$parent=b,e.$root=b.$root):e=b;return a.__isMetaphorClass?(b=new a(e,c,d,this),a.$stopRenderer||b.$stopRenderer?
!1:b.$returnToRenderer):a(e,c,d,this)},processNode:function(a,b){var c=a.nodeType,d=this.texts,e=this.scope,h;if(3==c)e={watchers:[],node:a,text:"",inx:h=d.length},this.processText(e,a[s]),0<e.watchers.length&&(d.push(e),b&&this.renderText(h));else if(1==c){g||(g=f());var k=a.attributes,n,p,q,r,c="tag."+a.tagName.toLowerCase();if(n=l(c,!0))if((r=this.runHandler(n,e,a))||!1===r)return r;n=0;for(p=g.length;n<p;n++)if(q=g[n].name,null!==(h=a.getAttribute(q))&&"undefined"!=typeof h&&(r=this.runHandler(g[n].handler,
e,a,h),a.removeAttribute(q),r||!1===r))return r;n=0;for(p=k.length;n<p;n++)l(c,!0)||(e={watchers:[],node:a,attr:k[n].name,text:"",inx:h=d.length},this.processText(e,k[n].value),0<e.watchers.length&&(d.push(e),b&&this.renderText(h)))}return!0},process:function(){t(this.el,this.processNode,this)},processText:function(a,b){for(var c=0,d=b.length,e,f,g=[];c<d;)if(-1!=(e=b.indexOf("{{",c))&&-1!=(f=b.indexOf("}}",e+2)))g.push(b.substring(c,e)),g.push(this.watcherMatch(a,b.substring(e+2,f))),c=f+2;else{c!==
d&&g.push(b.substring(c));break}return a.text=g.join("")},processPipes:function(b,c){for(var d=0,e=b.length,f,g,l,h=!1,k=b;d<e;)if(-1!=(f=b.indexOf("|",d)))g=b.charAt(f-1),l=b.charAt(f+1),"|"!=g&&"'"!=g&&'"'!=g&&"|"!=l&&"'"!=l&&'"'!=l&&(h?(d=a(b.substring(d,f)).split(":"),c.push([d[0],d.slice(1)])):(h=!0,k=a(b.substring(0,f)))),d=f+1;else{h&&(d=a(b.substr(d)).split(":"),c.push([d[0],d.slice(1)]));break}return k},watcherMatch:function(a,b){var d=a.watchers;d.push({watcher:c(this.scope,b,this.onDataChange,
this,a.inx)});return"---"+(d.length-1)+"---"},onDataChange:function(a,b,c){this.renderText(c)},render:function(){var a=this.texts.length,b;for(b=0;b<a;b++)this.renderText(b)},renderText:function(a){a=this.texts[a];var b=a.text,c=a.watchers,d=c.length,e=a.attr,f,g;for(f=0;f<d;f++)g=c[f].watcher.getLastResult(),b=b.replace("---"+f+"---",g);e?(a.node.setAttribute(e,b),"value"==e&&(a.node.value=b),"class"==e&&(a.node.className=b)):a.node[s]=b},destroy:function(){var a=this.texts,c,d,e,f,g;if(!this.destroyed){this.destroyed=
!0;d=0;for(e=a.length;d<e;d++)for(c=a[d].watchers,f=0,g=c.length;f<g;f++)b(this.scope,c[f].watcher.code,this.onDataChange,this);this.parent&&this.parent.un("destroy",this.destroy,this);z.trigger("destroy-"+this.id);this.parent=this.scope=this.el=this.texts=null}}},{eachNode:t});MetaphorJs.onReady(function(){var a=MetaphorJs.app;if(document.querySelectorAll)for(var b=document.querySelectorAll("[mjs-app]"),c=-1,d=b.length;++c<d;a(b[c]));else t(document.documentElement,function(b){if(b.hasAttribute("mjs-app"))return a(b),
!1})})})();
(function(){var n=window.MetaphorJs,p=n.data,q=n.toFragment,h=n.lib.Watchable,e=h.create,d=h.isExpression,f=h.eval,g=n.getTemplate,l=n.view.Renderer,a=n.clone,c=n.view.Scope,b=n.animate,k=n.lib.Promise,s=n.apply;n.define("MetaphorJs.view.Template",{_watcher:null,_tpl:null,_renderer:null,_initial:!0,_fragment:null,scope:null,node:null,tpl:null,ownRenderer:!1,initPromise:null,parentRenderer:null,deferRendering:!1,replace:!1,initialize:function(a){s(this,a,!0);a=this.node;a.removeAttribute("mjs-include");if(this.tpl){if(a.firstChild&&
p(a,"mjs-transclude",q(a.childNodes)),d(this.tpl)&&!this.replace&&(this.ownRenderer=!0,this._watcher=e(this.scope,this.tpl,this.onChange,this)),this.replace&&(this.ownRenderer=!1),this.initPromise=this.resolveTemplate(),this.deferRendering&&this.ownRenderer||this.initPromise.done(this.applyTemplate,this),this.ownRenderer&&this.parentRenderer)this.parentRenderer.on("destroy",this.onParentRendererDestroy,this)}else!this.deferRendering&&this.ownRenderer&&this.doRender();this.scope instanceof c&&this.scope.$on("destroy",
this.onScopeDestroy,this)},doRender:function(){this._renderer||(this._renderer=new l(this.node,this.scope),this._renderer.render())},startRendering:function(){var a=this.tpl;this.deferRendering&&(this.deferRendering=!1,this.initPromise?this.initPromise.done(a?this.applyTemplate:this.doRender,this):a?this.applyTemplate():this.doRender())},resolveTemplate:function(){var a=this,b=a._watcher?a._watcher.getLastResult():f(a.tpl,a.scope),c=new k;(new k(function(a,c){a(g(b))})).done(function(b){a._fragment=
b;c.resolve(!a.ownRenderer)}).fail(c.reject,c);return c},onChange:function(){this._renderer&&(this._renderer.destroy(),this._renderer=null);this.resolveTemplate().done(this.applyTemplate,this)},doApplyTemplate:function(){for(var b=this.node;b.firstChild;)b.removeChild(b.firstChild);this.replace?b.parentNode.replaceChild(a(this._fragment),b):b.appendChild(a(this._fragment));this.ownRenderer&&this.doRender()},applyTemplate:function(){var a=this.node,c=new k;this._initial?(this.doApplyTemplate(),c.resolve()):
(b(a,"leave").done(this.doApplyTemplate,this).done(c.resolve,c),b(a,"enter"));this._initial=!1;return c},onParentRendererDestroy:function(){this._renderer.destroy();this.destroy();delete this._renderer},onScopeDestroy:function(){this.destroy();delete this._renderer},destroy:function(){delete this.node;delete this.scope;delete this.initPromise;this._watcher&&(this._watcher.unsubscribeAndDestroy(this.onChange,this),delete this._watcher);delete this.tpl}})})();
(function(){var n={},p=MetaphorJs.nextUid,q=MetaphorJs.emptyFn,h=MetaphorJs.ns.get,e=MetaphorJs.lib.Promise,d=MetaphorJs.view.Template,f=MetaphorJs.trim,g=MetaphorJs.lib.Watchable.toExpression;MetaphorJs.define("MetaphorJs.cmp.Component","MetaphorJs.cmp.Base",{id:null,originalId:!1,node:null,renderTo:null,autoRender:!0,rendered:!1,hidden:!1,destroyEl:!0,scope:null,template:null,tag:null,initialize:function(e){this.supr(e);e.as&&(this.scope[e.as]=this);this.node&&(this.id=this.node.getAttribute("id"))&&
(this.originalId=!0);this.id=this.id||"cmp-"+p();n[this.id]=this;this.initComponent.apply(this,arguments);this.node||this._createNode();var a=this.template;a&&a instanceof d||(this.template=a=new d({scope:this.scope,node:this.node,deferRendering:!0,ownRenderer:!0,tpl:g(f(a))}));if(this.parentRenderer)this.parentRenderer.on("destroy",this.onParentRendererDestroy,this);this._initElement();this.autoRender&&(a.initPromise?a.initPromise.done(this.render,this):this.render())},_createNode:function(){this.node=
document.createElement(this.tag||"div")},_initElement:function(){var d=this.node;d.setAttribute("id",this.id);d.setAttribute("cmp-id",this.id);this.hidden&&(d.style.display="none")},render:function(){this.rendered||(this.renderTo&&this.renderTo.appendChild(this.node),this.hidden=!MetaphorJs.isVisible(this.node),this.rendered=!0,this.template.startRendering(),this.trigger("render",this),this.afterRender(),this.trigger("afterrender",this))},show:function(){this.hidden&&!1!==this.trigger("beforeshow",
this)&&(this.node.style.display="block",this.hidden=!1,this.onShow(),this.trigger("show",this))},hide:function(){this.hidden||!1===this.trigger("beforehide",this)||(this.node.style.display="none",this.hidden=!0,this.onHide(),this.trigger("hide",this))},isHidden:function(){return this.hidden},isRendered:function(){return this.rendered},isDestroyed:function(){return this.destroyed},getEl:function(){return this.node},initComponent:q,afterRender:q,onShow:q,onHide:q,onParentRendererDestroy:function(){this.destroy()},
onDestroy:function(){this.template&&(this.template.destroy(),delete this.template);this.destroyEl?this.node.parentNode&&this.node.parentNode.removeChild(this.node):(this.node.removeAttribute("cmp-id"),this.originalId||this.node.removeAttribute("id"));this.scope.$destroy();delete this.scope;delete this.node;this.supr();delete n[this.id]}});MetaphorJs.getCmp=function(d){return n[d]||null};MetaphorJs.resolveComponent=function(l,a,c,b,k,n){var p="string"==typeof l?h(l):l,q,t=[];l=p.template||a.template;
n=n||[];if(p.resolve)for(q in p.resolve)(function(d){var f=new e;t.push(f.done(function(b){a[d]=b}));f.resolve(p.resolve[q](c,b))})(q);l&&(a.template=new d({scope:c,node:b,deferRendering:!0,ownRenderer:!0,tpl:g(f(l))}),t.push(a.template.initPromise));var z=t.length;z&&(b.style.visibility="hidden");n.unshift(a);return e.all(t).then(function(){z&&(b.style.visibility="visible");return p.__instantiate.apply(null,n)})}})();
(function(){var n=MetaphorJs.data,p=MetaphorJs.currentUrl,q=MetaphorJs.toFragment,h=MetaphorJs.animate,e=MetaphorJs.lib.Scope,d=MetaphorJs.apply,f=MetaphorJs.stopAnimation,g=MetaphorJs.resolveComponent;MetaphorJs.define("MetaphorJs.cmp.View",{route:null,node:null,scope:null,currentComponent:null,initialize:function(e){history.initPushState();d(this,e,!0);MetaphorJs.on("locationchange",this.onLocationChange,this);e=this.node;e.firstChild&&n(e,"mjs-transclude",q(e.childNodes));e.removeAttribute("mjs-view");
this.onLocationChange()},onLocationChange:function(){var d=p(),a=this.route,c,b,e,f,g;b=0;for(e=a.length;b<e;b++){f=a[b];if(g=d.match(f.reg)){this.changeComponent(f,g);return}f["default"]&&!c&&(c=f)}c?this.changeComponent(c,[]):this.clearComponent()},changeComponent:function(d,a){f(this.node);this.clearComponent();this.setComponent(d,a)},clearComponent:function(){var d=this,a=d.node;d.currentComponent&&h(a,"leave").done(function(){d.currentComponent.destroy();for(d.currentComponent=null;a.firstChild;)a.removeChild(a.firstChild)})},
setComponent:function(d,a){var c=this,b=c.node;h(b,"enter",function(){var f=a||[],h={destroyEl:!1,node:b,scope:d.isolateScope?new e:c.scope.$new()};d.as&&(h.as=d.as);d.template&&(h.template=d.template);f.shift();return g(d.cmp||"MetaphorJs.cmp.Component",h,h.scope,b,null,f).done(function(a){c.currentComponent=a})})}})})();
(function(){var n=MetaphorJs.view.Scope,p=MetaphorJs.trim,q=MetaphorJs.bind,h=MetaphorJs.define,e=MetaphorJs.ns.get,d=MetaphorJs.lib.Watchable,f=MetaphorJs.view.Renderer,g=MetaphorJs.data,l=MetaphorJs.toArray,a=MetaphorJs.toFragment,c=MetaphorJs.addListener,b=MetaphorJs.removeListener,k=MetaphorJs.normalizeEvent,s=MetaphorJs.registerAttributeHandler,r=MetaphorJs.registerTagHandler,x=MetaphorJs.async,t=d.create,z=d.createGetter,u=MetaphorJs.animate,C=MetaphorJs.addClass,B=MetaphorJs.removeClass,y=
MetaphorJs.hasClass,D=MetaphorJs.stopAnimation,I=MetaphorJs.isArray,E=MetaphorJs.view.Template,G,F=function(a,b){for(var c;a;){c=g(a,b);if(void 0!=c)return c;a=a.parentNode}};MetaphorJs.d("MetaphorJs.view.AttributeHandler",{watcher:null,scope:null,node:null,expr:null,initialize:function(a,b,c){c=p(c);this.node=b;this.expr=c;this.scope=a;this.watcher=t(a,c);this.watcher.addListener(this.onChange,this);this.onChange();a instanceof n&&a.$on("destroy",this.onScopeDestroy,this)},onScopeDestroy:function(){delete this.node;
delete this.scope;this.watcher&&(this.watcher.unsubscribeAndDestroy(this.onChange,this),delete this.watcher)},onChange:function(){}});s("mjs-bind",1E3,h(null,"MetaphorJs.view.AttributeHandler",{isInput:!1,initialize:function(a,b,c){var d=b.tagName.toLowerCase();this.isInput="input"==d||"textarea"==d;this.supr(a,b,c)},onChange:function(){var a=this.watcher.getLastResult();this.isInput?this.node.value=a:this.node.textContent=a}}));s("mjs-bind-html",1E3,h(null,"MetaphorJs.view.AttributeHandler",{onChange:function(){this.node.innerHTML=
this.watcher.getLastResult()}}));s("mjs-model",1E3,h(null,"MetaphorJs.view.AttributeHandler",{inProg:!1,type:null,inputType:null,radio:null,listeners:null,initialize:function(a,b,c){var d;this.node=b;this.inputType=d=b.getAttribute("mjs-input-type")||b.type.toLowerCase();this.listeners=[];this.onRadioInputChangeDelegate=q(this.onRadioInputChange,this);this.onCheckboxInputChangeDelegate=q(this.onCheckboxInputChange,this);"radio"==d?this.initRadioInput():"checkbox"==d?this.initCheckboxInput():this.initTextInput();
this.supr(a,b,c)},onScopeDestroy:function(){var a=this.type,c=this.listeners,d=this.radio,e,f,g,h;e=0;for(f=c.length;e<f;e++)if("radio"==a)for(g=0,h=d.length;g<h;g++)b(d[g],c[e][0],c[e][1]);else b(this.node,c[e][0],c[e][1]);delete this.radio;this.supr()},initRadioInput:function(){var a,b,d;this.radio=a=l(document.querySelectorAll("input[name="+this.node.name+"]"));this.listeners.push(["click",this.onRadioInputChangeDelegate]);b=0;for(d=a.length;b<d;b++)c(a[b],"click",this.onRadioInputChangeDelegate)},
initCheckboxInput:function(){this.listeners.push(["click",this.onCheckboxInputChangeDelegate]);c(this.node,"click",this.onCheckboxInputChangeDelegate)},initTextInput:function(){var a=MetaphorJs.browser,b=!1,d=this,e=d.node,f=d.listeners,g;if(!a.android){var h=function(){b=!0},k=function(){b=!1;l()};f.push(["compositionstart",h]);f.push(["compositionend",k]);c(e,"compositionstart",h);c(e,"compositionend",k)}var l=d.onTextInputChangeDelegate=function(){if(!b)d.onTextInputChange()};if(a.hasEvent("input"))f.push(["input",
l]),c(e,"input",l);else{var n=function(a){g||(g=window.setTimeout(function(){l(a);g=null},0))},h=function(a){a=a||window.event;var b=a.keyCode;91===b||15<b&&19>b||37<=b&&40>=b||n(a)};f.push(["keydown",h]);c(e,"keydown",h);a.hasEvent("paste")&&(f.push(["paste",n]),f.push(["cut",n]),c(e,"paste",n),c(e,"cut",n))}f.push(["change",l]);c(e,"change",l)},onTextInputChange:function(){var a=this.node.value,b=this.scope;switch(this.inputType){case "number":a=parseInt(a,10)}this.watcher.setValue(a);this.inProg=
!0;b instanceof n?b.$root.$check():this.watcher.checkAll();this.inProg=!1},onCheckboxInputChange:function(){var a=this.node,b=this.scope;this.watcher.setValue(a.checked?a.getAttribute("value")||!0:!1);this.inProg=!0;b instanceof n?b.$root.$check():this.watcher.checkAll();this.inProg=!1},onRadioInputChange:function(a){a=a||window.event;a=k(a);var b=this.scope;this.watcher.setValue(a.target.value);this.inProg=!0;b instanceof n?b.$root.$check():this.watcher.checkAll();this.inProg=!1},onChange:function(){var a=
this.watcher.getLastResult(),b=this.inputType,c,d;if(!this.inProg)if("radio"==b)for(d=this.radio,b=0,c=d.length;b<c;b++){if(d[b].value==a){d[b].checked=!0;break}}else"checkbox"==b?(b=this.node,b.checked=!0===a||a==b.value):MetaphorJs.setValue(this.node,a)}}));s("mjs-show",500,h(null,"MetaphorJs.view.AttributeHandler",{initial:!0,initialize:function(a,b,c){this.supr(a,b,c)},runAnimation:function(a){var b=this.node.style,c=function(){b.display=a?"":"none"};this.initial?c():u(this.node,a?"show":"hide",
function(){a&&(b.display="")}).done(c)},onChange:function(){var a=this.watcher.getLastResult();this.runAnimation(a);this.initial=!1}}));s("mjs-hide",500,h(null,"attr.mjs-show",{onChange:function(){var a=this.watcher.getLastResult();this.runAnimation(!a);this.initial=!1}}));s("mjs-if",500,h(null,"MetaphorJs.view.AttributeHandler",{parentEl:null,prevEl:null,el:null,initial:!0,initialize:function(a,b,c){this.parentEl=b.parentNode;this.prevEl=b.previousSibling;this.supr(a,b,c)},onScopeDestroy:function(){delete this.prevEl;
delete this.parentEl;this.supr()},onChange:function(){var a=this,b=a.watcher.getLastResult(),c=a.parentEl,d=a.node,e=function(){a.prevEl?c.insertBefore(d,a.prevEl?a.prevEl.nextSibling:null):c.appendChild(d)},f=function(){c.removeChild(d)};b?d.parentNode||(a.initial?e():u(d,"enter",e)):d.parentNode&&(a.initial?f():u(d,"leave").done(f));a.initial=!1}}));s("mjs-each",100,h(null,"MetaphorJs.view.AttributeHandler",{model:null,itemName:null,tpl:null,renderers:null,parentEl:null,prevEl:null,nextEl:null,
initialize:function(a,b,c){this.parseExpr(c);b.removeAttribute("mjs-each");b.removeAttribute("mjs-include");this.tpl=b;this.renderers=[];this.prevEl=b.previousSibling;this.nextEl=b.nextSibling;this.parentEl=b.parentNode;this.node=b;this.scope=a;this.watcher=t(a,this.model);this.watcher.addListener(this.onChange,this);this.parentEl.removeChild(b);this.render(this.watcher.getValue())},onScopeDestroy:function(){var a=this.renderers,b,c;b=0;for(c=a.length;b<c;b++)a[b].renderer.destroy();delete this.renderers;
delete this.tpl;delete this.prevEl;delete this.nextEl;delete this.parentEl;this.supr()},doUpdate:function(a,b){for(var c=this.renderers,d=b,e=c.length,g=e-1,h=!(d%2),k,l;d<e;d++)k=c[d],l=k.scope,l.$index=d,l.$first=0===d,l.$last=d===g,l.$even=h,l.$odd=!h,h=!h,k.renderer?l.$check():(k.renderer=new f(k.el,k.scope),k.renderer.render())},render:function(a){var b=this.renderers,c=this.tpl,d=this.parentEl,e=this.nextEl,f=document.createDocumentFragment(),g,h,k;h=0;for(k=a.length;h<k;h++)g=c.cloneNode(!0),
f.appendChild(g),b.push(this.createItem(g,a,h));d.insertBefore(f,e);this.doUpdate(a,0)},createItem:function(a,b,c){var d=this.itemName,e=this.scope,e=e instanceof n?e.$new():{$parent:e,$root:e.$root};e[d]=b[c];return{el:a,scope:e}},onChange:function(a){var b=this,c=b.renderers;a=a.prescription;var d=b.tpl,e=0,f=b.parentEl,g=b.watcher.getValue(),h=null,k,l,p,q;l=0;for(p=a.length;l<p;l++)q=a[l],"-"==q?(c[e].scope.$index=e,e++):(null===h&&(h=0<l?l-1:0),"I"!=q&&c[e]&&(k=c[e],k.scope instanceof n&&k.scope.$destroy(),
k.renderer.destroy(),u(k.el,"leave").done(function(a){a.parentNode&&a.parentNode.removeChild(a)})),"D"==q?c.splice(e,1):(k=d.cloneNode(!0),u(k,"enter",function(a){return function(d){0<a?f.insertBefore(d,c[a-1].el.nextSibling):b.prevEl?f.insertBefore(d,b.prevEl.nextSibling):f.appendChild(d)}}(e)),"R"==q?c[l]=b.createItem(k,g,e):"I"==q&&(l<c.length?c.splice(l,0,b.createItem(k,g,e)):c.push(b.createItem(k,g,e))),e++));b.doUpdate(g,h)},parseExpr:function(a){a=a.split(" ");var b,c,d,e,f;b=0;for(c=a.length;b<
c;b++)if(f=a[b],""!=f&&"in"!=f)if(e){d=a.slice(b).join(" ");break}else e=f;this.model=d;this.itemName=e||"item"}},{$stopRenderer:!0}));s("mjs-each-in-store",100,h(null,"attr.mjs-each",{store:null,initialize:function(a,b,c){this.parseExpr(c);b.removeAttribute("mjs-each-in-store");b.removeAttribute("mjs-include");this.tpl=b;this.renderers=[];this.prevEl=b.previousSibling;this.nextEl=b.nextSibling;this.parentEl=b.parentNode;this.node=b;this.scope=a;this.store=a=z(this.model)(a);this.parentEl.removeChild(b);
this.initWatcher();this.render(this.watcher.getValue());x(this.bindStore,this,[a,"on"])},onScopeDestroy:function(){this.bindStore(this.store,"un");delete this.store;this.supr()},initWatcher:function(){this.watcher=t(this.store,".items",null);this.watcher.addListener(this.onChange,this)},resetWatcher:function(){this.watcher.setValue(this.store.items)},bindStore:function(a,b){a[b]("load",this.onStoreUpdate,this);a[b]("update",this.onStoreUpdate,this);a[b]("add",this.onStoreUpdate,this);a[b]("remove",
this.onStoreUpdate,this);a[b]("replace",this.onStoreUpdate,this);a[b]("filter",this.onStoreFilter,this);a[b]("clearfilter",this.onStoreFilter,this);a[b]("clear",this.onStoreClear,this);a[b]("destroy",this.onStoreDestroy,this)},onStoreUpdate:function(){this.watcher.check()},onStoreFilter:function(){this.resetWatcher();this.onStoreUpdate()},onStoreClear:function(){this.resetWatcher();this.onStoreUpdate()},onStoreDestroy:function(){this.onStoreClear();this.watcher.unsubscribeAndDestroy(this.onChange,
this);delete this.watcher}},{$stopRenderer:!0}));s("mjs-include",900,function(a,b,c,d){a=new E({scope:a,node:b,tpl:c,parentRenderer:d});return a.ownRenderer?!1:a.initPromise});r("mjs-include",900,function(a,b,c,d){return(new E({scope:a,node:b,tpl:b.getAttribute("src"),parentRenderer:d,replace:!0})).initPromise});s("mjs-transclude",1E3,function(b,c){var d=F(c,"mjs-transclude");if(d){c.firstChild&&g(c,"mjs-transclude",a(c.childNodes));var e=c.parentNode,f=c.nextSibling,d=MetaphorJs.clone(d),h=l(d.childNodes);
e.removeChild(c);e.insertBefore(d,f);return h}});r("mjs-transclude",900,function(b,c){var d=F(c,"mjs-transclude");if(d){c.firstChild&&g(c,"mjs-transclude",a(c.childNodes));var e=c.parentNode,f=c.nextSibling,d=MetaphorJs.clone(d),h=l(d.childNodes);e.removeChild(c);e.insertBefore(d,f);return h}});var J=function(a,b,c,d){if(null!==c){if(c==y(a,b))return;c=!c}else c=y(a,b);c?d?u(a,[b+"-remove"]).done(function(){B(a,b)}):B(a,b):d?u(a,[b+"-add"]).done(function(){C(a,b)}):C(a,b)};s("mjs-class",1E3,h(null,
"MetaphorJs.view.AttributeHandler",{initial:!0,onChange:function(){var a=this.node,b=this.watcher.getLastResult(),c;D(a);if("string"==typeof b)J(a,b,null,!this.initial);else if(I(b)){var d;c=-1;for(d=b.length;++c<d;J(a,b[c],!0,!this.initial));}else for(c in b)J(a,c,b[c]?!0:!1,!this.initial);this.initial=!1}}));var r="click dblclick mousedown mouseup mouseover mouseout mousemove mouseenter mouseleave keydown keyup keypress submit focus blur copy cut paste enter".split(" "),A,w=d.createFunc,d=0;for(A=
r.length;d<A;d++)(function(a){var b=a;"enter"==b&&(b="keyup");s("mjs-"+a,1E3,function(d,e,f){var g=w(f);c(e,b,function(b){b=b||window.event;b=k(b);if("enter"==a&&13!=b.keyCode)return null;d.$event=b;try{g(d)}catch(c){MetaphorJs.asyncError(c)}delete d.$event;d instanceof n?d.$root.$check():d.$$watchers&&d.$$watchers.$checkAll();b.preventDefault();return!1})})})(r[d]);r="selected checked disabled readonly required open".split(" ");d=0;for(A=r.length;d<A;d++)(function(a){s("mjs-"+a,1E3,h(null,"MetaphorJs.view.AttributeHandler",
{onChange:function(){this.watcher.getLastResult()?this.node.setAttribute(a,!0):this.node.removeAttribute(a)}}))})(r[d]);r=function(a,b,c,d){G||(G=MetaphorJs.resolveComponent);var e,f,g,h,k;b.removeAttribute("mjs-cmp");c=c.split(" ");g=0;for(h=c.length;g<h;g++)k=c[g],""!=k&&"as"!=k&&(e?f=k:e=k);G(e,{scope:a,node:b,as:f,parentRenderer:d},a,b,d);return!1};r.$breakScope=!0;s("mjs-cmp",200,r);var H=MetaphorJs.getCmp;s("mjs-cmp-prop",200,function(a,b,c){a=b.parentNode;for(var d;a;){if(d=a.getAttribute("cmp-id")){(a=
H(d))&&(a[c]=b);break}a=a.parentNode}});s("mjs-view",200,function(a,b,c){b.removeAttribute("mjs-view");var d=e(c);if(d)new d({scope:a,node:b});else throw"View '"+c+"' not found";return!1});s("mjs-init",150,function(a,b,c){b.removeAttribute("mjs-init");w(c)(a)})})();
(function(){var n=MetaphorJs.add,p=MetaphorJs.numberFormats,q=MetaphorJs.dateFormats;n("filter.toUpper",function(d){return d.toUpperCase()});n("filter.toLower",function(d){return d.toLowerCase()});n("filter.limitTo",function(d,e){var h=typeof d;if(!MetaphorJs.isArray(d)&&"string"!=h)return d;e=Infinity===Math.abs(Number(e))?Number(e):parseInt(e,10);if("string"==h)return e?0<=e?d.slice(0,e):d.slice(e,d.length):"";var h=[],a,c;e>d.length?e=d.length:e<-d.length&&(e=-d.length);0<e?(a=0,c=e):(a=d.length+
e,c=d.length);for(;a<c;a++)h.push(d[a]);return h});n("filter.ucfirst",function(d){return d.substr(0,1).toUpperCase()+d.substr(1)});var h=MetaphorJs.numberFormats;n("filter.numeral",function(d,e){e=h[e]||e;e=p[e]||e;return numeral(d).format(e)});var e=MetaphorJs.dateFormats;n("filter.moment",function(d,g){g=e[g]||g;g=q[g]||g;return moment(d).format(g)});var d=MetaphorJs.filterArray;n("filter.filter",function(e,g,h,a){h&&!a&&(h=null);return d(e,g,h)});n("filter.sortBy",function(d,e,h,a){h&&!a&&(h="asc");
d=d.slice();d.sort(function(a,b){var d=typeof a;return d!=typeof b?0:"object"==d?a[e]>b[e]?1:a[e]<b[e]?-1:0:a>b?1:a<b?-1:0});return"desc"==h?d.reverse():d})})();
