(function(){var m={}.undefined;"undefined"==typeof window&&(global.window=global);window.document&&!document.querySelectorAll&&(document.querySelectorAll=function(c){var a=document,b=a.documentElement.firstChild,l=a.createElement("STYLE");b.appendChild(l);a.__qsaels=[];l.sheet?l.sheet.insertRule(c+"{x:expression(document.__qsaels.push(this))}",0):l.styleSheet&&(l.styleSheet.cssText=c+"{x:expression(document.__qsaels.push(this))}");window.scrollBy(0,0);return a.__qsaels});var n=Function.prototype.bind?
function(c,a){return c.bind(a)}:function(c,a){return function(){c.apply(a,arguments)}},p={},e=Array.prototype.slice,d=function(){var c=!1,a=e.call(arguments),b=a.shift(),l,s;for("boolean"==typeof a[a.length-1]&&(c=a.pop());l=a.shift();)for(s in l)if(l.hasOwnProperty(s))if(b[s]&&"object"==typeof b[s]&&"object"==typeof l[s])d(b[s],l[s],c);else if(!0===c||b[s]===m||null===b[s])b[s]=l[s];return b},f=["0","0","0"],g=function(){for(var c=f.length,a;c;){c--;a=f[c].charCodeAt(0);if(57==a)return f[c]="A",
f.join("");if(90==a)f[c]="0";else return f[c]=String.fromCharCode(a+1),f.join("")}f.unshift("0");return f.join("")},h={},k=function(c){var a=document.createDocumentFragment();if(c.nodeType)a.appendChild(c);else for(var b=-1,l=c.length>>>0;++b!==l;a.appendChild(c[0]));return a},a=function(c){return c._mjsId||(c._mjsId=g())},b=[],c=[],l=!1,s=!1,r=function(c,a){return c.priority<a.priority?-1:c.priority>a.priority?1:0},n={VERSION:"0.2",registerAttributeHandler:function(c,a,s){b.push({priority:a,name:c,
handler:MetaphorJs.add("attr."+c,s)});l=!1},registerTagHandler:function(a,b,l){c.push({priority:b,name:a,handler:MetaphorJs.add("tag."+a,l)});s=!1},getAttributeHandlers:function(){l||(b.sort(r),l=!0);return b},getTagHandlers:function(){s||(c.sort(r),s=!0);return c},apply:d,nextUid:g,getTemplate:function(c){if(!h[c]){var a=document.getElementById(c);if(!a)return null;if("script"==a.tagName.toLowerCase()){var b=document.createElement("div");b.innerHTML=a.innerHTML;h[c]=k(b.childNodes)}else h[c]="content"in
a?a.content:k(a.childNodes)}return h[c]},numberFormats:{},dateFormats:{},getNodeId:a,data:function(c,b,l){c=a(c);var s=p[c];return"undefined"!=typeof l?(s||(s=p[c]={}),s[b]=l):s?s[b]:m},emptyFn:function(){},trim:function(){return String.prototype.trim?function(c){return"string"==typeof c?c.trim():c}:function(c){return"string"==typeof c?c.replace(/^\s\s*/,"").replace(/\s\s*$/,""):c}}(),bind:n,inArray:function(c,a){return a?Array.prototype.indexOf.call(a,c):-1},isArray:function(c){return c&&"object"==
typeof c&&"number"==typeof c.length&&"[object Array]"==Object.prototype.toString.call(c)||!1},isPlainObject:function(c){var a=Object.prototype.hasOwnProperty;if("[object Object]"!==Object.prototype.toString.call(c)||c.nodeType)return!1;try{if(c.constructor&&!a.call(c.constructor.prototype,"isPrototypeOf"))return!1}catch(b){return!1}return!0},clone:function(c){var a,b,l;if(MetaphorJs.isArray(c)){l=[];a=0;for(b=c.length;a<b;a++)l.push(MetaphorJs.clone(c[a]));return l}switch(c.nodeType){case 1:return c.cloneNode(!0);
case 3:return document.createTextNode(c.innerText||c.textContent);case 11:return c.cloneNode(!0);default:return null}},addListener:function(c,a,b){c.attachEvent?c.attachEvent("on"+a,b):c.addEventListener(a,b,!1)},removeListener:function(c,a,b){c.detachEvent?c.detachEvent("on"+a,b):c.removeEventListener(a,b,!1)},addClass:function(c,a){(new RegExp("(?:^|\\s)"+a+"(?!\\S)","g")).test(c.className)||(c.className+=" "+a)},removeClass:function(c,a){c.className=c.className.replace(new RegExp("(?:^|\\s)"+a+
"(?!\\S)","g"),"")},isVisible:function(c){return!(0>=c.offsetWidth||0>=c.offsetHeight)},isThenable:function(c){var a;return c&&"function"==typeof(a=c.then)?a:!1},async:function(c,a,b){setTimeout(function(){c.apply(a,b||[])},0)},onReady:function(c){var a=!1,b=!0,l=MetaphorJs.addListener,s=MetaphorJs.removeListener,w=window,d=w.document,f=d.documentElement,r=function(b){if("readystatechange"!=b.type||"complete"==d.readyState)s("load"==b.type?w:d,b.type,r),!a&&(a=!0)&&c.call(w,b.type||b)},x=function(){try{f.doScroll("left")}catch(c){setTimeout(x,
50);return}r("poll")};if("complete"==d.readyState)c.call(w,"lazy");else{if(d.createEventObject&&f.doScroll){try{b=!w.frameElement}catch(q){}b&&x()}l(d,"DOMContentLoaded",r);l(d,"readystatechange",r);l(w,"load",r)}},toFragment:k,toArray:function(c){for(var a=[],b=-1,l=c.length>>>0;++b!==l;a[b]=c[b]);return a},app:function(c,a){var b=MetaphorJs.view.Scope;a?a instanceof b||(a=new b(a)):a=new b;b=new MetaphorJs.view.Renderer(c,a);b.render();return b}};window.MetaphorJs?d(window.MetaphorJs,n,!0):window.MetaphorJs=
n})();
(function(){var m="undefined"!=typeof window?window:global,n={},p=function(d,g){if(n[d]||g)return n[d];var e=d.split("."),k,a=e.length,b,c=m;for(k=0;k<a;k++){b=e[k];if(!c[b])return null;c=c[b]}return c},e=function(d,g){var e;e=d.split(".");var k,a=e.pop();k=e.join(".");var b=e.length,c,l=m;if(n[k])e=[n[k],a];else{for(k=0;k<b;k++)c=e[k],l[c]||(l[c]={}),l=l[c];e=[l,a]}e[0][e[1]]=g;return n[d]=g},d=function(d,g){return n[d]=g};e("MetaphorJs.ns",{register:e,exists:function(d){return n[d]?!0:!1},get:p,
add:d,remove:function(d){delete n[d]}});MetaphorJs.r=e;MetaphorJs.g=p;MetaphorJs.add=d;"undefined"!=typeof module&&(module.exports=MetaphorJs.ns)})();
(function(){var m;if("undefined"!=typeof global)try{m=require("metaphorjs-namespace")}catch(n){m=global.MetaphorJs.ns}else m=window.MetaphorJs.ns;var p={}.undefined,e=Array.prototype.slice,d=function(c,a){return h(function(){},c,a)},f=function(c,a,b){return function(){var l=p,d=this.supr;this.supr=c.prototype[a]||function(){};try{l=b.apply(this,arguments)}catch(f){}this.supr=d;return l}},g=function(c,a,b){for(var l in a)a.hasOwnProperty(l)&&(c[l]="function"===typeof a[l]&&b.prototype&&"function"===
typeof b.prototype[l]?f(b,l,a[l]):a[l])},h=function(c,a,b){var l=function(){};l.prototype=c.prototype;l=new l;b=b||function(){this.initialize&&this.initialize.apply(this,arguments)};g(l,a,c);b.prototype=l;b.prototype.constructor=b;b.prototype.getClass=function(){return this.__proto__.constructor.__class};b.prototype.getParentClass=function(){return this.__proto__.constructor.__parentClass};b.__instantiate=function(c){return function(){var a=function(){},b;a.prototype=c.prototype;a=new a;b=c.prototype.constructor.apply(a,
arguments);return"object"==typeof b?b:a}}(b);return b},k=function(c,a,b,l,f,g){null===c&&(c="");"function"==typeof c?(f=b,"string"==typeof a?(f=l,l=b):(l=a,b=c,a=null),c=null):"string"!=typeof c&&(f=a,l=c,c=b=a=null);"string"!=typeof a&&"function"!=typeof a&&(f=l,l=b,b=a,a=null);"function"!=typeof b&&(f=l,l=b,b=null);l=l||{};var e=a&&"string"==typeof a?m.get(a):a;if(a&&!e)throw Error(a+" not found");a=e?h(e,l,b):d(l,b);a.__isMetaphorClass=!0;a.__parent=e;a.__parentClass=e?e.__class:null;a.__class=
c;if(f)for(var w in f)f.hasOwnProperty(w)&&(a[w]=f[w]);c&&(g?m.add(c,a):m.register(c,a));f&&f.alias&&m.add(f.alias,a);return a},a=function(c,a,b,l,d){return k(c,a,b,l,d,!0)},b=function(c){var a=m.get(c),b=e.call(arguments,1);if(!a)throw Error(c+" not found");return a.__instantiate.apply(this,b)},c=function(c,a){var b="string"==typeof a?m.get(a):a;return b?c instanceof b:!1},l=function(c,a){var b=c,l=m.get;"string"!=typeof a&&(a=a.getClass?a.getClass():a.prototype.constructor.__class);for("string"==
typeof c&&(b=l(c));b;){if(b.prototype.constructor.__class==a)return!0;b&&(b=b.getParentClass?l(b.getParentClass()):b.__parent)}return!1};"undefined"!=typeof global?module.exports={define:k,d:k,defineCache:a,dc:a,create:b,c:b,is:c,isSubclass:l}:(MetaphorJs.define=MetaphorJs.d=k,MetaphorJs.defineCache=MetaphorJs.dc=a,MetaphorJs.create=MetaphorJs.c=b,MetaphorJs.is=c,MetaphorJs.isSubclass=MetaphorJs.iss=l)})();
(function(){"undefined"==typeof window&&(global.window=global);if(window.Promise)m=window.Promise;else{var m;if("undefined"!=typeof global)try{m=require("metaphorjs-promise")}catch(n){global.Promise&&(m=global.Promise)}else window.MetaphorJs&&MetaphorJs.lib&&MetaphorJs.lib.Promise&&(m=MetaphorJs.lib.Promise)}var p=window.MetaphorJs&&MetaphorJs.nextUid?MetaphorJs.nextUid:function(){return Array(11).join((Math.random().toString(36)+"00000000000000000").slice(2,18)).slice(0,10)},e=function(c,a){for(var b in a)a.hasOwnProperty(b)&&
(c[b]=a[b])},d=Array.prototype.slice,f="undefined"!=typeof process?process.nextTick:function(c){window.setTimeout(c,0)},g=Function.prototype.bind?function(c,a){return c.bind(a)}:function(c,a){return function(){c.apply(a,arguments)}},h=function(){this.events={}};e(h.prototype,{createEvent:function(c,a){c=c.toLowerCase();var b=this.events;b[c]||(b[c]=new k(c,a));return b[c]},getEvent:function(c){c=c.toLowerCase();return this.events[c]},on:function(c,a,b,d){c=c.toLowerCase();var f=this.events;f[c]||
(f[c]=new k(c));return f[c].on(a,b,d)},once:function(c,a,b,d){d=d||{};d.limit=1;return this.on(c,a,b,d)},un:function(c,a,b){c=c.toLowerCase();var d=this.events;d[c]&&d[c].un(a,b)},hasListener:function(c,a,b){c=c.toLowerCase();var d=this.events;return d[c]?d[c].hasListener(a,b):!1},removeAllListeners:function(c){var a=this.events;a[c]&&a[c].removeAllListeners()},triggerAsync:function(){var c=arguments[0],a=this.events,c=c.toLowerCase();if(!a[c])return[];c=a[c];return c.triggerAsync.apply(c,d.call(arguments,
1))},trigger:function(){var c=arguments[0],a=this.events,c=c.toLowerCase();if(!a[c])return null;c=a[c];return c.trigger.apply(c,d.call(arguments,1))},suspendEvent:function(c){c=c.toLowerCase();var a=this.events;a[c]&&a[c].suspend()},suspendAllEvents:function(){var c=this.events,a;for(a in c)c[a].suspend()},resumeEvent:function(c){c=c.toLowerCase();var a=this.events;a[c]&&a[c].resume()},resumeAllEvents:function(){var c=this.events,a;for(a in c)c[a].resume()},destroyEvent:function(c){var a=this.events;
a[c]&&(a[c].removeAllListeners(),a[c].destroy(),delete a[c])},destroy:function(c){var a=this.events;if(c)c=c.toLowerCase(),a[c]&&(a[c].destroy(),delete a[c]);else{for(var b in a)a[b].destroy();this.events={}}},getApi:function(){if(!this.api){for(var c="createEvent getEvent on un once hasListener removeAllListeners triggerAsync trigger suspendEvent suspendAllEvents resumeEvent resumeAllEvents destroyEvent".split(" "),a={},b,d=-1,f=c.length;++d<f;b=c[d],a[b]=g(this[b],this));this.api=a}return this.api}});
var k=function(c,a){this.name=c;this.listeners=[];this.map={};this.hash=p();this.uni="$$"+c+"_"+this.hash;this.suspended=!1;this.lid=0;this.returnResult=a||!1};e(k.prototype,{getName:function(){return this.name},destroy:function(){this.map=this.listeners=null},on:function(c,a,b){if(!c)return null;a=a||null;b=b||{};var d=this.uni,f=a||c;if(f[d]&&!b.allowDupes)return null;var e=++this.lid,g=b.first||!1;f[d]=e;c={fn:c,scope:a,uniScope:f,id:e,called:0,limit:b.limit||0,start:b.start||1,count:0,append:b.append,
prepend:b.prepend};g?this.listeners.unshift(c):this.listeners.push(c);this.map[e]=c;return e},once:function(c,a,b){b=b||{};b.once=!0;return this.on(c,a,b)},un:function(c,a){var b=-1,d=this.uni,f=this.listeners,e;e=c==parseInt(c)?c:(a||c)[d];if(!e)return!1;for(var g=0,h=f.length;g<h;g++)if(f[g].id==e){b=g;delete f[g].uniScope[d];break}if(-1==b)return!1;f.splice(b,1);delete this.map[e];return!0},hasListener:function(c,a){var b=this.listeners,d;if(c){a=a||c;d=c==parseInt(c)?c:a[this.uni];if(!d)return!1;
for(var f=0,e=b.length;f<e;f++)if(b[f].id==d)return!0;return!1}return 0<b.length},removeAllListeners:function(){var c=this.listeners,a=this.uni,b,d;b=0;for(d=c.length;b<d;b++)delete c[b].uniScope[a];this.listeners=[];this.map={}},suspend:function(){this.suspended=!0},resume:function(){this.suspended=!1},_prepareArgs:function(c,a){var b;c.append||c.prepend?(b=d.call(a),c.prepend&&(b=c.prepend.concat(b)),c.append&&(b=b.concat(c.append))):b=a;return b},triggerAsync:function(){if("undefined"==typeof m)throw Error("Promises are not defined");
var c=this,a=c.listeners,b=c.returnResult,e=d.call(arguments),g=[],h=[],k,u,v;if(c.suspended||0==a.length)return m.resolve(null);u=0;for(v=a.length;u<v;u++)g.push(a[u]);for(u=function(a){k=c._prepareArgs(a,e);return new m(function(b,d){f(function(){try{b(a.fn.apply(a.scope,k))}catch(l){d(l)}a.called++;a.called==a.limit&&c.un(a.id)},0)})};(a=g.shift())&&(!a||!c.map[a.id]||(a.count++,a.count<a.start||(h.push(u(a)),"first"!=b))););return"last"==b?[h.pop()]:h},trigger:function(){var a=this.listeners,
b=this.returnResult;if(this.suspended||0==a.length)return null;var d="all"==b?[]:null,f=[],e,g;if("first"==b)f.push(a[0]);else for(e=0,g=a.length;e<g;e++)f.push(a[e]);for(;a=f.shift();)if(a&&this.map[a.id]&&(a.count++,!(a.count<a.start))){e=a.fn.apply(a.scope,this._prepareArgs(a,arguments));a.called++;a.called==a.limit&&this.un(a.id);"all"==b&&d.push(e);if("first"==b)return e;"last"==b&&(d=e);if(!1==b&&!1===e)break}if(b)return d}});var a=window.MetaphorJs;if(a&&a.VERSION){var b=new h;e(MetaphorJs,
b.getApi())}a&&a.r?a.r("MetaphorJs.lib.Observable",h):(window.MetaphorJs=window.MetaphorJs||{},MetaphorJs.lib=MetaphorJs.lib||{},MetaphorJs.lib.Observable=h);"undefined"!=typeof global&&(module.exports=h)})();
(function(){var m="undefined"!=typeof window?window.setTimeout:global.setTimeout,n=function(a){var b;return!a||"object"!=typeof a&&"function"!=typeof a||"function"!=typeof(b=a.then)?!1:b},p=Function.prototype.bind?function(a,b){return a.bind(b)}:function(a,b){return function(){a.apply(b,arguments)}},e=[],d=!1,f="undefined"!=typeof process?process.nextTick:function(a){m(a,0)},g=function(){d=!0;var a=e.shift();f(function(){a[0].apply(a[1],a[2]);e.length?g():d=!1},0)},h=function(a,b,f){f=f||[];e.push([a,
b,f]);d||g()},k=function(a,b){for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d])},a=function(a,b){return function(d){try{b.resolve(a(d))}catch(f){b.reject(f)}}},b=function(a,d){if(a instanceof b)return a;if(!(this instanceof b))return new b(a,d);this._fulfills=[];this._rejects=[];this._dones=[];this._fails=[];if(a)if(n(a))this.resolve(a);else if("function"==typeof a)try{a.call(d,p(this.resolve,this),p(this.reject,this))}catch(f){this.reject(f)}else throw"Cannot construct Promise with given value";};
k(b.prototype,{_state:0,_fulfills:null,_rejects:null,_dones:null,_fails:null,_value:null,_reason:null,_triggered:!1,isPending:function(){return 0==this._state},isFulfilled:function(){return 1==this._state},isRejected:function(){return 2==this._state},_cleanup:function(){delete this._fulfills;delete this._rejects;delete this._dones;delete this._fails},_processValue:function(a,d){var f;if(0==this._state)if(a===this)this._doReject(new TypeError("cannot resolve promise with itself"));else{try{if(f=n(a)){a instanceof
b?a.then(p(this._processResolveValue,this),p(this._processRejectReason,this)):(new b(f,a)).then(p(this._processResolveValue,this),p(this._processRejectReason,this));return}}catch(e){0==this._state&&this._doReject(e);return}d.call(this,a)}},_doResolve:function(a){this._value=a;this._state=1;a=this._fulfills;for(var b;b=a.shift();)h(b[0],b[1],[this._value]);this._done();this._cleanup()},_processResolveValue:function(a){this._processValue(a,this._doResolve)},resolve:function(a){this._triggered||(this._triggered=
!0,this._processResolveValue(a))},_doReject:function(a){this._state=2;this._reason=a;for(var b=this._rejects,d;d=b.shift();)h(d[0],d[1],[a]);this._fail();this._cleanup()},_processRejectReason:function(a){this._processValue(a,this._doReject)},reject:function(a){this._triggered||(this._triggered=!0,this._processRejectReason(a))},then:function(c,d){var f=new b,e=this._state;0==e?(c&&"function"==typeof c?this._fulfills.push([a(c,f),null]):this._fulfills.push([f.resolve,f]),d&&"function"==typeof d?this._rejects.push([a(d,
f),null]):this._rejects.push([f.reject,f])):1==e?c&&"function"==typeof c?h(a(c,f),null,[this._value]):f.resolve(this._value):2==e&&(d&&"function"==typeof d?h(a(d,f),null,[this._reason]):f.reject(this._reason));return f},"catch":function(a){return this.then(null,a)},_done:function(){for(var a=this._dones,b;b=a.shift();)b[0].call(b[1]||null,this._value)},done:function(a,b){0==this._state?this._dones.push([a,b]):a.call(b||null,this._value);return this},_fail:function(){for(var a=this._fails,b;b=a.shift();)b[0].call(b[1]||
null,this._reason)},fail:function(a,b){0==this._state?this._fails.push([a,b]):a.call(b||null,this._reason);return this},always:function(a,b){this.done(a,b);this.fail(a,b);return this},promise:function(){return{then:p(this.then,this),done:p(this.done,this),fail:p(this.fail,this),always:p(this.always,this)}}});k(b,{resolve:function(a){if(n(a)||"function"==typeof a)return new b(a);var d=new b;d.resolve(a);return d},reject:function(a){var d=new b;d.reject(a);return d},all:function(a){if(!a.length)return b.resolve(null);
var d=new b,f=a.length,e=[],g=f,h,k,u=function(a){e.push(a);g--;0==g&&d.resolve(e)};for(h=0;h<f;h++)k=a[h],k instanceof b?k.done(u).fail(d.reject,d):n(k)||"function"==typeof k?(new b(k)).done(u).fail(d.reject,d):u(k);return d},when:function(){return b.all(arguments)},allResolved:function(a){if(!a.length)return b.resolve(null);var d=new b,f=a.length,e=[],g=f,h,k,u=function(a){e.push(a);v()},v=function(){g--;0==g&&d.resolve(e)};for(h=0;h<f;h++)k=a[h],k instanceof b?k.done(u).fail(v):n(k)||"function"==
typeof k?(new b(k)).done(u).fail(v):u(k);return d},race:function(a){if(!a.length)return b.resolve(null);var d=new b,f=a.length,e,g;for(e=0;e<f&&(g=a[e],g instanceof b?g.done(d.resolve,d).fail(d.reject,d):n(g)||"function"==typeof g?(new b(g)).done(d.resolve,d).fail(d.reject,d):d.resolve(g),d.isPending());e++);return d}});"undefined"==typeof global?(window.Promise||(window.Promise=b),window.MetaphorJs&&window.MetaphorJs.r("MetaphorJs.lib.Promise",b)):"undefined"!=typeof module&&(module.exports=b)})();
(function(){"undefined"==typeof window&&(global.window=global);var m;if("undefined"!=typeof global)try{m=require("metaphorjs-observable")}catch(n){global.Observable&&(m=global.Observable)}else window.MetaphorJs&&MetaphorJs.lib&&MetaphorJs.lib.Observable&&(m=MetaphorJs.lib.Observable);var p=/(^|[^a-z0-9_$])(\.)([^0-9])/ig,e={},d=window.MetaphorJs&&MetaphorJs.nextUid?MetaphorJs.nextUid:function(){var a;a=Array(11).join((Math.random().toString(36)+"00000000000000000").slice(2,18)).slice(0,10);return e[a]?
d():e[a]=a},f=Object.prototype.toString,g=function(a){return"[object Array]"===f.call(a)},h=function(a){return"[object Date]"===f.call(a)},k=function(a){return"[object RegExp]"===f.call(a)},a=function(a){return a&&a.document&&a.location&&a.alert&&a.setInterval},b=function(c,d){if(a(c))throw Error("Cannot copy window object");if(d){if(c===d)throw Error("Objects are identical");if(g(c))for(var f=d.length=0;f<c.length;f++)d.push(b(c[f]));else{for(f in d)delete d[f];for(f in c)d[f]=b(c[f])}}else(d=c)&&
(g(c)?d=b(c,[]):h(c)?d=new Date(c.getTime()):k(c)?d=new RegExp(c.source):null!=c&&"object"===typeof c&&(d=b(c,{})));return d},c=function(b,d){if(b===d)return!0;if(null===b||null===d)return!1;if(b!==b&&d!==d)return!0;var f=typeof b,e;if(f==typeof d&&"object"==f)if(g(b)){if(!g(d))return!1;if((f=b.length)==d.length){for(e=0;e<f;e++)if(!c(b[e],d[e]))return!1;return!0}}else{if(h(b))return h(d)&&b.getTime()==d.getTime();if(k(b)&&k(d))return b.toString()==d.toString();if(a(b)||a(d)||g(d))return!1;f={};for(e in b)if(("$"!==
e.charAt(0)||"object"!=typeof b[e])&&"function"!==typeof b[e]){if(!c(b[e],d[e]))return!1;f[e]=!0}for(e in d)if(!f.hasOwnProperty(e)&&"$"!==e.charAt(0)&&void 0!==d[e]&&"function"!==typeof d[e])return!1;return!0}return!1},l=function(a,b){var d=a.length,f=b.length,e=Array(d+1),q=Array(d+1),g,l,h,k,s=0;if(d==f&&0==d)return{changes:0,distance:0,prescription:[]};for(g=0;g<=d;g++)e[g]=Array(f+1),q[g]=Array(f+1),e[g][0]=g,q[g][0]="D";for(g=0;g<=f;g++)e[0][g]=g,q[0][g]="I";for(g=1;g<=d;g++)for(l=1;l<=f;l++)h=
c(a[g-1],b[l-1])?0:1,e[g][l-1]<e[g-1][l]&&e[g][l-1]<e[g-1][l-1]+h?(e[g][l]=e[g][l-1]+1,q[g][l]="I"):e[g-1][l]<e[g-1][l-1]+h?(e[g][l]=e[g-1][l]+1,q[g][l]="D"):(e[g][l]=e[g-1][l-1]+h,q[g][l]=1==h?"R":"-");k=[];g=d;l=f;do h=q[g][l],k.push(h),"-"!=h&&s++,"R"==h||"-"==h?(g--,l--):"D"==h?g--:l--;while(0!=g||0!=l);return{changes:s/k.length,distance:e[d][f],prescription:k.reverse()}},s=MetaphorJs?MetaphorJs.trim:function(){return String.prototype.trim?function(a){return"string"==typeof a?a.trim():a}:function(a){return"string"==
typeof a?a.replace(/^\s\s*/,"").replace(/\s\s*$/,""):a}}(),r,t=function(a,b,c,f,e){r||(r=new m);var q=d(),l;g(a)&&null===b?l="array":("string"!=typeof b&&(f=c,c=b,b=null,l="object"),"string"==typeof a&&(f=c,c=b,b=a,a=null),b&&a&&(l=a.hasOwnProperty(b)?"attr":"expr"),b&&!a&&(l="expr"));if(c)r.on(q,c,f||this,{append:[e],allowDupes:!0});this.code=b;this.getterFn="expr"==l?u(b):null;this.id=q;this.type=l;this.obj=a;this.itv=null;this.curr=this._getValue()};(function(a,b){for(var c in b)b.hasOwnProperty(c)&&
(a[c]=b[c])})(t.prototype,{code:null,getterFn:null,setterFn:null,id:null,type:null,obj:null,itv:null,curr:null,arraySlice:!1,_checkCode:function(){var a=this._getValue(),b=!1,c=this.curr;if(g(c)&&g(a))return b=l(c,a),b.changes?(this.curr=a.slice(),r.trigger(this.id,b,a,c),!0):!1;a!==c&&(this.curr=a,r.trigger(this.id,a,c),b=!0);return b},_checkObject:function(){var a=this.obj,d=this.curr;return c(d,a)?!1:(this.curr=b(a),r.trigger(this.id,a,d),!0)},_checkArray:function(){var a=this.curr,b=this.obj,
c=l(a,b);return c.changes?(this.curr=b.slice(),r.trigger(this.id,c,b,a),!0):!1},_getValue:function(){var a;switch(this.type){case "attr":a=this.obj[this.code];break;case "expr":a=this.getterFn(this.obj);break;case "object":return b(this.obj);case "array":return this.obj.slice()}return g(a)?a.slice():a},addListener:function(a,b,c){return r.on(this.id,a,b,c)},removeListener:function(a,b){return r.un(this.id,a,b)},getValue:function(){return this._getValue()},setValue:function(a){var b=this.type;if("attr"==
b)this.obj[this.code]=a;else if("expr"==b)this.setterFn||(this.setterFn=v(this.code)),this.setterFn(this.obj,a);else if("array"==b)this.obj=a;else throw"Cannot set value";},check:function(){switch(this.type){case "expr":case "attr":return this._checkCode();case "object":return this._checkObject();case "array":return this._checkArray()}return!1},checkAll:function(){return this.obj.$$watchers.$checkAll()},getLastResult:function(){return this.curr},setInterval:function(a){var b=this;b.itv&&b.clearInterval();
b.itv=setInterval(function(){b.check()},a)},clearInterval:function(){this.itv&&(clearInterval(this.itv),this.itv=null)},unsubscribeAndDestroy:function(a,b){var c=this.id;r.un(c,a,b);return r.hasListener(c)?!1:(this.destroy(),!0)},destroy:function(){this.obj=this.curr=null;this.itv&&this.clearInterval();r.destroyEvent(this.id);this.obj&&delete this.obj.$$watchers[this.code]}});var y=function(a,b){if(a&&b){if(a.hasOwnProperty(b))return b;var c;if("."==b.charAt(0)&&(c=b.substr(1),a.hasOwnProperty(c)))return c}return b},
z=Function,u=function(a){a=a.replace(p,"$1____.$3");return new z("____","return ".concat(a))},v=function(a){a=a.replace(p,"$1____.$3");return new z("____","$$$$",a.concat(" = $$$$"))};t.create=function(a,b,c,d,f){b=y(a,s(b));return a?(a.$$watchers||(a.$$watchers={$checkAll:function(){var a,b=0;for(a in this)"$"!=a.charAt(0)&&this[a].check()?b++:"$"==a.charAt(0)&&this[a]instanceof t&&this[a].check()&&b++;return b},$destroyAll:function(){for(var a in this)if("$"!=a.charAt(0)||this[a]instanceof t)this[a].destroy(),
delete this[a]}}),a.$$watchers[b]?a.$$watchers[b].addListener(c,d,{append:[f],allowDupes:!0}):a.$$watchers[b]=new t(a,b,c,d,f),a.$$watchers[b]):new t(a,b,c,d,f)};t.unsubscribeAndDestroy=function(a,b,c,d){b=s(b);(a=a.$$watchers)&&a[b]&&a[b].unsubscribeAndDestroy(c,d)&&delete a[b]};t.normalizeExpr=y;t.prepareCode=function(a){return a.replace(p,"$1____.$3")};t.createGetter=u;t.createSetter=v;t.createFunc=function(a){a=a.replace(p,"$1____.$3");return new z("____",a)};window.MetaphorJs&&MetaphorJs.r&&
MetaphorJs.r("MetaphorJs.lib.Watchable",t);"undefined"!=typeof global&&(module.exports=t)})();
(function(){var m,n;if("undefined"!=typeof global)try{m=require("metaphorjs-promise"),n=require("metaphorjs-observable")}catch(p){m=global.MetaphorJs.lib.Promise,n=global.MetaphorJs.lib.Observable}else m=window.MetaphorJs.lib.Promise,n=window.MetaphorJs.lib.Observable;var e=function(a,b,c){for(var d in b)!b.hasOwnProperty(d)||void 0!=typeof a[d]&&!1===c||(a[d]=b[d])},d=Function.prototype.bind?function(a,b){return a.bind(b)}:function(a,b){return function(){a.apply(b,arguments)}},f;"undefined"!=typeof window&&
(f=document.querySelectorAll||function(a){var b=document,c=b.documentElement.firstChild,d=b.createElement("STYLE");c.appendChild(d);b.__qsaels=[];d.sheet?d.sheet.insertRule(a+"{x:expression(document.__qsaels.push(this))}",0):d.styleSheet&&(d.styleSheet.cssText=a+"{x:expression(document.__qsaels.push(this))}");window.scrollBy(0,0);return b.__qsaels});var g=/#.*$/,h=/([?&])_=[^&]*/,k=/\?/,a=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,b=/^(?:GET|HEAD)$/i,c=0,l=function(a,b){setTimeout(function(){a.call(b)},
0)},s=function(a,b,c){a.attachEvent?a.attachEvent("on"+b,c):a.addEventListener(b,c,!1)},r=function(){return String.prototype.trim?function(a){return"string"==typeof a?a.trim():a}:function(a){return"string"==typeof a?a.replace(/^\s\s*/,"").replace(/\s\s*$/,""):a}}(),t=function(a,b){var c,d;if(!a||"string"!==typeof a)return null;try{d=new DOMParser,c=d.parseFromString(a,b||"text/xml")}catch(f){c=void 0}if(!c||c.getElementsByTagName("parsererror").length)throw"Invalid XML: "+a;return c},y=function(a,
b,c){var d,f;if("string"==typeof a&&c)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a));else if(E(a)&&c)for(d=0,f=a.length;d<f;d++)y(a[d],b,c+"["+d+"]");else if("object"==typeof a)for(d in a)a.hasOwnProperty(d)&&y(a[d],b,c?c+"["+d+"]":d)},z=function(a,c){a.replace(g,"");if(!1===c.cache){var d=(new Date).getTime();return h.test(a)?a.replace(h,"$1_="+d):a+(k.test(a)?"&":"?")+"_="+d}!c.data||window.FormData&&c.data instanceof window.FormData||("string"!=typeof c.data?(d=[],y(c.data,d,null),d=d.join("&").replace(/%20/g,
"+")):d=c.data,c.data=d,b.test(c.method)&&(a+=(k.test(a)?"&":"?")+c.data,c.data=null));return a},u={xml:"application/xml, text/xml",html:"text/html",script:"text/javascript, application/javascript",json:"application/json, text/javascript",text:"text/plain",_default:"*/*"},v={url:null,data:null,method:"GET",headers:null,username:null,password:null,cache:null,dataType:null,timeout:0,contentType:"application/x-www-form-urlencoded",xhrFields:null,jsonp:!1,jsonpParam:null,jsonpCallback:null,transport:null,
replace:!1,selector:null,form:null,beforeSend:null,progress:null,uploadProgress:null,processResponse:null,callbackScope:null},w={},B=new n,C=function(a){var b;b=eval;a&&(/^[^\S]*use strict/.test(a)?(b=document.createElement("script"),b.text=a,document.head.appendChild(b).parentNode.removeChild(b)):b(a))},E=function(a){return a&&"object"==typeof a&&"number"==typeof a.length&&"[object Array]"==Object.prototype.toString.call(a)||!1},x=function(a,b,c){var d,f;if("object"!=typeof a&&"function"!=typeof a&&
c)d=document.createElement("input"),d.setAttribute("type","hidden"),d.setAttribute("name",c),d.setAttribute("value",a),b.appendChild(d);else if(E(a)&&c)for(d=0,f=a.length;d<f;d++)x(a[d],b,c+"["+d+"]");else if("object"==typeof a)for(d in a)a.hasOwnProperty(d)&&x(a[d],b,c?c+"["+d+"]":d)},q=function(a){for(var b,c,d="",f=0;f<a.elements.length;f++)if(b=a.elements[f],b.hasAttribute("name"))if(c="INPUT"===b.nodeName.toUpperCase()?b.getAttribute("type").toUpperCase():"TEXT","FILE"===c)for(c=0;c<b.files.length;d+=
"&"+encodeURIComponent(b.name)+"="+encodeURIComponent(b.files[c++].name));else if("RADIO"!==c&&"CHECKBOX"!==c||b.checked)d+="&"+encodeURIComponent(b.name)+"="+encodeURIComponent(b.value);return d},D=function(){},G=function(a,b,c){var d=b?b.dataType:null;b=b?b.selector:null;if("string"!=typeof a)return a;c=c||"";if("xml"===d||!d&&0<=c.indexOf("xml"))return a=t(r(a)),b?f.call(a,b):a;if("html"===d)return a=t(a,"text/html"),b?f.call(a,b):a;if("fragment"==d){c=document.createDocumentFragment();d=document.createElement("div");
for(d.innerHTML=a;d.firstChild;)c.appendChild(d.firstChild);return c}if("json"===d||!d&&0<=c.indexOf("json"))return a=r(a),JSON.parse(a);("script"===d||!d&&0<=c.indexOf("javascript"))&&C(a);return a+""},H=function(b){var c=a.exec(("undefined"!=typeof window?window.location.href:"").toLowerCase())||[],f=a.exec(b.url.toLowerCase());this._opt=b;b.crossDomain=!(!f||f[1]===c[1]&&f[2]===c[2]&&(f[3]||("http:"===f[1]?"80":"443"))===(c[3]||("http:"===c[1]?"80":"443")));c=new m;"iframe"!=b.transport||b.form?
b.form&&(this._form=b.form,"POST"!=b.method||"undefined"!=typeof window&&window.FormData||"iframe"==b.transport||(b.transport="iframe")):(this.createForm(),b.form=this._form);b.form&&"iframe"!=b.transport&&(b.data="POST"==b.method?new FormData(b.form):q(b.form));b.url=z(b.url,b);f=!b.crossDomain&&"script"!=b.transport||b.form?"iframe"==b.transport?new J(b,c,this):new I(b,c,this):new F(b,c,this);this._deferred=c;this._transport=f;c.done(function(a){B.trigger("success",a)});c.fail(function(a){B.trigger("error",
a)});c.always(function(){B.trigger("end")});B.trigger("start");b.timeout&&(this._timeout=setTimeout(d(this.onTimeout,this),b.timeout));b.jsonp&&this.createJsonp();!1===B.trigger("beforeSend",b,f)&&(this._promise=m.reject());b.beforeSend&&!1===b.beforeSend.call(b.callbackScope,b,f)&&(this._promise=m.reject());this._promise||(l(f.send,f),b=c.promise(),b.abort=d(this.abort,this),c.always(this.destroy,this),this._promise=b)};e(H.prototype,{_jsonpName:null,_transport:null,_opt:null,_deferred:null,_promise:null,
_timeout:null,_form:null,_removeForm:!1,promise:function(){return this._promise},abort:function(a){this._transport.abort();this._deferred.reject(a||"abort")},onTimeout:function(){this.abort("timeout")},createForm:function(){var a=document.createElement("form");a.style.display="none";a.setAttribute("method",this._opt.method);x(this._opt.data,a,null);document.body.appendChild(a);this._form=a;this._removeForm=!0},createJsonp:function(){var a=this._opt,b=a.jsonpParam||"callback",f=a.jsonpCallback||"jsonp_"+
++c;a.url+=(k.test(a.url)?"&":"?")+b+"="+f;this._jsonpName=f;"undefined"!=typeof window&&(window[f]=d(this.jsonpCallback,this));"undefined"!=typeof global&&(global[f]=d(this.jsonpCallback,this));return f},jsonpCallback:function(a){try{this._deferred.resolve(this.processResponseData(a))}catch(b){this._deferred.reject(b)}},processResponseData:function(a,b){var c=this._opt;a=G(a,c,b);B.hasListener("processResponse")&&(a=B.trigger("processResponse",a,this._deferred));c.processResponse&&(a=c.processResponse.call(c.callbackScope,
a,this._deferred));return a},processResponse:function(a,b){var c=this._deferred;if(this._opt.jsonp)if(a){try{C(a)}catch(d){c.reject(d)}c.isPending()&&c.reject("jsonp script didn't invoke callback")}else c.reject("jsonp script is empty");else try{c.resolve(this.processResponseData(a,b))}catch(f){c.reject(f)}},destroy:function(){this._timeout&&clearTimeout(this._timeout);this._form&&this._form.parentNode&&this._removeForm&&this._form.parentNode.removeChild(this._form);this._transport.destroy();delete this._transport;
delete this._opt;delete this._deferred;delete this._promise;delete this._timeout;delete this._form;this._jsonpName&&("undefined"!=typeof window&&delete window[this._jsonpName],"undefined"!=typeof global&&delete global[this._jsonpName])}},!0);var A=function(a,b){b=b||{};a&&"string"!=typeof a?b=a:b.url=a;if(!b.url&&(b.form&&(b.url=b.form.getAttribute("action")),!b.url))throw"Must provide url";e(b,w,!1);e(b,v,!1);b.method=b.method?b.method.toUpperCase():b.form?b.form.getAttribute("method").toUpperCase()||
"GET":"GET";return(new H(b)).promise()};A.setup=function(a){e(w,a,!0)};A.on=function(){B.on.apply(B,arguments)};A.un=function(){B.un.apply(B,arguments)};A.get=function(a,b){b=b||{};b.method="GET";return A(a,b)};A.post=function(a,b){b=b||{};b.method="POST";return A(a,b)};A.load=function(a,b,c){c=c||{};"string"!=typeof b&&(c=b);c.dataType="fragment";return A(b,c).done(function(b){if(c.replace)for(;a.firstChild;)a.removeChild(a.firstChild);a.appendChild(b)})};A.loadScript=function(a){return A(a,{transport:"script"})};
A.submit=function(a,b){b=b||{};b.form=a;return A(null,b)};var I=function(a,b,c){var f;if(!(window.XMLHttpRequest&&(f=new XMLHttpRequest)||(f=new ActiveXObject("Msxml2.XMLHTTP"))||(f=new ActiveXObject("Microsoft.XMLHTTP"))))throw"Unable to create XHR object";this._xhr=f;this._deferred=b;this._opt=a;this._ajax=c;a.progress&&s(f,"progress",d(a.progress,a.callbackScope));a.uploadProgress&&f.upload&&s(f.upload,"progress",d(a.uploadProgress,a.callbackScope));try{var e;if(a.xhrFields)for(e in a.xhrFields)f[e]=
a.xhrFields[e];a.data&&a.contentType&&f.setRequestHeader("Content-Type",a.contentType);f.setRequestHeader("X-Requested-With","XMLHttpRequest");f.setRequestHeader("Accept",a.dataType&&u[a.dataType]?u[a.dataType]+", */*; q=0.01":u._default);for(e in a.headers)f.setRequestHeader(e,a.headers[e])}catch(g){}f.onreadystatechange=d(this.onReadyStateChange,this)};e(I.prototype,{_xhr:null,_deferred:null,_ajax:null,onReadyStateChange:function(){var a=this._xhr,b=this._deferred;if(0===a.readyState)a.onreadystatechange=
D,b.resolve(a);else if(4===a.readyState){a.onreadystatechange=D;var c;a:{try{c=!a.status&&"undefined"!=typeof location&&"file:"==location.protocol||200<=a.status&&300>a.status||304===a.status||1223===a.status;break a}catch(d){}c=!1}c?this._ajax.processResponse("string"==typeof a.responseText?a.responseText:void 0,a.getResponseHeader("content-type")||""):b.reject(a)}},abort:function(){this._xhr.onreadystatechange=D;this._xhr.abort()},send:function(){var a=this._opt;try{this._xhr.open(a.method,a.url,
!0,a.username,a.password),this._xhr.send(a.data)}catch(b){this._deferred.reject(b)}},destroy:function(){delete this._xhr;delete this._deferred;delete this._opt;delete this._ajax}},!0);var F=function(a,b,c){this._opt=a;this._ajax=c;this._deferred=b};e(F.prototype,{_opt:null,_deferred:null,_ajax:null,_el:null,send:function(){var a=document.createElement("script");a.setAttribute("async","async");a.setAttribute("charset","utf-8");a.setAttribute("src",this._opt.url);s(a,"load",d(this.onLoad,this));s(a,
"error",d(this.onError,this));document.head.appendChild(a);this._el=a},onLoad:function(a){this._deferred&&this._deferred.resolve(a)},onError:function(a){this._deferred.reject(a)},abort:function(){this._el.parentNode&&this._el.parentNode.removeChild(this._el)},destroy:function(){this._el.parentNode&&this._el.parentNode.removeChild(this._el);delete this._el;delete this._opt;delete this._ajax;delete this._deferred}},!0);var J=function(a,b,c){this._opt=a;this._ajax=c;this._deferred=b};e(J.prototype,{_opt:null,
_deferred:null,_ajax:null,_el:null,send:function(){var a=document.createElement("iframe"),b="frame-"+ ++c,f=this._opt.form;a.setAttribute("id",b);a.setAttribute("name",b);a.style.display="none";document.body.appendChild(a);f.setAttribute("action",this._opt.url);f.setAttribute("target",b);s(a,"load",d(this.onLoad,this));s(a,"error",d(this.onError,this));this._el=a;try{f.submit()}catch(e){this._deferred.reject(e)}},onLoad:function(){var a=this._el;this._opt&&!this._opt.jsonp&&(a=a.contentDocument||
a.contentWindow.document,a=a.body.innerHTML,this._ajax.processResponse(a))},onError:function(a){this._deferred.reject(a)},abort:function(){this._el.parentNode&&this._el.parentNode.removeChild(this._el)},destroy:function(){this._el.parentNode&&this._el.parentNode.removeChild(this._el);delete this._el;delete this._opt;delete this._ajax;delete this._deferred}},!0);"undefined"!=typeof global?module.exports=A:window.MetaphorJs?MetaphorJs.ajax=A:window.MetaphorJs={ajax:A}})();
(function(){var m=[],n=!1,p=/(?:(\w+\:))?(?:\/\/(?:[^@]*@)?([^\/:\?#]+)(?::([0-9]+))?)?([^\?#]*)(?:(\?[^#]+)|\?)?(?:(#.*))?/,e=function(a,b,c){a.attachEvent?a.attachEvent("on"+b,c):a.addEventListener(b,c,!1)},d=!!history.pushState,f="onhashchange"in window,g=function(a){var b=location.protocol+"//"+location.hostname;location.port&&(b+=":"+location.port);a=a.replace(b,"");d||(a=encodeURIComponent(a));return a},h=function(){var a;d?a=location.pathname+location.search:(a=location.hash.substr(1))?("!"==
a.substr(0,1)&&(a=a.substr(1)),a=decodeURIComponent(a)):a=location.pathname+location.search;return a},k=function(){var a=h();if(m.length)for(var b=-1,c=m.length;++b<c;m[b].call(null,a));window.MetaphorJs&&MetaphorJs.triggerAsync("locationchange",a)};e(window,"load",function(){n=!0});history.initPushState=function(){if(d)history.origPushState=history.pushState,history.origReplaceState=history.replaceState,e(window,"popstate",k),history.pushState=function(a,b,c){history.origPushState(a,b,g(c));k()},
history.replaceState=function(a,b,c){history.origReplaceState(a,b,g(c));k()};else if(f)history.replaceState=history.pushState=function(a,b,c){a=g(c);location.hash=a?"!"+a:""},e(window,"hashchange",k);else{var a=null,b=!1;window.onIframeHistoryChange=function(a){b||(location.hash=a?"!"+a:"",k())};var c=function(b){var c=a.contentWindow.document;c.open();c.write("<html><head><title>"+document.title+'</title><script type="text/javascript">var hashValue = "'+b+'";window.top.onIframeHistoryChange(hashValue);\x3c/script></head><body>&nbsp;</body></html>');
c.close()};history.pushState=function(a,b,d){c(g(d))};history.replaceState=function(b,c,d){b=g(d);a.contentWindow.hashValue=b};var l=function(){a=document.createElement("iframe");a.src="about:blank";a.style.display="none";document.body.appendChild(a);b=!0;c(g(location.hash.substr(1)));b=!1};n?l():e(window,"load",l)}e(document.documentElement,"click",function(a){a=a||window.event;for(var b=a.target||a.srcElement,c;b&&"a"!=b.nodeName.toLowerCase();)b=b.parentNode;if(b){c=b.getAttribute("href");var d;
if(d=c&&"#"!=c.substr(0,1))c=c.match(p),d=c[1]&&location.protocol!=c[1]||c[2]&&location.hostname!=c[2]?!1:c[2]||c[3]?location.port!=c[3]?!1:!0:!0;if(d&&!b.getAttribute("target"))return history.pushState(null,null,b.getAttribute("href")),a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation(),!1}});history.initPushState=function(){}};window.MetaphorJs?(MetaphorJs.pushUrl=function(a){history.pushState(null,null,a)},MetaphorJs.replaceUrl=function(a){history.replaceState(null,null,
a)},MetaphorJs.currentUrl=function(){return h()}):history.onchange=function(a){m.push(a)}})();
(function(){var m=/\r/g,n=function(e){var d,f;if((d=p[e.type]||p[e.nodeName.toLowerCase()])&&"get"in d&&void 0!==(f=d.get(e,"value")))return f;f=e.value;return"string"===typeof f?f.replace(m,""):null==f?"":f},p={option:{get:function(e){var d=e.getAttribute("value");return null!=d?d:MetaphorJs.trim(e.innerText||e.textContent)}},select:{get:function(e){for(var d,f=e.options,g=e.selectedIndex,h=(e="select-one"===e.type||0>g)?null:[],k=e?g+1:f.length,a,b=0>g?k:e?g:0;b<k;b++)if(d=f[b],a=d.disabled||null!==
d.getAttribute("disabled")||f.parentNode.disabled,(d.selected||b===g)&&!a){d=n(d);if(e)return d;h.push(d)}return h},set:function(e,d){for(var f,g,h=e.options,k=MetaphorJs.toArray(d),a=h.length;a--;)if(g=h[a],g.selected=MetaphorJs.inArray(g.value,k))f=!0;f||(e.selectedIndex=-1);return k}}};p.radio=p.checkbox={set:function(e,d){if(MetaphorJs.isArray(d))return e.checked=0<=MetaphorJs.inArray(n(e),d)},get:function(e){return null===e.getAttribute("value")?"on":e.value}};MetaphorJs.getValue=n;MetaphorJs.setValue=
function(e,d){if(1===e.nodeType){null==d?d="":"number"===typeof d&&(d+="");var f=p[e.type]||p[e.nodeName.toLowerCase()];f&&"set"in f&&void 0!==f.set(this,d,"value")||(e.value=d)}}})();
(function(){var m=function(){return!1},n=function(){return!0},p=function(e){if(!(this instanceof p))return new p(e);for(var d in e)e.hasOwnProperty&&e.hasOwnProperty(d)||this[d]||(this[d]=e[d]);this.originalEvent=e;this.type=e.type;!this.target&&e.srcElement&&(this.target=e.srcElement);this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?n:m;this.timeStamp=e&&e.timeStamp||(new Date).getTime()};p.prototype={isDefaultPrevented:m,isPropagationStopped:m,isImmediatePropagationStopped:m,
preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=n;e&&e.preventDefault&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=n;e&&e.stopPropagation&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=n;e&&e.stopImmediatePropagation&&e.stopImmediatePropagation();this.stopPropagation()}};MetaphorJs.normalizeEvent=function(e){return new p(e)}})();
(function(){var m=MetaphorJs.lib.Observable,n=MetaphorJs.apply;MetaphorJs.d("MetaphorJs.cmp.Base",{destroyed:!1,_observable:null,initialize:function(p){p=p||{};this._observable=new m;n(this,this._observable.getApi());if(p.callback){var e=p.callback,d=e.scope||this;delete e.scope;for(var f in e)if(e.hasOwnProperty(f))this.on(f,e[f],d);delete p.callback}n(this,p,!0)},destroy:function(){if(!this.destroyed){if(!1===this.trigger("beforedestroy",this))return!1;this.onDestroy();this.destroyed=!0;this.trigger("destroy",
this);this._observable.destroy();delete this._observable}},onDestroy:MetaphorJs.emptyFn})})();
(function(){var m={},n={},p=MetaphorJs.apply,e=MetaphorJs.ajax,d=MetaphorJs.create;MetaphorJs.define("MetaphorJs.data.Model",{type:null,fields:null,record:null,store:null,plain:!1,initialize:function(d){this.fields={};p(this,{record:{load:null,save:null,"delete":null,id:null,data:null,success:null,extra:{}},store:{load:null,save:null,"delete":null,id:null,data:null,total:null,start:null,limit:null,success:null,extra:{}}},!1);p(this,d,!0);this.plain=!this.type},isPlain:function(){return this.plain},
getRecordProp:function(d,e){return this.getProp("record",d,e)},setRecordProp:function(d,e){this.record[d]=e},getStoreProp:function(d,e){return this.getProp("store",d,e)},setStoreProp:function(d,e){this.store[d]=e},getProp:function(d,e,h){d=this[d];return d[e]&&d[e][h]||d[h]||this[h]||null},setProp:function(d,e){return this[d]=e},_createAjaxCfg:function(d,e,h,k){var a=this,b=a[d],c=p({},"string"==typeof b[e]?{url:b[e]}:b[e]),l=a.getProp(d,e,"id"),s=a.getProp(d,e,"data"),m=a.getProp(d,e,"url"),n=a.getProp(d,
e,"json");if(!c)if(m)c={url:m};else throw d+"."+e+" not defined";"string"==typeof c&&(c={url:c});if(!c.url){if(!m)throw d+"."+e+" url not defined";c.url=m}c.data=p({},c.data,a.extra,b.extra,b[e]?b[e].extra:{});c.method||(c.method="load"==e?"GET":"POST");h&&(c.data[l]=h);k&&(s?c.data[s]=k:c.data=k);n&&c.data&&"GET"!=c.method&&(c.data=JSON.stringify(c.data));c.callbackScope=a;"record"==d?c.processResponse=function(b,c){a._processRecordResponse(e,b,c)}:"store"==d&&(c.processResponse=function(b,c){a._processStoreResponse(e,
b,c)});return c},_processRecordResponse:function(d,e,h){var k=this.getRecordProp(d,"id"),a=this.getRecordProp(d,"data"),k=(a=a?e[a]:e)&&a[k]||e[k];this._getSuccess("record",d,e)?h.resolve({id:k,data:a}):h.reject(e)},_processStoreResponse:function(d,e,h){var k=this.getStoreProp(d,"data"),a=this.getStoreProp(d,"total"),k=k?e[k]:e,a=a?e[a]:null;this._getSuccess("store",d,e)?h.resolve({data:k,total:a}):h.reject(e)},_getSuccess:function(d,e,h){return(d=this.getProp(d,e,"success"))&&void 0!=h[d]?h[d]:!0},
loadRecord:function(d){return e(this._createAjaxCfg("record","load",d))},saveRecord:function(d,g,h){return e(this._createAjaxCfg("record",d.getId()?"save":"create",d.getId(),p({},d.storeData(d.getData(g)),h)))},deleteRecord:function(d){return e(this._createAjaxCfg("record","delete",d.getId()))},loadStore:function(d,g){return e(p(this._createAjaxCfg("store","load"),g,!0))},saveStore:function(d,g){return e(this._createAjaxCfg("store","save",null,g))},deleteRecords:function(d,g){return e(this._createAjaxCfg("store",
"delete",g))},getFields:function(){return this.fields},restoreField:function(d,e,h){var k=this.fields[e];if(k){switch("string"==typeof k?k:k.type){case "int":h=parseInt(h);break;case "bool":case "boolean":"string"==typeof h?(h=h.toLowerCase(),h=!("off"===h||"no"===h||"0"===h||"false"==h||"null"==h)):h=h?!0:!1;break;case "double":case "float":h=parseFloat(h);break;case "date":k.parseFn?h=k.parseFn(h,k.format):Date.parse?h=Date.parse(h,k.format):("timestamp"==k.format&&(h=1E3*parseInt(h)),h=new Date(h))}k.restore&&
(h=k.restore.call(d,h,e))}return this.onRestoreField(d,e,h)},onRestoreField:function(d,e,h){return h},storeField:function(d,e,h){var k=this.fields[e];if(k){switch("string"==typeof k?k:k.type){case "bool":case "boolean":h=h?"1":"0";break;case "date":h=k.formatFn?k.formatFn(h,k.format):Date.format?Date.format(h,k.format):"timestamp"==k.format?h.getTime()/1E3:h.format?h.format(k.format):h.toString();break;default:h=h.toString()}k.store&&(h=k.store.call(d,h,e))}return this.onStoreField(d,e,h)},onStoreField:function(d,
e,h){return h}},{create:function(e,g){return"MetaphorJs.data.Model"==e?d(e,g):g?d(e,g):m[e]?m[e]:m[e]=d(e)},addToCache:function(d){var e=d.getClass(),h=d.getId();"MetaphorJs.data.Record"!=e&&(n[e]||(n[e]={}),n[e][h]=d)},getFromCache:function(d,e){return n[d]&&n[d][e]?n[d][e]:null},removeFromCache:function(d,e){n[d]&&n[d][e]&&delete n[d][e]}})})();
(function(){var m=MetaphorJs.data.Model,n=MetaphorJs.create,p=MetaphorJs.is,e=MetaphorJs.apply;MetaphorJs.define("MetaphorJs.data.Record","MetaphorJs.cmp.Base",{id:null,data:null,orig:null,modified:null,loaded:!1,dirty:!1,destroyed:!1,model:null,standalone:!0,stores:null,initialize:function(d,e,g){var h=arguments.length;1==h?(g=d,e=d=null):2==h&&(g=e,e=null);this.data={};this.orig={};this.stores=[];this.modified={};g=g||{};this.supr(g);"string"==typeof this.model?this.model=n(this.model):p(this.model,
"MetaphorJs.data.Model")||(this.model=n("MetaphorJs.data.Model",this.model));this.id=d;e?this.importData(e):!1!==g.autoLoad&&d&&this.load();"MetaphorJs.data.Record"!=this.getClass()&&m.addToCache(this)},isLoaded:function(){return this.loaded},isStandalone:function(){return this.standalone},isDirty:function(){return this.dirty},getModel:function(){return this.model},attachStore:function(d){d=d.getId();-1==this.stores.indexOf(d)&&this.stores.push(d)},detachStore:function(d){d=d.getId();var e;this.destroyed||
-1==(e=this.stores.indexOf(d))||(this.stores.splice(e,1),0!=this.stores.length||this.standalone||this.destroy())},setDirty:function(d){this.dirty!=d&&(this.dirty=!!d,this.trigger("dirtychange",this,d))},importData:function(d){var f={},g;if(d){for(g in d)f[g]=this.model.restoreField(this,g,d[g]);this.data=f}this.orig=e({},this.data);this.modified={};this.loaded=!0;this.setDirty(!1)},storeData:function(d){var e={},g;for(g in d)e[g]=this.model.storeField(this,g,d[g]);return e},getId:function(){return this.id},
getData:function(d){if(d){var f={},g,h;d="string"==typeof d?[d]:d;g=0;for(h=d.length;g<h;g++)f[d[g]]=this.data[d[g]];return f}return e({},this.data)},getChanged:function(){return e({},this.modified)},isChanged:function(d){return this.modified[d]||!1},get:function(d){return this.data[d]},setId:function(d){!this.id&&d&&(this.id=d)},set:function(d,e){var g=this.data[d];e=this.model.restoreField(this,d,e);this.data[d]=e;g!=e&&(this.modified[d]=!0,this.setDirty(!0),this.trigger("change",this,d,e,g),this.trigger("change-"+
d,this,d,e,g))},revert:function(){this.dirty&&(this.data=e({},this.orig),this.modified={},this.setDirty(!1))},load:function(){var d=this;d.trigger("beforeload",d);return d.model.loadRecord(d.id).done(function(e){d.setId(e.id);d.importData(e.data);d.trigger("load",d)}).fail(function(){d.trigger("failedload",d)})},save:function(d,e){var g=this;g.trigger("beforesave",g);return g.model.saveRecord(g,d,e).done(function(d){g.setId(d.id);g.importData(d.data);g.trigger("save",g)}).fail(function(d){g.trigger("failedsave",
g)})},"delete":function(){var d=this;d.trigger("beforedelete",d);return d.model.deleteRecord(d).done(function(){d.trigger("delete",d);d.destroy()}).fail(function(){d.trigger("faileddelete",d)})},reset:function(){this.id=null;this.data={};this.orig={};this.modified={};this.dirty=this.loaded=!1;this.trigger("reset",this)},destroy:function(){this.destroyed||(this.destroyed=!0,this.trigger("destroy",this),this.stores=this.model=this.modified=this.orig=this.data=null,m.removeFromCache(this.getClass(),
this.id),this.supr())}})})();
(function(){var m=0,n={},p=MetaphorJs.create,e=MetaphorJs.isArray,d=MetaphorJs.data.Record,f=MetaphorJs.data.Model,g=MetaphorJs.is,h=MetaphorJs.emptyFn,k=MetaphorJs.apply;MetaphorJs.d("MetaphorJs.data.Store","MetaphorJs.cmp.Base",{id:null,autoLoad:!1,clearOnLoad:!0,model:null,extraParams:null,loaded:!1,loading:!1,local:!1,items:null,map:null,keys:null,length:0,totalLength:0,start:0,pageSize:null,pages:null,filtered:!1,filterBackup:null,filterFn:null,filterScope:null,filterParams:null,initialize:function(a,
b,c){this.items=[];this.map={};this.keys=[];this.loaded=!1;this.extraParams=this.extraParams||{};a&&"string"!=typeof a&&(c=b,b=a,a=null);b=b||{};this.supr(b);this.id=this.id||++m;n[this.id]=this;"string"==typeof this.model?this.model=p(this.model):g(this.model,f)||(this.model=p("MetaphorJs.data.Model",this.model));if(a||b.url)this.model.store.load=a||b.url;!this.local&&this.autoLoad?this.load():c&&(e(c)?this.loadArray(c):this.loadAjaxData(c));this.local&&(this.loaded=!0)},getId:function(){return this.id},
isLoaded:function(){return this.loaded},isLocal:function(){return this.local},setLocal:function(a){this.local=!!a},isLoading:function(){return this.loading},isFiltered:function(){return this.filtered},getLength:function(){return this.length},getTotalLength:function(){return this.filtered?this.length:this.totalLength||this.length},getPagesCount:function(){return null!==this.pageSize?parseInt(this.totalLength/this.pageSize):1},setParam:function(a,b){this.extraParams[a]=b},getParam:function(a){return this.extraParams[a]},
setStart:function(a){this.start=a},setPageSize:function(a){this.pageSize=a},getAjaxData:function(){return this.ajaxData},hasDirty:function(){if(this.model.isPlain())return!1;var a=!1;this.each(function(b){return b.isDirty()?(a=!0,!1):!0});return a},getDirty:function(){var a=[];if(this.model.isPlain())return a;this.each(function(b){b.isDirty()&&a.push(b)});return a},getModel:function(){return this.model},importData:function(a){this.suspendAllEvents();for(var b=0;b<a.length;b++)this.add(a[b]);this.resumeAllEvents();
this.loaded=!0;this.loading=!1;this.onLoad();this.trigger("load",this)},load:function(a){var b=this,c=b.model.store,d=c.start,c=c.limit;if(b.local)return null;a=k({},b.extraParams,a||{});null===b.pageSize||a[d]||a[c]||(a[d]=b.start,a[c]=b.pageSize);return!1===b.trigger("beforeload",b)?null:b.model.loadStore(b,a).done(function(a){b.totalLength=parseInt(a.total);b.importData(a.data);b.totalLength=parseInt(a.total)}).fail(function(){b.onFailedLoad();b.trigger("failedload",b)})},onLoad:h,onFailedLoad:h,
save:function(){var a=this,b={},c=0;if(a.local)return null;if(a.model.isPlain())throw Error("Cannot save plain store");a.each(function(a){a.isDirty()&&(b[a.getId()]=a.storeData(a.getData()),c++)});if(!c)throw Error("Nothing to save");return!1===a.trigger("beforesave",a,b)?null:a.model.saveStore(a,b).done(function(b){var c,d,e=b.data;if(e&&e.length)for(b=0,c=e.length;b<c;b++)d=a.getRecordId(e[b]),(d=a.getById(d))&&d.importData(e[b]);a.onSave();a.trigger("save",a)}).fail(function(){a.onFailedSave();
a.trigger("failedsave",a)})},onSave:h,onFailedSave:h,deleteById:function(a){var b=this,c,f,g;if(b.local)return null;if(!a||e(a)&&!a.length)throw Error("Record id required");e(a)||(a=[a]);c=0;for(f=a.length;c<f;c++)g=b.getById(a[c]),g instanceof d?g.destroy():b.removeId(a[c]);return!1===b.trigger("beforedelete",b,a)?null:b.model.deleteRecords(b,a).done(function(){b.onDelete();b.trigger("delete",b,a)}).fail(function(){b.onFailedDelete();b.trigger("faileddelete",b,a)})},onDelete:h,onFailedDelete:h,deleteAt:function(a){var b=
this.getAt(a);if(!b)throw Error("Record not found at "+a);return this.deleteRecord(b)},"delete":function(a){return this.deleteById(this.getRecordId(a))},deleteRecords:function(a){var b=[],c,d;c=0;for(d=a.length;c<d;c++)b.push(this.getRecordId(a[c]));return this.deleteById(b)},loadAjaxData:function(a){var b=this;!1!==b.trigger("beforeload",b)&&b.model._processStoreResponse("load",a,{resolve:function(a,d){b.importData(a);b.totalLength=parseInt(d)},reject:function(){}})},loadArray:function(a,b){!1!==
this.trigger("beforeload",this)&&(!b&&this.clearOnLoad&&0<this.length&&this.clear(),e(a)&&(this.importData(a),this.totalLength=this.length))},loadOr:function(a,b){this.local||this.isLoading()||(this.isLoaded()?a&&a.call(b||this):this.load())},addNextPage:function(){!this.local&&this.length<this.totalLength&&this.load({start:this.length,limit:this.pageSize},!0)},loadNextPage:function(){this.local||(this.start+=this.pageSize,this.load())},loadPrevPage:function(){this.local||(this.start-=this.pageSize,
this.load())},getRecordId:function(a){return a instanceof d?a.getId():a[this.model.getStoreProp("load","id")]||null},processRawDataItem:function(a){if(a instanceof d||this.model.isPlain())return a;var b=this.model.type,c=this.getRecordId(a),e;c&&(e=f.getFromCache(b,c));e||(e=p(b,c,a,{model:this.model,standalone:!1}));return e},bindRecord:function(a,b){b[a]("change",this.onRecordChange,this);b[a]("destroy",this.onRecordDestroy,this);b[a]("dirtychange",this.onRecordDirtyChange,this);return b},onRecordDirtyChange:function(a){this.trigger("update",
this,a)},onRecordChange:function(a,b,c,d){this.trigger("update",this,a)},onRecordDestroy:function(a){this.remove(a)},add:function(a,b,c){if(this.filtered)throw"Cannot add to filtered store";if("string"!=typeof a&&"number"!=typeof a){b=a;if(e(b)){if(!b.length)return;a=this.length;for(var f=0,g=b.length;f<g;f++)b[f]=this.processRawDataItem(b[f]),this.add(this.getRecordId(b[f]),b[f],!0);this.onAdd(a,b);c||this.trigger("add",a,b);return}b=this.processRawDataItem(b);a=this.getRecordId(b)}if("undefined"!=
typeof a&&null!==a){if("undefined"!=typeof this.map[a]){this.replace(a,b);return}this.map[a]=b}this.length++;this.items.push(b);this.keys.push(a);b instanceof d&&(b.attachStore(this),this.bindRecord("on",b));this.onAdd(this.length-1,[b]);c||this.trigger("add",this.length-1,[b])},onAdd:h,removeAt:function(a){if(a<this.length&&0<=a){this.length--;this.totalLength--;var b=this.items[a];this.items.splice(a,1);var c=this.keys[a];"undefined"!=typeof c&&delete this.map[c];this.keys.splice(a,1);this.onRemove(b,
c);this.trigger("remove",b,c);return b instanceof d?(this.bindRecord("un",b),b.detachStore(this),null):b}return!1},onRemove:h,insert:function(a,b,c,e){if(this.filtered)throw Error("Cannot insert into filtered store");2==arguments.length&&(c=arguments[1],b=this.getRecordId(c));c=this.processRawDataItem(c);this.containsId(b)&&(this.suspendAllEvents(),this.removeId(b),this.resumeAllEvents());if(a>=this.length)return this.add(b,c,e);this.length++;this.items.splice(a,0,c);"undefined"!=typeof b&&null!==
b&&(this.map[b]=c);this.keys.splice(a,0,b);c instanceof d&&(c.attachStore(this),this.bindRecord("on",c));this.onAdd(a,[c]);e||this.trigger("add",a,[c]);return c},replace:function(a,b){var c,e;1==arguments.length&&(b=arguments[0],a=this.getRecordId(b));b=this.processRawDataItem(b);c=this.map[a];if("undefined"==typeof a||null===a||"undefined"==typeof c)return this.add(a,b);c instanceof d&&(this.bindRecord("un",c),c.detachStore(this));e=this.indexOfId(a);this.items[e]=b;this.map[a]=b;b instanceof d&&
(this.bindRecord("on",b),b.attachStore(this));this.onReplace(a,c,b);this.trigger("replace",a,c,b);return b},onReplace:h,remove:function(a){return this.removeAt(this.indexOf(a))},removeId:function(a){return this.removeAt(this.indexOfId(a))},contains:function(a){return-1!=this.indexOf(a)},containsId:function(a){return"undefined"!=typeof this.map[a]},clear:function(){var a=this.getRange();this.clearFilter(!0);this._reset();this.onClear();this.trigger("clear",a)},onClear:h,reset:function(){this._reset()},
_reset:function(a){var b,c;if(!a)for(a=0,b=this.items.length;a<b;a++)c=this.items[a],c instanceof d&&(this.bindRecord("un",c),c.detachStore(this));this.totalLength=this.length=this.start=0;this.items=[];this.keys=[];this.map={};this.loaded=this.local},filter:function(a,b,c){this.filtered&&this.clearFilter(!0);this.filtered=!0;this.filterFn=a;this.filterScope=b;this.filterParams=c;this.trigger("beforefilter",this);this.suspendAllEvents();this.filterBackup={length:this.length,items:this.items,keys:this.keys,
map:this.map};this._reset(!0);a=this.filterBackup.keys;b=this.filterBackup.items;c=0;for(var d=b.length;c<d;c++)this._filterRecord(b[c],a[c])&&(this.items.push(b[c]),this.keys.push(a[c]),this.length++,this.map[a[c]]=b[c]);this.resumeAllEvents();this.onFilter();this.trigger("filter",this)},onFilter:h,_filterRecord:function(a,b){return this.filtered&&this.filterFn.call(this.filterScope,a,b,this.filterParams)},clearFilter:function(a){this.filtered&&(a||this.trigger("beforeclearfilter",this),this.suspendAllEvents(),
this.filtered=!1,this._reset(!0),this.length=this.filterBackup.length,this.items=this.filterBackup.items,this.keys=this.filterBackup.keys,this.map=this.filterBackup.map,this.filterBackup=null,this.resumeAllEvents(),this.onClearFilter(),a||this.trigger("clearfilter",this))},onClearFilter:h,getAt:function(a){return this.items[a]||null},getById:function(a){return this.map[a]||null},indexOf:function(a){return this.items.indexOf(a)},indexOfId:function(a){return this.keys.indexOf(a)},each:function(a,b){var c=
[].concat(this.items);b=b||window;for(var d=0,e=c.length;d<e&&!1!==a.call(b,c[d],d,e);d++);},eachId:function(a,b){b=b||window;for(var c=0,d=this.keys.length;c<d;c++)a.call(b,this.keys[c],this.items[c],c,d)},collect:function(a){var b=[],c=!this.model.isPlain();this.each(function(d){(d=c?d.get(a):d[a])&&b.push(d)});return b},first:function(){return this.items[0]},last:function(){return this.items[this.length-1]},getRange:function(a,b){var c=this.items;if(1>c.length)return[];a=a||0;b=Math.min("undefined"==
typeof b||null===b?this.length-1:b,this.length-1);var d,e=[];if(a<=b)for(d=a;d<=b;d++)e[e.length]=c[d];else for(d=a;d>=b;d--)e[e.length]=c[d];return e},findBy:function(a,b,c){a=this.findIndexBy(a,b,c);return-1==a?null:this.getAt(a)},findIndexBy:function(a,b,c){b=b||this;var d=this.keys,e=this.items;c=c||0;for(var f=e.length;c<f;c++)if(a.call(b,e[c],d[c]))return c;return-1},find:function(a,b,c){var d=!this.model.isPlain(),e;return this.findIndexBy(function(f){e=d?f.get(a):f[a];return c?e===b:e==b},
this)},findExact:function(a,b){return this.find(a,b,!0)},findBySet:function(a){var b=null,c,d;this.each(function(e){c=!0;for(d in a)if(a[d]!=e[d]){c=!1;break}return c?(b=e,!1):!0});return b},onDestroy:function(){delete n[this.id];this.clear();this.supr()}},{createFromSelect:function(a){var b=[];a=a.options;for(var c=0,d=a.length;c<d;c++){var e=a[c],f=(e.hasAttribute?e.hasAttribute("value"):e.getAttributeNode("value").specified)?e.value:e.text;b.push([f,e.text])}a=p("MetaphorJs.data.Store",{server:{load:{id:0}}});
a.loadArray(b);return a},lookupStore:function(a){return n[a]||null},eachStore:function(a,b){for(var c in n)if(!1===a.call(b||window,n[c]))break}})})();
(function(){var m={show:["mjs-show"],hide:["mjs-hide"],enter:["mjs-enter"],leave:["mjs-leave"],move:["mjs-move"]},n=["Moz","Webkit","ms","O","Khtml"],p="animationDelay",e="animationDuration",d="transitionDelay",f="transitionDuration",g=0,h=function(){var a=document.createElement("div"),b=!1,c,g,h;if(void 0!==a.style.animationName)b=!0;else for(g=0,h=n.length;g<h;g++)if(c=n[g],void 0!==a.style[c+"AnimationName"]){b=!0;p=c+"AnimationDelay";e=c+"AnimationDuration";d=c+"TransitionDelay";f=c+"TransitionDuration";
break}return b}(),k=window.requestAnimationFrame?window.requestAnimationFrame:function(a){window.setTimeout(a,0)},a=MetaphorJs.g,b=MetaphorJs.lib.Promise,c=MetaphorJs.data,l=MetaphorJs.isThenable,s=function(a,b,c){var d=function(){(new Date).getTime()-b>=c?a():k(d)};k(d)},r=function(a){if(!a)return 0;var b=parseFloat(a);-1==a.indexOf("ms")&&(b*=1E3);return b},t=function(a,b,c){var d,e,f=b.length;for(d=0;d<f;d++)e=r(b[d])+r(c[d]),a=Math.max(e,a);return a},y=function w(a,b,g,x,q,h,G){var m=function(){var b=
c(a,"mjsAnimationQueue");return b&&b.length&&b[0].id==G?!1:(q.reject(a),!0)},n=function(){if(!m())if(u(a,b[g]),u(a,b[g]+"-active"),g++,g==b.length){q.resolve(a);c(a,"mjsAnimationQueue").shift();var d=c(a,"mjsAnimationQueue");d.length?(d=d[0],y(d.el,d.stages,0,d.start,d.deferred,!1,d.id)):c(a,"mjsAnimationQueue",null)}else c(a,"mjsAnimationQueue")[0].position=g,w(a,b,g,null,q)},r=function(){if(!m()){z(a,b[g]+"-active");var c,q=window.getComputedStyle?window.getComputedStyle(a):a.style;c=0;var x=(q[e]||
"").split(","),h=(q[p]||"").split(","),k=(q[f]||"").split(","),q=(q[d]||"").split(",");c=Math.max(c,t(c,x,h));(c=Math.max(c,t(c,k,q)))?s(n,(new Date).getTime(),c):n()}},F=function(){if(!m()){z(a,b[g]);var c;x&&(c=x(a),x=null);l(c)?c.done(r):k(r)}};h?k(F):F()},z=MetaphorJs.addClass,u=MetaphorJs.removeClass;MetaphorJs.stopAnimation=function(a){var b=c(a,"mjsAnimationQueue"),d;b&&b.length&&(d=b[0])&&d.stages&&(b=d.position,d=d.stages,u(a,d[b]),u(a,d[b]+"-active"));c(a,"mjsAnimationQueue",null)};MetaphorJs.animate=
function(d,e,f){var k=d.getAttribute("mjs-animate"),x=d.getAttribute("mjs-animate-js"),q=new b,D=c(d,"mjsAnimationQueue")||[],u=++g,n,p;e&&"string"==typeof e&&(e=m[e]);"string"==typeof k&&k&&"["==k.substr(0,1)&&(e=(new Function("","return "+k))(),k=null);D.push({el:d,stages:e,start:f,deferred:q,position:0,id:u});c(d,"mjsAnimationQueue",D);void 0!=k&&h&&e?1==D.length&&y(d,e,0,f,q,!0,u):(n=x||k)&&(p=a("animate."+n,!0))?p(d,f,q):f?(e=f(d),l(e)?e.done(function(){q.resolve(d)}):q.resolve(d)):q.resolve(d);
return q.promise()}})();
(function(){var m=MetaphorJs.lib.Observable,n=MetaphorJs.lib.Watchable,p=MetaphorJs.apply,e;e=MetaphorJs.d("MetaphorJs.view.Scope",{$parent:null,$root:null,$isRoot:!1,$$observable:null,$$watchers:null,$$checking:!1,$$destroyed:!1,initialize:function(d){this.$$observable=new m;p(this,d);this.$parent?(this.$parent.$on("check",this.$$onParentCheck,this),this.$parent.$on("destroy",this.$$onParentDestroy,this)):(this.$root=this,this.$isRoot=!0)},$new:function(){return new e({$parent:this,$root:this.$root})},
$on:function(d,e,g){return this.$$observable.on(d,e,g)},$un:function(d,e,g){return this.$$observable.un(d,e,g)},$watch:function(d,e,g){n.create(this,d,e,g,null)},$unwatch:function(d,e,g){n.unsubscribeAndDestroy(this,d,e,g)},$get:function(d){for(var e=this;e;){if(void 0!=e[d])return e[d];e=e.$parent}},$$onParentDestroy:function(){this.$destroy()},$$onParentCheck:function(){this.$check()},$check:function(){var d;this.$$checking||(this.$$checking=!0,this.$$watchers&&(d=this.$$watchers.$checkAll()),this.$$checking=
!1,this.$$destroyed||this.$$observable.trigger("check",d))},$destroy:function(){this.$$observable.trigger("destroy");this.$$observable.destroy();delete this.$$observable;this.$$watchers&&(this.$$watchers.$destroyAll(),delete this.$$watchers);this.$$destroyed=!0}})})();
(function(){var m=navigator.userAgent.toLowerCase(),n=parseInt((/msie (\d+)/.exec(m)||[])[1],10),p=parseInt((/android (\d+)/.exec(m)||[])[1],10),e={};isNaN(n)&&(n=parseInt((/trident\/.*; rv:(\d+)/.exec(m)||[])[1],10));MetaphorJs.browser={android:p,hasEvent:function(d){if("input"==d&&9==n)return!1;if(void 0===e[d]){var f=document.createElement("div");e[d]="on"+d in f}return e[d]}}})();
(function(){var m=MetaphorJs.nextUid,n=MetaphorJs.view.Scope,p=MetaphorJs.lib.Watchable,e=MetaphorJs.lib.Observable,d=MetaphorJs.isThenable,f=MetaphorJs.toArray,g=MetaphorJs.getAttributeHandlers,h=null,k=MetaphorJs.g,a=MetaphorJs.trim,b=p.create,c=p.unsubscribeAndDestroy,l,s="string"==typeof document.createTextNode("").textContent?"textContent":"nodeValue",r=function(a,b,c,d,e){var g=[];if(a&&!0!==a){if(a.nodeType){y(a,c,d,e);return}g=f(a)}g.length||(g=f(b.childNodes));a=-1;for(b=g.length>>>0;++a!==
b;y(g[a],c,d,e));},t=/^(script|template|mjs-template|style)$/i,y=function(a,b,c,e){var f;a.nodeName.match(t)||!1!==(f=b.call(c,a,e))&&(d(f)?f.done(function(d){r(d,a,b,c,e)}):r(f,a,b,c,e))},z=new e;l=MetaphorJs.d("MetaphorJs.view.Renderer",{id:null,el:null,scope:null,texts:null,parent:null,destroyed:!1,_observable:null,initialize:function(a,b,c){this.id=m();this.el=a;this.scope=b;this.texts=[];this.parent=c;b instanceof n&&b.$on("destroy",this.destroy,this);if(c)c.on("destroy",this.destroy,this);this.process()},
on:function(a,b,c){return z.on(a+"-"+this.id,b,c)},un:function(a,b,c){return z.un(a+"-"+this.id,b,c)},createChild:function(a){return new l(a,this.scope,this)},reset:function(){},getEl:function(){return this.el},runHandler:function(a,b,c,d){var e;if(a.$breakRenderer)return this.createChild(c).render(),!1;a.$isolateScope?e=new n:a.$breakScope?b instanceof n?e=b.$new():(e={},e.$parent=b,e.$root=b.$root):e=b;return a.__isMetaphorClass?(b=new a(e,c,d,this),a.$stopRenderer||b.$stopRenderer?!1:b.$returnToRenderer):
a(e,c,d,this)},processNode:function(a,b){var c=a.nodeType,d=this.texts,e=this.scope,f;if(3==c)e={watchers:[],node:a,text:"",inx:f=d.length},this.processText(e,a[s]),0<e.watchers.length&&(d.push(e),b&&this.renderText(f));else if(1==c){h||(h=g());var x=a.attributes,q,l,m,n,c="tag."+a.tagName.toLowerCase();if(q=k(c,!0))if((n=this.runHandler(q,e,a))||!1===n)return n;q=0;for(l=h.length;q<l;q++)if(m=h[q].name,null!==(f=a.getAttribute(m))&&"undefined"!=typeof f&&(n=this.runHandler(h[q].handler,e,a,f),a.removeAttribute(m),
n||!1===n))return n;q=0;for(l=x.length;q<l;q++)k(c,!0)||(e={watchers:[],node:a,attr:x[q].name,text:"",inx:f=d.length},this.processText(e,x[q].value),0<e.watchers.length&&(d.push(e),b&&this.renderText(f)))}return!0},process:function(){y(this.el,this.processNode,this)},processText:function(a,b){for(var c=0,d=b.length,e,f,g=[];c<d;)if(-1!=(e=b.indexOf("{{",c))&&-1!=(f=b.indexOf("}}",e+2)))g.push(b.substring(c,e)),g.push(this.watcherMatch(a,b.substring(e+2,f))),c=f+2;else{c!==d&&g.push(b.substring(c));
break}return a.text=g.join("")},processPipes:function(b,c){for(var d=0,e=b.length,f,g,h,q=!1,k=b;d<e;)if(-1!=(f=b.indexOf("|",d)))g=b.charAt(f-1),h=b.charAt(f+1),"|"!=g&&"'"!=g&&'"'!=g&&"|"!=h&&"'"!=h&&'"'!=h&&(q?(d=a(b.substring(d,f)).split(":"),c.push([d[0],d.slice(1)])):(q=!0,k=a(b.substring(0,f)))),d=f+1;else{q&&(d=a(b.substr(d)).split(":"),c.push([d[0],d.slice(1)]));break}return k},watcherMatch:function(a,c){var d=[],e=a.watchers;c=this.processPipes(c,d);e.push({watcher:b(this.scope,c,this.onDataChange,
this,a.inx),pipes:d});return"---"+(e.length-1)+"---"},onDataChange:function(a,b,c){this.renderText(c)},render:function(){var a=this.texts.length,b;for(b=0;b<a;b++)this.renderText(b)},renderText:function(a){a=this.texts[a];var b=a.text,c=a.watchers,d=c.length,e=a.attr,f,g,q,h,l,m;for(f=0;f<d;f++){g=c[f].watcher.getLastResult();l=c[f].pipes;h=l.length;for(q=0;q<h;q++)m=l[q][1].slice(),m.unshift(g),g=k("filter."+l[q][0],!0).apply(a.node,m);b=b.replace("---"+f+"---",g)}e?(a.node.setAttribute(e,b),"value"==
e&&(a.node.value=b)):a.node[s]=b},destroy:function(){var a=this.texts,b,d,e,f,g;if(!this.destroyed){this.destroyed=!0;d=0;for(e=a.length;d<e;d++)for(b=a[d].watchers,f=0,g=b.length;f<g;f++)c(this.scope,b[f].watcher.code,this.onDataChange,this);this.parent&&this.parent.un("destroy",this.destroy,this);z.trigger("destroy-"+this.id);this.parent=this.scope=this.el=this.texts=null}}},{eachNode:y});MetaphorJs.onReady(function(){var a=MetaphorJs.app;if(document.querySelectorAll)for(var b=document.querySelectorAll("[mjs-app]"),
c=-1,d=b.length;++c<d;a(b[c]));else y(document.documentElement,function(b){if(b.hasAttribute("mjs-app"))return a(b),!1})})})();
(function(){var m={},n=MetaphorJs.nextUid,p=MetaphorJs.getTemplate,e=MetaphorJs.view.Renderer,d=MetaphorJs.data,f=MetaphorJs.toFragment,g=MetaphorJs.isThenable,h=MetaphorJs.emptyFn,k=function(a){return m[a]||null};MetaphorJs.define("MetaphorJs.cmp.Component","MetaphorJs.cmp.Base",{id:null,originalId:!1,node:null,renderTo:null,rendered:!1,hidden:!1,destroyEl:!0,renderer:null,scope:null,template:null,propertyAttr:null,tag:null,initPromise:null,initialize:function(a){this.supr(a);this.node&&(this.id=
this.node.getAttribute("id"))&&(this.originalId=!0);this.id=this.id||"cmp-"+n();m[this.id]=this;var b=this.initComponent.apply(this,arguments);g(b)?(this.initPromise=b,this.node&&(this.node.style.visibility="hidden"),b.done(this.finishInitialize,this)):this.finishInitialize()},finishInitialize:function(){this.initPromise=null;this.node&&(this.node.style.visibility="");this.node?this.template&&this._applyTemplate():this._createNode();this._initElement();!this.node.parentNode&&this.renderTo?this.render(this.renderTo):
this.node&&this.render()},_createNode:function(){var a,b;this.tag?this.node=document.createElement(this.tag):(b=p(this.template)||this.template,"string"==typeof b&&(a=document.createElement("div"),a.innerHTML=b,b=f(a.childNodes)),1==b.childNodes.length?this.node=b.firstChild.cloneNode(!0):(this.node=document.createElement("div"),this.node.appendChild(b.cloneNode(!0))))},_applyTemplate:function(){var a=this.node,b=p(this.template)||this.template,c;"string"==typeof b?(c=document.createElement("div"),
c.innerHTML=b,b=f(c.childNodes)):b=MetaphorJs.clone(b);a.firstChild&&d(this.node,"mjs-transclude",f(a.childNodes));a.appendChild(b)},_initElement:function(){var a=this,b=a.node,c=a.propertyAttr;b.setAttribute("id",a.id);b.setAttribute("cmp-id",a.id);a.hidden&&(b.style.display="none");a.renderer=new e(a.node,a.scope);a.renderer.render();c&&window.jQuery&&$(b).find("["+c+"]").each(function(){var b=$(this),d=b.attr(c);a[d]?a[d].add(b):a[d]=b})},render:function(a){this.rendered||(a&&a.appendChild(this.node),
this.hidden=!MetaphorJs.isVisible(this.node),this.rendered=!0,this.trigger("render",this),this.afterRender(),this.trigger("afterrender",this))},show:function(){this.hidden&&!1!==this.trigger("beforeshow",this)&&(this.node.style.display="block",this.hidden=!1,this.onShow(),this.trigger("show",this))},hide:function(){this.hidden||!1===this.trigger("beforehide",this)||(this.node.style.display="none",this.hidden=!0,this.onHide(),this.trigger("hide",this))},isHidden:function(){return this.hidden},isRendered:function(){return this.rendered},
isDestroyed:function(){return this.destroyed},getEl:function(){return this.node},initComponent:h,afterRender:h,onShow:h,onHide:h,onDestroy:function(){this.destroyEl?(console.log("destroy"),this.node.parentNode&&this.node.parentNode.removeChild(this.node)):(this.node.removeAttribute("cmp-id"),this.originalId||this.node.removeAttribute("id"));this.rendered&&(this.renderer.destroy(),delete this.renderer);this.scope.$destroy();delete this.scope;delete this.node;this.supr();delete m[this.id]}});MetaphorJs.getCmp=
k;window.jQuery&&(jQuery.fn.createCmp=function(a,b){var c=null;a&&"string"!=typeof a&&(b=a,a=null);a=a||"MetaphorJs.cmp.Component";b=b||{};this.each(function(){var d=$(this).attr("cmp-id");if(d)return c=k(d),!1;b.node=this;c=MetaphorJs.create(a,b);return!1});return c},jQuery.fn.getCmp=function(){return k(this.attr("cmp-id"))},jQuery.fn.getParentCmp=function(){if(this.attr("cmp-id"))return MetaphorJs.getCmp(this.attr("cmp-id"));var a=this.parents("[cmp-id]").eq(0);return a.length?MetaphorJs.getCmp(a.attr("cmp-id")):
null})})();
(function(){var m=MetaphorJs.data,n=MetaphorJs.currentUrl,p=MetaphorJs.toFragment,e=MetaphorJs.ns.get,d=MetaphorJs.animate,f=MetaphorJs.lib.Scope,g=MetaphorJs.apply,h=MetaphorJs.stopAnimation;MetaphorJs.define("MetaphorJs.cmp.View",{route:null,node:null,scope:null,currentComponent:null,initialize:function(d){g(this,d,!0);MetaphorJs.on("locationchange",this.onLocationChange,this);d=this.node;d.firstChild&&m(d,"mjs-transclude",p(d.childNodes));this.onLocationChange()},onLocationChange:function(){var d=n(),
a=this.route,b,c,e,f;b=0;for(c=a.length;b<c;b++)if(e=a[b],f=d.match(e.reg)){this.changeComponent(e,f);return}this.clearComponent()},changeComponent:function(d,a){h(this.node);this.clearComponent();this.setComponent(d,a)},clearComponent:function(){var e=this,a=e.node;e.currentComponent&&d(a,"leave").done(function(){e.currentComponent.destroy();for(e.currentComponent=null;a.firstChild;)a.removeChild(a.firstChild)})},setComponent:function(g,a){var b=this,c=b.node;d(c,"enter",function(){var d=e(g.cmp||
"MetaphorJs.cmp.Component"),h={destroyEl:!1,node:c,scope:g.isolateScope?new f:b.scope.$new()};g.template&&(h.template=g.template);a.shift();a.unshift(h);b.currentComponent=d.__instantiate.apply(null,a);return b.currentComponent.initPromise})}})})();
(function(){var m=MetaphorJs.view.Scope,n=MetaphorJs.trim,p=MetaphorJs.bind,e=MetaphorJs.define,d=MetaphorJs.ns.get,f=MetaphorJs.lib.Watchable,g=MetaphorJs.view.Renderer,h=MetaphorJs.lib.Promise,k=MetaphorJs.data,a=MetaphorJs.toArray,b=MetaphorJs.toFragment,c=MetaphorJs.addListener,l=MetaphorJs.removeListener,s=MetaphorJs.normalizeEvent,r=MetaphorJs.registerAttributeHandler,t=MetaphorJs.registerTagHandler,y=MetaphorJs.async,z=f.create,u=f.createGetter,v=MetaphorJs.animate,w=function(a,b){for(var c;a;){c=
k(a,b);if(void 0!=c)return c;a=a.parentNode}};MetaphorJs.d("MetaphorJs.view.AttributeHandler",{watcher:null,scope:null,node:null,expr:null,initialize:function(a,b,c){c=n(c);this.node=b;this.expr=c;this.scope=a;this.watcher=z(a,c);this.watcher.addListener(this.onChange,this);this.onChange();a instanceof m&&a.$on("destroy",this.onScopeDestroy,this)},onScopeDestroy:function(){delete this.node;delete this.scope;this.watcher&&(this.watcher.unsubscribeAndDestroy(this.onChange,this),delete this.watcher)},
onChange:function(){}});r("mjs-bind",1E3,e(null,"MetaphorJs.view.AttributeHandler",{isInput:!1,initialize:function(a,b,c){var d=b.tagName.toLowerCase();this.isInput="input"==d||"textarea"==d;this.supr(a,b,c)},onChange:function(){var a=this.watcher.getLastResult();this.isInput?this.node.value=a:this.node.textContent=a}}));r("mjs-bind-html",1E3,e(null,"MetaphorJs.view.AttributeHandler",{onChange:function(){this.node.innerHTML=this.watcher.getLastResult()}}));r("mjs-model",1E3,e(null,"MetaphorJs.view.AttributeHandler",
{inProg:!1,type:null,inputType:null,radio:null,listeners:null,initialize:function(a,b,c){var d;this.node=b;this.inputType=d=b.getAttribute("mjs-input-type")||b.type.toLowerCase();this.listeners=[];this.onRadioInputChangeDelegate=p(this.onRadioInputChange,this);this.onCheckboxInputChangeDelegate=p(this.onCheckboxInputChange,this);"radio"==d?this.initRadioInput():"checkbox"==d?this.initCheckboxInput():this.initTextInput();this.supr(a,b,c)},onScopeDestroy:function(){var a=this.type,b=this.listeners,
c=this.radio,d,e,f,g;d=0;for(e=b.length;d<e;d++)if("radio"==a)for(f=0,g=c.length;f<g;f++)l(c[f],b[d][0],b[d][1]);else l(this.node,b[d][0],b[d][1]);delete this.radio;this.supr()},initRadioInput:function(){var b,d,e;this.radio=b=a(document.querySelectorAll("input[name="+this.node.name+"]"));this.listeners.push(["click",this.onRadioInputChangeDelegate]);d=0;for(e=b.length;d<e;d++)c(b[d],"click",this.onRadioInputChangeDelegate)},initCheckboxInput:function(){this.listeners.push(["click",this.onCheckboxInputChangeDelegate]);
c(this.node,"click",this.onCheckboxInputChangeDelegate)},initTextInput:function(){var a=MetaphorJs.browser,b=!1,d=this,e=d.node,f=d.listeners,g;if(!a.android){var h=function(){b=!0},k=function(){b=!1;l()};f.push(["compositionstart",h]);f.push(["compositionend",k]);c(e,"compositionstart",h);c(e,"compositionend",k)}var l=d.onTextInputChangeDelegate=function(){if(!b)d.onTextInputChange()};if(a.hasEvent("input"))f.push(["input",l]),c(e,"input",l);else{var m=function(a){g||(g=window.setTimeout(function(){l(a);
g=null},0))},h=function(a){a=a||window.event;var b=a.keyCode;91===b||15<b&&19>b||37<=b&&40>=b||m(a)};f.push(["keydown",h]);c(e,"keydown",h);a.hasEvent("paste")&&(f.push(["paste",m]),f.push(["cut",m]),c(e,"paste",m),c(e,"cut",m))}f.push(["change",l]);c(e,"change",l)},onTextInputChange:function(){var a=this.node.value,b=this.scope;switch(this.inputType){case "number":a=parseInt(a,10)}this.watcher.setValue(a);this.inProg=!0;b instanceof m?b.$root.$check():this.watcher.checkAll();this.inProg=!1},onCheckboxInputChange:function(){var a=
this.node,b=this.scope;this.watcher.setValue(a.checked?a.value||!0:!1);this.inProg=!0;b instanceof m?b.$root.$check():this.watcher.checkAll();this.inProg=!1},onRadioInputChange:function(a){a=a||window.event;a=s(a);var b=this.scope;this.watcher.setValue(a.target.value);this.inProg=!0;b instanceof m?b.$root.$check():this.watcher.checkAll();this.inProg=!1},onChange:function(){var a=this.watcher.getLastResult(),b=this.inputType,c,d;if(!this.inProg)if("radio"==b)for(d=this.radio,b=0,c=d.length;b<c;b++){if(d[b].value==
a){d[b].checked=!0;break}}else"checkbox"==b?(b=this.node,b.checked=!0===a||a==b.value):MetaphorJs.setValue(this.node,a)}}));r("mjs-show",500,e(null,"MetaphorJs.view.AttributeHandler",{display:null,initial:!0,initialize:function(a,b,c){this.display=b.style.display||"block";"none"==this.display&&(this.display="block");this.supr(a,b,c)},runAnimation:function(a){var b=this.node.style,c=this.display,d=function(){b.display=a?c:"none"};this.initial?d():v(this.node,a?"show":"hide",function(){a&&(b.display=
c)}).done(d)},onChange:function(){var a=this.watcher.getLastResult();this.runAnimation(a);this.initial=!1}}));r("mjs-hide",500,e(null,"attr.mjs-show",{onChange:function(){var a=this.watcher.getLastResult();this.runAnimation(!a);this.initial=!1}}));r("mjs-if",500,e(null,"MetaphorJs.view.AttributeHandler",{parentEl:null,prevEl:null,el:null,initial:!0,initialize:function(a,b,c){this.parentEl=b.parentNode;this.prevEl=b.previousSibling;this.supr(a,b,c)},onScopeDestroy:function(){delete this.prevEl;delete this.parentEl;
this.supr()},onChange:function(){var a=this,b=a.watcher.getLastResult(),c=a.parentEl,d=a.node,e=function(){a.prevEl?c.insertBefore(d,a.prevEl?a.prevEl.nextSibling:null):c.appendChild(d)},f=function(){c.removeChild(d)};b?d.parentNode||(a.initial?e():v(d,"enter",e)):d.parentNode&&(a.initial?f():v(d,"leave").done(f));a.initial=!1}}));r("mjs-each",100,e(null,"MetaphorJs.view.AttributeHandler",{model:null,itemName:null,tpl:null,renderers:null,parentEl:null,prevEl:null,nextEl:null,initialize:function(a,
b,c){this.parseExpr(c);b.removeAttribute("mjs-each");b.removeAttribute("mjs-include");this.tpl=b;this.renderers=[];this.prevEl=b.previousSibling;this.nextEl=b.nextSibling;this.parentEl=b.parentNode;this.node=b;this.scope=a;this.watcher=z(a,this.model);this.watcher.addListener(this.onChange,this);this.parentEl.removeChild(b);this.render(this.watcher.getValue())},onScopeDestroy:function(){var a=this.renderers,b,c;b=0;for(c=a.length;b<c;b++)a[b].renderer.destroy();delete this.renderers;delete this.tpl;
delete this.prevEl;delete this.nextEl;delete this.parentEl;this.supr()},doUpdate:function(a,b){for(var c=this.renderers,d=b,e=c.length,f=e-1,h=!(d%2),k,l;d<e;d++)k=c[d],l=k.scope,l.$index=d,l.$first=0===d,l.$last=d===f,l.$even=h,l.$odd=!h,h=!h,k.renderer?l.$check():(k.renderer=new g(k.el,k.scope),k.renderer.render())},render:function(a){var b=this.renderers,c=this.tpl,d=this.parentEl,e=this.nextEl,f=document.createDocumentFragment(),g,h,k;h=0;for(k=a.length;h<k;h++)g=c.cloneNode(!0),f.appendChild(g),
b.push(this.createItem(g,a,h));d.insertBefore(f,e);this.doUpdate(a,0)},createItem:function(a,b,c){var d=this.itemName,e=this.scope,e=e instanceof m?e.$new():{$parent:e,$root:e.$root};e[d]=b[c];return{el:a,scope:e}},onChange:function(a){var b=this,c=b.renderers;a=a.prescription;var d=b.tpl,e=0,f=b.parentEl,g=b.watcher.getValue(),h=null,k,l,n,p;l=0;for(n=a.length;l<n;l++)p=a[l],"-"==p?(c[e].scope.$index=e,e++):(null===h&&(h=0<l?l-1:0),c[e]&&(k=c[e],k.scope instanceof m&&k.scope.$destroy(),k.renderer.destroy(),
v(k.el,"leave").done(function(a){a.parentNode&&a.parentNode.removeChild(a)})),"D"==p?c.splice(e,1):(k=d.cloneNode(!0),v(k,"enter",function(a){return function(d){0<a?f.insertBefore(d,c[a-1].el.nextSibling):b.prevEl?f.insertBefore(d,b.prevEl.nextSibling):f.appendChild(d)}}(e)),"R"==p?c[l]=b.createItem(k,g,e):"I"==p&&(l>c.length-1?c.splice(l,0,b.createItem(k,g,e)):c.push(b.createItem(k,g,e))),e++));b.doUpdate(g,h)},parseExpr:function(a){a=a.split(" ");var b,c,d,e,f;b=0;for(c=a.length;b<c;b++)if(f=a[b],
""!=f&&"in"!=f)if(e){d=f;"."==d.charAt(0)&&(d=d.substr(1));break}else e=f;this.model=d;this.itemName=e||"item"}},{$stopRenderer:!0}));r("mjs-each-in-store",100,e(null,"attr.mjs-each",{store:null,initialize:function(a,b,c){this.parseExpr(c);b.removeAttribute("mjs-each-in-store");b.removeAttribute("mjs-include");this.tpl=b;this.renderers=[];this.prevEl=b.previousSibling;this.nextEl=b.nextSibling;this.parentEl=b.parentNode;this.node=b;this.scope=a;this.store=a=u("."+this.model)(a);this.parentEl.removeChild(b);
this.initWatcher();this.render(this.watcher.getValue());y(this.bindStore,this,[a,"on"])},onScopeDestroy:function(){this.bindStore(this.store,"un");delete this.store;this.supr()},initWatcher:function(){this.watcher=z(this.store,".items",null);this.watcher.addListener(this.onChange,this)},resetWatcher:function(){this.watcher.setValue(this.store.items)},bindStore:function(a,b){a[b]("load",this.onStoreUpdate,this);a[b]("update",this.onStoreUpdate,this);a[b]("add",this.onStoreUpdate,this);a[b]("remove",
this.onStoreUpdate,this);a[b]("replace",this.onStoreUpdate,this);a[b]("filter",this.onStoreFilter,this);a[b]("clearfilter",this.onStoreFilter,this);a[b]("clear",this.onStoreClear,this);a[b]("destroy",this.onStoreDestroy,this)},onStoreUpdate:function(){this.watcher.check()},onStoreFilter:function(){this.resetWatcher();this.onStoreUpdate()},onStoreClear:function(){this.resetWatcher();this.onStoreUpdate()},onStoreDestroy:function(){this.onStoreClear();this.watcher.unsubscribeAndDestroy(this.onChange,
this);delete this.watcher}},{$stopRenderer:!0}));var B=MetaphorJs.getTemplate;r("mjs-include",900,e(null,{watcher:null,scope:null,node:null,expr:null,tpl:null,renderer:null,$stopRenderer:!1,initial:!0,initialize:function(a,c,d,e){var f;this.node=c;this.scope=a;c.firstChild&&k(c,"mjs-transclude",b(c.childNodes));c.removeAttribute("mjs-include");(f=B(d))?this.$returnToRenderer=this.applyTemplate(c,f):(this.watcher=z(a,d),this.watcher.addListener(this.onChange,this),this.$stopRenderer=!0,this.$returnToRenderer=
this.onChange(),e.on("destroy",this.onParentRendererDestroy,this));a instanceof m&&a.$on("destroy",this.onScopeDestroy,this)},onChange:function(){var a=this,b=a.watcher.getLastResult();a.renderer&&a.renderer.destroy();return a.applyTemplate(a.node,B(b)).done(function(){a.renderer=new g(a.node,a.scope);a.renderer.render()})},applyTemplate:function(a,b){var c=new h,d=function(){for(;a.firstChild;)a.removeChild(a.firstChild);b&&a.appendChild(MetaphorJs.clone(b));c.resolve()};this.initial?d():(v(a,"leave").done(d),
v(a,"enter"));this.initial=!1;return c.promise()},onParentRendererDestroy:function(){this.renderer.destroy();this.destroy();delete this.renderer},onScopeDestroy:function(){this.destroy();delete this.renderer},destroy:function(){delete this.node;delete this.scope;this.watcher&&(this.watcher.unsubscribeAndDestroy(this.onChange,this),delete this.watcher);delete this.tpl}}));t("mjs-include",900,function(c,d){var e=d.getAttribute("src"),f=B(e);d.firstChild&&k(d,"mjs-transclude",b(d.childNodes));var e=
d.parentNode,g=d.nextSibling,f=MetaphorJs.clone(f),l=a(f.childNodes),m=new h;e.removeChild(d);e.insertBefore(f,g);v(d,"enter").done(function(){m.resolve(l)});return m.promise()});r("mjs-transclude",1E3,function(c,d){var e=w(d,"mjs-transclude");if(e){d.firstChild&&k(d,"mjs-transclude",b(d.childNodes));var f=d.parentNode,g=d.nextSibling,e=MetaphorJs.clone(e),h=a(e.childNodes);f.removeChild(d);f.insertBefore(e,g);return h}});t("mjs-transclude",900,function(c,d){var e=w(d,"mjs-transclude");if(e){d.firstChild&&
k(d,"mjs-transclude",b(d.childNodes));var f=d.parentNode,g=d.nextSibling,e=MetaphorJs.clone(e),h=a(e.childNodes);f.removeChild(d);f.insertBefore(e,g);return h}});r("mjs-class",1E3,e(null,"MetaphorJs.view.AttributeHandler",{onChange:function(){var a=this.node,b=this.watcher.getLastResult(),c;for(c in b)MetaphorJs[b[c]?"addClass":"removeClass"](a,c)}}));var t="click dblclick mousedown mouseup mouseover mouseout mousemove mouseenter mouseleave keydown keyup keypress submit focus blur copy cut paste enter".split(" "),
C,E=f.createFunc,f=0;for(C=t.length;f<C;f++)(function(a){var b=a;"enter"==b&&(b="keyup");r("mjs-"+a,1E3,function(d,e,f){var g=E(f);c(e,b,function(b){b=b||window.event;b=s(b);if("enter"==a&&13!=b.keyCode)return null;d.$event=b;g(d);delete d.$event;d instanceof m?d.$root.$check():d.$$watchers&&d.$$watchers.$checkAll();b.preventDefault();return!1})})})(t[f]);t="selected checked disabled readonly required open".split(" ");f=0;for(C=t.length;f<C;f++)(function(a){r("mjs-"+a,1E3,e(null,"MetaphorJs.view.AttributeHandler",
{onChange:function(){this.watcher.getLastResult()?this.node.setAttribute(a,!0):this.node.removeAttribute(a)}}))})(t[f]);t=function(a,b,c){var e,f,g,h,k;b.removeAttribute("mjs-cmp");c=c.split(" ");g=0;for(h=c.length;g<h;g++)k=c[g],""!=k&&"as"!=k&&(e?f=k:e=k);b=new (d(e))({scope:a,node:b});f&&(a[f]=b);return b.$returnToRenderer||!1};t.$breakScope=!0;r("mjs-cmp",200,t);r("mjs-view",200,function(a,b,c){b.removeAttribute("mjs-view");var e=d(c);if(e)new e({scope:a,node:b});else throw"View '"+c+"' not found";
return!1});r("mjs-init",150,function(a,b,c){b.removeAttribute("mjs-init");E(c)(a)})})();
(function(){var m=MetaphorJs.add,n=MetaphorJs.numberFormats,p=MetaphorJs.dateFormats;m("filter.toUpper",function(e){return e.toUpperCase()});m("filter.toLower",function(e){return e.toLowerCase()});m("filter.limitTo",function(e,d){var f=typeof e;if(!MetaphorJs.isArray(e)&&"string"!=f)return e;d=Infinity===Math.abs(Number(d))?Number(d):parseInt(d,10);if("string"==f)return d?0<=d?e.slice(0,d):e.slice(d,e.length):"";var f=[],g,h;d>e.length?d=e.length:d<-e.length&&(d=-e.length);0<d?(g=0,h=d):(g=e.length+
d,h=e.length);for(;g<h;g++)f.push(e[g]);return f});m("filter.ucfirst",function(e){return e.substr(0,1).toUpperCase()+e.substr(1)});m("filter.numeral",function(e,d){d=d||this.getAttribute("mjs-numeral-format");d=n[d]||d;return numeral(e).format(d)});m("filter.moment",function(e,d){d=d||this.getAttribute("mjs-moment-format");d=p[d]||d;return moment(e).format(d)})})();
